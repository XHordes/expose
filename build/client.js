"use strict";const t=(t,e,s)=>s.items[t]["book"==t?Math.floor(e/5):e],e=(e,s,i)=>t(e,s,i).name+("book"==e?" Lv. "+(s%5+1):""),s=(e,s,i)=>t(e,s,i).description;function i(){}const n=t=>t;function a(t,e){for(const s in e)t[s]=e[s];return t}function r(t){return t()}function o(){return Object.create(null)}function l(t){t.forEach(r)}function c(t){return"function"==typeof t}function d(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function h(t,e){return t!=t?e==e:t!==e}function u(t){return 0===Object.keys(t).length}function m(t,...e){if(null==t)return i;const s=t.subscribe(...e);return s.unsubscribe?()=>s.unsubscribe():s}function p(t,e,s){t.$$.on_destroy.push(m(e,s))}function f(t,e,s,i){if(t){const n=g(t,e,s,i);return t[0](n)}}function g(t,e,s,i){return t[1]&&i?a(s.ctx.slice(),t[1](i(e))):s.ctx}function v(t,e,s,i){if(t[2]&&i){const n=t[2](i(s));if(void 0===e.dirty)return n;if("object"==typeof n){const t=[],s=Math.max(e.dirty.length,n.length);for(let i=0;i<s;i+=1)t[i]=e.dirty[i]|n[i];return t}return e.dirty|n}return e.dirty}function y(t,e,s,i,n,a,r){const o=v(e,i,n,a);if(o){const n=g(e,s,i,r);t.p(n,o)}}function b(t){return null==t?"":t}function x(t,e,s=e){return t.set(s),e}const w="undefined"!=typeof window;let k=w?()=>window.performance.now():()=>Date.now(),$=w?t=>requestAnimationFrame(t):i;const S=new Set;function M(t){S.forEach(e=>{e.c(t)||(S.delete(e),e.f())}),0!==S.size&&$(M)}function E(t){let e;return 0===S.size&&$(M),{promise:new Promise(s=>{S.add(e={c:t,f:s})}),abort(){S.delete(e)}}}function C(t,e){t.appendChild(e)}function T(t,e,s){t.insertBefore(e,s||null)}function I(t){t.parentNode.removeChild(t)}function P(t,e){for(let s=0;s<t.length;s+=1)t[s]&&t[s].d(e)}function B(t){return document.createElement(t)}function F(t){return document.createTextNode(t)}function z(){return F(" ")}function U(){return F("")}function D(t,e,s,i){return t.addEventListener(e,s,i),()=>t.removeEventListener(e,s,i)}function A(t,e,s){null==s?t.removeAttribute(e):t.getAttribute(e)!==s&&t.setAttribute(e,s)}function R(t){return""===t?void 0:+t}function L(t){return Array.from(t.childNodes)}function O(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function _(t,e){t.value=null==e?"":e}function N(t,e,s,i){t.style.setProperty(e,s,i?"important":"")}function Z(t,e){for(let s=0;s<t.options.length;s+=1){const i=t.options[s];if(i.__value===e)return void(i.selected=!0)}}function q(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function G(t,e){const s=document.createEvent("CustomEvent");return s.initCustomEvent(t,!1,!1,e),s}class H{constructor(t=null){this.a=t,this.e=this.n=null}m(t,e,s=null){this.e||(this.e=B(e.nodeName),this.t=e,this.h(t)),this.i(s)}h(t){this.e.innerHTML=t,this.n=Array.from(this.e.childNodes)}i(t){for(let e=0;e<this.n.length;e+=1)T(this.t,this.n[e],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(I)}}const X=new Set;let j,J=0;function V(t){let e=5381,s=t.length;for(;s--;)e=(e<<5)-e^t.charCodeAt(s);return e>>>0}function Y(t,e,s,i,n,a,r,o=0){const l=16.666/i;let c="{\n";for(let t=0;t<=1;t+=l){const i=e+(s-e)*a(t);c+=100*t+`%{${r(i,1-i)}}\n`}const d=c+`100% {${r(s,1-s)}}\n}`,h=`__svelte_${V(d)}_${o}`,u=t.ownerDocument;X.add(u);const m=u.__svelte_stylesheet||(u.__svelte_stylesheet=u.head.appendChild(B("style")).sheet),p=u.__svelte_rules||(u.__svelte_rules={});p[h]||(p[h]=!0,m.insertRule(`@keyframes ${h} ${d}`,m.cssRules.length));const f=t.style.animation||"";return t.style.animation=`${f?f+", ":""}${h} ${i}ms linear ${n}ms 1 both`,J+=1,h}function W(t,e){const s=(t.style.animation||"").split(", "),i=s.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),n=s.length-i.length;n&&(t.style.animation=i.join(", "),J-=n,J||Q())}function Q(){$(()=>{J||(X.forEach(t=>{const e=t.__svelte_stylesheet;let s=e.cssRules.length;for(;s--;)e.deleteRule(s);t.__svelte_rules={}}),X.clear())})}function K(t){j=t}function tt(){if(!j)throw new Error("Function called outside component initialization");return j}function et(t){tt().$$.before_update.push(t)}function st(t){tt().$$.on_mount.push(t)}function it(t){tt().$$.after_update.push(t)}function nt(t){tt().$$.on_destroy.push(t)}function at(){const t=tt();return(e,s)=>{const i=t.$$.callbacks[e];if(i){const n=G(e,s);i.slice().forEach(e=>{e.call(t,n)})}}}function rt(t,e){const s=t.$$.callbacks[e.type];s&&s.slice().forEach(t=>t(e))}const ot=[],lt=[],ct=[],dt=[],ht=Promise.resolve();let ut=!1;function mt(){ut||(ut=!0,ht.then(bt))}function pt(){return mt(),ht}function ft(t){ct.push(t)}function gt(t){dt.push(t)}let vt=!1;const yt=new Set;function bt(){if(!vt){vt=!0;do{for(let t=0;t<ot.length;t+=1){const e=ot[t];K(e),xt(e.$$)}for(ot.length=0;lt.length;)lt.pop()();for(let t=0;t<ct.length;t+=1){const e=ct[t];yt.has(e)||(yt.add(e),e())}ct.length=0}while(ot.length);for(;dt.length;)dt.pop()();ut=!1,vt=!1,yt.clear()}}function xt(t){if(null!==t.fragment){t.update(),l(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ft)}}let wt;function kt(){return wt||(wt=Promise.resolve(),wt.then(()=>{wt=null})),wt}function $t(t,e,s){t.dispatchEvent(G(`${e?"intro":"outro"}${s}`))}const St=new Set;let Mt;function Et(){Mt={r:0,c:[],p:Mt}}function Ct(){Mt.r||l(Mt.c),Mt=Mt.p}function Tt(t,e){t&&t.i&&(St.delete(t),t.i(e))}function It(t,e,s,i){if(t&&t.o){if(St.has(t))return;St.add(t),Mt.c.push(()=>{St.delete(t),i&&(s&&t.d(1),i())}),t.o(e)}}const Pt={duration:0};function Bt(t,e,s){let a,r=e(t,s),o=!0;const d=Mt;function h(){const{delay:e=0,duration:s=300,easing:c=n,tick:h=i,css:u}=r||Pt;u&&(a=Y(t,1,0,s,e,c,u));const m=k()+e,p=m+s;ft(()=>$t(t,!1,"start")),E(e=>{if(o){if(e>=p)return h(0,1),$t(t,!1,"end"),--d.r||l(d.c),!1;if(e>=m){const t=c((e-m)/s);h(1-t,t)}}return o})}return d.r+=1,c(r)?kt().then(()=>{r=r(),h()}):h(),{end(e){e&&r.tick&&r.tick(1,0),o&&(a&&W(t,a),o=!1)}}}function Ft(t,e,s,a){let r=e(t,s),o=a?0:1,d=null,h=null,u=null;function m(){u&&W(t,u)}function p(t,e){const s=t.b-o;return e*=Math.abs(s),{a:o,b:t.b,d:s,duration:e,start:t.start,end:t.start+e,group:t.group}}function f(e){const{delay:s=0,duration:a=300,easing:c=n,tick:f=i,css:g}=r||Pt,v={start:k()+s,b:e};e||(v.group=Mt,Mt.r+=1),d?h=v:(g&&(m(),u=Y(t,o,e,a,s,c,g)),e&&f(0,1),d=p(v,a),ft(()=>$t(t,e,"start")),E(e=>{if(h&&e>h.start&&(d=p(h,a),h=null,$t(t,d.b,"start"),g&&(m(),u=Y(t,o,d.b,d.duration,0,c,r.css))),d)if(e>=d.end)f(o=d.b,1-o),$t(t,d.b,"end"),h||(d.b?m():--d.group.r||l(d.group.c)),d=null;else if(e>=d.start){const t=e-d.start;o=d.a+d.d*c(t/d.duration),f(o,1-o)}return!(!d&&!h)}))}return{run(t){c(r)?kt().then(()=>{r=r(),f(t)}):f(t)},end(){m(),d=h=null}}}const zt="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Ut(t,e){t.d(1),e.delete(t.key)}function Dt(t,e){It(t,1,1,()=>{e.delete(t.key)})}function At(t,e,s,i,n,a,r,o,l,c,d,h){let u=t.length,m=a.length,p=u;const f={};for(;p--;)f[t[p].key]=p;const g=[],v=new Map,y=new Map;for(p=m;p--;){const t=h(n,a,p),o=s(t);let l=r.get(o);l?i&&l.p(t,e):(l=c(o,t),l.c()),v.set(o,g[p]=l),o in f&&y.set(o,Math.abs(p-f[o]))}const b=new Set,x=new Set;function w(t){Tt(t,1),t.m(o,d),r.set(t.key,t),d=t.first,m--}for(;u&&m;){const e=g[m-1],s=t[u-1],i=e.key,n=s.key;e===s?(d=e.first,u--,m--):v.has(n)?!r.has(i)||b.has(i)?w(e):x.has(n)?u--:y.get(i)>y.get(n)?(x.add(i),w(e)):(b.add(n),u--):(l(s,r),u--)}for(;u--;){const e=t[u];v.has(e.key)||l(e,r)}for(;m;)w(g[m-1]);return g}function Rt(t,e){const s={},i={},n={$$scope:1};let a=t.length;for(;a--;){const r=t[a],o=e[a];if(o){for(const t in r)t in o||(i[t]=1);for(const t in o)n[t]||(s[t]=o[t],n[t]=1);t[a]=o}else for(const t in r)n[t]=1}for(const t in i)t in s||(s[t]=void 0);return s}function Lt(t){return"object"==typeof t&&null!==t?t:{}}function Ot(t,e,s){const i=t.$$.props[e];void 0!==i&&(t.$$.bound[i]=s,s(t.$$.ctx[i]))}function _t(t){t&&t.c()}function Nt(t,e,s){const{fragment:i,on_mount:n,on_destroy:a,after_update:o}=t.$$;i&&i.m(e,s),ft(()=>{const e=n.map(r).filter(c);a?a.push(...e):l(e),t.$$.on_mount=[]}),o.forEach(ft)}function Zt(t,e){const s=t.$$;null!==s.fragment&&(l(s.on_destroy),s.fragment&&s.fragment.d(e),s.on_destroy=s.fragment=null,s.ctx=[])}function qt(t,e){-1===t.$$.dirty[0]&&(ot.push(t),mt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Gt(t,e,s,n,a,r,c=[-1]){const d=j;K(t);const h=e.props||{},u=t.$$={fragment:null,ctx:null,props:r,update:i,not_equal:a,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:o(),dirty:c,skip_bound:!1};let m=!1;if(u.ctx=s?s(t,h,(e,s,...i)=>{const n=i.length?i[0]:s;return u.ctx&&a(u.ctx[e],u.ctx[e]=n)&&(!u.skip_bound&&u.bound[e]&&u.bound[e](n),m&&qt(t,e)),s}):[],u.update(),m=!0,l(u.before_update),u.fragment=!!n&&n(u.ctx),e.target){if(e.hydrate){const t=L(e.target);u.fragment&&u.fragment.l(t),t.forEach(I)}else u.fragment&&u.fragment.c();e.intro&&Tt(t.$$.fragment),Nt(t,e.target,e.anchor),bt()}K(d)}class Ht{$destroy(){Zt(this,1),this.$destroy=i}$on(t,e){const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}$set(t){this.$$set&&!u(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Xt=[];function jt(t,e=i){let s;const n=[];function a(e){if(d(t,e)&&(t=e,s)){const e=!Xt.length;for(let e=0;e<n.length;e+=1){const s=n[e];s[1](),Xt.push(s,t)}if(e){for(let t=0;t<Xt.length;t+=2)Xt[t][0](Xt[t+1]);Xt.length=0}}}function r(e){a(e(t))}function o(r,o=i){const l=[r,o];return n.push(l),1===n.length&&(s=e(a)||i),r(t),()=>{const t=n.indexOf(l);-1!==t&&n.splice(t,1),0===n.length&&(s(),s=null)}}return{set:a,update:r,subscribe:o}}const Jt=jt([]),Vt=jt({}),Yt=jt([]),Wt=jt(),Qt=jt([]),Kt=jt({}),te=jt(),ee=jt(!1),se=jt(),ie=jt(!1),ne=jt(!0),ae=jt(),re=jt([]),oe=jt({}),le=jt({}),ce=jt([]),de=jt([]),he=jt(),ue=jt("auto"),me=jt(0),pe=jt(0),fe=jt(0),ge=jt([]),ve=jt({}),ye=jt({}),be=jt([]),xe=jt({current:0,max:1}),we=jt(),ke=jt(),$e=jt(!1),Se=jt(0),Me=jt([0,0]),Ee=jt(),Ce=jt(),Te=jt(!1),Ie=jt(),Pe=jt(),Be=jt([]),Fe=jt(),ze=jt(!1),Ue=jt(!1),De=jt(),Ae=jt([]),Re=jt(),Le=jt(),Oe=jt(),_e=jt(),Ne=jt({}),Ze=jt({}),qe=jt(),Ge=jt(),He=[],Xe=jt(""),je=jt(0),Je=jt(35),Ve=jt(90),Ye=jt(2),We=jt(!1),Qe=jt(!0),Ke=jt(!0),ts=jt(!0),es=jt(!1),ss=jt(!0),is=jt(!0),ns=jt(!0),as=jt(50),rs=jt(65),os=jt(20),ls=jt("en"),cs=jt("global"),ds=jt(8),hs=jt(300),us=jt(5),ms=jt(!1),ps=jt(!1),fs=jt(!1),gs=jt(!1),vs=jt(!0),ys=jt(!1),bs=jt(!1),xs=jt(!1),ws=jt(!0),ks=jt("Damage"),$s=jt(!1),Ss=jt({}),Ms=jt([0,0,0,0,0,0,1,1,1,1,1,1]),Es=jt(7),Cs=jt(!1),Ts=jt(100),Is=jt(!0),Ps=jt(!0),Bs=jt(!1),Fs=jt(!0),zs=jt(!1),Us=jt(!0),Ds=jt(!1),As=jt(0),Rs=jt(!0),Ls=jt(!0),Os=jt(!0),_s=jt(!0),Ns=jt([]),Zs=jt(""),qs=jt(0),Gs=jt(!1),Hs=jt(!1),Xs=jt(70),js=jt(!0),Js=jt(!0),Vs=jt(.5),Ys=jt(3),Ws=jt(!0),Qs=jt(200),Ks=jt(!0),ti=jt(!1),ei=jt(14),si=jt(8),ii=jt(!1),ni=jt(1),ai=jt(!1),ri=jt(!1),oi=jt(!0),li=jt(!0),ci=jt("w"),di=jt("arrowleft"),hi=jt("arrowright"),ui=jt("arrowup"),mi=jt("arrowdown"),pi=jt("a"),fi=jt("s"),gi=jt("d"),vi=jt("tab"),yi=jt("escape"),bi=jt("m"),xi=jt("k"),wi=jt("c"),ki=jt("b"),$i=jt("g"),Si=jt("v"),Mi=jt(12),Ei=jt("1"),Ci=jt("2"),Ti=jt("3"),Ii=jt("4"),Pi=jt("5"),Bi=jt("6"),Fi=jt("7"),zi=jt("8"),Ui=jt("9"),Di=jt("0"),Ai=jt("o"),Ri=jt("p"),Li=jt(""),Oi=jt(""),_i=jt(""),Ni=jt(""),Zi=jt(""),qi=jt(""),Gi=jt(""),Hi=jt(""),Xi=jt(""),ji=jt(""),Ji=jt(""),Vi=jt("");let Yi;Yi={...Object.freeze({__proto__:null,activeWorld:Xe,lastConnectedChar:je,viewRange:Je,resolution:Ve,shadowmapResolution:Ye,realtimeShadows:We,postProcessing:Qe,grass:Ke,shadows:ts,ssao:es,clouds:ss,particles:is,detailprops:ns,ambienceVolume:as,audioVolume:rs,musicVolume:os,lang:ls,command:cs,stashCols:ds,stashHeight:hs,inventoryCols:us,inventoryOpen:ms,settingsOpen:ps,skillmenuOpen:fs,dpsmeterOpen:gs,twitchOpen:vs,subscriptionOpen:ys,clanOpen:bs,pvpOpen:xs,dpsmeterParty:ws,dpsmeterMode:ks,charpanelOpen:$s,skillbarsettings:Ss,chat:Ms,cameraZoom:Es,editorActive:Cs,nameplateViewRange:Ts,nameplateShowMonsers:Is,nameplateShowTransparency:Ps,alwaysShowLevel:Bs,showFriendlyBars:Fs,classColorBars:zs,mapShowMonsters:Us,mapLowQuality:Ds,tutprogress:As,chatbubbles:Rs,showIncomingHeal:Ls,showIncomingDamage:Os,showIncomingMana:_s,filteredChannels:Ns,itemTypeFilter:Zs,itemQualityFilter:qs,itemQualityPercent:Gs,showFpsPing:Hs,itemProtectQuality:Xs,cdTextSkills:js,cdTextBuffs:Js,buffCdFlashingInterval:Vs,buffCdFlashingDuration:Ys,partyBuffLimitUpdateRate:Ws,partyWidth:Qs,showSelfInParty:Ks,showPartyMana:ti,buffcountUnitframes:ei,buffcountParty:si,buffsHideIrrelevant:ii,mouseSensitivity:ni,invertMouseX:ai,invertMouseY:ri,lockedcamera:oi,pointerlock:li,kbForward:ci,kbTurnLeft:di,kbTurnRight:hi,kbAltForward:ui,kbAltBack:mi,kbLeft:pi,kbBack:fi,kbRight:gi,kbNextTarget:vi,kbUntarget:yi,kbMap:bi,kbSkills:xi,kbCharacter:wi,kbInventory:ki,kbClan:$i,kbPvp:Si,skillbarAmount:Mi,kbSkillbar1:Ei,kbSkillbar2:Ci,kbSkillbar3:Ti,kbSkillbar4:Ii,kbSkillbar5:Pi,kbSkillbar6:Bi,kbSkillbar7:Fi,kbSkillbar8:zi,kbSkillbar9:Ui,kbSkillbar10:Di,kbSkillbar11:Ai,kbSkillbar12:Ri,kbSkillbar13:Li,kbSkillbar14:Oi,kbSkillbar15:_i,kbSkillbar16:Ni,kbSkillbar17:Zi,kbSkillbar18:qi,kbSkillbar19:Gi,kbSkillbar20:Hi,kbSkillbar21:Xi,kbSkillbar22:ji,kbSkillbar23:Ji,kbSkillbar24:Vi})};const Wi=(t,e)=>{const s=localStorage.getItem(t),i=JSON.parse("undefined"==s?null:s);null!==i&&e.set(i),e.subscribe(e=>{Qi[t]=e,localStorage.setItem(t,JSON.stringify(e))})},Qi={};for(const t in Yi)Wi(t,Yi[t]);var Ki=Object.freeze({__proto__:null,current:Qi,activeWorld:Xe,lastConnectedChar:je,viewRange:Je,resolution:Ve,shadowmapResolution:Ye,realtimeShadows:We,postProcessing:Qe,grass:Ke,shadows:ts,ssao:es,clouds:ss,particles:is,detailprops:ns,ambienceVolume:as,audioVolume:rs,musicVolume:os,lang:ls,command:cs,stashCols:ds,stashHeight:hs,inventoryCols:us,inventoryOpen:ms,settingsOpen:ps,skillmenuOpen:fs,dpsmeterOpen:gs,twitchOpen:vs,subscriptionOpen:ys,clanOpen:bs,pvpOpen:xs,dpsmeterParty:ws,dpsmeterMode:ks,charpanelOpen:$s,skillbarsettings:Ss,chat:Ms,cameraZoom:Es,editorActive:Cs,nameplateViewRange:Ts,nameplateShowMonsers:Is,nameplateShowTransparency:Ps,alwaysShowLevel:Bs,showFriendlyBars:Fs,classColorBars:zs,mapShowMonsters:Us,mapLowQuality:Ds,tutprogress:As,chatbubbles:Rs,showIncomingHeal:Ls,showIncomingDamage:Os,showIncomingMana:_s,filteredChannels:Ns,itemTypeFilter:Zs,itemQualityFilter:qs,itemQualityPercent:Gs,showFpsPing:Hs,itemProtectQuality:Xs,cdTextSkills:js,cdTextBuffs:Js,buffCdFlashingInterval:Vs,buffCdFlashingDuration:Ys,partyBuffLimitUpdateRate:Ws,partyWidth:Qs,showSelfInParty:Ks,showPartyMana:ti,buffcountUnitframes:ei,buffcountParty:si,buffsHideIrrelevant:ii,mouseSensitivity:ni,invertMouseX:ai,invertMouseY:ri,lockedcamera:oi,pointerlock:li,kbForward:ci,kbTurnLeft:di,kbTurnRight:hi,kbAltForward:ui,kbAltBack:mi,kbLeft:pi,kbBack:fi,kbRight:gi,kbNextTarget:vi,kbUntarget:yi,kbMap:bi,kbSkills:xi,kbCharacter:wi,kbInventory:ki,kbClan:$i,kbPvp:Si,skillbarAmount:Mi,kbSkillbar1:Ei,kbSkillbar2:Ci,kbSkillbar3:Ti,kbSkillbar4:Ii,kbSkillbar5:Pi,kbSkillbar6:Bi,kbSkillbar7:Fi,kbSkillbar8:zi,kbSkillbar9:Ui,kbSkillbar10:Di,kbSkillbar11:Ai,kbSkillbar12:Ri,kbSkillbar13:Li,kbSkillbar14:Oi,kbSkillbar15:_i,kbSkillbar16:Ni,kbSkillbar17:Zi,kbSkillbar18:qi,kbSkillbar19:Gi,kbSkillbar20:Hi,kbSkillbar21:Xi,kbSkillbar22:ji,kbSkillbar23:Ji,kbSkillbar24:Vi});let tn;ls.subscribe(async t=>{await fetch(`/assets/loc/${t}.json?v=4597824`).then(async t=>{tn=await t.json(),ee.set(!0)})});const en=(t,s)=>e(t,s,tn),sn=(t,e)=>s(t,e,tn);function nn(t){const e=t[0],s=t[1],i=t[2];return Math.sqrt(e*e+s*s+i*i)}function an(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function rn(t,e,s,i){return t[0]=e,t[1]=s,t[2]=i,t}function on(t,e){return t[0]=e,t[1]=e,t[2]=e,t}function ln(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t}function cn(t,e,s,i){return t[0]+=e,t[1]+=s,t[2]+=i,t}function dn(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2],t}function hn(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function un(t,e,s,i){return t[0]=e[0]+s[0]*i,t[1]=e[1]+s[1]*i,t[2]=e[2]+s[2]*i,t}function mn(t,e){const s=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(s*s+i*i+n*n)}function pn(t,e){const s=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return s*s+i*i+n*n}function fn(t){const e=t[0],s=t[1],i=t[2];return e*e+s*s+i*i}function gn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function vn(t,e){const s=e[0],i=e[1],n=e[2];let a=s*s+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function yn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function bn(t,e,s){const i=e[0],n=e[1],a=e[2],r=s[0],o=s[1],l=s[2];return t[0]=n*l-a*o,t[1]=a*r-i*l,t[2]=i*o-n*r,t}function xn(t,e,s,i){const n=e[0],a=e[1],r=e[2];return t[0]=n+i*(s[0]-n),t[1]=a+i*(s[1]-a),t[2]=r+i*(s[2]-r),t}function wn(t,e,s){const i=e[0],n=e[1],a=e[2];let r=s[3]*i+s[7]*n+s[11]*a+s[15];return r=r||1,t[0]=(s[0]*i+s[4]*n+s[8]*a+s[12])/r,t[1]=(s[1]*i+s[5]*n+s[9]*a+s[13])/r,t[2]=(s[2]*i+s[6]*n+s[10]*a+s[14])/r,t}function kn(t,e,s){const i=e[0],n=e[1],a=e[2];return t[0]=s[0]*i+s[4]*n+s[8]*a,t[1]=s[1]*i+s[5]*n+s[9]*a,t[2]=s[2]*i+s[6]*n+s[10]*a,t}function $n(t,e,s){const i=e[0],n=e[1],a=e[2],r=s[0],o=s[1],l=s[2];let c=o*a-l*n,d=l*i-r*a,h=r*n-o*i,u=o*h-l*d,m=l*c-r*h,p=r*d-o*c;const f=2*s[3];return c*=f,d*=f,h*=f,u*=2,m*=2,p*=2,t[0]=i+c+u,t[1]=n+d+m,t[2]=a+h+p,t}function Sn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Mn(t,e,s){const i=Math.sin(s),n=Math.cos(s);return t[0]=e[2]*i+e[0]*n,t[1]=e[1],t[2]=e[2]*n-e[0]*i,t}function En(t,e,s){const i=Math.sin(s),n=Math.cos(s);return t[0]=e[1]*i+e[0]*n,t[2]=e[1]*n-e[0]*i,t}const Cn=[0,0,0];let Tn=1,In=1;const Pn=(t,e,s,i,n)=>{if(t.length>0){rn(e,1/0,1/0,1/0),rn(s,-1/0,-1/0,-1/0);for(let i=0,n=t.length;i<n;i+=3){const n=t[i],a=t[i+1],r=t[i+2];e[0]=Math.min(n,e[0]),e[1]=Math.min(a,e[1]),e[2]=Math.min(r,e[2]),s[0]=Math.max(n,s[0]),s[1]=Math.max(a,s[1]),s[2]=Math.max(r,s[2])}}else rn(e,0,0,0),rn(s,-0,-0,-0);dn(n,s,e),hn(i,ln(i,e,s),.5)};class Bn{constructor(t,e={}){this.gl=t,this.attributes=e,this.id=Tn++,this.drawRange={start:0,count:0},this.attrRange=0,this.instancedCount=0,this.vao={},this.bounds={min:[0,0,0],max:[0,0,0],center:[0,0,0],scale:[0,0,0],radius:1/0,initiated:!1},this.addAttributes(e)}addAttributes(t){this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry="",this.glState=this.gl.renderer.state;for(const e in t)this.addAttribute(e,t[e]);this.attributes.position&&this.computeBoundingSphere()}addAttribute(t,e){if(this.attributes[t]=e,e.id=In++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalize=e.normalize||!1,e.buffer=this.gl.createBuffer(),e.count=e.data.length/e.size,e.divisor=e.instanced?"number"==typeof e.instanced?e.instanced:1:0,e.needsUpdate=!1,e.bufferMode=e.bufferMode||this.gl.STATIC_DRAW,this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){this.glState.boundBuffer!==t.id&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.id),this.gl.bufferData(t.target,t.data,t.bufferMode,0,this.attrRange>0?this.attrRange*t.size:this.instancedCount*t.size),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.attrRange=e,this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.vao[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.vao[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach((t,e)=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);const s=this.attributes[e];if(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s.buffer),this.glState.boundBuffer=s.id,s.size>4){const e=s.size/4,i=4*e,n=4*i;for(let s=0;s<e;++s)this.gl.vertexAttribPointer(t+s,e,this.gl.FLOAT,!1,n,i*s),this.gl.enableVertexAttribArray(t+s),this.gl.renderer.vertexAttribDivisor(t+s,1)}else this.gl.vertexAttribPointer(t,s.size,s.type,s.normalize,0,0),this.gl.enableVertexAttribArray(t),this.gl.renderer.vertexAttribDivisor(t,s.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){const s=`${this.id}_${t.attributeOrder}`;this.gl.renderer.currentGeometry!==s&&(this.vao[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.vao[t.attributeOrder]),this.gl.renderer.currentGeometry=s),t.attributeLocations.forEach((t,e)=>{const s=this.attributes[e];s.needsUpdate&&this.updateAttribute(s)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}computeBoundingBox(){Pn(this.attributes.position.data,this.bounds.min,this.bounds.max,this.bounds.center,this.bounds.scale),this.bounds.initiated=!0}computeBoundingSphereRadius(){let t=0;for(let e=0,s=this.attributes.position.data.length;e<s;e+=3)Cn[0]=this.attributes.position.data[e],Cn[1]=this.attributes.position.data[e+1],Cn[2]=this.attributes.position.data[e+2],t=Math.max(t,pn(this.bounds.center,Cn));this.bounds.radius=Math.sqrt(t)}computeBoundingSphere(){this.bounds.initiated||this.computeBoundingBox(),this.computeBoundingSphereRadius()}remove(){for(const t in this.vao)this.gl.renderer.deleteVertexArray(this.vao[t]);for(const t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}let Fn=1;class zn{constructor(t,{vertex:e,fragment:s,uniforms:i={},instanced:n={},active:a=!0,transparent:r=!1,cullFace:o=t.BACK,frontFace:l=t.CCW,depthTest:c=!0,depthWrite:d=!0,depthFunc:h=t.LESS,globalUniforms:u={}}={}){this.gl=t,this.uniforms=i,this.instanced=n,this.autoUniforms=[],this.id=Fn++,this.active=a,this.textureUnitsUsed=this.gl.renderer.textureUnitsUsed,this.textureUnitsState=this.gl.renderer.state.textureUnits,this.maxTextureUnits=this.gl.renderer.parameters.maxTextureUnits,e||console.warn("vertex shader not supplied"),s||console.warn("fragment shader not supplied"),this.transparent=r,this.cullFace=o,this.frontFace=l,this.depthTest=c,this.depthWrite=d,this.depthFunc=h,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const m=t.createShader(t.VERTEX_SHADER);t.shaderSource(m,e),t.compileShader(m);const p=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(p,s),t.compileShader(p),this.program=t.createProgram(),t.attachShader(this.program,m),t.attachShader(this.program,p),t.linkProgram(this.program),t.deleteShader(m),t.deleteShader(p),this.uniformArray=[];const f=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<f;e++){const s=t.getActiveUniform(this.program,e),i=t.getUniformLocation(this.program,s.name),n=s.name.match(/(\w+)/g);s.uniformName=n[0];const a=s.uniformName;u[a]?this.uniforms[a]||(this.uniforms[a]=u[a]):this.uniforms[a]||(Rn.has(a)||this.autoUniforms.push(a),this.uniforms[a]={value:void 0});const r={name:a,location:i,cacheArray:[],cacheValue:-0,cacheState:-1,data:this.uniforms[a],type:s.type,isTexture:35678===s.type||35682===s.type};this.uniformArray.push(r)}this.attributeLocations=new Map;const g=[],v=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<v;e++){const s=t.getActiveAttrib(this.program,e),i=t.getAttribLocation(this.program,s.name);g[i]=s.name,this.attributeLocations.set(s.name,i)}this.attributeOrder=g.join("")}setBlendFunc(t,e,s,i){this.blendFunc.src=t,this.blendFunc.Qg=e,this.blendFunc.srcAlpha=s,this.blendFunc.dstAlpha=i,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.Qg,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.blendEquation.modeRGB&&this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({programActive:t=!1}={}){t||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.updateUniforms(),this.applyState()}updateValueUniform(t){let e=!1;if(t.data.state>0){if(!(t.data.state>t.cacheState))return;e=!0,t.cacheState=t.data.state}(e||Un(t))&&An(this.gl,t.type,t.location,t.data.value)}updateTextureUniformSingle(t,e,s){const i=this.textureUnitsState.indexOf(e.id);if(i>=0)t.cacheValue!==i&&(An(this.gl,t.type,t.location,i),t.cacheValue=i);else{const i=this.textureUnitsState.length;if(i<this.maxTextureUnits)e.update(i),An(this.gl,t.type,t.location,i),t.cacheValue=i;else for(let n=0;n<i;++n)if(s.indexOf(this.textureUnitsState[n])<0)return e.update(n),An(this.gl,t.type,t.location,n),void(t.cacheValue=n)}}updateTextureUniformArray(t,e,s){const i=[];for(let t=0;t<e.length;++t){const n=e[t];if(void 0!==n){const t=this.textureUnitsState.indexOf(n.id);if(t>=0)i.push(t);else for(let t=0,e=this.maxTextureUnits;t<e;++t)s.indexOf(this.textureUnitsState[t])<0&&(n.update(t),i.push(t),e=t)}}let n=!1;for(let e=0;e<i.length;++e)t.cacheArray[e]!==i[e]&&(n=!0,t.cacheArray[e]=i[e]);n&&An(this.gl,t.type,t.location,i)}updateTextureUniform(t,e){void 0===t.data.value.length?this.updateTextureUniformSingle(t,t.data.value,e):t.data.value.length>0&&this.updateTextureUniformArray(t,t.data.value,e)}compileTextureIds(){const t=[];if(this.uniformArray.forEach(e=>{if(e.isTexture)if(void 0===e.data.value.length)t.push(e.data.value.id),this.textureUnitsUsed.indexOf(e.data.value.id)<0&&this.textureUnitsUsed.push(e.data.value.id);else for(let s=0;s<e.data.value.length;++s)void 0!==e.data.value[s]&&(t.push(e.data.value[s].id),this.textureUnitsUsed.indexOf(e.data.value[s].id)<0&&this.textureUnitsUsed.push(e.data.value[s].id))}),this.textureUnitsUsed.length>this.maxTextureUnits){for(let e=0;e<this.maxTextureUnits-t.length;++e)t.indexOf(this.textureUnitsUsed)<0&&t.push(this.textureUnitsUsed[e]);return t}return this.textureUnitsUsed}updateUniforms(){const t=this.compileTextureIds();this.uniformArray.forEach(e=>{e.isTexture?this.updateTextureUniform(e,t):this.updateValueUniform(e)})}remove(){this.gl.deleteProgram(this.program),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader)}}function Un(t){if(void 0!==t.data.value.length){if(Dn(t.cacheArray,t.data.value))return!1}else{if(t.cacheValue===t.data.value)return!1;t.cacheValue=t.data.value}return!0}function Dn(t,e){let s=!0;const i=t.length,n=e.length;i!==n&&(s=!1);for(let i=0;i<n;i++)t[i]!==e[i]&&(s=!1,t[i]=e[i]);return s}function An(t,e,s,i){switch(e){case 5126:return i.length?t.uniform1fv(s,i):t.uniform1f(s,i);case 35664:return t.uniform2fv(s,i);case 35665:return t.uniform3fv(s,i);case 35666:return t.uniform4fv(s,i);case 35670:case 5124:case 35678:case 35682:case 35680:return i.length?t.uniform1iv(s,i):t.uniform1i(s,i);case 35671:case 35667:return t.uniform2iv(s,i);case 35672:case 35668:return t.uniform3iv(s,i);case 35673:case 35669:return t.uniform4iv(s,i);case 35674:return t.uniformMatrix2fv(s,!1,i);case 35675:return t.uniformMatrix3fv(s,!1,i);case 35676:return t.uniformMatrix4fv(s,!1,i)}}const Rn=new Set(["kX","oh","vJ","Dt","Nh","Ux","Rq"]);function Ln(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function On(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _n(t,e){const s=e[0],i=e[1],n=e[2],a=e[3],r=e[4],o=e[5],l=e[6],c=e[7],d=e[8],h=e[9],u=e[10],m=e[11],p=e[12],f=e[13],g=e[14],v=e[15],y=s*o-i*r,b=s*l-n*r,x=s*c-a*r,w=i*l-n*o,k=i*c-a*o,$=n*c-a*l,S=d*f-h*p,M=d*g-u*p,E=d*v-m*p,C=h*g-u*f,T=h*v-m*f,I=u*v-m*g;let P=y*I-b*T+x*C+w*E-k*M+$*S;return P?(P=1/P,t[0]=(o*I-l*T+c*C)*P,t[1]=(n*T-i*I-a*C)*P,t[2]=(f*$-g*k+v*w)*P,t[3]=(u*k-h*$-m*w)*P,t[4]=(l*E-r*I-c*M)*P,t[5]=(s*I-n*E+a*M)*P,t[6]=(g*x-p*$-v*b)*P,t[7]=(d*$-u*x+m*b)*P,t[8]=(r*T-o*E+c*S)*P,t[9]=(i*E-s*T-a*S)*P,t[10]=(p*k-f*x+v*y)*P,t[11]=(h*x-d*k-m*y)*P,t[12]=(o*M-r*C-l*S)*P,t[13]=(s*C-i*M+n*S)*P,t[14]=(f*b-p*w-g*y)*P,t[15]=(d*w-h*b+u*y)*P,t):null}function Nn(t,e,s){const i=e[0],n=e[1],a=e[2],r=e[3],o=e[4],l=e[5],c=e[6],d=e[7],h=e[8],u=e[9],m=e[10],p=e[11],f=e[12],g=e[13],v=e[14],y=e[15];let b=s[0],x=s[1],w=s[2],k=s[3];return t[0]=b*i+x*o+w*h+k*f,t[1]=b*n+x*l+w*u+k*g,t[2]=b*a+x*c+w*m+k*v,t[3]=b*r+x*d+w*p+k*y,b=s[4],x=s[5],w=s[6],k=s[7],t[4]=b*i+x*o+w*h+k*f,t[5]=b*n+x*l+w*u+k*g,t[6]=b*a+x*c+w*m+k*v,t[7]=b*r+x*d+w*p+k*y,b=s[8],x=s[9],w=s[10],k=s[11],t[8]=b*i+x*o+w*h+k*f,t[9]=b*n+x*l+w*u+k*g,t[10]=b*a+x*c+w*m+k*v,t[11]=b*r+x*d+w*p+k*y,b=s[12],x=s[13],w=s[14],k=s[15],t[12]=b*i+x*o+w*h+k*f,t[13]=b*n+x*l+w*u+k*g,t[14]=b*a+x*c+w*m+k*v,t[15]=b*r+x*d+w*p+k*y,t}function Zn(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function qn(t,e){const s=e[0],i=e[1],n=e[2],a=e[4],r=e[5],o=e[6],l=e[8],c=e[9],d=e[10];return t[0]=Math.sqrt(s*s+i*i+n*n),t[1]=Math.sqrt(a*a+r*r+o*o),t[2]=Math.sqrt(l*l+c*c+d*d),t}function Gn(t){const e=t[0],s=t[1],i=t[2],n=t[4],a=t[5],r=t[6],o=t[8],l=t[9],c=t[10],d=e*e+s*s+i*i,h=n*n+a*a+r*r,u=o*o+l*l+c*c;return Math.sqrt(Math.max(d,h,u))}function Hn(t,e){const s=e[0]+e[5]+e[10];let i=0;return s>0?(i=2*Math.sqrt(s+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function Xn(t,e,s,i){const n=e[0],a=e[1],r=e[2],o=e[3],l=n+n,c=a+a,d=r+r,h=n*l,u=n*c,m=n*d,p=a*c,f=a*d,g=r*d,v=o*l,y=o*c,b=o*d,x=i[0],w=i[1],k=i[2];return t[0]=(1-(p+g))*x,t[1]=(u+b)*x,t[2]=(m-y)*x,t[3]=0,t[4]=(u-b)*w,t[5]=(1-(h+g))*w,t[6]=(f+v)*w,t[7]=0,t[8]=(m+y)*k,t[9]=(f-v)*k,t[10]=(1-(h+p))*k,t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1,t}function jn(t,e,s,i,n){const a=1/Math.tan(e/2),r=1/(i-n);return t[0]=a/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*r,t[15]=0,t}function Jn(t,e,s,i,n,a,r){const o=1/(e-s),l=1/(i-n),c=1/(a-r);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+s)*o,t[13]=(n+i)*l,t[14]=(r+a)*c,t[15]=1,t}function Vn(t,e,s,i){const n=e[0],a=e[1],r=e[2],o=i[0],l=i[1],c=i[2];let d=n-s[0],h=a-s[1],u=r-s[2],m=d*d+h*h+u*u;m>0&&(m=1/Math.sqrt(m),d*=m,h*=m,u*=m);let p=l*u-c*h,f=c*d-o*u,g=o*h-l*d;return m=p*p+f*f+g*g,m>0&&(m=1/Math.sqrt(m),p*=m,f*=m,g*=m),t[0]=p,t[1]=f,t[2]=g,t[3]=0,t[4]=h*g-u*f,t[5]=u*p-d*g,t[6]=d*f-h*p,t[7]=0,t[8]=d,t[9]=h,t[10]=u,t[11]=0,t[12]=n,t[13]=a,t[14]=r,t[15]=1,t}function Yn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}const Wn=[0,0,0];class Qn{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:s=150,dpr:i=1,alpha:n=!1,BS:a=!0,stencil:r=!1,antialias:o=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:c=!1,powerPreference:d="default",autoClear:h=!0,resolution:u=1}={}){const m={alpha:n,BS:a,stencil:r,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:d};this.dpr=i,this.alpha=n,this.color=!0,this.BS=a,this.stencil=r,this.premultipliedAlpha=l,this.autoClear=h,this.gl=t.getContext("webgl2",m),this.isWebgl2=!!this.gl,this.canvas2dElement=document.createElement("canvas"),this.canvas2dContext=this.canvas2dElement.getContext("2d",{}),this.gl&&(this.gl.renderer=this),this.width=this.height=0,this.parameters={maxTextureUnits:this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},this.state={blendFunc:{src:this.gl.ONE,Qg:this.gl.ZERO},blendEquation:{modeRGB:this.gl.FUNC_ADD},cullFace:null,frontFace:this.gl.CCW,depthMask:!0,depthFunc:this.gl.LESS,premultiplyAlpha:!1,flipY:!1,framebuffer:null,viewport:{width:null,height:null},textureUnits:[],activeTextureUnit:0},this.textureUnitsUsed=[],this.extensions={},this.vertexAttribDivisor=this.gl.renderer.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.gl.renderer.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.gl.renderer.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.gl.renderer.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.gl.renderer.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.gl.renderer.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.currentGeometry="",this.currentProgram=-1,this.setSize(e,s,u)}setSize(t,e,s){this.width=Math.round(t*s),this.height=Math.round(e*s),this.gl.canvas.width=this.width*this.dpr,this.gl.canvas.height=this.height*this.dpr,this.canvas2dElement.width=t*this.dpr,this.canvas2dElement.height=e*this.dpr}setViewport(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,s,i){this.state.blendFunc.src===t&&this.state.blendFunc.Qg===e&&this.state.blendFunc.srcAlpha===s&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=t,this.state.blendFunc.Qg=e,this.state.blendFunc.srcAlpha=s,this.state.blendFunc.dstAlpha=i,void 0!==s?this.gl.blendFuncSeparate(t,e,s,i):this.gl.blendFunc(t,e))}setBlendEquation(t,e){this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,s){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t][s].bind(this.extensions[t]):this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:s,sort:i,shadowTarget:n}){let a=[];e&&s&&e.updateFrustum();for(let i=0,r=t.length;i<r;++i)t[i].data.mesh.traverse(t=>{if(!t.visible)return!0;const i=t.data.mesh;return!(n&&!i.receiveShadow.has(n)&&!i.throwShadow.has(n))&&(!(!(s&&i.frustumCulled&&e)||e.frustumIntersectsMesh(i.geometry,t))||(a.push(i),!1))});if(i){const t=[],s=[],i=[];for(let n=0,r=a.length;n<r;++n){const r=a[n];r.program.transparent?r.program.depthTest?s.push(r):i.push(r):t.push(r),r.zDepth=0,0===r.renderOrder&&r.program.depthTest&&e&&(Zn(Wn,r.transform.cX),wn(Wn,Wn,e.kX),r.zDepth=Wn[2])}t.sort(this.sortOpaque),s.sort(this.sortTransparent),i.sort(this.sortUI),a=t.concat(s,i)}return a}render({scene:t,camera:e,target:s=null,update:i=!0,sort:n=!0,frustumCull:a=!0,shadowTarget:r=!1,sceneCamera:o,clear:l=!0}){r&&(s=r),null===s?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(s),this.setViewport(s.width,s.height)),l&&this.autoClear&&(!this.BS||s&&s.BS||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.BS?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0)));const c=this.getRenderList({scene:t,camera:e,frustumCull:a,sort:n,shadowTarget:r});for(let t=0,s=c.length;t<s;++t)c[t].draw({camera:e,shadowTarget:r,sceneCamera:o,update:i})}postRender(){this.textureUnitsUsed.length=0}}function Kn(t,e){return t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0),t}function ta(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ea(t,e,s,i,n){return t[0]=e,t[1]=s,t[2]=i,t[3]=n,t}function sa(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function ia(t,e){const s=Math.sin(.5*e[0]),i=Math.cos(.5*e[0]),n=Math.sin(.5*e[1]),a=Math.cos(.5*e[1]),r=Math.sin(.5*e[2]),o=Math.cos(.5*e[2]);return t[0]=s*a*o+i*n*r,t[1]=i*n*o-s*a*r,t[2]=i*a*r-s*n*o,t[3]=i*a*o+s*n*r,t}const na=Ln(),aa=()=>({parent:null,children:[],visible:!0,geometry:void 0,matrix:Ln(),cX:Ln(),position:[0,0,0],scale:[1,1,1],quaternion:[-0,-0,-0,1],rotation:[-0,-0,-0],matrixAutoUpdate:!1,matrixNeedsUpdate:!0,data:{}}),ra=(t,e,s=!0)=>{s&&null!==t.parent&&e!==t.parent&&la(t.parent,t,!1),t.parent=e,t.matrixNeedsUpdate=!0,s&&e&&oa(e,t,!1)},oa=(t,e,s=!0)=>{~t.children.indexOf(e)||t.children.push(e),s&&ra(e,t,!1)},la=(t,e,s=!0)=>{~t.children.indexOf(e)&&t.children.splice(t.children.indexOf(e),1),s&&ra(e,null,!1)},ca=(t,e)=>{if(!t.visible)return;const s=da(t),i=ha(t,e,s);t.children.forEach(t=>{t.visible&&ca(t,i)})},da=t=>!(!t.matrixAutoUpdate&&!t.matrixNeedsUpdate)&&(ia(t.quaternion,t.rotation),Xn(t.matrix,t.quaternion,t.position,t.scale),!0),ha=(t,e,s)=>null!==t.parent?!(!e&&!s)&&(Nn(t.cX,t.parent.cX,t.matrix),!0):!!s&&(On(t.cX,t.matrix),!0),ua=(t,e,s=!1,i)=>{s?Vn(na,t.position,e,i):Vn(na,e,t.position,i),Kn(t.rotation,na)},ma=[],pa=()=>ma.length>0?ma.pop():aa(),fa=t=>{ga(t),ma.indexOf(t)<0?ma.push(t):console.log("tried returning transform that is already known")},ga=t=>{t.data={},t.geometry=void 0,t.visible=!0,t.matrixAutoUpdate=!1,rn(t.position,0,0,0),rn(t.scale,1,1,1),rn(t.rotation,0,0,0),ra(t,null,!0);for(let e=0;e<t.children.length;++e)ra(t.children[e],null);t.children.length=0},va=Ln(),ya=[0,0,0];class ba{constructor(t=.1,e=100,s=45,i=1){this.near=t,this.Oq=e,this.fov=s,this.aspect=i,this.transform=pa(),this.transform.matrixAutoUpdate=!0,this.Ux=Ln(),this.Dt=Ln(),this.kX=Ln(),this.worldPosition=[0,0,0],this.frustum=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this.frustumConstants=[0,0,0,0,0,0]}perspective({near:t=this.near,Oq:e=this.Oq,fov:s=this.fov,aspect:i=this.aspect}={}){return jn(this.Ux,s*(Math.PI/180),i,t,e),this}orthographic({near:t=this.near,Oq:e=this.Oq,left:s=-1,right:i=1,bottom:n=-1,top:a=1}={}){return Jn(this.Ux,s,i,n,a,t,e),this}updateGlobalWorldPos(){Zn(this.worldPosition,this.transform.cX)}updateMatrixWorldCamView(t){ca(this.transform,t),_n(this.Dt,this.transform.cX),Nn(this.kX,this.Ux,this.Dt),this.updateGlobalWorldPos()}lookAt(t,e){ua(this.transform,t,!0,e)}project(t){return wn(t,t,this.Dt),wn(t,t,this.Ux),t}unproject(t){return wn(t,t,_n(va,this.Ux)),wn(t,t,this.transform.cX),t}updateFrustum(){const t=this.kX;rn(this.frustum[0],t[3]-t[0],t[7]-t[4],t[11]-t[8]),rn(this.frustum[1],t[3]+t[0],t[7]+t[4],t[11]+t[8]),rn(this.frustum[2],t[3]+t[1],t[7]+t[5],t[11]+t[9]),rn(this.frustum[3],t[3]-t[1],t[7]-t[5],t[11]-t[9]),rn(this.frustum[4],t[3]-t[2],t[7]-t[6],t[11]-t[10]),rn(this.frustum[5],t[3]+t[2],t[7]+t[6],t[11]+t[10]),this.frustumConstants[0]=t[15]-t[12],this.frustumConstants[1]=t[15]+t[12],this.frustumConstants[2]=t[15]+t[13],this.frustumConstants[3]=t[15]-t[13],this.frustumConstants[4]=t[15]-t[14],this.frustumConstants[5]=t[15]+t[14];for(let t=0;t<6;t++){const e=this.frustum[t],s=1/nn(e);hn(e,e,s),this.frustumConstants[t]*=s}}frustumIntersectsMesh(t,e){an(ya,t.bounds.center),wn(ya,ya,e.cX);const s=t.bounds.radius*Gn(e.cX);return this.frustumIntersectsSphere(ya,s)}frustumIntersectsSphere(t,e){for(let s=0;s<6;s++){if(yn(this.frustum[s],t)+this.frustumConstants[s]<-e)return!1}return!0}}let xa=0;class wa{constructor(t,e,s,i=!0,n=0,a=null,r=new Set,o=new Set){this.id=xa++,this.geometry=t,this.program=e,this.shadowProgram=a,this.throwShadow=r,this.receiveShadow=o,this.mode=s,this.frustumCulled=i,this.renderOrder=n,this.Nh=Ln(),this.transform=pa(),this.transform.data.mesh=this,this.zDepth=0,this.uniformData={}}draw({camera:t,shadowTarget:e=null}={}){if(!this.program.active)return;if(e&&!this.throwShadow.has(e))return;const s=e?this.shadowProgram:this.program;t&&s&&(s.uniforms.Ux&&(s.uniforms.Ux.value=t.Ux),s.uniforms.Rq&&(s.uniforms.Rq.value=t.worldPosition),s.uniforms.Dt&&(s.uniforms.Dt.value=t.Dt),s.uniforms.kX&&(s.uniforms.kX.value=t.kX),s.uniforms.Nh&&(Nn(this.Nh,t.Dt,this.transform.cX),s.uniforms.Nh.value=this.Nh),s.uniforms.vJ&&(s.uniforms.vJ.value=this.transform.matrix)),s.autoUniforms.forEach(t=>{s.uniforms[t].value=this.uniformData[t]});const i=s.gl.renderer.currentProgram===s.id;s.use({programActive:i,shadowTarget:e}),this.geometry.draw({mode:this.mode,program:s})}traverse(t){if(t(this.transform))return!1;this.transform.children.forEach(e=>e.data.mesh.traverse(t))}}const ka=[0,0,0];class $a extends wa{constructor(t,e,s,i=0,n=null,a=new Set,r=new Set,o=!1,l=!1){super(new Bn(t),e,s,!1,i,n,a,r),this.transform.visible=!1,this.individualFrustums=l,this.dynamicThrowShadows=!1,this.permanent=!1,this.dynamic=o,this.needsUpdate=!1,this.lastUpdateCamPos=[0,0,0],this.drawCount=0,this.cullFace=1029,this.uniformData.Hp=!1,this.instances=[],this.instanced=[]}create(){const t=pa();return t.geometry=this.geometry,t.data.cX=t.cX,t.data.multi=this,t.data.distToCam=0,this.instances.indexOf(t)<0?this.instances.push(t):console.log("error, instance already present"),this.needsUpdate=!0,t}remove(t){this.instances.splice(this.instances.indexOf(t),1),this.needsUpdate=!0,fa(t)}rebuild(t){if(!this.needsUpdate&&pn(this.lastUpdateCamPos,t.worldPosition)<100)return;an(this.lastUpdateCamPos,t.worldPosition),this.needsUpdate=this.dynamic;const e=this.instances.filter(e=>!!e.visible&&(Zn(ka,e.cX),e.data.distToCam=pn(ka,t.worldPosition),e.data.distToCam<(t.Oq+10)**2&&(!this.dynamic||!this.individualFrustums||t.frustumIntersectsMesh(e.geometry,e))));if(this.drawCount=e.length,this.geometry.setInstancedCount(this.drawCount),0!=this.drawCount)for(let t=0;t<this.instanced.length;++t){const s=this.instanced[t];Sa(s,s.size,this.drawCount),s.size>1?Ma(s,s.size,this.drawCount,s.name,e):Ea(s,s.size,this.drawCount,s.name,e),this.geometry.updateAttribute(s)}}draw({camera:t,shadowTarget:e=null,sceneCamera:s,update:i}={}){this.transform.visible&&((i&&this.dynamicThrowShadows||!this.dynamicThrowShadows&&!e)&&this.rebuild(s||t),this.drawCount>0&&(e||(this.program.cullFace=this.cullFace),super.draw({camera:t,shadowTarget:e})))}setAttributes(t){this.instanced.length=0;const e={...t},s={...this.program.instanced,cX:{size:16}};for(const t in s)e[t]={name:t,instanced:!0,bufferMode:this.dynamic?35048:35044,size:s[t].size,data:new Float32Array(s[t].size)},this.instanced.push(e[t]);this.geometry.addAttributes(e)}}const Sa=(t,e,s)=>{t.data=t.data.byteLength>=e*s*4?t.data:new Float32Array(e*(s+5))},Ma=(t,e,s,i,n)=>{for(let a=0;a<s;++a)t.data.set(n[a].data[i],a*e)},Ea=(t,e,s,i,n)=>{for(let e=0;e<s;++e)t.data[e]=n[e].data[i]},Ca=new Uint8Array(4);let Ta=1;class Ia{constructor(t,{image:e,target:s=t.TEXTURE_2D,type:i=t.UNSIGNED_BYTE,format:n=t.RGBA,internalFormat:a=n,wrapS:r=t.CLAMP_TO_EDGE,wrapT:o=t.CLAMP_TO_EDGE,generateMipmaps:l=!0,minFilter:c=(l?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:d=t.LINEAR,premultiplyAlpha:h=!1,flipY:u=!0,level:m=0,width:p,height:f=p,compareMode:g=t.NONE,compareFunc:v=t.LEQUAL}={}){this.gl=t,this.id=Ta++,this.image=e,this.target=s,this.type=i,this.format=n,this.internalFormat=a,this.minFilter=c,this.magFilter=d,this.wrapS=r,this.wrapT=o,this.generateMipmaps=l,this.premultiplyAlpha=h,this.flipY=u,this.level=m,this.width=p,this.height=f,this.compareMode=g,this.texture=this.gl.createTexture(),this.store={image:void 0},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.premultiplyAlpha=!1,this.needsUpdate=!0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){const e=!(this.image===this.store.image&&!this.needsUpdate);(e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e&&(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.state.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.state.premultiplyAlpha=this.premultiplyAlpha),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.compareMode!==this.state.compareMode&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_COMPARE_MODE,this.compareMode),this.state.compareMode=this.compareMode),this.compareFunc!==this.state.compareFunc&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_COMPARE_FUNC,this.compareFunc),this.state.compareFunc=this.compareFunc),this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image),this.generateMipmaps&&this.gl.generateMipmap(this.target)):this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Ca),this.store.image=this.image,this.onUpdate&&this.onUpdate())}}class Pa{constructor(t,{width:e=t.canvas.width,height:s=t.canvas.height,target:i=t.FRAMEBUFFER,color:n=1,BS:a=!0,stencil:r=!1,depthTexture:o=!1,depthCompareMode:l=t.NONE,wrapS:c=t.CLAMP_TO_EDGE,wrapT:d=t.CLAMP_TO_EDGE,minFilter:h=t.LINEAR,magFilter:u=t.LINEAR}={}){this.gl=t,this.width=e,this.height=s,this.buffer=this.gl.createFramebuffer(),this.target=i,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];for(let i=0;i<n;i++)this.textures.push(new Ia(t,{width:e,height:s,wrapS:c,wrapT:d,minFilter:h,magFilter:u,flipY:!1,generateMipmaps:!1})),this.textures[i].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+i,this.gl.TEXTURE_2D,this.textures[i].texture,0);if(this.texture=this.textures[0],o){const i=l==this.gl.COMPARE_REF_TO_TEXTURE?this.gl.LINEAR:this.gl.NEAREST;this.depthTexture=new Ia(t,{width:e,height:s,wrapS:c,wrapT:d,minFilter:i,magFilter:i,flipY:!1,format:this.gl.DEPTH_COMPONENT,internalFormat:this.gl.DEPTH_COMPONENT24,type:this.gl.UNSIGNED_INT,generateMipmaps:!1,compareMode:l}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)}else a&&!r&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,e,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),r&&!a&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,e,s),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),a&&r&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,e,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer));this.gl.bindFramebuffer(this.target,null)}}function Ba(t,e){return t[0]=e[0],t[1]=e[1],t}function Fa(t,e,s){return t[0]=e,t[1]=s,t}function za(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t}function Ua(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t}function Da(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t}function Aa(t,e,s,i){return t[0]=e[0]+s[0]*i,t[1]=e[1]+s[1]*i,t}function Ra(t){const e=t[0],s=t[1];return Math.sqrt(e*e+s*s)}function La(t){const e=t[0],s=t[1];return e*e+s*s}function Oa(t,e){const s=e[0],i=e[1];let n=s*s+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function _a(t,e){return t[0]===e[0]&&t[1]===e[1]}function Na(t,e,s){const i=Math.sin(s),n=Math.cos(s);return t[0]=e[1]*i+e[0]*n,t[1]=e[1]*n-e[0]*i,t}class Za{constructor(t,{width:e,height:s,dpr:i,wrapS:n=t.CLAMP_TO_EDGE,wrapT:a=t.CLAMP_TO_EDGE,minFilter:r=t.LINEAR,magFilter:o=t.LINEAR,resolution:l=1}={}){this.gl=t,this.options={wrapS:n,wrapT:a,minFilter:r,magFilter:o},this.passes=[],this.geometry=new Bn(t,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},Lz:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),this.resize({width:e,height:s,dpr:i,resolution:l})}addPass({vertex:t=qa,fragment:e=Ga,uniforms:s={},textureUniform:i="QV",enabled:n=!0,globalUniforms:a,postDraw:r}={}){s[i]={value:this.target.texture},s.jJ={value:this.original.texture},s.JF={value:this.original.depthTexture};const o=new zn(this.gl,{vertex:t,fragment:e,uniforms:s,globalUniforms:a}),l={mesh:new wa(this.geometry,o,this.gl.TRIANGLES),program:o,uniforms:s,enabled:n,textureUniform:i,postDraw:r};return this.passes.push(l),l}resize({width:t,height:e,dpr:s,resolution:i=1}={}){s&&(this.dpr=s),t&&(this.width=t*i,this.height=e*i),s=this.dpr||this.gl.renderer.dpr,t=(this.width||this.gl.renderer.width)*s,e=(this.height||this.gl.renderer.height)*s,this.options.width=t,this.options.height=e,this.target=new Pa(this.gl,{depthTexture:!0,...this.options}),this.original=new Pa(this.gl,{depthTexture:!0,...this.options}),this.ping=new Pa(this.gl,this.options),this.pong=new Pa(this.gl,this.options),this.passes.forEach(t=>{t.uniforms.jJ.value=this.original.texture,t.uniforms.JF.value=this.original.depthTexture})}render({scene:t,camera:e,target:s=null,update:i=!0,sort:n=!0,frustumCull:a=!0}){const r=this.passes.filter(t=>t.enabled);this.gl.renderer.render({scene:t,camera:e,target:r.length?this.original:s,update:i,sort:n,frustumCull:a}),r.forEach((t,e)=>{t.mesh.program.uniforms[t.textureUniform].value=e?e%2?this.ping.texture:this.pong.texture:this.target.texture,this.gl.renderer.render({scene:[t.mesh.transform],target:e==r.length-1?s:e%2?this.pong:this.ping,clear:!0}),t.postDraw&&t.postDraw()})}}const qa="#version 300 es\nin vec2 Lz;\nin vec2 position;\nout vec2 FS;\nvoid main() {\n    FS = Lz;\n    gl_Position = vec4(position, 0.0, 1.0);\n}",Ga="#version 300 es\nprecision highp float;\nuniform sampler2D QV;\nin vec2 FS;\nout vec4 IZ;\nvoid main() {\n    IZ = texture2D(QV, FS);\n}";let Ha,Xa,ja,Ja,Va,Ya;const Wa=[0,1,0],Qa=[0,0,0],Ka=[0,0,0],tr=[0,0,0],er=[0,0,0],sr=[0,0,0],ir=[0,0,0],nr=[0,0,0],ar=[0,0,0,0],rr=[0,0],or=[0,0],lr=t=>{Ya=t};let cr=0;const dr=t=>cr=t,hr=(t,e,s,i,n,a)=>{Ha=t,Xa=e,ja=s,Ja=i,Va=n},ur=new Map,mr=()=>{window.hordes={events:{on:pr,remove:fr},get loc(){return tn},getCreatureName:t=>Ya.entities.map.has(t)&&Ya.entity(t).name},window.hordes.events.on("creatureTakeDamage",(t,e,s,i)=>{console.log(t,e,s,i)})},pr=(t,e)=>(ur.has(t)?ur.get(t).push(e):ur.set(t,[e]),e),fr=(t,e)=>{if(!ur.has(t))return!1;ur.get(t).splice(ur.get(t).indexOf(e),1)},gr=(t,e,s)=>Math.min(Math.max(t,e),s),vr=(t,e)=>(t%e+e)%e,yr=(t,e,s)=>{const i=gr((s-t)/(e-t),0,1);return i*i*(3-2*i)},br={linear:t=>t,easeInQuad:t=>t*t,easeInQuart:t=>t**4,easeOutQuad:t=>t*(2-t),easeOutExpo:t=>1-Math.pow(2,-10*t),easeOutFlick:t=>1-Math.pow(1-t,10),sin:t=>Math.sin(3.14*t),sinReverse:t=>1-Math.sin(3.14*t),easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,anticipate:t=>-1/(1+Math.exp(50*(t-.5)))+1.4*Math.sin(6.2*(t-.5))*(1-.5*t)+1},xr=2*Math.PI,wr=3*Math.PI,kr=t=>t<0||t>xr?(t%xr+xr)%xr:t,$r=(t,e,s,i)=>(dn(tr,i,s),dn(Ka,e,s),bn(tr,tr,Ka),vn(t,tr)),Sr=t=>{let e=Math.atan2(t[0],t[1]);return e<0&&(e+=2*Math.PI),e},Mr=t=>{let e=Math.atan2(t[0],t[2]);return e<0&&(e+=2*Math.PI),e},Er=(t,e)=>(e-t+wr)%xr-Math.PI,Cr=(t,e,s,i)=>{hn(Ka,e,1-i),hn(tr,s,i),ln(t,Ka,tr)},Tr=(t,e,s)=>{dn(Ka,s,t);const i=yn(Ka,e);return un(Ka,t,e,i)},Ir=(t,e,s,i,n)=>{const a=dn(Ka,s,e),r=dn(tr,i,e),o=dn(er,n,e),l=yn(a,a),c=yn(a,r),d=yn(r,r),h=-yn(o,a),u=-yn(o,r),m=l*d-c*c;let p=c*u-d*h,f=c*h-l*u;if(p+f<=m)if(p<0)f<0&&h<0?(f=0,p=-h>=l?1:-h/l):(p=0,f=u>=0?0:-u>=d?1:-u/d);else if(f<0)f=0,p=h>=0?0:-h>=l?1:-h/l;else{const t=1/m;p*=t,f*=t}else if(p<0){const t=c+h,e=d+u;if(e>t){const s=e-t,i=l-2*c+d;s>=i?(p=1,f=0):(p=s/i,f=1-p)}else p=0,f=e<=0?1:u>=0?0:-u/d}else if(f<0){const t=c+u,e=l+h;if(e>t){const s=e-t,i=l-2*c+d;s>=i?(f=1,p=0):(f=s/i,p=1-f)}else f=0,p=e<=0?1:h>=0?0:-h/l}else{const t=d+u-c-h;if(t<=0)p=0,f=1;else{const e=l-2*c+d;t>=e?(p=1,f=0):(p=t/e,f=1-p)}}return hn(t,r,f),un(t,t,a,p),ln(t,e,t)},Pr=(t,e)=>(t[0]=e[0],t[1]=e[2],t),Br=(t,e,s)=>(t[0]=e[0]+s[0],t[2]=e[2]+s[1],t),Fr=(t,e,s,i,n,a)=>{dn(Ka,e,t),dn(tr,s,t),bn(er,Ka,tr);let r,o=yn(n,er);if(o>0){if(!a)return 1/0;r=1}else{if(!(o<0))return 1/0;r=-1,o=-o}dn(sr,i,t);const l=r*yn(n,bn(tr,sr,tr));if(l<0)return 1/0;const c=r*yn(n,bn(Ka,Ka,sr));if(c<0)return 1/0;if(l+c>o)return 1/0;const d=-r*yn(sr,er);return d<0?1/0:d/o},zr=(t,e,s,i)=>{let n=0,a=0,r=1;return e.length>2&&(n=i.findIndex(t=>t>=s),n<0&&(n=i.length),a=n>0?i[n-1]:0,r=n>=i.length?1:i[n]),xn(t,e[n],e[n+1],(s-a)/(r-a)),n};function Ur(t){if(t>Kr)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return e.__proto__=Dr.prototype,e}function Dr(t,e,s){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return Rr(t)}return Ar(t,e,s)}function Ar(t,e,s){if(ArrayBuffer.isView(t))return Lr(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Yr(t,ArrayBuffer)||t&&Yr(t.buffer,ArrayBuffer))return Or(t,e,s);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return Dr.from(i,e,s);const n=_r(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return Dr.from(t[Symbol.toPrimitive]("string"),e,s);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function Rr(t){return Ur(t<0?0:0|Nr(t))}function Lr(t){const e=t.length<0?0:0|Nr(t.length),s=Ur(e);for(let i=0;i<e;i+=1)s[i]=255&t[i];return s}function Or(t,e,s){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(s||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===e&&void 0===s?new Uint8Array(t):void 0===s?new Uint8Array(t,e):new Uint8Array(t,e,s),i.__proto__=Dr.prototype,i}function _r(t){if(Dr.isBuffer(t)){const e=0|Nr(t.length),s=Ur(e);return 0===s.length||t.copy(s,0,0,e),s}return void 0!==t.length?"number"!=typeof t.length||Wr(t.length)?Ur(0):Lr(t):"Buffer"===t.type&&Array.isArray(t.data)?Lr(t.data):void 0}function Nr(t){return 0|t}function Zr(t,e){if(Dr.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Yr(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const s=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===s)return 0;let n=!1;for(;;)switch(e){case"ascii":return s;case"utf8":case"utf-8":return Jr(t).length;case"hex":return s>>>1;default:if(n)return i?-1:Jr(t).length;e=(""+e).toLowerCase(),n=!0}}function qr(t,e,s){return(void 0===e||e<0)&&(e=0),e>this.length?"":((void 0===s||s>this.length)&&(s=this.length),s<=0||(s>>>=0)<=(e>>>=0)?"":Hr(this,e,s))}function Gr(t,e,s,i){return Vr(Jr(e,t.length-s),t,s,i)}function Hr(t,e,s){s=Math.min(t.length,s);const i=[];let n=e;for(;n<s;){const e=t[n];let a=null,r=e>239?4:e>223?3:e>191?2:1;if(n+r<=s){let s,i,o,l;switch(r){case 1:e<128&&(a=e);break;case 2:s=t[n+1],128==(192&s)&&(l=(31&e)<<6|63&s,l>127&&(a=l));break;case 3:s=t[n+1],i=t[n+2],128==(192&s)&&128==(192&i)&&(l=(15&e)<<12|(63&s)<<6|63&i,l>2047&&(l<55296||l>57343)&&(a=l));break;case 4:s=t[n+1],i=t[n+2],o=t[n+3],128==(192&s)&&128==(192&i)&&128==(192&o)&&(l=(15&e)<<18|(63&s)<<12|(63&i)<<6|63&o,l>65535&&l<1114112&&(a=l))}}null===a?(a=65533,r=1):a>65535&&(a-=65536,i.push(a>>>10&1023|55296),a=56320|1023&a),i.push(a),n+=r}return jr(i)}"undefined"!=typeof Symbol&&null!=Symbol.species&&Dr[Symbol.species]===Dr&&Object.defineProperty(Dr,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Dr.from=function(t,e,s){return Ar(t,e,s)},Dr.prototype.__proto__=Uint8Array.prototype,Dr.__proto__=Uint8Array,Dr.allocUnsafe=function(t){return Rr(t)},Dr.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==Dr.prototype},Dr.byteLength=Zr,Dr.prototype._isBuffer=!0,Dr.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?Hr(this,0,t):qr.apply(this,arguments)},Dr.prototype.write=function(t,e,s,i){if(void 0===e)s=this.length,e=0;else if(void 0===s&&"string"==typeof e)s=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(s)?s>>>=0:s=void 0}const n=this.length-e;if((void 0===s||s>n)&&(s=n),t.length>0&&(s<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");return Gr(this,t,e,s)};const Xr=4096;function jr(t){const e=t.length;if(e<=Xr)return String.fromCharCode.apply(String,t);let s="",i=0;for(;i<e;)s+=String.fromCharCode.apply(String,t.slice(i,i+=Xr));return s}function Jr(t,e){let s;e=e||1/0;const i=t.length;let n=null;const a=[];for(let r=0;r<i;++r){if(s=t.charCodeAt(r),s>55295&&s<57344){if(!n){if(s>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(r+1===i){(e-=3)>-1&&a.push(239,191,189);continue}n=s;continue}if(s<56320){(e-=3)>-1&&a.push(239,191,189),n=s;continue}s=65536+(n-55296<<10|s-56320)}else n&&(e-=3)>-1&&a.push(239,191,189);if(n=null,s<128){if((e-=1)<0)break;a.push(s)}else if(s<2048){if((e-=2)<0)break;a.push(s>>6|192,63&s|128)}else if(s<65536){if((e-=3)<0)break;a.push(s>>12|224,s>>6&63|128,63&s|128)}else{if(!(s<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}}return a}function Vr(t,e,s,i){let n=0;for(;n<i&&!(n+s>=e.length||n>=t.length);++n)e[n+s]=t[n];return n}function Yr(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function Wr(t){return t!=t}Dr.prototype.readUInt8=function(t){return this[t>>>=0]},Dr.prototype.readUInt16BE=function(t){return this[t>>>=0]<<8|this[t+1]},Dr.prototype.readUInt32BE=function(t){return 16777216*this[t>>>=0]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Dr.prototype.readInt8=function(t){return 128&this[t>>>=0]?-1*(255-this[t]+1):this[t]},Dr.prototype.readInt16BE=function(t){const e=this[(t>>>=0)+1]|this[t]<<8;return 32768&e?4294901760|e:e},Dr.prototype.readInt32BE=function(t){return this[t>>>=0]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Dr.prototype.writeUInt8=function(t,e){return t=+t,this[e>>>=0]=255&t,e+1},Dr.prototype.writeUInt16BE=function(t,e){return t=+t,this[e>>>=0]=t>>>8,this[e+1]=255&t,e+2},Dr.prototype.writeUInt32BE=function(t,e){return t=+t,this[e>>>=0]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},Dr.prototype.writeInt8=function(t,e){return(t=+t)<0&&(t=255+t+1),this[e>>>=0]=255&t,e+1},Dr.prototype.writeInt16BE=function(t,e){return t=+t,this[e>>>=0]=t>>>8,this[e+1]=255&t,e+2},Dr.prototype.writeInt32BE=function(t,e){return(t=+t)<0&&(t=4294967295+t+1),this[e>>>=0]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},Dr.prototype.readDoubleBE=function(t){let e=0,s=0;const i=8*8-52-1,n=(1<<i)-1,a=n>>1;let r=-7,o=0,l=this[(t>>>=0)+o];for(o+=1,e=l&(1<<-r)-1,l>>=-r,r+=i;r>0;e=256*e+this[t+o],o+=1,r-=8);for(s=e&(1<<-r)-1,e>>=-r,r+=52;r>0;s=256*s+this[t+o],o+=1,r-=8);if(0===e)e=1-a;else{if(e===n)return s?NaN:1/0*(l?-1:1);s+=Math.pow(2,52),e-=a}return(l?-1:1)*s*Math.pow(2,e-52)},Dr.prototype.writeDoubleBE=function(t,e){t=+t,e>>>=0;let s=52;const i=8;let n=0,a=0,r=0,o=8*i-s-1;const l=(1<<o)-1,c=l>>1,d=23===s?Math.pow(2,-24)-Math.pow(2,-77):0;let h=i-1;const u=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,n=l):(n=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-n))<1&&(n--,r*=2),(t+=n+c>=1?d/r:d*Math.pow(2,1-c))*r>=2&&(n++,r/=2),n+c>=l?(a=0,n=l):n+c>=1?(a=(t*r-1)*Math.pow(2,s),n+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,s),n=0));s>=8;this[e+h]=255&a,h-=1,a/=256,s-=8);for(n=n<<s|a,o+=s;o>0;this[e+h]=255&n,h-=1,n/=256,o-=8);return this[e+h+1]|=128*u,e+8},Dr.prototype.copy=function(t,e,s,i){if(!Dr.isBuffer(t))throw new TypeError("argument should be a Buffer");if(s||(s=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<s&&(i=s),i===s)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-s&&(i=t.length-e+s);const n=i-s;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,s,i);else if(this===t&&s<e&&e<i)for(let i=n-1;i>=0;--i)t[i+e]=this[i+s];else Uint8Array.prototype.set.call(t,this.subarray(s,i),e);return n};var Qr=Dr=Dr;const Kr=2147483647;let to=0;const eo="utf8",so={string:function(t){const e=Qr.byteLength(t,eo);return co(e)+e},varuint:function(t){return co(t)},varint:function(t){return ho(t)},buffer:function(t){const e=t.length;return co(e)+e}};function io(t,e){for(;t>127;)e[to++]=127&t|128,t>>=7;e[to++]=127&t}function no(t){let e,s=0,i=0;do{e=t[to++],s|=(127&e)<<7*i,i++}while(128&e);return s}function ao(t,e){const s=Qr.byteLength(t||"",eo);io(s,e),to+=e.write(t||"",to,s,eo)}function ro(t){const e=no(t),s=t.toString(eo,to,to+e);return to+=e,s}function oo(t,e){const s=t.length;io(s,e),t.copy(e,to),to+=s}function lo(t){const e=no(t),s=uo(e);return t.copy(s,0,to,to+e),to+=e,s}function co(t){return t<=0?1:Math.floor(Math.log(t)/Math.log(128))+1}function ho(t){return co(t<<1^t>>31)}const uo=function(t){return Qr.allocUnsafe(t)},mo={clientPlayerInput:{decode:t=>{const e={};to=0,e._header=t.readUInt8(to,!0),to+=1;const s=[];e.doubles=s;const i=no(t);for(let e=0;e<i;e++)s[e]=t.readDoubleBE(to,!0),to+=8;const n=[];e.int8s=n;const a=no(t);for(let e=0;e<a;e++)n[e]=t.readInt8(to,!0),to+=1;const r=[];e.uint16s=r;const o=no(t);for(let e=0;e<o;e++)r[e]=t.readUInt16BE(to,!0),to+=2;const l=[];e.uint8s=l;const c=no(t);for(let e=0;e<c;e++)l[e]=t.readUInt8(to,!0),to+=1;return e},encode:t=>{const e=t,s=e.doubles,i=e.int8s,n=e.uint16s,a=e.uint8s;let r=0;r+=1,r+=co(s.length);for(let t=0;t<s.length;t++)r+=8;r+=co(i.length);for(let t=0;t<i.length;t++)r+=1;r+=co(n.length);for(let t=0;t<n.length;t++)r+=2;r+=co(a.length);for(let t=0;t<a.length;t++)r+=1;const o=uo(r);to=0,to=o.writeUInt8(e._header,to,!0),io(s.length,o);for(let t=0;t<s.length;t++)to=o.writeDoubleBE(s[t],to,!0);io(i.length,o);for(let t=0;t<i.length;t++)to=o.writeInt8(i[t],to,!0);io(n.length,o);for(let t=0;t<n.length;t++)to=o.writeUInt16BE(n[t],to,!0);io(a.length,o);for(let t=0;t<a.length;t++)to=o.writeUInt8(a[t],to,!0);return o}},clientPlayerChangeTarget:{decode:t=>{const e={};return to=0,e._header=t.readUInt8(to,!0),to+=1,e.target=t.readUInt16BE(to,!0),to+=2,e},encode:t=>{const e=t;let s=0;s+=1,s+=2;const i=uo(s);return to=0,to=i.writeUInt8(e._header,to,!0),to=i.writeUInt16BE(e.target,to,!0),i}},clientPlayerSkill:{decode:t=>{const e={};to=0,e._header=t.readUInt8(to,!0),to+=1,e.id=t.readUInt16BE(to,!0),to+=2;const s=[];e.info=s;const i=no(t);for(let e=0;e<i;e++)s[e]=t.readUInt32BE(to,!0),to+=4;return e},encode:t=>{const e=t,s=e.info;let i=0;i+=1,i+=2,i+=co(s.length);for(let t=0;t<s.length;t++)i+=4;const n=uo(i);to=0,to=n.writeUInt8(e._header,to,!0),to=n.writeUInt16BE(e.id,to,!0),io(s.length,n);for(let t=0;t<s.length;t++)to=n.writeUInt32BE(s[t],to,!0);return n}},clientPlayerInteract:{decode:t=>{const e={};return to=0,e._header=t.readUInt8(to,!0),to+=1,e.id=t.readUInt8(to,!0),to+=1,e},encode:t=>{const e=t;let s=0;s+=1,s+=1;const i=uo(s);return to=0,to=i.writeUInt8(e._header,to,!0),to=i.writeUInt8(e.id,to,!0),i}},clientCommand:{decode:t=>{const e={};return to=0,e._header=t.readUInt8(to,!0),to+=1,e.command=ro(t),e.string=ro(t),e},encode:t=>{const e=t;let s=0;s+=1,s+=so.string(e.command),s+=so.string(e.string);const i=uo(s);return to=0,to=i.writeUInt8(e._header,to,!0),ao(e.command,i),ao(e.string,i),i}},serverOnClientConnect:{decode:t=>{const e={};return to=0,e._header=t.readUInt8(to,!0),to+=1,e.file=ro(t),e.playerId=t.readUInt16BE(to,!0),to+=2,e.tickId=t.readUInt32BE(to,!0),to+=4,e.world=ro(t),e},encode:t=>{const e=t;let s=0;s+=1,s+=so.string(e.file),s+=2,s+=4,s+=so.string(e.world);const i=uo(s);return to=0,to=i.writeUInt8(e._header,to,!0),ao(e.file,i),to=i.writeUInt16BE(e.playerId,to,!0),to=i.writeUInt32BE(e.tickId,to,!0),ao(e.world,i),i}},serverEntityDelta:{decode:t=>{const e={};to=0,e._header=t.readUInt8(to,!0),to+=1;const s=[];e.inputs=s;const i=no(t);for(let e=0;e<i;e++){const i={};s[e]=i,i.id=t.readUInt16BE(to,!0),to+=2,i.jump=t.readUInt8(to,!0),to+=1,i.rot=t.readDoubleBE(to,!0),to+=8,i.speed=t.readUInt16BE(to,!0),to+=2;const n=[];i.steer=n,n[0]=t.readInt8(to,!0),to+=1;const a=no(t);for(let e=1;e<a;e++)n[e]=t.readInt8(to,!0),to+=1}const n=[];e.log=n;const a=no(t);for(let e=0;e<a;e++){const s={};n[e]=s;const i=[];s.data=i,s.type=t.readUInt8(to,!0),to+=1;const a=no(t);for(let e=0;e<a;e++)i[e]=no(t)}const r=[];e.logPersonal=r;const o=no(t);for(let e=0;e<o;e++){const s={};r[e]=s;const i=[];s.data=i,s.type=t.readUInt8(to,!0),to+=1;const n=no(t);for(let e=0;e<n;e++)i[e]=no(t)}const l=[];e.movements=l;const c=no(t);for(let e=0;e<c;e++){const s={};l[e]=s,s.id=t.readUInt16BE(to,!0),to+=2;const i=[];s.Zc=i,i[0]=t.readDoubleBE(to,!0),to+=8,i[1]=t.readDoubleBE(to,!0),to+=8;const n=[];s.vel=n,n[0]=t.readDoubleBE(to,!0),to+=8,n[1]=t.readDoubleBE(to,!0),to+=8;const a=no(t);for(let e=2;e<a;e++){n[e]=t.readDoubleBE(to,!0),to+=8;const s=no(t);for(let e=2;e<s;e++)i[e]=t.readDoubleBE(to,!0),to+=8}}return e.tickId=t.readUInt32BE(to,!0),to+=4,e},encode:t=>{const e=t,s=e.inputs,i=e.log,n=e.logPersonal,a=e.movements;let r=0;r+=1,r+=co(s.length);for(let t=0;t<s.length;t++){r+=2,r+=1,r+=8,r+=2;const e=s[t].steer;r+=1,r+=co(e.length);for(let t=1;t<e.length;t++)r+=1}r+=co(i.length);for(let t=0;t<i.length;t++){const e=i[t].data;r+=1,r+=co(e.length);for(let t=0;t<e.length;t++)r+=so.varuint(e[t])}r+=co(n.length);for(let t=0;t<n.length;t++){const e=n[t].data;r+=1,r+=co(e.length);for(let t=0;t<e.length;t++)r+=so.varuint(e[t])}r+=co(a.length);for(let t=0;t<a.length;t++){const e=a[t];r+=2;const s=e.Zc;r+=8,r+=8;const i=e.vel;r+=8,r+=8,r+=co(i.length);for(let t=2;t<i.length;t++){r+=8,r+=co(s.length);for(let t=2;t<s.length;t++)r+=8}}r+=4;const o=uo(r);to=0,to=o.writeUInt8(e._header,to,!0),io(s.length,o);for(let t=0;t<s.length;t++){const e=s[t];to=o.writeUInt16BE(e.id,to,!0),to=o.writeUInt8(e.jump,to,!0),to=o.writeDoubleBE(e.rot,to,!0),to=o.writeUInt16BE(e.speed,to,!0);const i=e.steer;to=o.writeInt8(i[0],to,!0),io(i.length,o);for(let t=1;t<i.length;t++)to=o.writeInt8(i[t],to,!0)}io(i.length,o);for(let t=0;t<i.length;t++){const e=i[t],s=e.data;to=o.writeUInt8(e.type,to,!0),io(s.length,o);for(let t=0;t<s.length;t++)io(s[t],o)}io(n.length,o);for(let t=0;t<n.length;t++){const e=n[t],s=e.data;to=o.writeUInt8(e.type,to,!0),io(s.length,o);for(let t=0;t<s.length;t++)io(s[t],o)}io(a.length,o);for(let t=0;t<a.length;t++){const e=a[t];to=o.writeUInt16BE(e.id,to,!0);const s=e.Zc;to=o.writeDoubleBE(s[0],to,!0),to=o.writeDoubleBE(s[1],to,!0);const i=e.vel;to=o.writeDoubleBE(i[0],to,!0),to=o.writeDoubleBE(i[1],to,!0),io(i.length,o);for(let t=2;t<i.length;t++){to=o.writeDoubleBE(i[t],to,!0),io(s.length,o);for(let t=2;t<s.length;t++)to=o.writeDoubleBE(s[t],to,!0)}}return to=o.writeUInt32BE(e.tickId,to,!0),o}},serverPartyUpdate:{decode:t=>{const e={};to=0,e._header=t.readUInt8(to,!0),to+=1;const s=[];e.members=s;const i=no(t);for(let e=0;e<i;e++){const i={};s[e]=i,i.class=t.readUInt8(to,!0),to+=1,i.entityid=t.readUInt16BE(to,!0),to+=2,i.level=t.readUInt8(to,!0),to+=1,i.name=ro(t),i.role=t.readUInt16BE(to,!0),to+=2,i.world=ro(t)}const n=[];e.queues=n;const a=no(t);for(let e=0;e<a;e++)n[e]=ro(t);return e},encode:t=>{const e=t,s=e.members,i=e.queues;let n=0;n+=1,n+=co(s.length);for(let t=0;t<s.length;t++){const e=s[t];n+=1,n+=2,n+=1,n+=so.string(e.name),n+=2,n+=so.string(e.world)}n+=co(i.length);for(let t=0;t<i.length;t++)n+=so.string(i[t]);const a=uo(n);to=0,to=a.writeUInt8(e._header,to,!0),io(s.length,a);for(let t=0;t<s.length;t++){const e=s[t];to=a.writeUInt8(e.class,to,!0),to=a.writeUInt16BE(e.entityid,to,!0),to=a.writeUInt8(e.level,to,!0),ao(e.name,a),to=a.writeUInt16BE(e.role,to,!0),ao(e.world,a)}io(i.length,a);for(let t=0;t<i.length;t++)ao(i[t],a);return a}},serverWarUpdate:{decode:t=>{const e={};to=0,e._header=t.readUInt8(to,!0),to+=1,e.contrib=no(t);const s=[];e.contributors=s;const i=no(t);for(let e=0;e<i;e++){const i={};s[e]=i,i.class=t.readUInt8(to,!0),to+=1,i.faction=t.readUInt8(to,!0),to+=1,i.level=t.readUInt8(to,!0),to+=1,i.name=ro(t);const n=[];i.stats=n;const a=no(t);for(let e=0;e<a;e++)n[e]=no(t)}e.duration=no(t);const n=[];e.kills=n,n[0]=no(t);const a=no(t);for(let e=1;e<a;e++)n[e]=no(t);return e.level=no(t),e.reward=no(t),e.status=t.readUInt8(to,!0),to+=1,e},encode:t=>{const e=t,s=e.contributors,i=e.kills;let n=0;n+=1,n+=so.varuint(e.contrib),n+=co(s.length);for(let t=0;t<s.length;t++){const e=s[t];n+=1,n+=1,n+=1,n+=so.string(e.name);const i=e.stats;n+=co(i.length);for(let t=0;t<i.length;t++)n+=so.varuint(i[t])}n+=so.varuint(e.duration),n+=so.varuint(i[0]),n+=co(i.length);for(let t=1;t<i.length;t++)n+=so.varuint(i[t]);n+=so.varuint(e.level),n+=so.varuint(e.reward),n+=1;const a=uo(n);to=0,to=a.writeUInt8(e._header,to,!0),io(e.contrib,a),io(s.length,a);for(let t=0;t<s.length;t++){const e=s[t];to=a.writeUInt8(e.class,to,!0),to=a.writeUInt8(e.faction,to,!0),to=a.writeUInt8(e.level,to,!0),ao(e.name,a);const i=e.stats;io(i.length,a);for(let t=0;t<i.length;t++)io(i[t],a)}io(e.duration,a),io(i[0],a),io(i.length,a);for(let t=1;t<i.length;t++)io(i[t],a);return io(e.level,a),io(e.reward,a),to=a.writeUInt8(e.status,to,!0),a}},serverPartyPositions:{decode:t=>{const e={};to=0,e._header=t.readUInt8(to,!0),to+=1;const s=[];e.members=s;const i=no(t);for(let e=0;e<i;e++){const i={};s[e]=i,i.entityid=t.readUInt16BE(to,!0),to+=2;const n=[];i.Zc=n;const a=no(t);for(let e=0;e<a;e++)n[e]=t.readUInt16BE(to,!0),to+=2}return e},encode:t=>{const e=t,s=e.members;let i=0;i+=1,i+=co(s.length);for(let t=0;t<s.length;t++){i+=2;const e=s[t].Zc;i+=co(e.length);for(let t=0;t<e.length;t++)i+=2}const n=uo(i);to=0,to=n.writeUInt8(e._header,to,!0),io(s.length,n);for(let t=0;t<s.length;t++){const e=s[t];to=n.writeUInt16BE(e.entityid,to,!0);const i=e.Zc;io(i.length,n);for(let t=0;t<i.length;t++)to=n.writeUInt16BE(i[t],to,!0)}return n}},serverMapUpdate:{decode:t=>{const e={};to=0,e._header=t.readUInt8(to,!0),to+=1;const s=[];e.wars=s;const i=no(t);for(let e=0;e<i;e++){const i={};s[e]=i,i.active=!!t.readUInt8(to,!0),to+=1;const n=[];i.Zc=n,n[0]=t.readUInt16BE(to,!0),to+=2,i.size=t.readUInt16BE(to,!0),to+=2;const a=no(t);for(let e=1;e<a;e++)n[e]=t.readUInt16BE(to,!0),to+=2}return e},encode:t=>{const e=t,s=e.wars;let i=0;i+=1,i+=co(s.length);for(let t=0;t<s.length;t++){i+=1;const e=s[t].Zc;i+=2,i+=2,i+=co(e.length);for(let t=1;t<e.length;t++)i+=2}const n=uo(i);to=0,to=n.writeUInt8(e._header,to,!0),io(s.length,n);for(let t=0;t<s.length;t++){const e=s[t];to=n.writeUInt8(e.active?1:0,to,!0);const i=e.Zc;to=n.writeUInt16BE(i[0],to,!0),to=n.writeUInt16BE(e.size,to,!0),io(i.length,n);for(let t=1;t<i.length;t++)to=n.writeUInt16BE(i[t],to,!0)}return n}},serverChat:{decode:t=>{const e={};to=0,e._header=t.readUInt8(to,!0),to+=1;const s=[];e.messages=s;const i=no(t);for(let e=0;e<i;e++){const i={};s[e]=i,i.channel=ro(t),i.clan=ro(t),i.class=t.readUInt8(to,!0),to+=1,i.faction=t.readUInt8(to,!0),to+=1,i.from=ro(t),i.id=t.readUInt32BE(to,!0),to+=4,i.level=t.readUInt8(to,!0),to+=1,i.message=ro(t),i.subscribed=t.readUInt8(to,!0),to+=1}return e},encode:t=>{const e=t,s=e.messages;let i=0;i+=1,i+=co(s.length);for(let t=0;t<s.length;t++){const e=s[t];i+=so.string(e.channel),i+=so.string(e.clan),i+=1,i+=1,i+=so.string(e.from),i+=4,i+=1,i+=so.string(e.message),i+=1}const n=uo(i);to=0,to=n.writeUInt8(e._header,to,!0),io(s.length,n);for(let t=0;t<s.length;t++){const e=s[t];ao(e.channel,n),ao(e.clan,n),to=n.writeUInt8(e.class,to,!0),to=n.writeUInt8(e.faction,to,!0),ao(e.from,n),to=n.writeUInt32BE(e.id,to,!0),to=n.writeUInt8(e.level,to,!0),ao(e.message,n),to=n.writeUInt8(e.subscribed,to,!0)}return n}},serverSystemMessage:{decode:t=>{const e={};to=0,e._header=t.readUInt8(to,!0),to+=1;const s=[];e.messages=s;const i=no(t);for(let e=0;e<i;e++){const i={};s[e]=i,i.message=ro(t),i.type=ro(t)}return e},encode:t=>{const e=t,s=e.messages;let i=0;i+=1,i+=co(s.length);for(let t=0;t<s.length;t++){const e=s[t];i+=so.string(e.message),i+=so.string(e.type)}const n=uo(i);to=0,to=n.writeUInt8(e._header,to,!0),io(s.length,n);for(let t=0;t<s.length;t++){const e=s[t];ao(e.message,n),ao(e.type,n)}return n}},ping:{decode:t=>{const e={};return to=0,e._header=t.readUInt8(to,!0),to+=1,e.id=t.readUInt8(to,!0),to+=1,e},encode:t=>{const e=t;let s=0;s+=1,s+=1;const i=uo(s);return to=0,to=i.writeUInt8(e._header,to,!0),to=i.writeUInt8(e.id,to,!0),i}}},po={world:{decode:t=>{const e={};to=0,e.chunkAmount=t.readUInt8(to,!0),to+=1;const s=[];e.cols=s;const i=no(t);for(let e=0;e<i;e++){const i={};s[e]=i,i.ambient=t.readUInt32BE(to,!0),to+=4,i.directional=t.readUInt32BE(to,!0),to+=4,i.fog=t.readUInt32BE(to,!0),to+=4,i.sky=t.readUInt32BE(to,!0),to+=4}const n=[];e.settings=n;const a=no(t);for(let e=0;e<a;e++){const s={};n[e]=s,s.id=ro(t),s.value=ro(t)}const r=[];e.spawns=r;const o=no(t);for(let e=0;e<o;e++){const s={};r[e]=s,s.class=t.readUInt16BE(to,!0),to+=2,s.faction=t.readUInt8(to,!0),to+=1,s.id=t.readUInt16BE(to,!0),to+=2;const i=[];s.meta=i,s.name=ro(t),s.Zc=t.readUInt32BE(to,!0),to+=4,s.rot=t.readUInt8(to,!0),to+=1;const n=no(t);for(let e=0;e<n;e++)i[e]=t.readUInt32BE(to,!0),to+=4}const l=[];e.water=l;const c=no(t);for(let e=0;e<c;e++){const s={};l[e]=s,s.Tp=t.readUInt32BE(to,!0),to+=4,s.Hd=t.readUInt32BE(to,!0),to+=4,s.Rj=t.readUInt32BE(to,!0),to+=4;const i=[];s.Zc=i,i[0]=t.readUInt16BE(to,!0),to+=2,i[1]=t.readUInt16BE(to,!0),to+=2,s.rot=t.readInt8(to,!0),to+=1,s.speed=t.readUInt8(to,!0),to+=1,s.sx=t.readUInt16BE(to,!0),to+=2,s.sz=t.readUInt16BE(to,!0),to+=2,s.visibility=t.readUInt8(to,!0),to+=1,s.Xj=t.readUInt8(to,!0),to+=1,s.aX=t.readUInt8(to,!0),to+=1,s.vk=t.readUInt8(to,!0),to+=1;const n=no(t);for(let e=2;e<n;e++)i[e]=t.readUInt16BE(to,!0),to+=2}return e},encode:t=>{const e=t,s=e.cols,i=e.settings,n=e.spawns,a=e.water;let r=0;r+=1,r+=co(s.length);for(let t=0;t<s.length;t++){s[t];r+=4,r+=4,r+=4,r+=4}r+=co(i.length);for(let t=0;t<i.length;t++){const e=i[t];r+=so.string(e.id),r+=so.string(e.value)}r+=co(n.length);for(let t=0;t<n.length;t++){const e=n[t];r+=2,r+=1,r+=2;const s=e.meta;r+=so.string(e.name),r+=4,r+=1,r+=co(s.length);for(let t=0;t<s.length;t++)r+=4}r+=co(a.length);for(let t=0;t<a.length;t++){r+=4,r+=4,r+=4;const e=a[t].Zc;r+=2,r+=2,r+=1,r+=1,r+=2,r+=2,r+=1,r+=1,r+=1,r+=1,r+=co(e.length);for(let t=2;t<e.length;t++)r+=2}const o=uo(r);to=0,to=o.writeUInt8(e.chunkAmount,to,!0),io(s.length,o);for(let t=0;t<s.length;t++){const e=s[t];to=o.writeUInt32BE(e.ambient,to,!0),to=o.writeUInt32BE(e.directional,to,!0),to=o.writeUInt32BE(e.fog,to,!0),to=o.writeUInt32BE(e.sky,to,!0)}io(i.length,o);for(let t=0;t<i.length;t++){const e=i[t];ao(e.id,o),ao(e.value,o)}io(n.length,o);for(let t=0;t<n.length;t++){const e=n[t];to=o.writeUInt16BE(e.class,to,!0),to=o.writeUInt8(e.faction,to,!0),to=o.writeUInt16BE(e.id,to,!0);const s=e.meta;ao(e.name,o),to=o.writeUInt32BE(e.Zc,to,!0),to=o.writeUInt8(e.rot,to,!0),io(s.length,o);for(let t=0;t<s.length;t++)to=o.writeUInt32BE(s[t],to,!0)}io(a.length,o);for(let t=0;t<a.length;t++){const e=a[t];to=o.writeUInt32BE(e.Tp,to,!0),to=o.writeUInt32BE(e.Hd,to,!0),to=o.writeUInt32BE(e.Rj,to,!0);const s=e.Zc;to=o.writeUInt16BE(s[0],to,!0),to=o.writeUInt16BE(s[1],to,!0),to=o.writeInt8(e.rot,to,!0),to=o.writeUInt8(e.speed,to,!0),to=o.writeUInt16BE(e.sx,to,!0),to=o.writeUInt16BE(e.sz,to,!0),to=o.writeUInt8(e.visibility,to,!0),to=o.writeUInt8(e.Xj,to,!0),to=o.writeUInt8(e.aX,to,!0),to=o.writeUInt8(e.vk,to,!0),io(s.length,o);for(let t=2;t<s.length;t++)to=o.writeUInt16BE(s[t],to,!0)}return o}},chunk:{decode:t=>{const e={};to=0,e.color=lo(t),e.foliage=lo(t),e.id=t.readUInt16BE(to,!0),to+=2;const s=[];e.props=s;const i=no(t);for(let e=0;e<i;e++){const i={};s[e]=i,i.id=t.readUInt32BE(to,!0),to+=4,i.rx=t.readInt16BE(to,!0),to+=2,i.ry=t.readInt16BE(to,!0),to+=2,i.rz=t.readInt16BE(to,!0),to+=2,i.scale=t.readUInt16BE(to,!0),to+=2,i.x=t.readUInt16BE(to,!0),to+=2,i.y=t.readUInt32BE(to,!0),to+=4,i.z=t.readUInt16BE(to,!0),to+=2}return e.terrain=lo(t),e},encode:t=>{const e=t,s=e.props;let i=0;i+=so.buffer(e.color),i+=so.buffer(e.foliage),i+=2,i+=co(s.length);for(let t=0;t<s.length;t++){s[t];i+=4,i+=2,i+=2,i+=2,i+=2,i+=2,i+=4,i+=2}i+=so.buffer(e.terrain);const n=uo(i);to=0,oo(e.color,n),oo(e.foliage,n),to=n.writeUInt16BE(e.id,to,!0),io(s.length,n);for(let t=0;t<s.length;t++){const e=s[t];to=n.writeUInt32BE(e.id,to,!0),to=n.writeInt16BE(e.rx,to,!0),to=n.writeInt16BE(e.ry,to,!0),to=n.writeInt16BE(e.rz,to,!0),to=n.writeUInt16BE(e.scale,to,!0),to=n.writeUInt16BE(e.x,to,!0),to=n.writeUInt32BE(e.y,to,!0),to=n.writeUInt16BE(e.z,to,!0)}return oo(e.terrain,n),n}},modelformat:{decode:t=>{const e={};to=0;const s=[];e.coll=s;const i=no(t);for(let e=0;e<i;e++)s[e]=no(t);e.doubleSided=!!t.readUInt8(to,!0),to+=1;const n=[];e.effects=n;const a=no(t);for(let e=0;e<a;e++){const s={};n[e]=s,s.id=ro(t);const i=[];s.Zc=i;const a=no(t);for(let e=0;e<a;e++)i[e]=t.readDoubleBE(to,!0),to+=8}e.flipBacksideNormal=!!t.readUInt8(to,!0),to+=1;const r=[];e.index=r;const o=no(t);for(let e=0;e<o;e++)r[e]=no(t);e.name=ro(t);const l=[];e.Jw=l;const c=no(t);for(let e=0;e<c;e++)l[e]=t.readInt8(to,!0),to+=1;const d=[];e.position=d;const h=no(t);for(let e=0;e<h;e++)d[e]=t.readInt8(to,!0),to+=1;e.receiveShadow=!!t.readUInt8(to,!0),to+=1,e.sx=t.readUInt32BE(to,!0),to+=4,e.sy=t.readUInt32BE(to,!0),to+=4,e.sz=t.readUInt32BE(to,!0),to+=4,e.texture=ro(t),e.textureTile=t.readUInt8(to,!0),to+=1,e.throwShadow=!!t.readUInt8(to,!0),to+=1;const u=[];e.Lz=u;const m=no(t);for(let e=0;e<m;e++)u[e]=t.readUInt8(to,!0),to+=1;return e},encode:t=>{const e=t,s=e.coll,i=e.effects,n=e.index,a=e.Jw,r=e.position,o=e.Lz;let l=0;l+=co(s.length);for(let t=0;t<s.length;t++)l+=so.varuint(s[t]);l+=1,l+=co(i.length);for(let t=0;t<i.length;t++){const e=i[t];l+=so.string(e.id);const s=e.Zc;l+=co(s.length);for(let t=0;t<s.length;t++)l+=8}l+=1,l+=co(n.length);for(let t=0;t<n.length;t++)l+=so.varuint(n[t]);l+=so.string(e.name),l+=co(a.length);for(let t=0;t<a.length;t++)l+=1;l+=co(r.length);for(let t=0;t<r.length;t++)l+=1;l+=1,l+=4,l+=4,l+=4,l+=so.string(e.texture),l+=1,l+=1,l+=co(o.length);for(let t=0;t<o.length;t++)l+=1;const c=uo(l);to=0,io(s.length,c);for(let t=0;t<s.length;t++)io(s[t],c);to=c.writeUInt8(e.doubleSided?1:0,to,!0),io(i.length,c);for(let t=0;t<i.length;t++){const e=i[t];ao(e.id,c);const s=e.Zc;io(s.length,c);for(let t=0;t<s.length;t++)to=c.writeDoubleBE(s[t],to,!0)}to=c.writeUInt8(e.flipBacksideNormal?1:0,to,!0),io(n.length,c);for(let t=0;t<n.length;t++)io(n[t],c);ao(e.name,c),io(a.length,c);for(let t=0;t<a.length;t++)to=c.writeInt8(a[t],to,!0);io(r.length,c);for(let t=0;t<r.length;t++)to=c.writeInt8(r[t],to,!0);to=c.writeUInt8(e.receiveShadow?1:0,to,!0),to=c.writeUInt32BE(e.sx,to,!0),to=c.writeUInt32BE(e.sy,to,!0),to=c.writeUInt32BE(e.sz,to,!0),ao(e.texture,c),to=c.writeUInt8(e.textureTile,to,!0),to=c.writeUInt8(e.throwShadow?1:0,to,!0),io(o.length,c);for(let t=0;t<o.length;t++)to=c.writeUInt8(o[t],to,!0);return c}}},fo=[];let go=0;for(const t in mo)mo[t]&&(mo[t].header=go++,mo[t].packData=function(t){return this.prepareData&&this.prepareData(t),t._header=this.header,this.encode(t)},fo.push(mo[t]));const vo=t=>{if(0===t.length)return;return fo[t.readUInt8(0,!1)]},yo=127,bo=254,xo=2**32-1,wo=t=>{t=po.modelformat.decode(t);const e=yo/(xo/t.sx),s=yo/(xo/t.sy),i=yo/(xo/t.sz);for(let n=0;n<t.position.length;n+=3)t.position[n+0]=t.position[n+0]/e,t.position[n+1]=t.position[n+1]/s,t.position[n+2]=t.position[n+2]/i;if(0==t.Lz.length)t.Lz.length=t.position.length/3*2,t.emptyUv=!0;else for(let e=0;e<t.Lz.length;++e)t.Lz[e]/=bo;for(let e=0,s=t.position.length;e<s;e++)t.Jw[e]=t.Jw[e]/yo;return t},ko=async(t,e,s,i,n,a=3)=>{switch(e.split(".").pop()){case"jpg":case"png":case"webp":{const a=new Image;a.onload=()=>{s[e]=i(a),n(s[e],t+e),a.onload=void 0},a.src=t+e+"?v=4597824";break}default:fetch(t+e+"?v=4597824").then(a=>{if(!a.ok)throw new Error;a.arrayBuffer().then(async a=>{s[e]=await i(a),n(s[e],t+e)})}).catch(r=>{console.log(e+" fetch failed"),a>1&&ko(t,e,s,i,n,--a)})}},$o={},So=(t,e)=>{for(let s=0,i=$o[e].length;s<i;++s)$o[e][s](...t);$o[e]=void 0},Mo=async(t,e,s,i,n)=>{s[e]?n(...s[e]):$o[t+e]?$o[t+e].push(n):($o[t+e]=[],$o[t+e].push(n),ko(t,e,s,i,So))},Eo=t=>{const e=wo(Qr.from(t));return[{position:{size:3,data:new Float32Array(e.position)},index:{type:5125,data:new Uint32Array(e.index)},Lz:{size:2,data:new Float32Array(e.Lz)},Jw:{size:3,data:new Float32Array(e.Jw)}},e]},Co={},To=(t,e)=>{Mo("assets/geometry/",t+=".ho",Co,Eo,e)},Io="webp",Po="webp";let Bo;const Fo={terrain:[]};let zo;const Uo=()=>{Bo=new wa(Ja.geometry,void 0,Ha.TRIANGLES),fetch("/assets/items/atlas.json?v=4597824").then(async t=>{zo=await t.json();for(const t in zo)"s"!=t&&(zo[t]=zo[t].map(t=>t/zo.s))})},Do=t=>{const e=new Ia(Ha,{wrapS:Ha.REPEAT,wrapT:Ha.REPEAT,minFilter:Ha.LINEAR_MIPMAP_LINEAR});return e.image=t,e.element=t,[e]},Ao={},Ro=(t,e)=>{if(Ya&&Ya.data){const e=Ya.data.settings.find(e=>e.id===t);e&&(t=e.value)}t.includes(".")||(t+=".png"),t=t.split(".")[0]+".webp",Mo("assets/textures/",t,Ao,Do,e)},Lo=(t,e,s)=>{Bo.program=new zn(s.gl,{vertex:qa,fragment:t,uniforms:{seed:{value:Date.now()%1e3}}});const i=new Pa(s.gl,{width:e,height:e,wrapT:s.gl.REPEAT,wrapS:s.gl.REPEAT});return s.render({scene:[Bo.transform],target:i}),i.texture};let Oo;const _o=(t,e,s)=>{Oo=e,Mo("assets/audio/",t+".ogg",Ao,No,s)},No=async t=>[await Oo.decodeAudioData(t)],Zo=(t,e)=>t+Math.random()*(e-t),qo=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,Go=t=>Ho(t,Math.random()),Ho=(t,e)=>t[Math.floor(e*t.length)],Xo={hammer:{audio:"weaponmetal",rot:1},bow:{audio:"weaponwood",rot:1},staff:{audio:"weaponwood",rot:1},sword:{audio:"weaponmetal",rot:1},armlet:{audio:"leather"},armor:{audio:"armor"},bag:{audio:"leather"},boot:{audio:"leather"},glove:{audio:"leather"},ring:{audio:"small"},amulet:{audio:"small"},quiver:{audio:"leather",rot:1},shield:{audio:"armor"},totem:{audio:"armor",rot:1},orb:{audio:"armor"},rune:{audio:"small",rot:0},misc:{audio:"potion",rot:1},book:{audio:"leather"},mount:{audio:"leather",rot:0},box:{audio:"box",rot:0},gold:{audio:"gold"},charm:{audio:"small"}},jo={hammer:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:3,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:15,min:.05,max:.1}}},bow:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:2,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}}},staff:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:1,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}}},sword:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:0,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:20,min:.05,max:.1}}},armlet:{baselvl:1,slot:[102],tiers:13,drop:1,weight:.3,stats:{6:{base:10,min:.5,max:.9},12:{base:7,min:.5,max:.8}}},armor:{baselvl:2,slot:[103],tiers:11,drop:1,weight:1,stats:{12:{base:10,min:1.4,max:2.8},6:{base:20,min:1,max:2}}},bag:{baselvl:5,slot:[104],tiers:5,drop:1,weight:.1,stats:{19:{base:1,min:.1,max:.3}}},boot:{baselvl:2,slot:[105],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.6,max:1.1},15:{base:3,min:.03,max:.1}}},glove:{baselvl:2,slot:[106],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.7,max:1.1},14:{base:1,min:.1,max:1.5}}},ring:{baselvl:5,slot:[107],tiers:12,drop:.8,weight:.2,stats:{6:{base:10,min:.5,max:.9},7:{base:5,min:.6,max:1}}},amulet:{baselvl:7,slot:[108],tiers:12,drop:.8,weight:.3,stats:{7:{base:10,min:1,max:1.8},9:{base:1,min:.2,max:.3}}},quiver:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:2,stats:{14:{base:5,min:.1,max:.9},9:{base:1,min:.1,max:.3}}},shield:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:0,stats:{12:{base:20,min:.8,max:1.4},13:{base:4,min:1,max:2.8}}},totem:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:3,stats:{12:{base:10,min:.4,max:.9},9:{base:1,min:.1,max:.4}}},orb:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:1,stats:{3:{base:10,min:.3,max:.7},9:{base:1,min:.1,max:.3}}},rune:{baselvl:1,tiers:11,drop:.8,quality:70},misc:{drop:7,weight:.1},book:{drop:1.5,weight:.5},charm:{slot:[110,111],noupgrade:!0,undroppable:!0,drop:0,stackable:!1},mount:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},box:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},gold:{drop:20}},Jo=Object.keys(jo),Vo={6:{min:.2,max:.8,round:!0},7:{min:.2,max:.5,round:!0},8:{min:.1,max:1},9:{min:.1,max:.5},10:{min:.03,max:.13,round:!0},11:{min:.1,max:.2,round:!0},12:{min:.1,max:.8,round:!0},13:{min:.1,max:.4},14:{min:.1,max:.5},16:{min:.1,max:.4},2:{min:.08,max:.45,round:!0},0:{min:.08,max:.45,round:!0},3:{min:.08,max:.45,round:!0},4:{min:.08,max:.45,round:!0},1:{min:.08,max:.45,round:!0},5:{min:.08,max:.45,round:!0},18:{min:.01,max:.15,round:!0}},Yo={6:4,7:3,8:5,9:4,10:1,11:1,12:5,13:5,14:5,15:.3,16:5,17:0,2:2,0:2,3:2,4:2,1:2,5:2,19:1,18:3};let Wo,Qo=[];const Ko=new Map,tl=new Map,el=t=>{Wo&&(ll(Wo.listener,Xa.transform.cX),Hn(ar,ja.cX),rn(Ka,0,0,1),$n(Ka,Ka,ar),rn(tr,0,1,0),$n(tr,tr,ar),Wo.listener.setOrientation(Ka[0],Ka[1],Ka[2],tr[0],tr[1],tr[2]),Qo.forEach(e=>{e.transform&&e.dynamic&&ll(e.panner,e.transform.cX),e.delay>0&&(e.delay-=t,e.delay<=0&&e.start(0,e.loop?Zo(0,1):0)),e.ended&&il(e.id)}),Qo=Qo.filter(t=>!t.ended))},sl=t=>{if(tl.has(t)){if(tl.get(t)>3)return!1;tl.set(t,tl.get(t)+1)}else tl.set(t,1);return!0},il=t=>{tl.set(t,Math.max(0,tl.get(t)-1))},nl=({id:t,loop:e,transform:s,type:i="sfx",distance:n,gain:a,delay:r,rndDelay:o=!1,rnd:l,pitch:c,force:d,dynamic:h=!1})=>{if(s&&!d){if(1/((tl.get(t)||0)+10+mn(ja.position,s.position))*1e3/(Qo.length+20)**1.2<.4)return}if(Qo.length>35&&!d||void 0===Wo||"suspended"==Wo.state)return;if(!sl(t)&&!d)return;const u=Wo.createBufferSource();u.id=t,l&&(t+=qo(1,l)),u.loop=e||!1,-1!==c&&(u.playbackRate.value=(c||1)*Zo(.95,1.05)),void 0!==al[t]?u.buffer=al[t]:rl(t,u);const m=Ko.get(i),p=a?Wo.createGain():m;return a&&(u.gain=p,p.connect(m)),s?(u.panner=Wo.createPanner(),u.panner.distanceModel="exponential",u.panner.refDistance=n,u.panner.rolloffFactor=1,u.transform=s,u.dynamic=h,u.connect(u.panner),u.panner.connect(p),ll(u.panner,s.cX)):u.connect(p),u.onended=cl,r?u.delay=o?Zo(0,r):r:u.start(0,e?Zo(0,1):0),Qo.push(u),u},al={},rl=(t,e)=>{_o(t,Wo,s=>{al[t]=s,e.buffer=s})},ol=t=>{Ya&&Ya.deserialized&&(Wo=new(window.AudioContext||window.webkitAudioContext),Ko.set("sfx",Wo.createGain()).get("sfx").connect(Wo.destination),Ko.set("music",Wo.createGain()).get("music").connect(Wo.destination),Ko.set("ambience",Wo.createGain()).get("ambience").connect(Wo.destination),rs.subscribe(t=>{Ko.get("sfx").gain.value=(t/100)**2}),os.subscribe(t=>{Ko.get("music").gain.value=(t/100)**2}),as.subscribe(t=>{Ko.get("ambience").gain.value=(t/100)**2}),ie.set(!0),document.removeEventListener("click",ol))};document.addEventListener("click",ol);const ll=(t,e)=>{t.setPosition(e[12],e[13],e[14])},cl=function(){this.ended=!0},dl=t=>{nl({id:"item/"+Xo[t].audio,loop:!1})},hl=t=>{Qo.length=0,tl.clear()},ul=[0,0],ml=[0,0],pl=[0,0],fl={},gl={},vl=function(t){return this.press.push(t),t},yl=function(t){return this.release.push(t),t},bl=(t,e)=>(e.press||(e.down=!1,e.onPress=vl,e.onRelease=yl,e.press=[],e.release=[],e.mappings=[],e.store||(e.store=jt(!1))),(t=Array.isArray(t)?t:[t]).forEach(t=>{gl[t]=e,e.mappings.push(t)}),se.set(fl),e),xl=()=>{bl(Qi.kbForward,fl.fwd={}),bl(Qi.kbLeft,fl.left={}),bl(Qi.kbBack,fl.back={}),bl(Qi.kbRight,fl.right={}),bl(Qi.kbNextTarget,fl.nextTarget={}),bl(Qi.kbUntarget,fl.untarget={}),bl(" ",fl.jump={}),bl(Qi.kbAltForward,fl.fwd),bl(Qi.kbAltBack,fl.back),bl(Qi.kbTurnRight,fl.turnright={}),bl(Qi.kbTurnLeft,fl.turnleft={}),bl("shift",fl.shift={}),bl("m0",fl.lmb={}),bl("m2",fl.rmb={}),bl("control",fl.ctrl={}),bl("alt",fl.alt={}),bl(Qi.kbMap,fl.map={}),bl(Qi.kbSkills,fl.skills={}).onPress(()=>{fs.update(t=>!t),nl({id:"page",loop:!1})}),bl(Qi.kbCharacter,fl.char={}).onPress(()=>{$s.update(t=>!t),nl({id:"page",loop:!1})}),bl(Qi.kbInventory,fl.inventory={}).onPress(()=>{ms.update(t=>!t),nl({id:"inventory",loop:!1})}),bl(Qi.kbClan,fl.clan={}).onPress(()=>{bs.update(t=>!t),nl({id:"inventory",loop:!1})}),bl(Qi.kbPvp,fl.pvp={}).onPress(()=>{xs.update(t=>!t),nl({id:"inventory",loop:!1})}),document.addEventListener("wheel",Il,{passive:!0}),document.addEventListener("keydown",Fl,!1),document.addEventListener("keyup",zl,!1),document.addEventListener("contextmenu",Pl,!1),document.addEventListener("mousedown",Cl,!1),document.addEventListener("mouseup",Tl,!1),document.addEventListener("mousemove",$l,!1)},wl=t=>{El&&(El=!1,!Qi.pointerlock||fl.lmb.down||fl.rmb.down||(document.exitPointerLock(),Ml=!1))};let kl=0;const $l=t=>{if(Fa(ul,t.x*Qi.resolutionScale/Ha.canvas.width*2-1,2*(1-t.y*Qi.resolutionScale/Ha.canvas.height)-1),Fa(ml,t.x,t.y),fl.rmb.down||fl.lmb.down){const e=gr(t.movementX,-100,100),s=gr(t.movementY,-100,100);pl[1]=pl[1]+.004*s*(Qi.invertMouseY?-Qi.mouseSensitivity:Qi.mouseSensitivity),pl[0]=kr(pl[0]-.005*e*(Qi.invertMouseX?-Qi.mouseSensitivity:Qi.mouseSensitivity)),kl+=Math.abs(s)+Math.abs(e)}};let Sl=!1;he.subscribe(t=>{Sl=void 0!==t});let Ml=!1,El=!1;const Cl=t=>{t.target!=Ha.canvas&&"chat"!=t.target.id||(Qi.pointerlock&&(Ml=!0,Ha.canvas.requestPointerLock()),Bl("m"+t.button,!0),Sl&&he.update(t=>{t&&t.discard&&t.discard()}))},Tl=t=>{Bl("m"+t.button,!1),kl=0,El=!0},Il=t=>{t.target==Ha.canvas&&Es.update(e=>gr(e+(t.deltaY>0?1:-1),2,18))},Pl=t=>{t.preventDefault()},Bl=(t,e,s)=>{const i=gl[t];return void 0!==i&&(i.down!=e&&(i.down=e,i[e?"press":"release"].forEach(t=>{t(s)}),i.store.set(i.down)),s&&s.preventDefault(),!0)},Fl=t=>{if(!Ul(t))return;const e=t.key.toLowerCase();t.ctrlKey&&Bl("ctrl+"+e,!0,t)||t.shiftKey&&Bl("shift+"+e,!0,t)||Bl(e,!0,t)},zl=t=>{if(!Ul(t))return;const e=t.key.toLowerCase();Bl("ctrl+"+e,!1),Bl("shift+"+e,!1),Bl(e,!1)},Ul=t=>{const e=t.target.tagName.toLowerCase();return"input"!==e&&"textarea"!==e};const Dl={frag:"snippet version;out vec4 IZ;in vec2 FS;in vec3 JK;snippet zj;uniform float time;uniform float Nt;uniform sampler2D TJ;void main(){gl_FragDepth=0.999997;vec2 Zc=vec2(FS.x+time*0.005,FS.y);float hZ=texture(TJ,Zc).r;hZ+=sin(Nt*6.28)*0.04-0.035;if(hZ<0.17){discard;}hZ=smoothstep(0.3,0.6,hZ);hZ*=smoothstep(0.0,0.3,JK.y);float Ug=max(dot(Wl,normalize(JK)),0.0);float Pd=max(0.0,pow(Ug,6.0))*0.3;vec3 base=mix(rJ+Pd+vec3(0.3),rJ+Pd+vec3(0.1),hZ);IZ=vec4(base,hZ);}"},Al={frag:"snippet version;precision highp float;in vec2 FS;uniform float seed;snippet Fd;snippet mK;out vec4 IZ;void main(){vec2 Zc=vec2(FS.x*0.7+seed,FS.y)*1.5;float hZ=0.0;const int uo=8;for(int i=1;i<uo;++i){float Dn=float(i);hZ+=noise(Zc*pow(Dn,1.2+Dn*0.05)+vec2(pow(Dn,3.5)*0.0002,Dn))/Dn;}hZ+=noise(Zc*25.0)/15.0;hZ+=noise(Zc*40.0)/35.0;hZ=hZ/(float(uo)-5.0)*0.8+0.05;hZ-=pow(max(0.0,abs(FS.x-0.5)),5.0)*18.0;IZ.rgb+=hZ;}"},Rl={frag:"snippet version;out vec4 IZ;snippet zj;uniform sampler2D pG;uniform float time;in vec2 FS;in vec4 jQ;void main(){snippet GK;vec4 result=texture(pG,FS);if(result.a<0.25)discard;result.rgb=mix(result.rgb*Dz,result.rgb*1.1,smoothstep(-0.7,0.7,sin(time*6.0+jQ.x)));snippet jz;IZ=result;}",vert:"snippet version;snippet zj;in vec2 Lz;in vec3 position;in vec3 Jw;in mat4 cX;in vec4 Fs;in vec4 MT;uniform mat4 kX;out vec4 jQ;out vec2 FS;void main(){jQ=MT;dh=cX*vec4(position,1.0);FS=Fs.zw-Lz*Fs.xy;snippet RK;gl_Position=kX*cX*vec4(position,1.0);}"},Ll={frag:"snippet version;snippet zj;uniform sampler2D zx;in vec3 BM;in float DZ;out vec4 IZ;in vec3 Lm;uniform float time;in vec2 BH;void main(){snippet GK;vec2 Lz=vec2(gl_PointCoord.x,gl_PointCoord.y)+vec2(cos(time*0.5+Lm.x*0.2)*sin(time*4.0+Lm.z*0.5)*(1.0-gl_PointCoord.y)*0.08,0.0);Lz.x=clamp(Lz.x,0.,1.)*0.25;Lz.y=1.0-clamp(Lz.y,0.,1.)*0.25;Lz+=BH;vec4 result=texture(zx,Lz);if(result.a<max(0.3,0.6-Mw*0.003))discard;float Gb=DZ*(0.9+sin(Lm.x*0.5)*0.05+cos(Lm.z*0.3)*0.05);result.rgb=result.rgb*BM+result.rgb*cG*Gb+result.rgb*Dz;snippet jz;IZ=result;}",vert:"snippet version;precision highp sampler2DShadow;snippet zj;snippet Jl;snippet shadowsEnabled;uniform mat4 Dt;uniform mat4 Ux;uniform mat4 oh;uniform sampler2DShadow LG;uniform vec2 resolution;in vec4 position;in float info;out vec3 Lm;out vec2 BH;out float DZ;snippet Cz;void main(){float id=1.0;BH=vec2(fract(info*0.25),-floor(info/4.0)*0.25);if(shadowsEnabled==1){vec4 Qj=Cz(oh*vec4(position.xyz,1));vec3 kq=(Qj.xyz/Qj.w)*0.5+0.5;DZ=texture(LG,kq);}else{DZ=1.0;}DZ*=0.65;Lm=position.xyz;vec4 dh=Dt*vec4(position.xyz,1);vec3 Gb=vec3(0.0);for(int i=0;i<uT;++i){vec3 uh=aA[i]-Lm.xyz;float uY=uG[i].w-dot(uh,uh);if(uY>0.0){uY/=(uG[i].w);uY=uY*uY;Gb+=max(0.2,dot(normalize(uh),vec3(0.0,1.0,0.0)))*uG[i].rgb*uY;;}}BM=Gb*0.65;Mw=length(dh.xyz);if(Mw>min(100.0,zn*0.6)){gl_PointSize=0.;gl_Position.w=0.0;}else{gl_PointSize=resolution[1]/(Mw)*position.w;}gl_Position=Ux*dh;}"},Ol={frag:"snippet version;precision highp sampler2DShadow;snippet zj;snippet shadowsEnabled;uniform sampler2DShadow LG;uniform int Hp;in vec3 BM;in vec4 qf;in vec3 GR;in vec3 NM;out vec4 IZ;\n#define RECIPROCAL_PI 0.31830988618\n#define LOG2 1.442695\n#define PI 3.14159265359\nvoid main(){snippet GK;float WV=(float(gl_FrontFacing)*2.0-1.0);float qn=1.0;if(shadowsEnabled==1&&Hp==1){qn=texture(LG,NM+vec3(0.0,0.0,-0.001*WV));}vec3 IJ=reflect(Wl,GR);float Bc=max(0.0,dot(normalize(Rq-dh.xyz),-IJ));Bc=pow(Bc*max(0.0,min(1.0,qf[3]*2.0))*1.5,5.0);vec3 pG=qf.rgb;vec3 ambient=Dz*PI;ambient*=RECIPROCAL_PI*pG;float GW=clamp(dot(GR*WV,Wl),0.0,1.0);vec3 directional=PI*BM+(GW*(PI*cG)+Bc)*qn;directional*=RECIPROCAL_PI*pG;vec3 MF=qf.rgb*max(qf[3]*0.5-0.5,-qf[3]);vec4 result=vec4(directional+ambient+MF,1.0);snippet jz;IZ=result;}",vert:"snippet version;snippet Jl;snippet zj;snippet shadowsEnabled;in vec3 position;in vec3 Jw;in vec4 color;in mat4 cX;uniform mat4 kX;uniform mat4 oh;out vec4 qf;out vec3 GR;out vec3 NM;snippet Cz;void main(){GR=normalize(mat3(cX)*Jw);dh=cX*vec4(position,1.0);qf=color;snippet RK;snippet Cq;if(shadowsEnabled==1){vec4 qS=Cz(oh*dh);NM=(qS.xyz/qS.w)*0.5+0.5;}gl_Position=kX*dh;}"},_l={frag:"snippet version;in vec4 qf;out vec4 IZ;void main(){IZ=qf;IZ.a=1.0;}",vert:"snippet version;in vec3 position;in vec4 color;in mat4 cX;uniform mat4 kX;out vec4 qf;void main(){qf=color;gl_Position=kX*cX*vec4(position,1.0);;}"},Nl={frag:"snippet version;precision highp sampler2DShadow;snippet zj;snippet shadowsEnabled;in vec3 BM;uniform sampler2D pG;uniform sampler2DShadow LG;uniform int Hp;in vec3 GR;in vec3 NM;in vec2 FS;out vec4 IZ;void main(){snippet GK;vec4 result=texture(pG,FS);if(result.a<0.5)discard;float WV=(float(gl_FrontFacing)*2.0-1.0);float VN=max(dot(GR*WV,Wl),0.0);if(shadowsEnabled==1&&Hp==1&&VN>0.0){float qg=texture(LG,NM);snippet TG;VN*=max(qg,TG);}result.rgb=result.rgb*BM+result.rgb*cG*VN+result.rgb*Dz;snippet jz;IZ=result;}",vert:"snippet version;snippet Jl;snippet zj;snippet shadowsEnabled;in vec2 Lz;in vec3 position;in vec3 Jw;in mat4 cX;uniform mat4 kX;uniform mat4 oh;out vec3 GR;out vec2 FS;out vec3 NM;snippet Cz;void main(){GR=normalize(mat3(cX)*Jw);FS=Lz;dh=cX*vec4(position,1.0);snippet RK;snippet Cq;if(shadowsEnabled==1){vec4 qS=Cz(oh*(dh+vec4(GR*0.2,0.0)));NM=(qS.xyz/qS.w)*0.5+0.5;}gl_Position=kX*dh;}"},Zl={vert:"snippet version;snippet Jl;snippet zj;snippet shadowsEnabled;in vec2 Lz;in vec3 position;in vec3 Jw;in float JC;in mat4 cX;uniform mat4 kX;uniform mat4 oh;out vec3 GR;out vec2 FS;out vec3 NM;snippet Cz;void main(){GR=normalize(mat3(cX)*Jw);FS=Lz*JC;dh=cX*vec4(position,1.0);snippet RK;snippet Cq;if(shadowsEnabled==1){vec4 qS=Cz(oh*(dh+vec4(GR*0.2,0.0)));NM=(qS.xyz/qS.w)*0.5+0.5;}gl_Position=kX*dh;}"},ql={frag:"snippet version;precision highp sampler2DShadow;snippet zj;snippet shadowsEnabled;in vec3 BM;uniform sampler2D pG;uniform sampler2DShadow LG;uniform int Hp;in vec3 GR;in vec3 NM;in vec2 FS;out vec4 IZ;void main(){snippet GK;vec4 result=texture(pG,FS);if(result.a<0.5)discard;float VN=max(dot(GR,Wl),0.0);if(shadowsEnabled==1&&Hp==1&&VN>0.0){float qg=texture(LG,NM+vec3(0.0,0.0,-0.001));snippet TG;VN*=max(qg,TG);}result.rgb=result.rgb*BM+result.rgb*cG*VN+result.rgb*Dz;snippet jz;IZ=result;}"},Gl={frag:"snippet version;uniform sampler2D HC;in vec4 cQ;in vec2 BH;in float cL;out vec4 IZ;void main(){float qa=0.5;vec2 Lz=vec2(-0.1+gl_PointCoord.x*1.2,-0.1+gl_PointCoord.y*1.2);if(cL!=0.0){Lz=vec2(cos(cL)*(Lz.x-qa)+sin(cL)*(Lz.y-qa)+qa,cos(cL)*(Lz.y-qa)-sin(cL)*(Lz.x-qa)+qa);}Lz.x=clamp(Lz.x,0.,1.)*0.125;Lz.y=1.0-clamp(Lz.y,0.,1.)*0.125;vec4 result=texture(HC,Lz+BH);result*=cQ;if(result.a<0.01){discard;}IZ=result;IZ.rgb*=IZ.a;IZ.a*=0.33;}",vert:"snippet version;in vec3 Zc;uniform mat4 Dt;uniform mat4 Ux;uniform vec2 resolution;in vec4 info;in vec4 Qm;in vec4 UO;in vec4 vX;out vec4 cQ;out float cL;out vec2 BH;void main(){float id=round(mix(info[2],info[3],info[0]));BH=vec2(fract(id*0.125),-floor(id/8.0)*0.125);cQ=mix(UO,vX,info[0]);cL=mix(Qm[2],Qm[3],info[0]);vec4 dh=Dt*vec4(Zc,1);gl_PointSize=(resolution[1]*mix(Qm[0],Qm[1],info[0]))/length(dh.xyz);gl_Position=Ux*dh;}"},Hl={frag:"snippet version;precision highp float;uniform sampler2D jJ;uniform vec2 resolution;in vec2 FS;out vec4 IZ;\n#define texTop(t, p) texture(t, p, 0.0)\n#define texOff(t, p, o, r) texture(t, p + (o * r), 0.0)\nvec4 FxaaPixelShader(vec2 Zc,sampler2D tex,vec2 fxaaQualityRcpFrame,float fxaaQualitySubpix,float fxaaQualityEdgeThreshold,float fxaaQualityEdgeThresholdMin){vec2 Yx;Yx.x=Zc.x;Yx.y=Zc.y;vec4 rj=texTop(tex,Yx);\n#define lumaM rj.y\nfloat jm=texOff(tex,Yx,vec2(0.0,1.0),fxaaQualityRcpFrame.xy).y;float XO=texOff(tex,Yx,vec2(1.0,0.0),fxaaQualityRcpFrame.xy).y;float SU=texOff(tex,Yx,vec2(0.0,-1.0),fxaaQualityRcpFrame.xy).y;float cH=texOff(tex,Yx,vec2(-1.0,0.0),fxaaQualityRcpFrame.xy).y;float zk=max(jm,lumaM);float Zv=min(jm,lumaM);float Pg=max(XO,zk);float zK=min(XO,Zv);float Jv=max(SU,cH);float fJ=min(SU,cH);float rangeMax=max(Jv,Pg);float rangeMin=min(fJ,zK);float Kq=rangeMax*fxaaQualityEdgeThreshold;float range=rangeMax-rangeMin;float DY=max(fxaaQualityEdgeThresholdMin,Kq);bool earlyExit=range<DY;if(earlyExit)return rj;float iN=texOff(tex,Yx,vec2(-1.0,-1.0),fxaaQualityRcpFrame.xy).y;float Zw=texOff(tex,Yx,vec2(1.0,1.0),fxaaQualityRcpFrame.xy).y;float SQ=texOff(tex,Yx,vec2(1.0,-1.0),fxaaQualityRcpFrame.xy).y;float Dj=texOff(tex,Yx,vec2(-1.0,1.0),fxaaQualityRcpFrame.xy).y;float EY=SU+jm;float Yv=cH+XO;float qE=1.0/range;float GA=EY+Yv;float WK=(-2.0*lumaM)+EY;float QW=(-2.0*lumaM)+Yv;float Ol=SQ+Zw;float bE=iN+SQ;float bH=(-2.0*XO)+Ol;float Dc=(-2.0*SU)+bE;float MC=iN+Dj;float XG=Dj+Zw;float Dq=(abs(WK)*2.0)+abs(bH);float Wd=(abs(QW)*2.0)+abs(Dc);float cg=(-2.0*cH)+MC;float YJ=(-2.0*jm)+XG;float ZR=abs(cg)+Dq;float Ng=abs(YJ)+Wd;float Yr=MC+Ol;float qA=fxaaQualityRcpFrame.x;bool horzSpan=ZR>=Ng;float vH=GA*2.0+Yr;if(!horzSpan)SU=cH;if(!horzSpan)jm=XO;if(horzSpan)qA=fxaaQualityRcpFrame.y;float Pq=(vH*(1.0/12.0))-lumaM;float Lu=SU-lumaM;float Ys=jm-lumaM;float YX=SU+lumaM;float Cv=jm+lumaM;bool pairN=abs(Lu)>=abs(Ys);float EZ=max(abs(Lu),abs(Ys));if(pairN)qA=-qA;float JP=clamp(abs(Pq)*qE,0.0,1.0);vec2 zt;zt.x=Yx.x;zt.y=Yx.y;vec2 GG;GG.x=(!horzSpan)? 0.0 : fxaaQualityRcpFrame.x;GG.y=(horzSpan)? 0.0 : fxaaQualityRcpFrame.y;if(!horzSpan)zt.x+=qA*0.5;if(horzSpan)zt.y+=qA*0.5;vec2 fG;fG.x=zt.x-GG.x;fG.y=zt.y-GG.y;vec2 Kl;Kl.x=zt.x+GG.x;Kl.y=zt.y+GG.y;float Hc=((-2.0)*JP)+3.0;float FX=texTop(tex,fG).y;float Zi=JP*JP;float JV=texTop(tex,Kl).y;if(!pairN)YX=Cv;float Rz=EZ*1.0/4.0;float DV=lumaM-YX*0.5;float aC=Hc*Zi;bool lumaMLTZero=DV<0.0;FX-=YX*0.5;JV-=YX*0.5;bool doneN=abs(FX)>=Rz;bool doneP=abs(JV)>=Rz;if(!doneN)fG.x-=GG.x*1.5;if(!doneN)fG.y-=GG.y*1.5;bool doneNP=(!doneN)||(!doneP);if(!doneP)Kl.x+=GG.x*1.5;if(!doneP)Kl.y+=GG.y*1.5;if(doneNP){if(!doneN)FX=texTop(tex,fG.xy).y;if(!doneP)JV=texTop(tex,Kl.xy).y;if(!doneN)FX=FX-YX*0.5;if(!doneP)JV=JV-YX*0.5;doneN=abs(FX)>=Rz;doneP=abs(JV)>=Rz;if(!doneN)fG.x-=GG.x*2.0;if(!doneN)fG.y-=GG.y*2.0;doneNP=(!doneN)||(!doneP);if(!doneP)Kl.x+=GG.x*2.0;if(!doneP)Kl.y+=GG.y*2.0;if(doneNP){if(!doneN)FX=texTop(tex,fG.xy).y;if(!doneP)JV=texTop(tex,Kl.xy).y;if(!doneN)FX=FX-YX*0.5;if(!doneP)JV=JV-YX*0.5;doneN=abs(FX)>=Rz;doneP=abs(JV)>=Rz;if(!doneN)fG.x-=GG.x*4.0;if(!doneN)fG.y-=GG.y*4.0;doneNP=(!doneN)||(!doneP);if(!doneP)Kl.x+=GG.x*4.0;if(!doneP)Kl.y+=GG.y*4.0;if(doneNP){if(!doneN)FX=texTop(tex,fG.xy).y;if(!doneP)JV=texTop(tex,Kl.xy).y;if(!doneN)FX=FX-YX*0.5;if(!doneP)JV=JV-YX*0.5;doneN=abs(FX)>=Rz;doneP=abs(JV)>=Rz;if(!doneN)fG.x-=GG.x*12.0;if(!doneN)fG.y-=GG.y*12.0;doneNP=(!doneN)||(!doneP);if(!doneP)Kl.x+=GG.x*12.0;if(!doneP)Kl.y+=GG.y*12.0;}}}float Gs=Yx.x-fG.x;float Fc=Kl.x-Yx.x;if(!horzSpan)Gs=Yx.y-fG.y;if(!horzSpan)Fc=Kl.y-Yx.y;bool goodSpanN=(FX<0.0)!=lumaMLTZero;float Ew=(Fc+Gs);bool goodSpanP=(JV<0.0)!=lumaMLTZero;float Tt=1.0/Ew;bool directionN=Gs<Fc;float Qg=min(Gs,Fc);bool goodSpan=directionN ? goodSpanN : goodSpanP;float sK=aC*aC;float Rn=(Qg*(-Tt))+0.5;float Hn=sK*fxaaQualitySubpix;float fR=goodSpan ? Rn : 0.0;float QA=max(fR,Hn);if(!horzSpan)Yx.x+=QA*qA;if(horzSpan)Yx.y+=QA*qA;return vec4(texTop(tex,Yx).xyz,lumaM);}void main(){vec4 Zj=FxaaPixelShader(FS,jJ,1.0/resolution,0.5,0.2,0.0833);IZ=Zj;}"},Xl={frag:"snippet version;precision highp float;uniform sampler2D QV;uniform sampler2D jJ;uniform sampler2D JF;uniform vec3 Dz;uniform vec2 resolution;uniform float PF;uniform float zn;in vec2 FS;out vec4 IZ;const int zr=16;const float SV=float(zr);const vec3 YR[zr]=vec3[](vec3(0.5381,0.1856,-0.4319),vec3(0.1379,0.2486,0.4430),vec3(0.3371,0.5679,-0.0057),vec3(-0.6999,-0.0451,-0.0019),vec3(0.0689,-0.1598,-0.8547),vec3(0.0560,0.0069,-0.1843),vec3(-0.0146,0.1402,0.0762),vec3(0.0100,-0.1924,-0.0344),vec3(-0.3577,-0.5301,-0.4358),vec3(-0.3169,0.1063,0.0158),vec3(0.0103,-0.5869,0.0046),vec3(-0.0897,-0.4940,0.3287),vec3(0.7119,-0.0154,-0.0918),vec3(-0.0533,0.0596,-0.5411),vec3(0.0352,-0.0631,0.5460),vec3(-0.4776,0.2847,-0.0271));float rand(vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}const float Tz=0.03;const float Nz=0.0000005;const float radius=0.004;const vec2 Zy=vec2(0.0,0.001);const vec2 fX=vec2(0.001,0.0);vec3 normal_from_depth(float BS,vec2 texcoords){float dq=texture(JF,texcoords+Zy).r;float ql=texture(JF,texcoords+fX).r;vec3 p1=vec3(Zy,dq-BS);vec3 p2=vec3(fX,ql-BS);vec3 Jw=cross(p1,p2);Jw.z=-Jw.z;return normalize(Jw);}void main(){float BS=texture(JF,FS).r;vec3 Zc=vec3(FS.xy,BS);vec3 Jw=normal_from_depth(BS,FS);float Oq=zn;float Az=(2.0*0.1*Oq)/(Oq+0.1-BS*(Oq-0.1))/Oq;float XZ=radius/Az;float TL=0.0;vec3 kK=normalize(vec3(rand(FS.xy),rand(FS.yx),rand(FS.xy*1.5)));for(int i=0;i<zr;i++){vec3 Td=XZ*reflect(YR[i],kK);vec3 Lc=Zc+sign(dot(Td,Jw))*Td;float cK=texture(JF,clamp(Lc.xy,0.0,1.0)).r;float difference=BS-cK;TL+=step(Nz,difference)*(1.0-smoothstep(Nz,Tz,difference));}TL*=(1.0-smoothstep(0.6,1.0,Az));TL*=(1.0/SV);TL=pow(TL,1.7);float SB=clamp(0.1+1.0-TL,0.0,1.0);IZ=vec4(mix(Dz*0.2,vec3(1.0),SB),1.0);}"},jl={frag:"snippet version;precision highp float;uniform sampler2D QV;uniform sampler2D jJ;uniform vec2 resolution;in vec2 FS;uniform int step;float weight[5]=float[5](0.227027,0.1945946,0.1216216,0.054054,0.016216);out vec4 IZ;void main(){vec2 NJ=2.0/resolution;vec3 result=vec3(1.0);if(step==0){result=texture(QV,FS).rgb*weight[0];for(int i=1;i<5;++i){result+=texture(QV,FS+vec2(NJ.x*float(i),0.0)).rgb*weight[i];result+=texture(QV,FS-vec2(NJ.x*float(i),0.0)).rgb*weight[i];}}else{result=texture(QV,FS).rgb*weight[0];for(int i=1;i<5;++i){result+=texture(QV,FS+vec2(0.0,NJ.y*float(i))).rgb*weight[i];result+=texture(QV,FS-vec2(0.0,NJ.y*float(i))).rgb*weight[i];}}if(step==1){result=result*texture(jJ,FS).rgb;}IZ=vec4(result,1.0);}"},Jl={frag:"snippet version;uniform vec4 UO;uniform vec4 vX;uniform vec3 offset;in vec2 FS;out vec4 IZ;void main(){float uH=min(1.,max(0.,FS.x+offset.x));IZ=mix(UO,vX,abs(sin(uH*3.141*offset.z))*offset.y);IZ.a*=sin(FS.y*3.14);if(IZ.a<0.01){discard;}IZ.rgb*=IZ.a;IZ.a*=0.33;}",vert:"snippet version;in vec3 position;in vec2 Lz;out vec2 FS;uniform mat4 kX;void main(){FS=Lz;gl_Position=kX*vec4(position,1.0);}"},Vl={frag:"snippet version;void main(){}",vert:"snippet version;in vec3 position;in vec2 Lz;in mat4 cX;uniform mat4 kX;out vec2 FS;snippet Cz;void main(){FS=Lz;gl_Position=Cz(kX*cX*vec4(position,1.0));}"},Yl={frag:"snippet version;in vec2 FS;uniform sampler2D pG;void main(){if(texture(pG,FS).a<0.5)discard;}"},Wl={frag:"snippet version;uniform sampler2D jx[8];in vec4 NH;in vec4 Jc;in vec2 FS;uniform int DJ;float height;float count;snippet iZ;void computeColor(vec4 color,float value,vec4 info){float WB=(color.r+color.g+color.b)/3.0;height+=pow(smoothstep(info[1],info[2],WB)*value,2.5);count+=value;}void main(){height=0.0;if(DJ==1){if(NH[0]>0.0)computeColor(texture(jx[0],FS*tinf0[0]),NH[0],tinf0);if(NH[1]>0.0)computeColor(texture(jx[1],FS*tinf1[0]),NH[1],tinf1);if(NH[2]>0.0)computeColor(texture(jx[2],FS*tinf2[0]),NH[2],tinf2);if(NH[3]>0.0)computeColor(texture(jx[3],FS*tinf3[0]),NH[3],tinf3);if(Jc[0]>0.0)computeColor(texture(jx[4],FS*tinf4[0]),Jc[0],tinf4);if(Jc[1]>0.0)computeColor(texture(jx[5],FS*tinf5[0]),Jc[1],tinf5);if(Jc[2]>0.0)computeColor(texture(jx[6],FS*tinf6[0]),Jc[2],tinf6);if(Jc[3]>0.0)computeColor(texture(jx[7],FS*tinf7[0]),Jc[3],tinf7);height/=count;}gl_FragDepth=gl_FragCoord.z-height*0.003;}",vert:"snippet version;in vec3 position;in vec2 Lz;in vec4 MR;in vec4 Xm;uniform mat4 Nh;uniform mat4 Ux;out vec2 FS;out vec4 NH;out vec4 Jc;out vec3 BJ;snippet Cz;void main(){NH=MR;Jc=Xm;FS=Lz*16.0;gl_Position=Cz(Ux*Nh*vec4(position,1.0));}"},Ql={frag:"snippet version;uniform vec4 color;out vec4 IZ;void main(){IZ=color;}",vert:"snippet version;in vec3 position;in vec2 Lz;in vec3 Jw;out vec2 FS;out vec3 GR;out vec3 JK;uniform mat4 Nh;uniform mat4 Ux;void main(){FS=Lz;GR=Jw;JK=position;gl_Position=Ux*Nh*vec4(position,1.0);}"},Kl={frag:"snippet version;precision highp sampler2DShadow;snippet zj;snippet shadowsEnabled;uniform sampler2DShadow LG;uniform int Hp;uniform vec4 color;in vec3 GR;in vec3 NM;out vec4 IZ;void main(){snippet GK;vec4 result=color;float WV=(float(gl_FrontFacing)*2.0-1.0);float VN=max(dot(GR*WV,Wl),0.0);if(shadowsEnabled==1&&Hp==1&&VN>0.0&&NM.x>0.0&&NM.x<1.0&&NM.z>0.0&&NM.z<1.0){float qg=texture(LG,NM+vec3(0.0,0.0,-0.001*WV));VN*=qg;}result.rgb=result.rgb*cG*VN+result.rgb*Dz;snippet jz;IZ=result;}",vert:"snippet version;in vec3 position;in vec3 Jw;snippet zj;snippet shadowsEnabled;out vec3 GR;out vec2 FS;out vec3 NM;snippet Cz;uniform mat4 vJ;uniform mat4 kX;uniform mat4 oh;void main(){GR=Jw;vec4 dh=vJ*vec4(position,1.0);snippet RK;if(shadowsEnabled==1){vec4 qS=Cz(oh*dh);NM=(qS.xyz/qS.w)*0.5+0.5;}gl_Position=kX*dh;}"},tc={frag:"snippet version;uniform sampler2D pG;in vec2 FS;out vec4 IZ;void main(){vec4 Zj=texture(pG,FS);vec3 Gb=normalize(vec3(1.0,1.0,0.3));IZ=Zj;if(IZ.a<0.2)discard;}",vert:"snippet version;in vec2 Lz;in vec3 position;in vec3 Jw;uniform mat4 Nh;uniform mat4 Ux;out vec2 FS;out vec3 GR;void main(){FS=Lz;gl_Position=Ux*Nh*vec4(position,1.0);}"},ec={frag:"snippet version;snippet zj;uniform float Nt;uniform sampler2D Qt;in vec2 FS;in vec3 JK;out vec4 IZ;void main(){gl_FragDepth=0.999999;vec3 result=vec3(0.0);float Ug=dot(Wl,normalize(JK));float Pd=pow((1.0+Ug)*0.5,3.0);vec3 XM=Oy;vec3 TN=rJ;float c=pow(max(0.0,min(1.0,(1.0-(0.5+JK.y))*2.0)),3.0);float hA=0.0;if(c<0.85){hA=smoothstep(0.85-Pd*0.8,0.85,c);}else{hA=1.0-smoothstep(0.85,1.0,c);}c=pow(c,(1.0-Pd)*3.0);TN+=cG*hA*0.4*Pd;XM=mix(Oy*0.8,XM,Pd);result=mix(XM,TN,c);float iD=1.0-sin(Nt*6.28)+0.02;float Gv=max(0.0,min(1.0,JK.y*5.0))*0.4;result+=texture(Qt,vec2(Wl.x*0.5-FS.x,FS.y)).rgb*iD*Gv;IZ=vec4(result,1.0);}",vert:"snippet version;in vec3 position;in vec2 Lz;uniform mat4 Nh;uniform mat4 Ux;out vec2 FS;out vec3 JK;void main(){FS=Lz;JK=position;gl_Position=Ux*Nh*vec4(JK,1.0);}"},sc={frag:"snippet version;precision highp float;in vec2 FS;uniform float seed;float stars(in vec2 Lz,float scale){Lz*=scale;vec2 s=floor(Lz),f=fract(Lz),p;float k=3.,d;p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);k=min(d,k);return smoothstep(0.,k,sin(f.x+f.y)*0.003);}snippet Fd;snippet mK;out vec4 IZ;void main(){vec2 Zc=vec2(FS.x+seed,FS.y);float n=stars(FS,10.0);n+=stars(FS,20.0)*0.5;n+=stars(FS,30.0)*0.2;n*=noise(FS*20.0);vec2 PP=vec2(FS.x*3.0+5.0,FS.y*5.0);float vQ=noise(PP)*0.9;vQ+=noise(PP*1.5)*0.5;vQ+=noise(PP*2.9)*0.25;vQ*=noise(PP*0.3)*0.1;vQ*=1.0-distance(vec2(0.5),FS)*2.0;IZ.rgb+=n*4.0+vQ*2.5;}"},ic={frag:"snippet version;snippet zj;uniform float Nt;in vec2 FS;out vec4 IZ;void main(){gl_FragDepth=0.999998;float height=max(0.0,min(1.0,abs(sin(Nt*6.282))+FS.y*0.1-0.15));float iX=min(1.0,pow((1.0-height*height),100.0));float circle=0.5-length(vec2(0.5,0.5)-FS);float alpha=smoothstep(0.0,1.0,circle)*2.0;alpha+=smoothstep(0.4,0.45,circle);IZ.rgba=vec4(mix(vec3(1.0),rJ,iX),alpha);}"},nc={frag:"snippet version;precision highp sampler2DShadow;in vec3 GR;in vec3 Qn;in vec3 JK;in vec3 BJ;uniform vec4 YQ;snippet zj;snippet shadowsEnabled;snippet iZ;in vec3 BM;in vec2 FS;uniform sampler2D jx[8];in vec4 NH;in vec4 Jc;vec4 result;float detail;uniform sampler2DShadow LG;in vec3 NM;void computeColor(vec4 color,float value,vec4 info){float WB=max(max(color.x,color.y),color.z);color.a=pow(smoothstep(info[1],info[2],WB)*value,2.5);detail+=info[3]*color.a;color.rgb=color.rgb*min(1.0,value*0.5+0.7)*color.a;result+=color;}out vec4 IZ;void main(){snippet GK;if(NH[0]>0.0)computeColor(texture(jx[0],FS*tinf0[0]),NH[0],tinf0);if(NH[1]>0.0)computeColor(texture(jx[1],FS*tinf1[0]),NH[1],tinf1);if(NH[2]>0.0)computeColor(texture(jx[2],FS*tinf2[0]),NH[2],tinf2);if(NH[3]>0.0)computeColor(texture(jx[3],FS*tinf3[0]),NH[3],tinf3);if(Jc[0]>0.0)computeColor(texture(jx[4],FS*tinf4[0]),Jc[0],tinf4);if(Jc[1]>0.0)computeColor(texture(jx[5],FS*tinf5[0]),Jc[1],tinf5);if(Jc[2]>0.0)computeColor(texture(jx[6],FS*tinf6[0]),Jc[2],tinf6);if(Jc[3]>0.0)computeColor(texture(jx[7],FS*tinf7[0]),Jc[3],tinf7);result.rgb/=result.a*0.85;detail/=result.a;result.a=1.0;float VN=dot(GR,Wl);float Kp=0.0;if(VN>0.0){if(shadowsEnabled==1&&NM.x>0.0&&NM.x<1.0&&NM.y>0.0&&NM.y<1.0){float qg=texture(LG,NM);snippet TG;VN=min(clamp(VN,0.0,1.0),max(qg,TG));}vec3 IJ=reflect(-Wl,GR);float EI=max(dot(IJ,Qn),0.0);Kp=pow(EI,8.5)*2.0;}float hY=length(result.rgb)*3.0*detail;float UW=pow((hY-0.5),3.0)*0.5+0.2;float qt=pow((hY-0.5)*VN,3.0)*1.2;if(hY>1.2){qt*=1.3;UW*=1.3;}Kp*=qt;vec3 Oo=result.rgb*cG*VN*0.65;vec3 Cp=result.rgb*Dz;result.rgb=Cp+Oo+vec3(Kp)*0.15+BM*UW;float Pw=distance(JK.xz,BJ.xz);result.rgb=mix(result.rgb,YQ.rgb,YQ.a*((Pw<BJ.y ? Pw/BJ.y : 0.0)*0.5+max(0.,(0.09-abs(BJ.y-Pw))/0.1)));snippet jz;IZ=result;}",vert:"snippet version;snippet zj;snippet Jl;snippet Cz;snippet shadowsEnabled;in vec3 position;in vec3 Jw;in vec2 Lz;in vec4 MR;in vec4 Xm;uniform mat4 vJ;uniform mat4 kX;uniform mat4 oh;uniform vec3 Zb;out vec3 Ss;out vec3 GR;out vec3 JK;out vec2 FS;out vec4 qS;out vec3 NM;out vec4 NH;out vec4 Jc;out vec3 Qn;out vec3 BJ;void main(){BJ.xz=Zb.xz-(vJ*vec4(0.0,0.0,0.0,1.0)).xz;BJ.y=Zb.y;JK=position;GR=Jw;NH=MR;Jc=Xm;FS=Lz*16.0;dh=vJ*vec4(position,1.0);snippet Cq;snippet RK;Qn=-normalize(dh.xyz-Rq);if(shadowsEnabled==1){vec4 Qj=Cz(oh*(dh));NM=(Qj.xyz/Qj.w)*0.5+0.5;}gl_Position=kX*dh;}"},ac={frag:"snippet version;in vec3 JK;in vec3 BJ;out vec4 IZ;void main(){float Pw=distance(JK.xz,BJ.xz);if(Pw>BJ.y){IZ.rgba=vec4(0.0,0.0,0.0,1.0);}else{IZ.rgba=mix(vec4(0.0,1.0,0.0,1.0),vec4(0.0,0.0,0.0,1.0),Pw/BJ.y);}}",vert:"snippet version;in vec3 position;in vec3 Jw;uniform mat4 vJ;uniform mat4 Nh;uniform mat4 Ux;uniform vec3 Zb;out vec3 JK;out vec3 BJ;void main(){BJ.xz=Zb.xz-(vJ*vec4(0.0,0.0,0.0,1.0)).xz;BJ.y=Zb.y;JK=position;gl_Position=Ux*Nh*vec4(position+Jw*0.001,1.0);}"},rc={frag:"snippet version;snippet zj;snippet shadowsEnabled;uniform float time;uniform mat4 uN;uniform float visibility;uniform float speed;uniform vec3 Hd;uniform vec3 Rj;uniform vec3 Tp;uniform sampler2D Vr;uniform sampler2D bX;uniform sampler2D Gj;in vec2 FS;in vec3 GR;out vec4 IZ;snippet Cz;float getWaterDepth(vec2 Zc,float z){return texture(Vr,Zc).r-z;}void main(){snippet GK;ivec2 Lr=textureSize(Vr,0);float Pm=1.0/float(Lr.x);vec4 zb=Cz(uN*dh);vec3 Rv=(zb.xyz/zb.w)*0.5+0.5;float BS=1.0;if(shadowsEnabled==1){if(Rv.x>0.0&&Rv.x<1.0&&Rv.y>0.0&&Rv.y<1.0){float Gh=Rv.z;float HZ=Pm*0.5;float ZI=getWaterDepth(Rv.xy+vec2(-HZ,-HZ),Rv.z);float ZC=getWaterDepth(Rv.xy+vec2(HZ,-HZ),Rv.z);float WY=getWaterDepth(Rv.xy+vec2(-HZ,HZ),Rv.z);float Tk=getWaterDepth(Rv.xy+vec2(HZ,HZ),Rv.z);float pJ=mod(Rv.x-HZ,Pm)/Pm;float Ie=mod(Rv.y-HZ,Pm)/Pm;BS=mix(mix(ZI,ZC,pJ),mix(WY,Tk,pJ),Ie);}else{BS=1.0;}BS*=50.0;}float speed=speed*0.01;float gY=0.0;vec3 Jw=normalize(GR);vec2 dir=normalize(GR.xz);float HW=1.0;for(int i=0;i<2;++i){float XC=1.0/3.0*float(i);float t=mod(time*0.2+XC,1.0)*3.141;float Ff=speed+0.2;vec2 shift=vec2(Ff*dir.y*t+XC,Ff*dir.x*t+XC);float curve=abs(sin(t));gY+=texture(bX,FS.yx*0.5+shift).r*curve;HW+=((sin((FS.x+shift.y)*10.0)+cos((FS.y+shift.x)*10.0))*curve*(0.2+Ff*0.6));}float Jp=visibility/100.0;vec4 Wm=texture(Gj,FS.yx+time*speed*2.0+gY*0.1);vec4 Yu=vec4(Hd,0.0);vec4 jS=vec4(Hd,0.9);vec4 PN=vec4(mix(Hd,Rj,0.9)*0.8,0.5)+speed*0.1;vec4 jV=vec4(Rj,0.4)+Wm*0.05;vec4 Jo=vec4(mix(Rj,Tp,0.5),0.8-Jp*0.4)+Wm*0.08;vec4 TW=vec4(Tp,1.4-Jp*0.8)+Wm*0.12;float dJ=0.03+0.01*gY;float Fm=dJ+0.02+speed*0.05+0.03*gY+HW*0.02;float kZ=Fm+(0.05+speed*0.5*gY+HW*0.05)*Jp;float pQ=kZ+(0.2+speed*0.2-gY*0.1)*Jp;float WH=pQ+(0.2)*Jp;vec4 result=vec4(0.0);if(BS<dJ){result=mix(Yu,jS,smoothstep(0.0,dJ,BS));}else if(BS<Fm){result=mix(jS,PN,smoothstep(dJ,Fm,BS));}else if(BS<kZ){result=mix(PN,jV,smoothstep(Fm+(kZ-Fm)*0.3,kZ,BS));}else if(BS<pQ){result=mix(jV,Jo,smoothstep(kZ+(pQ-kZ)*0.4,pQ,BS));}else{result=mix(Jo,TW,smoothstep(WH,1.0,BS));}result.rgb+=(abs(Jw.x)+abs(Jw.z))*0.5-0.2;float VN=max(dot(Wl,Jw),0.0);float Bc=0.0;vec3 IJ=reflect(-Wl,Jw);vec3 SZ=-normalize(dh.xyz-Rq);float EI=max(dot(IJ,SZ),0.0);Bc=min(1.0,max(0.0,pow(EI,10.0)))*0.6;result.rgb=result.rgb*cG*VN+result.rgb*Dz+Bc*cG;snippet jz;IZ=result;}",vert:"snippet version;snippet zj;uniform mat4 vJ;uniform mat4 kX;uniform float time;uniform int Xj;uniform float aX;uniform float vk;uniform float speed;in vec3 position;in vec3 Jw;in vec2 Lz;out vec3 GR;out vec2 FS;out vec3 xh;void main(){vec4 Zc=vec4(position,1.0);if(Xj==0){if(Zc.x<=-0.5)Zc.x-=10.0;if(Zc.z<=-0.5)Zc.z-=10.0;if(Zc.x>=0.5)Zc.x+=10.0;if(Zc.z>=0.5)Zc.z+=10.0;}dh=vJ*Zc;dh.y+=cos(dh.z*vk*0.005)*sin(dh.x*0.1+dh.z*vk*0.008+time*speed*0.1)*aX*0.03;snippet RK;FS=dh.xz/2.0;GR=vec3(0.01,0.8,0.002)*6.5;gl_Position=kX*dh;}"};var oc=Object.freeze({__proto__:null,clouds:Dl,cloudsTex:Al,drop:Rl,foliage:Ll,multimeshFlat:Ol,multimeshSimple:_l,multimeshTextured:Nl,multimeshTileable:Zl,multimeshTree:ql,particles:Gl,post:Hl,ssao:Xl,ssaoBlur:jl,ribbon:Jl,shadowInstanced:Vl,shadowInstancedAlpha:Yl,shadowTerrain:Wl,simple:Ql,simpleShaded:Kl,simpleTextured:tc,sky:ec,skyStarTex:sc,sun:ic,terrain:nc,terrainDebug:ac,water:rc});const lc={version:"#version 300 es\n    precision highp float;\n    precision highp int;\n  ",zj:"\n    uniform vec3 Dz;\n    uniform vec3 Wl;\n    uniform vec3 cG;\n    uniform vec3 Oy;\n    uniform vec3 rJ;\n    uniform float PF;\n    uniform float zn;\n    uniform vec3 Rq;\n    out float Mw; // V\n    out vec4 dh; // V\n    in float Mw; // F\n    in vec4 dh; // F\n  ",shadowsEnabled:`\n    const int shadowsEnabled = ${Qi.shadows?1:0};\n  `,Jl:"\n    uniform vec4 uG[16];\n    uniform vec3 aA[16];\n    uniform int uT;\n    out vec3 BM;\n  ",Cq:"\n    vec3 Gb = vec3(0.0);\n    for(int i = 0; i < uT; ++i){\n      vec3 uh = aA[i] - dh.xyz;\n      float uY = uG[i].w-dot(uh,uh);\n      if(uY > 0.0){\n        uY /= (uG[i].w);\n        uY = uY*uY;\n        Gb += max(0.0,dot(normalize(uh), GR)) * uG[i].rgb*uY;\n      } \n    }\n    BM = Gb;\n  ",RK:"\n    Mw = length(Rq - dh.xyz);\n  ",GK:"\n    float fogValue = Mw;\n    if(fogValue > zn){\n      float fogFade = zn*0.1;\n      float fogPatt = 0.5 - sin(dh.x*2.0)*0.25+sin(dh.y*2.0)*0.25;\n      if(fogValue + fogPatt*fogFade  >= zn+fogFade) discard;\n    } ",TG:"\n    float TG = smoothstep(PF*1.5, zn*0.75, fogValue);\n  ",jz:"\n    result.rgb = mix(result.rgb, rJ, smoothstep(PF, zn, fogValue));",Cz:"\n    vec4 Cz(vec4 Zc){\n      Zc.x = 2.0 / (1.0+exp(-10.0*Zc.x)) - 1.0;\n      Zc.y = 2.0 / (1.0+exp(-10.0*Zc.y)) - 1.0;\n      return Zc;\n    }",Fd:"\n    vec2 hash( vec2 p ) {\n    p = vec2(dot(p,vec2(127.1,311.7)), dot(p,vec2(269.5,183.3)));\n    return -1.0 + 2.0*fract(sin(p)*43758.5453123);\n  }",mK:"float noise( in vec2 p ) {\n    const float K1 = 0.366025404; // (sqrt(3)-1)/2;\n    const float K2 = 0.211324865; // (3-sqrt(3))/6;\n    vec2 i = floor(p + (p.x+p.y)*K1); \n    vec2 a = p - i + (i.x+i.y)*K2;\n    vec2 o = (a.x>a.y) ? vec2(1.0,0.0) : vec2(0.0,1.0);\n    vec2 b = a - o + K2;\n    vec2 c = a - 1.0 + 2.0*K2;\n    vec3 h = max(0.5-vec3(dot(a,a), dot(b,b), dot(c,c) ), 0.0 );\n    vec3 n =h*h*h*vec3( dot(a,hash(i+0.0)), dot(b,hash(i+o)), dot(c,hash(i+1.0)));\n    float d = dot(n, vec3(70.0));\n    return smoothstep(-1.0,1.0,d);\n  }",iZ:Array(8).fill(0).map((t,e)=>`uniform vec4 tinf${e};`).join("")},cc=(t,e)=>t.replace(/snippet (\w+);/g,(t,s)=>{let i=lc[s].split("\n");return i=i.filter(t=>!(0==e&&t.indexOf("// F")>-1)&&!(1==e&&t.indexOf("// V")>-1)),i.join("\n")}),dc=t=>{for(const e in t)t[e].vert&&(t[e].vert=cc(t[e].vert,0)),t[e].frag&&(t[e].frag=cc(t[e].frag,1))};let hc=0,uc=0;const mc=[0,0,0];let pc=!1;const fc={},gc={},vc=[0,0,0],yc=[256,512,1024,2048,4096][Qi.shadowmapResolution]||1024,bc={},xc=()=>{bc.LG=new ba,bc.water=new ba,fc.shadowStatic=new Pa(Ha,{width:yc,height:yc,color:0,depthTexture:!0,depthCompareMode:Ha.COMPARE_REF_TO_TEXTURE}),fc.LG=new Pa(Ha,{width:yc,height:yc,color:0,depthTexture:!0,depthCompareMode:Ha.COMPARE_REF_TO_TEXTURE}),fc.water=new Pa(Ha,{width:yc,height:yc,color:0,depthTexture:!0});for(const t in fc)gc[t]=new Set([fc[t]])},wc=()=>{const t=Xa.Oq;if(hc!=t){hc=t,pc=!0;for(const e in bc)bc[e].orthographic({near:.1,Oq:"LG"==e?2*t:200,left:-t,right:t,bottom:-t,top:t}),bc[e].updateMatrixWorldCamView(!0)}if(Qi.realtimeShadows||pc||Ya.time-uc>10||mn(ja.position,mc)>15){an(bc.LG.transform.position,vc),hn(bc.LG.transform.position,bc.LG.transform.position,t),bc.LG.lookAt(Qa,Wa),ln(bc.LG.transform.position,bc.LG.transform.position,ja.position),rn(bc.water.transform.position,1e-4,100,0),bc.water.lookAt(Qa,Wa),ln(bc.water.transform.position,bc.water.transform.position,ja.position),bc.water.transform.position[1]=200,an(mc,ja.position);for(const t in bc)bc[t].updateMatrixWorldCamView(!1);pc=!0,uc=Ya.time}},kc=t=>{pc=t},$c=t=>{an(vc,t)};let Sc={};const Mc=()=>{Sc={resolution:{c:Cc,value:[0,0]},time:{c:Ec,value:0},Nt:{c:Ec,value:0},Dz:{c:Tc,value:[0,0,0]},Oy:{c:Tc,value:[0,0,0]},Wl:{c:Tc,value:[0,0,0]},cG:{c:Tc,value:[0,0,0]},PF:{c:Ec,value:0},zn:{c:Ec,value:0},rJ:{c:Tc,value:[0,0,0]},Rq:{c:Tc,value:Xa.worldPosition},oh:{c:Pc,value:bc.LG.kX},LG:{c:null,value:fc.LG.depthTexture},uN:{c:Pc,value:bc.water.kX},Vr:{c:null,value:fc.water.depthTexture},bX:{c:null},Gj:{c:null},uG:{c:null,value:[0,0,0,0]},aA:{c:null,value:[0,0,0]},uT:{c:Ec,value:0},HC:{c:null},zx:{c:null},jx:{c:null,value:Fo.terrain},Ux:{c:Pc,value:Xa.Ux},kX:{c:Pc,value:Xa.kX},Qt:{c:null},TJ:{c:null},Zb:{c:Tc,value:[0,0,0]},YQ:{c:Ic,value:[0,1,0,1]},movieMode:{c:Ec,value:0}};for(let t=0;t<8;++t)Sc["tinf"+t]={c:null,value:[0,0,0,0]};for(const t in Sc)Sc[t].state=0},Ec=(t,e)=>{t.value!==t.cacheValue&&(t.state++,t.cacheValue=t.value)},Cc=(t,e)=>{t.cacheArray&&_a(t.value,t.cacheArray)||(t.state++,t.cacheArray?Ba(t.cacheArray,t.value):t.cacheArray=t.value.slice())},Tc=(t,e)=>{t.cacheArray&&Sn(t.value,t.cacheArray)||(t.state++,t.cacheArray?an(t.cacheArray,t.value):t.cacheArray=t.value.slice())},Ic=(t,e)=>{t.cacheArray&&sa(t.value,t.cacheArray)||(t.state++,t.cacheArray?ta(t.cacheArray,t.value):t.cacheArray=t.value.slice())},Pc=(t,e)=>{t.cacheArray&&Yn(t.value,t.cacheArray)||(t.state++,t.cacheArray?On(t.cacheArray,t.value):t.cacheArray=t.value.slice())},Bc=t=>{Sc.time.value=Ya.smoothtime%600;for(const e in Sc){const s=Sc[e];null!==s.c&&s.c(s,t)}},Fc=(t,e)=>{Fa(Sc.resolution.value,t,e),Sc.resolution.state++},zc={},Uc=t=>{Bc(t)},Dc=()=>{if(Mc(),dc(oc),Qi.ssao){Ja.addPass({fragment:Xl.frag,globalUniforms:Sc});for(let t=0;t<2;++t)Ja.addPass({fragment:jl.frag,uniforms:{step:{value:t}},globalUniforms:Sc,postDraw:0==t?void 0:()=>{Ha.bindFramebuffer(Ha.READ_FRAMEBUFFER,Ja.ping.buffer),Ha.bindFramebuffer(Ha.DRAW_FRAMEBUFFER,Ja.original.buffer),Ha.blitFramebuffer(0,0,Ja.pong.width,Ja.pong.height,0,0,Ja.pong.width,Ja.pong.height,Ha.COLOR_BUFFER_BIT,Ha.NEAREST)}})}Ja.addPass({fragment:Hl.frag,globalUniforms:Sc}),zc.foliage=new zn(Ha,{vertex:Ll.vert,fragment:Ll.frag,cullFace:null,active:!1,globalUniforms:Sc}),zc.multimeshFlat=new zn(Ha,{vertex:Ol.vert,fragment:Ol.frag,instanced:{color:{size:4}},globalUniforms:Sc}),zc.multimeshTextured=new zn(Ha,{vertex:Nl.vert,fragment:Nl.frag,globalUniforms:Sc}),zc.multimeshTree=new zn(Ha,{vertex:Nl.vert,fragment:ql.frag,globalUniforms:Sc}),zc.multimeshTileable=new zn(Ha,{vertex:Zl.vert,fragment:Nl.frag,instanced:{JC:{size:1}},globalUniforms:Sc}),zc.multimeshSimple=new zn(Ha,{vertex:_l.vert,fragment:_l.frag,instanced:{color:{size:4}},globalUniforms:Sc}),zc.drop=new zn(Ha,{vertex:Rl.vert,fragment:Rl.frag,instanced:{Fs:{size:4},MT:{size:4}},globalUniforms:Sc}),zc.terrain=new zn(Ha,{active:!1,vertex:nc.vert,fragment:nc.frag,globalUniforms:Sc,autoUniforms:["pG"]}),zc.sun=new zn(Ha,{vertex:Ql.vert,fragment:ic.frag,transparent:!0,globalUniforms:Sc}),zc.clouds=new zn(Ha,{vertex:Ql.vert,fragment:Dl.frag,transparent:!0,frontFace:Ha.CW,globalUniforms:Sc}),zc.water=new zn(Ha,{vertex:rc.vert,fragment:rc.frag,transparent:!0,active:!1,globalUniforms:Sc}),zc.sky=new zn(Ha,{vertex:ec.vert,fragment:ec.frag,cullFace:null,depthTest:!0,globalUniforms:Sc}),zc.shadowInstancedAlpha=new zn(Ha,{cullFace:null,vertex:Vl.vert,fragment:Yl.frag,autoUniforms:["pG"],globalUniforms:Sc}),zc.shadowInstanced=new zn(Ha,{vertex:Vl.vert,fragment:Vl.frag,globalUniforms:Sc}),zc.shadowTerrain=new zn(Ha,{vertex:Wl.vert,fragment:Wl.frag,globalUniforms:Sc,uniforms:{DJ:{value:1}}}),zc.particles=new zn(Ha,{vertex:Gl.vert,fragment:Gl.frag,active:!1,transparent:!0,depthWrite:!1,globalUniforms:Sc}),zc.ribbon=new zn(Ha,{vertex:Jl.vert,fragment:Jl.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:Sc})},Ac=t=>{Sc.kX.state++},Rc=t=>{Sc.kX.state++},Lc=t=>{Sc.oh.state++,Sc.kX.state++},Oc=t=>{Sc.uN.state++},_c=[],Nc=t=>{~_c.indexOf(t)?console.log("tried adding but already present"):_c.push(t)},Zc=t=>{const e=_c.indexOf(t);~e?_c.splice(e,1):console.log("tried removing but already remove")};let qc;const Gc=()=>{qc=new wa(void 0,zc.sky,Ha.TRIANGLES,!1,6e3),on(qc.transform.scale,40),Nc(qc.transform),qc.transform.visible=!1,qc.transform.matrixAutoUpdate=!0,To("engine/skybox",t=>{const e=new Bn(Ha,t);qc.geometry=e;const s=Lo(sc.frag,1024,Va);zc.sky.uniforms.Qt.value=s,zc.sky.uniforms.Qt.state++,qc.transform.visible=!0})},Hc=()=>{qc.transform.position[0]=.998*Xa.transform.cX[12],qc.transform.position[1]=.998*Xa.transform.cX[13],qc.transform.position[2]=.998*Xa.transform.cX[14]};let Xc,jc;const Jc=()=>{Qi.clouds&&To("engine/skybox",t=>{jc=new Bn(Ha,t),Xc=new wa(jc,zc.clouds,Ha.TRIANGLES,!1,4e3),Xc.transform.position[1]=0,on(Xc.transform.scale,.2),Xc.transform.scale[1]*=.3,ra(Xc.transform,qc.transform),Xc.transform.matrixAutoUpdate=!0;const e=Lo(Al.frag,1024,Va);zc.clouds.uniforms.TJ.value=e,zc.clouds.uniforms.TJ.state++})},Vc=[];let Yc,Wc,Qc;const Kc=()=>{Wc=Sc.uG,Yc=Sc.aA,Qc=Sc.uT},td=t=>{Vc.sort((t,e)=>t.camDistance-e.camDistance);for(let t=0,e=Vc.length;t<e;++t){const s=Vc[t];if(s.data.remove)Vc.splice(t,1),fa(s),--t,--e;else if(t<16){const e=4*t,i=3*t;Yc.value[i]=s.cX[12],Yc.value[i+1]=s.cX[13],Yc.value[i+2]=s.cX[14],Wc.value[e]=s.data.val[0],Wc.value[e+1]=s.data.val[1],Wc.value[e+2]=s.data.val[2],Wc.value[e+3]=s.data.val[3]*(1-s.data.distanceFactor)}}Yc.state++,Wc.state++,Qc.value=Math.min(16,Vc.length)},ed=({Zj:t,size:e},s,i)=>(s||((s=pa()).data.remove=!1,s.data.camDistance=0,s.data.distanceFactor=0,Vc.push(s)),On(s.cX,i),s.data.val=[...t,e],s),sd=t=>{for(let t=0;t<Vc.length;++t)fa(Vc[t]);Vc.length=0};class id{constructor(t=0,e=0){this.start=t,this.end=t+e,this.duration=e}done(t){return t>this.end}fraction(t){return gr(1-(this.end-t)/this.duration,0,1)}remaining(t){return this.end-t}passed(t){return t-this.start}reset(t,e=this.duration){return this.start=t,this.end=t+e,this.duration=e,!0}set(t,e){return this.start=t,this.end=e,this.duration=this.end-this.start,!0}}const nd=[],ad=66,rd=new Uint32Array(ad);for(let t=0,e=0;t<ad;t+=6,e+=2)rd[t+0]=e,rd[t+1]=e+1,rd[t+2]=e+3,rd[t+3]=e,rd[t+4]=e+3,rd[t+5]=e+2;const od=new Map,ld=t=>{const e=od.get(t.steps||10);let s;return s=e&&0!==e.length?e.pop():new ud(t),s.reset(t),nd.push(s),s},cd=t=>{for(let e=0;e<nd.length;e++)if(nd[e].tick(t),nd[e].remove){const t=nd.splice(e--,1)[0];dd(t)}},dd=t=>{od.has(t.maxSteps)||od.set(t.maxSteps,[]),od.get(t.maxSteps).push(t),t.onCache()},hd=t=>{nd.forEach(dd),nd.length=0};class ud{constructor(t){this.maxSteps=t.steps||10,this.stepTimer=new id(0,1),this.timer=new id(0,1),this.lines=this.maxSteps+1,this.Lz=new Float32Array(4*this.lines),this.positions=new Float32Array(6*this.lines),this.geometry=new Bn(Ha,{position:{size:3,data:this.positions},Lz:{size:2,data:this.Lz},index:{type:Ha.UNSIGNED_INT,data:rd.subarray(0,6*this.maxSteps)}}),this.mesh=new wa(this.geometry,zc.ribbon,Ha.TRIANGLES,!1),this.mesh.uniformData.offset=[0,this.maxSteps,1]}reset(t){if(this.stepTimer.reset(0,t.interval||.5),this.timer.reset(Ya.time,t.timer||1),this.currentStep=0,this.permanent=t.permanent||!1,this.a=t.a,this.b=t.b,this.mesh.uniformData.offset[2]=t.repeat||.5,this.remove=!1,this.timeoutSteps=0,t.uvTop=t.uvTop||1,t.uvBot=t.uvBot||0,this.uvTop!==t.uvTop||this.uvBot!==t.uvBot){for(let e=0,s=0;e<this.lines;++e,s+=4)this.Lz[s]=e/this.maxSteps,this.Lz[s+2]=e/this.maxSteps,this.Lz[s+1]=t.uvTop,this.Lz[s+3]=t.uvBot;this.uvTop=t.uvTop,this.uvBot=t.uvBot,this.geometry.updateAttribute(this.geometry.attributes.Lz)}this.geometry.drawRange.count=0,this.mesh.uniformData.UO=this.UO=t.UO,this.mesh.uniformData.vX=this.vX=t.vX,Nc(this.mesh.transform),this.parent=t.parent||null}tick(t){if(this.timer.done(Ya.time)&&!this.permanent)return void(this.remove=!0);if(null!==this.parent){if(this.mesh.transform.visible=this.parent.visible&&(!this.parent.parent||this.parent.parent.visible),!this.mesh.transform.visible)return;this.mesh.transform.visible&&0==this.timeoutSteps&&(this.positions.set(wn(Ka,this.a,this.parent.cX),0),this.positions.set(wn(Ka,this.b,this.parent.cX),3))}this.stepTimer.done(Ya.time)&&(this.stepTimer.reset(Ya.time),this.step()),this.geometry.updateAttribute(this.geometry.attributes.position);const e=this.stepTimer.fraction(Ya.time);this.mesh.uniformData.offset[0]=e/(this.maxSteps+1)+(this.permanent?0:this.timer.fraction(Ya.time)),this.currentStep<this.maxSteps?this.mesh.uniformData.offset[1]=this.maxSteps/(this.currentStep+e):this.mesh.uniformData.offset[1]=1}step(){this.currentStep=Math.min(this.maxSteps,this.currentStep+1),this.positions.copyWithin(6,0),this.geometry.drawRange.count=6*this.currentStep,this.timeoutSteps>0&&(this.timeoutSteps--,0==this.timeoutSteps&&(this.remove=!0))}onCache(){Zc(this.mesh.transform),this.mesh.transform.visible=!1,this.parent=null}}const md={},pd=(t,e)=>{const s=[];for(let i=0;i<t;++i){const t=e(i);t.idStart=t.idStart||0,t.vX=t.vX||t.UO,t.scaleStart=t.scaleStart||1,t.rotaStart=t.rotaStart||0,t.idEnd=void 0!==t.idEnd?t.idEnd:t.idStart,t.scaleEnd=void 0!==t.scaleEnd?t.scaleEnd:t.scaleStart,t.rotaEnd=void 0!==t.rotaEnd?t.rotaEnd:t.rotaStart,t.friction=t.friction||0,t.acc=t.acc||[0,0,0],t.iX=t.iX||br.linear,s.push(t)}return s};md.dust=pd(3,()=>({idStart:2,rotaStart:3*Math.random(),rotaEnd:3*-Math.random(),UO:[Zo(.4,.5),Zo(.4,.5),Zo(.4,.5),2],vX:[Zo(.4,.5),Zo(.4,.5),Zo(.4,.5),2],scaleStart:.7+.5*Math.random(),scaleEnd:0,friction:.1,duration:350})),md.floaterGreen=pd(5,()=>({iX:br.sinReverse,idStart:6,UO:[Zo(.5,.8),Zo(1.5,2),Zo(.5,.8),2.5],vX:[Zo(0,.2),Zo(.8,.9),Zo(.1,.2),0],scaleStart:1,scaleEnd:.5,duration:15e3})),md.totemfloater=pd(1,()=>({iX:br.sinReverse,idStart:6,UO:[Zo(.5,.8),Zo(1.5,2),Zo(.5,.8),2.5],vX:[Zo(0,.2),Zo(.8,.9),Zo(.1,.2),0],scaleStart:2,scaleEnd:2,duration:2e3})),md.floaterRed=pd(5,()=>({iX:br.sinReverse,idStart:0,UO:[Zo(1.5,2),Zo(.5,.7),Zo(.3,.6),2.5],vX:[Zo(0,.2),Zo(.2,.5),Zo(.2,.2),0],scaleStart:.15,scaleEnd:.04,duration:15e3})),md.fire=pd(12,()=>{const t=Zo(0,.5),e=Zo(.9,1.7)-.5*t;return{idStart:27,idEnd:32,UO:[1.3,.3+2*t,t,1],vX:[1.2,.1,0,.8],scaleStart:e,scaleEnd:.5*e,rotaStart:Zo(-.4,.4),rotaEnd:Zo(-.2,.2),acc:[0,3-t,0],duration:Zo(700,800)*(1.5-t)}}),md.mystical=pd(3,()=>({iX:br.easeOutQuad,idStart:1,UO:[.1,1,1,1],vX:[0,.1,.9,0],scaleStart:0,scaleEnd:1.4,rotaStart:0,rotaEnd:2,duration:Zo(400,600)})),md.meleeFlash=pd(3,()=>({iX:br.sinReverse,idStart:3,rotaStart:Zo(0,3),UO:[1,1,1,.5],vX:[1,1,1,0],scaleStart:1.5+.3*Zo(0,3),scaleEnd:.5+.3*Zo(0,3),duration:200})),md.meleePhys=pd(3,()=>{const t=Zo(0,1);return{idStart:2,UO:[1,.4,.1,.7],vX:[1,0,0,0],scaleStart:.5-.2*t,scaleEnd:0,friction:.05+.2*t,acc:[0,-20,0],duration:250}}),md.blood=pd(3,()=>({idStart:2,UO:[Zo(.2,.25),0,Zo(0,.05),3],vX:[Zo(.2,.25),0,Zo(0,.05),2],scaleStart:.5-.2*Zo(0,1),scaleEnd:0,acc:[0,-20,0],duration:1e3})),md.bloodFloat=pd(3,()=>({idStart:2,UO:[Zo(.2,.25),0,Zo(0,.05),3],vX:[Zo(.2,.25),0,Zo(0,.05),2],scaleStart:.5,scaleEnd:0,duration:500})),md.meleeFlashBig=pd(3,()=>({iX:br.sinReverse,idStart:3,rotaStart:Zo(0,3),UO:[2,1,1,.5],vX:[1,.8,.8,0],scaleStart:3+.3*Zo(0,3),scaleEnd:.5+.3*Zo(0,3),duration:200})),md.blockCircle=pd(1,()=>({idStart:8,UO:[1,1,1.5,2],vX:[0,0,1,-1],scaleStart:0,scaleEnd:10,duration:250})),md.blockFlick=pd(3,()=>({idStart:2,rotaStart:Zo(0,3),UO:[1,1,1.5,2],vX:[0,.3,1,-1],scaleStart:.25,scaleEnd:.1,duration:400})),md.healHolySoft=pd(3,()=>({iX:br.sinReverse,idStart:4,UO:[1,2,1,3],vX:[.8,1,.7,0],scaleStart:Zo(1.8,3.2),scaleEnd:Zo(1,2),acc:[0,Zo(.3,1.5),0],duration:1e3})),md.healNatureBlink=pd(3,()=>({iX:br.sinReverse,idStart:6,rotaStart:Zo(0,3),rotaEnd:Zo(0,3),UO:[1,2,.6,.8],vX:[.8,.7,.7,0],scaleStart:Zo(.8,1.5),scaleEnd:0,acc:[0,Zo(1.5,3),0],duration:600})),md.healHolySparkle=pd(3,()=>({iX:br.sinReverse,idStart:6,rotaStart:Zo(0,3),rotaEnd:Zo(0,3),UO:[2,2,1,.8],vX:[.8,.7,.7,0],scaleStart:Zo(1,2),scaleEnd:0,acc:[0,Zo(.3,1.5),0],duration:1e3})),md.removeCC=pd(1,()=>({iX:br.sinReverse,idStart:6,UO:[1,2,1.5,1],vX:[.5,.5,1,.3],scaleStart:2,scaleEnd:0,acc:[0,2,0],friction:.1,duration:800})),md.removeCCFlash=pd(1,()=>({idStart:13,UO:[1,1.5,1,3],vX:[0,1,1,-1],scaleStart:0,scaleEnd:10,duration:600})),md.blockBuffShield=pd(1,()=>({idStart:9,UO:[.1,1.3,1,.8],vX:[.1,.8,1,.3],scaleStart:.5,scaleEnd:.4,duration:500})),md.holyShield=pd(1,()=>({idStart:9,UO:[1.2,1,0,1.5],vX:[1,.8,0,.9],scaleStart:.5,scaleEnd:.4,duration:200})),md.blockBuffFocus=pd(1,()=>({idStart:8,UO:[1,1,1.5,1],vX:[0,0,1,0],scaleStart:10,scaleEnd:0,duration:400})),md.blockBuffEnrage=pd(3,()=>({idStart:1,UO:[.3,0,.05,3],vX:[.2,0,.05,0],acc:[0,1,0],scaleStart:.4,scaleEnd:.2,duration:1e3,rotaStart:Zo(0,3)})),md.crescentStrike=pd(1,()=>({idStart:0,UO:[1.5,.7,.4,2],vX:[1,.5,.5,0],scaleStart:.5,scaleEnd:.3,duration:500,friction:.1})),md.levelUp=pd(1,()=>({iX:br.sinReverse,idStart:6,UO:[2,2,1,.8],vX:[.8,.7,.7,0],scaleStart:1.5,scaleEnd:0,friction:.03,duration:1e3})),md.iceBig=pd(5,()=>({iX:br.sinReverse,idStart:0,UO:[Zo(.18,.21),Zo(.6,.7),Zo(1.4,1.5),2],vX:[.8,.9,1,0],scaleStart:.4,scaleEnd:.3,rotaStart:Zo(0,6),friction:.1,acc:[Zo(-1,1),Zo(-1,1),Zo(-1,1)],duration:Zo(200,300)})),md.extraBoltParticle=pd(1,()=>({iX:br.sinReverse,idStart:24,UO:[.8,.9,1.4,1.3],vX:[.8,.9,1,.9],scaleStart:.25,scaleEnd:.2,rotaStart:0,duration:1e3})),md.snowflake=pd(3,()=>({idStart:0,UO:[.9,1,1.3,2],vX:[.9,1,1.1,0],scaleStart:.5,scaleEnd:.2,rotaStart:Zo(0,3),friction:.1,duration:Zo(800,1e3)})),md.frostflake=pd(3,()=>({idStart:0,UO:[.1,.3,1.3,3],vX:[.1,.3,1,1],scaleStart:.7,scaleEnd:0,rotaStart:Zo(0,3),friction:.05,duration:Zo(600,800)})),md.preciseArrow=pd(3,()=>({idStart:0,UO:[1,1,1,2],vX:[1,1,1,0],scaleStart:.2,scaleEnd:.1,rotaStart:Zo(0,3),duration:Zo(300,400)})),md.healNatureBig=pd(3,()=>({iX:br.sinReverse,idStart:10,UO:[.2,1.5,.5,1.5],vX:[.3,.9,1,0],scaleStart:.7,scaleEnd:.2,acc:[Zo(-.5,.5),1.5,Zo(-.5,.5)],rotaStart:Zo(0,3),duration:Zo(600,800),friction:.02})),md.healNatureSparkle=pd(3,()=>({iX:br.sinReverse,idStart:0,UO:[1.5,1.5,.4,2],vX:[1.7,1.5,.4,0],scaleStart:.12,scaleEnd:.05,acc:[Zo(-.5,.5),2,Zo(-.5,.5)],rotaStart:Zo(0,3),duration:Zo(600,800)})),md.invigorateBuff=pd(1,()=>({idStart:11,UO:[0,1,1.5,1],vX:[0,.7,1.5,.7],scaleStart:.8,scaleEnd:.7,duration:300})),md.hypothermicBuff=pd(1,()=>({idStart:7,UO:[.4,.9,2.5,2.5],vX:[.5,.8,1.5,.9],scaleStart:.7,scaleEnd:.5,duration:500})),md.manaGain=pd(3,()=>({iX:br.sinReverse,idStart:6,rotaStart:Zo(0,3),rotaEnd:Zo(0,3),UO:[.2,.6,2,2],vX:[.1,.4,1,1],scaleStart:Zo(1,2),scaleEnd:.5,acc:[0,Zo(.5,3),0],duration:800})),md.iceglare=pd(1,()=>({idStart:6,UO:[.3,.4,1,1.5],vX:[.3,.4,1,1.5],scaleStart:2,scaleEnd:3,duration:800})),md.skulls=pd(6,t=>{const e=Zo(.7,1.5);return{iX:br.sinReverse,idStart:t%2==0?12:23,rotaStart:Zo(-2,2),UO:[e,1.5-.5*e,Zo(.05,.25),1.6],vX:[e,2.5-e,Zo(.05,.25),.2],scaleStart:Zo(.4,.5),scaleEnd:0,friction:.05,duration:700}}),md.decay=pd(1,()=>({idStart:12,rotaStart:0,rotaEnd:0,UO:[.5,.3,.1,2],vX:[.5,1,.1,1],scaleStart:.6,scaleEnd:.6,duration:500})),md.decayCloud=pd(1,()=>({idStart:2,rotaStart:0,UO:[.5,.3,.1,2],vX:[.5,1,.1,0],scaleStart:.6,scaleEnd:.4,duration:700})),md.soulCloud=pd(1,()=>({idStart:2,rotaStart:0,UO:[.8,.7,1.4,1.3],vX:[.6,1,.9,0],scaleStart:.5,scaleEnd:.3,duration:700})),md.soulHarvested=pd(1,()=>({iX:br.sinReverse,idStart:12,rotaStart:0,UO:[.6,.7,.9,1.5],vX:[.1,.1,1.2,.1],scaleStart:.4,scaleEnd:0,acc:[0,1,0],duration:900})),md.souls=pd(6,()=>({iX:br.sinReverse,idStart:12,rotaStart:Zo(-1.5,1.5),UO:[Zo(.1,.2),Zo(.4,.5),Zo(.5,.9),1.6],vX:[Zo(.1,.2),Zo(.4,.5),Zo(.5,.9),.2],scaleStart:Zo(.35,.45),scaleEnd:0,friction:.05,duration:700})),md.dmgBoostFangs=pd(1,()=>({idStart:25,rotaStart:-.3,rotaEnd:.3,UO:[2,1.6,1.3,.8],vX:[1,.8,.6,.7],scaleStart:.4,scaleEnd:.38,duration:200})),md.dmgBoostFangsFlash=pd(1,()=>({idStart:25,UO:[2,1.6,1.3,.9],vX:[1,.8,.6,-1],scaleStart:0,scaleEnd:5,duration:800})),md.moveBoostFlash=pd(1,()=>({idStart:1,UO:[1,1,2,.9],vX:[1,1,2,-1],scaleStart:0,scaleEnd:5,duration:800})),md.plaguebones=pd(1,()=>({idStart:23,rotaStart:0,rotaEnd:4,UO:[1.7,2,1.3,.6],vX:[.8,1,.6,.5],scaleStart:.4,scaleEnd:.38,friction:.05,duration:3e3})),md.mimir=pd(3,()=>({idStart:6,UO:[.2,.6,3,2],vX:[.1,.4,1.2,1],scaleStart:Zo(1,2),scaleEnd:.5,duration:800})),md.icenova=pd(3,()=>({idStart:0,UO:[.2,.3,1.5,1.5],vX:[.5,.4,1,0],scaleStart:.3,scaleEnd:1.4,rotaStart:Zo(0,3),friction:.1,duration:Zo(300,400)})),md.iceFlash=pd(1,()=>({idStart:8,UO:[.8,.8,1.5,2],vX:[.5,.5,1,-1],scaleStart:0,scaleEnd:10,duration:350})),md.icicle=pd(3,()=>({idStart:1,UO:[1,1,1.5,1.5],vX:[.2,.2,1.3,.5],scaleStart:.8,scaleEnd:0,rotaStart:Zo(0,9),duration:Zo(400,500),friction:.01})),md.courage=pd(1,()=>({idStart:13,UO:[.5,1.5,1.5,2],vX:[.2,1.4,1.3,1],scaleStart:.8,duration:400})),md.courageFlash=pd(1,()=>({idStart:13,UO:[.5,1.5,1.5,2],vX:[0,0,1,0],scaleStart:0,scaleEnd:15,duration:800})),md.warcry=pd(1,()=>({idStart:14,UO:[1,.3,.2,3],vX:[1,.2,.1,2],scaleStart:.8,duration:400})),md.warcryFlash=pd(1,()=>({idStart:14,UO:[1,.3,.2,3],vX:[1,0,0,0],scaleStart:0,scaleEnd:15,duration:800})),md.enchant=pd(4,()=>({idStart:5,UO:[1,.3,.2,Zo(2,3)],vX:[1,.2,.1,2],scaleStart:Zo(1.5,1.8),scaleEnd:1.3,rotaStart:Zo(0,3),rotaEnd:0,duration:500})),md.shadowglow=pd(3,()=>({idStart:1,UO:[.5,1,.6,1.5],vX:[.2,1.5,.2,0],scaleStart:.5,scaleEnd:.8,acc:[Zo(-1,1),Zo(-1,1),Zo(-1,1)],rotaStart:Zo(-1,1),rotaEnd:Zo(-1,1),duration:500})),md.enchantFlash=pd(1,()=>({idStart:8,UO:[1,.2,.05,1.5],vX:[1,.5,.4,.5],scaleStart:10,scaleEnd:0,duration:500})),md.hardenedEggFlash=pd(1,()=>({idStart:9,UO:[.5,.7,.8,1.4],vX:[.5,.5,.7,-1],scaleStart:0,scaleEnd:5,duration:800})),md.blueMarbleFlash=pd(1,()=>({idStart:26,UO:[.5,.5,2,1.4],vX:[.5,.5,1,-1],scaleStart:0,scaleEnd:5,duration:800})),md.blueMarble=pd(3,t=>({idStart:26,UO:[.5,.5,2,1.5],vX:[.5,.5,1.5,.9],rotaStart:0+t,rotaEnd:200+t,scaleStart:1,duration:3e4})),md.whiteAura=pd(2,t=>({idStart:5,UO:[.3,.4,.6,2.5],vX:[.2,.3,.4,2],scaleStart:3,scaleEnd:2.5,rotaStart:3.5,rotaEnd:1.5*t,duration:300})),md.arcticaura=pd(2,()=>({idStart:5,UO:[0,.3,1,Zo(2,3)],vX:[0,0,1,1],scaleStart:Zo(3,4),scaleEnd:3,rotaStart:Zo(0,3),rotaEnd:0,duration:500})),md.arcticFlash=pd(1,()=>({idStart:7,UO:[.3,.5,1.5,1.5],vX:[0,.5,1,.5],scaleStart:10,scaleEnd:0,duration:500})),md.temporal=pd(1,()=>({idStart:5,UO:[1.2,1.2,0,1.5],vX:[1,1,0,.9],scaleStart:1,scaleEnd:.8,duration:200})),md.temporalFlash=pd(1,()=>({idStart:8,UO:[1,1,0,1],vX:[1,1,0,.5],scaleStart:5,scaleEnd:0,duration:200})),md.pathfindFlash=pd(1,()=>({idStart:8,UO:[1,1,.9,1],vX:[1,.5,.5,.2],scaleStart:0,scaleEnd:6,duration:200})),md.canine=pd(1,()=>({idStart:15,UO:[1.5,.5,.1,2],vX:[1.3,.3,.2,1],scaleStart:.6,scaleEnd:.5,duration:200})),md.canineFlash=pd(1,()=>({idStart:15,UO:[1.5,.5,.1,2],vX:[1.3,.3,.2,0],scaleStart:0,scaleEnd:10,duration:400})),md.etherglow=pd(1,()=>({iX:br.sinReverse,idStart:5,UO:[.4,1,2,.9],vX:[.2,.9,1,0],scaleStart:1.2,scaleEnd:.5,acc:[0,2,0],rotaStart:0,rotaEnd:0,duration:900})),md.poison=pd(6,()=>({iX:br.sinReverse,idStart:17,idEnd:21,rotaStart:Zo(-.2,.2),rotaEnd:Zo(-.2,.2),UO:[Zo(0,.6),2,Zo(0,.1),1],vX:[1.5,1,0,0],scaleStart:Zo(.6,.8),scaleEnd:.5,acc:[Zo(-.5,.5),Zo(1,3),Zo(-.5,.5)],friction:.05,duration:1e3})),md.poisonSoft=pd(4,()=>({iX:br.sinReverse,idStart:16,UO:[Zo(0,1),2,0,1],vX:[Zo(0,1),1,.2,0],scaleStart:Zo(1.8,3.2),scaleEnd:Zo(1,2),duration:1500})),md.decaySoft=pd(4,()=>({iX:br.sinReverse,idStart:16,UO:[Zo(.5,1),.8,0,1.5],vX:[Zo(.5,.8),Zo(.8,1.1),.2,0],scaleStart:Zo(1.8,3.2),scaleEnd:Zo(1,2),duration:1500})),md.teleportSparkle=pd(3,()=>({iX:br.sinReverse,idStart:6,UO:[Zo(.5,1),.6,Zo(1,2),Zo(.5,1.5)],vX:[.5,.3,1.3,0],scaleStart:Zo(2,4),scaleEnd:Zo(.5,1.5),duration:400})),md.teleportFlash=pd(1,()=>({idStart:8,UO:[.8,.6,2,2],vX:[.5,.3,1.3,-1],scaleStart:8,scaleEnd:0,duration:150})),md.precisesparcle=pd(5,()=>({iX:br.sinReverse,idStart:6,UO:[Zo(1,2),Zo(.9,1.2),Zo(.5,.8),Zo(1.5,2.5)],vX:[1,.5,.3,0],scaleStart:Zo(2,4),scaleEnd:Zo(.4,.7),duration:200,rotaStart:Zo(0,3),rotaEnd:Zo(-3,0)})),md.stun=pd(1,()=>({idStart:6,UO:[1.2,1.2,.2,1.2],vX:[1.2,1.2,.2,.9],scaleStart:1.7,scaleEnd:1.8,duration:500})),md.daze=pd(1,()=>({idStart:6,UO:[.2,1.2,1.2,1.2],vX:[.2,1.2,1.2,.9],scaleStart:1.2,scaleEnd:1,duration:500})),md.chargeFlash=pd(1,()=>({idStart:8,UO:[2,1.5,.3,1.5],vX:[1,.5,.3,.2],scaleStart:0,scaleEnd:5,duration:250})),md.tauntFlash=pd(1,()=>({idStart:8,UO:[2,1,.8,1.2],vX:[1.5,.2,.3,.2],scaleStart:8,scaleEnd:0,duration:350})),md.tauntsparkle=pd(4,()=>({iX:br.sinReverse,idStart:6,UO:[Zo(2,3),Zo(.9,1.2),Zo(.2,.1),Zo(1.5,2.5)],vX:[1,.9,.8,0],scaleStart:Zo(2,2.5),scaleEnd:Zo(1,1.5),duration:800,friction:.08,rotaStart:Zo(0,3)})),md.transformationAura=pd(5,()=>({iX:br.sinReverse,idStart:8,UO:[Zo(.5,.9),.5,Zo(2,3),0],vX:[Zo(.5,.9),.5,Zo(1,2),2],scaleStart:2,scaleEnd:0,duration:250})),md.transformSoft=pd(5,()=>({iX:br.sinReverse,idStart:16,UO:[Zo(.5,.8),.5,Zo(2,3),2],vX:[Zo(.5,.8),.5,Zo(1,2),0],scaleStart:Zo(2.5,4.2),scaleEnd:Zo(1,2),duration:800,rotaStart:Zo(0,5)})),md.snipe=pd(1,()=>({idStart:6,UO:[2.6,2,1.5,1],vX:[2.6,2,1.5,1],scaleStart:3,scaleEnd:0,friction:.15,duration:300})),md.summonFlash=pd(1,()=>({idStart:8,UO:[1.5,.6,2,2],vX:[.8,.1,1.3,-1],scaleStart:0,scaleEnd:12,duration:1600})),md.summonSparkle=pd(3,()=>({iX:br.sinReverse,idStart:6,rotaStart:Zo(0,3),rotaEnd:Zo(0,3),UO:[.9,.5,2,2],vX:[.5,.1,1.5,1],scaleStart:Zo(1,2),scaleEnd:.5,acc:[0,Zo(.5,3),0],friction:.02,duration:1600}));const fd=[];let gd,vd;const yd=[],bd=()=>{Cd(),zc.ribbon.setBlendFunc(Ha.ONE,Ha.ONE_MINUS_SRC_ALPHA),zc.particles.setBlendFunc(Ha.ONE,Ha.ONE_MINUS_SRC_ALPHA);for(let t=0;t<1e3;++t)yd.push({Zc:[-0,-0,-0],vel:[-0,-0,-0],info:md.dust[0],distance:0,uH:0,start:0,end:1.01,forced:!1})},xd=(t,e,s)=>{const i=[];for(let n=fd.length-1;n>=0;--n){const a=fd[n];a.start<0||a.end>t?a.Zc[0]>0&&(un(a.vel,a.vel,a.info.acc,e),un(a.Zc,a.Zc,a.vel,e),a.info.friction>0&&hn(a.vel,a.vel,1-a.info.friction),a.distance=Id(a.Zc,s.kX),a.distance<1&&(a.uH=a.start<0?.5*(Math.sin(t/a.info.duration)+1):(t-a.start)/a.info.duration,i.push(a))):(fd.splice(n,1),yd.push(a))}return i.sort(Td),i},wd=t=>{$d(t),kd(t)},kd=t=>{t.length>0?(gd.transform.visible=!0,vd.setDrawRange(0,t.length),vd.updateAttribute(vd.attributes.Zc),vd.updateAttribute(vd.attributes.info),vd.updateAttribute(vd.attributes.Qm),vd.updateAttribute(vd.attributes.UO),vd.updateAttribute(vd.attributes.vX)):gd.transform.visible=!1},$d=t=>{for(let e=0;e<t.length;++e){const s=t[e];vd.attributes.Zc.data.set(s.Zc,3*e),vd.attributes.info.data.set([s.info.iX(s.uH),0,s.info.idStart,s.info.idEnd],4*e),vd.attributes.Qm.data.set([s.info.scaleStart,s.info.scaleEnd,s.info.rotaStart,s.info.rotaEnd],4*e),vd.attributes.UO.data.set(s.info.UO,4*e),vd.attributes.vX.data.set(s.info.vX,4*e)}},Sd=t=>{const e=xd(cr,t,Xa);wd(e)};let Md=0;const Ed=(t,e,s=0,i=0,n=0,a=0,r=0,o=0,l=!1)=>{let c=yd.pop();if(!c){if(l){let t=fd.length-1;for(;t>=0&&fd[t].forced;)--t;t>=0&&(c=fd.splice(t,1)[0])}if(!c)return}return rn(c.vel,a,r,o),rn(c.Zc,s,i,n),e&&wn(c.Zc,c.Zc,e),Md>100&&(Md=0),c.info=t[++Md%t.length],c.start=l?-1:cr,c.end=c.start+c.info.duration,c.forced=l,fd.push(c),c},Cd=()=>{vd=new Bn(Ha,{Zc:{size:3,data:new Float32Array(3e3)},info:{size:4,data:new Float32Array(4e3)},Qm:{size:4,data:new Float32Array(4e3)},UO:{size:4,data:new Float32Array(4e3)},vX:{size:4,data:new Float32Array(4e3)}}),gd=new wa(vd,zc.particles,Ha.POINTS),gd.frustumCulled=!1,Nc(gd.transform),Ro("particles.png",t=>{zc.particles.uniforms.HC.value=t,zc.particles.uniforms.HC.state++,zc.particles.active=!0,gd.renderOrder=7e3})},Td=(t,e)=>t.distance<e.distance?1:-1,Id=(t,e)=>(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14])/(e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]),Pd={},Bd=({geo:t,program:e,ts:s,rs:i,mode:n,dynamic:a,cull:r,permanent:o,frustum:l=!0,visible:c=!0})=>{const d=t+e.id+(s?1:0)+(i?1:0)+(a?1:0)+(l?1:0)+(void 0!==r?r:1029)+(void 0!==n?n:999);let h,u,m=0;for(;!h;)u=d+m,Pd[u]?Pd[u].instances.length<3e3?h=Pd[u]:++m:h=Fd({geo:t,program:e,ts:s,rs:i,mode:n,dynamic:a,hash:u,cull:r,permanent:o,frustum:l,visible:c});return h.create()},Fd=({geo:t,program:e,ts:s,rs:i,mode:n,dynamic:a,hash:r,cull:o,permanent:l,frustum:c,visible:d})=>{const h=Pd[r]=new $a(Ha,e,void 0!==n?n:Ha.TRIANGLES,0,null,Qi.shadows&&s?a?gc.LG:gc.shadowStatic:void 0,Qi.shadows&&i?gc.LG:void 0,a,c);return h.permanent=l||!1,h.cullFace=void 0!==o?o:1029,h.uniformData.Hp=Qi.shadows&&i?1:0,h.dynamicThrowShadows=Qi.shadows&&a&&s||!1,Nc(h.transform),To(t,(t,i)=>{h.shadowProgram=Qi.shadows&&s?i.texture?zc.shadowInstancedAlpha:zc.shadowInstanced:void 0,h.setAttributes(t),void 0!==e.uniforms.pG?Ro(i.texture,t=>{h.uniformData.pG=t,h.transform.visible=d,h.renderOrder=0+(h.program.id+1)*(t.id+1)*(h.uniformData.Hp+1)}):(h.renderOrder=0+(h.program.id+1)*(h.uniformData.Hp+1),h.transform.visible=d)}),h},zd=()=>{for(const t in Pd)void 0===Pd[t]||Pd[t].permanent||(Zc(Pd[t].transform),Pd[t]=void 0)},Ud=[],Dd=[0,0,0],Ad=(t,e)=>{let s=Ud.length;for(;s--;){const i=Ud[s],n=i.data;n.remove||n.timeout>0&&n.time>n.timeout?(Nd(i),Ud.splice(s,1),Od(i)):(null===i.parent&&ca(i,!1),Zn(Dd,i.cX),n.camDistance=Math.max(0,mn(Dd,Xa.worldPosition)-10),n.distanceFactor=n.camDistance/(.25*e),n.lod=Math.max(0,1-n.distanceFactor),n.time+=t,n.accumulator+=t,n.distanceFactor<1||!n.info.permanent?(n.info.sound&&void 0===n.sound&&(n.info.sound.loop||0===n.info.sound.frame)&&Gd(i),n.info.Gb&&void 0===n.Gb&&Xd(i),void 0!==n.Gb&&(n.Gb.data.camDistance=n.camDistance,n.Gb.data.distanceFactor=n.distanceFactor),void 0!==n.tick&&(0===n.frame||n.time>=0&&(void 0!==n.particles||n.accumulator>=Math.min(1,.2*n.distanceFactor)))&&(!i.visible||null!=i.parent&&!i.parent.visible?n.invisibilified||(void 0!==n.particles&&n.particles.forEach(th),n.mesh&&(n.mesh.visible=!1),n.invisibilified=!0):(n.invisibilified&&(n.mesh&&(n.mesh.visible||(n.mesh.visible=!0,ca(n.mesh,!1))),n.invisibilified=!1),n.tick(cr,n.accumulator),n.accumulator=0,n.frame++))):(void 0!==n.sound&&n.sound.loop&&Hd(i),void 0!==n.Gb&&jd(i)))}},Rd=[],Ld=()=>{if(Rd.length>0)return Rd.pop();{const t=pa();return t.data={fraction:Vd,particle:qd,localize:eh,transform:t,time:-0,timeout:-0,accumulator:-0,frame:0,remove:!1,invisibilified:!1,camDistance:-0,distanceFactor:-0,lod:0,info:void 0,tick:void 0,creature:void 0,sound:void 0,ribbon:void 0,buff:void 0,Gb:void 0,mesh:void 0},t}},Od=t=>{Rd.indexOf(t)<0?Rd.push(t):console.error("tried returning effect that is already known")},_d=(t,e)=>{const s=Ld();if(s.data.time=void 0!==t.time?t.time:0,s.data.timeout=void 0!==t.timeout?t.timeout:0,s.data.accumulator=0,s.data.frame=0,s.data.remove=!1,s.data.info=t,s.data.tick=t.tick,s.data.buff=void 0,s.data.invisibilified=!1,s.matrixAutoUpdate=t.dynamic||!1,s.matrixNeedsUpdate=!0,s.visible=!0,e&&ra(s,e),void 0!==s.data.info.Gb&&Xd(s),void 0!==s.data.info.sound&&Gd(s),void 0!==s.data.info.ribbon&&Yd(s),void 0!==s.data.info.mesh&&Qd(s),void 0!==s.data.info.particles){s.data.particles=[];for(let t=0;t<s.data.info.particles.amount;++t){const t=s.data.particle(s.data.info.particles.info,0,0,0,0,0,0,!0);t&&s.data.particles.push(t)}}else s.data.particles=void 0;return Ud.push(s),s},Nd=t=>{void 0!==t.data.Gb&&jd(t),void 0!==t.data.sound&&Hd(t),void 0!==t.data.particles&&Jd(t),void 0!==t.data.ribbon&&Wd(t),void 0!==t.data.mesh&&Kd(t),null!==t.parent&&ra(t,null),rn(t.position,0,0,0),rn(t.scale,1,1,1),rn(t.rotation,0,0,0),t.data.creature=void 0,t.data.dir=void 0},Zd=t=>{for(let t=0;t<Ud.length;++t)Ud[t].data.remove=!0},qd=function(t,e=0,s=0,i=0,n=0,a=0,r=0,o=!1){if(o||Qi.particles)return Ed(t,this.transform.cX,e,s,i,n,a,r,o)},Gd=t=>{void 0!==t.data.sound&&t.data.sound.stop(),t.data.sound=nl({id:t.data.info.sound.id,loop:t.data.info.sound.loop,dynamic:t.data.info.sound.dynamic,transform:t.data.info.sound.parent?t.parent:t,distance:t.data.info.sound.distance})},Hd=t=>{t.data.sound.stop(),t.data.sound=void 0},Xd=t=>{void 0!==t.data.Gb&&jd(t),t.data.Gb=ed(t.data.info.Gb,t.data.Gb,t.cX),ra(t.data.Gb,t)},jd=t=>{ra(t.data.Gb,null),t.data.Gb.data.remove=!0,t.data.Gb=void 0},Jd=t=>{t.data.particles.forEach(t=>{t.start=1,t.end=1}),t.data.particles=void 0},Vd=function(t,e,s=this.time){return s>=t&&s-e<=t},Yd=t=>{void 0!==t.data.ribbon&&(t.data.ribbon.remove=!0),t.data.ribbon=ld({parent:t,...t.data.info.ribbon})},Wd=t=>{void 0!==t.data.ribbon&&(t.data.ribbon.timeoutSteps=Math.max(1,t.data.ribbon.currentStep),t.data.ribbon.parent=null,t.data.ribbon=void 0)},Qd=t=>{void 0!==t.data.mesh&&Kd(t),t.data.mesh=Bd({geo:t.data.info.mesh.id||"cube",program:zc.multimeshFlat,ts:!0,rs:!0,dynamic:!0}),t.data.mesh.data.color=t.data.info.mesh.color,void 0!==t.data.info.mesh.scale&&an(t.data.mesh.scale,t.data.info.mesh.scale),void 0!==t.data.info.mesh.Zc&&an(t.data.mesh.position,t.data.info.mesh.Zc),void 0!==t.data.info.mesh.rot&&an(t.data.mesh.rotation,t.data.info.mesh.rot),ra(t.data.mesh,t)},Kd=t=>{void 0!==t.data.mesh&&(t.data.mesh.data.multi.remove(t.data.mesh),t.data.mesh=void 0)},th=t=>t.Zc[0]=-1;function eh(t,e=0,s=0,i=0,n=0,a=0,r=0){const o=this.transform.position,l=this.transform.parent.scale,c=this.transform.parent.position;t[0]=(o[0]+e)*l[0]+c[0]+n,t[1]=(o[1]+s)*l[1]+c[1]+a,t[2]=(o[2]+i)*l[2]+c[2]+r}const sh=(t,e)=>{const s=[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255];return void 0!==e&&s.push(e),s},ih=[];let nh,ah;const rh={color:[0,0,0]},oh={color:[0,0,0]},lh={color:[0,0,0],dir:[0,0,0]},ch={near:10,Oq:100,color:[0,0,0]},dh=()=>{Sc.PF.value=ch.near,Sc.zn.value=ch.Oq,Sc.rJ.value=ch.color,Sc.Oy.value=oh.color,Sc.Dz.value=rh.color,Sc.cG.value=lh.color,Sc.Wl.value=lh.dir,rn(lh.dir,1.5,2.5,0),vn(lh.dir,lh.dir),$c(lh.dir)};let hh;const uh=t=>{Ya.data&&mh(Ya),Ya.data&&ph();let e=5,s=t+10;hh!=s&&(Sc.PF.value=e,Sc.zn.value=s,hh=s)},mh=t=>{let e=t.daytime;e=e<.85?.5*yr(0,.85,e):.5+.5*yr(.85,1,e),Sc.Nt.value=e;let s,i,n=.5;e<.05?(s=1,i=0,n=yr(0,.05,e)):e<.4?(s=0,i=0):e<.5?(s=0,i=1,n=yr(.4,.5,e)):e<.6?(s=1,i=2,n=yr(.5,.6,e)):e<.9?(s=2,i=2):(s=2,i=1,n=yr(.9,1,e)),Cr(lh.color,ih[s].directional,ih[i].directional,n),Cr(ch.color,ih[s].fog,ih[i].fog,n),Cr(rh.color,ih[s].ambient,ih[i].ambient,n),Cr(oh.color,ih[s].sky,ih[i].sky,n),Ha.clearColor(ch.color[0],ch.color[1],ch.color[2],1)};ie.subscribe(t=>{t&&Ya.deserialized&&gh(Ya)});const ph=t=>{if(!nh||!ah)return;const e=Sc.Nt.value;let s,i,n=.5;e<.1?(s=nh,i=ah,n=.5*yr(0,.1,e)+.5):e<.4?(s=nh,i=ah,n=-1):e<.6?(s=ah,i=nh,n=yr(.4,.6,e)):e<.9?(s=ah,i=nh,n=-1):(s=nh,i=ah,n=.5*yr(.9,1,e)),n>=0?(s.gain.gain.value=1-n,i.gain.gain.value=n):(s.gain.gain.value=0,i.gain.gain.value=1)},fh=(t,e)=>{t.data.cols.forEach((t,e)=>{ih[e]={fog:sh(t.fog),directional:sh(t.directional),ambient:sh(t.ambient),sky:sh(t.sky)}}),gh(t)},gh=t=>{ah&&ah.stop(),nh&&nh.stop(),ah=nl({id:t.getSetting("ambDay")||"ambient/gs_day",pitch:-1,loop:!0,gain:!0,type:"ambience"}),nh=nl({id:t.getSetting("ambNight")||"ambient/gs_night",pitch:-1,loop:!0,gain:!0,type:"ambience"})};let vh=1;const yh=t=>{vh=t%2147483647,vh<=0&&(vh+=2147483646)},bh=()=>vh=16807*vh%2147483647,xh=()=>(bh()-1)/2147483647,wh=(t,e)=>t*e/255,kh=(t,e)=>t*e/65535,$h=(t,e)=>{const s=e/65535;return[(t>>>16)*s,(65535&t)*s]},Sh=t=>t/60,Mh=t=>{const e=Math.floor(t%8);t/=8;const s=Math.floor(t%8);t/=8;const i=Math.floor(t%10);t/=10;const n=Math.floor(t%10);return t/=10,{col3:e,col2:s,col1:i,val1:Math.floor(t),val2:n}},Eh=t=>{const e=Math.floor(t%16);return t/=16,{type:Math.floor(t%16),value:e}},Ch=1024,Th=1073741.8235,Ih=65536/(2*Math.PI),Ph=655.36,Bh=(t,e,s)=>(e.id=s.id,rn(e.Zc,s.x/Ch,s.y/Th,s.z/Ch),rn(e.rot,s.rx/Ih,s.ry/Ih,s.rz/Ih),e.scale=Math.max(s.scale,100)/Ph,e),Fh=(t,e)=>(t.id=e.id,t.meta=e.meta,t.class=e.class,t.faction=e.faction,t.name=e.name,t.Zc=$h(e.Zc,768),t.rot=wh(e.rot,2*Math.PI),t),zh=(t,e)=>{if(!Qi.grass||!e)return;const s=[];for(let e=0;e<64;++e)for(let i=0;i<64;++i){const n=i+64*e,a=Eh(t.data.foliage.readUInt8(n));yh(n**2);for(let n=0;n<Math.min(Math.round(a.value/8),2);++n){const n=[i-.7+1.4*xh(),0,e-.7+1.4*xh(),.4+(1.5*xh()+.2)*a.value/15];if(n[0]<0||n[0]>=64||n[2]<0||n[2]>=64)continue;n[1]=t.getHeight(n[0],n[2])+.5*n[3];const r={Zc:n,info:[a.type]};n[0]+=t.origin[0],n[2]+=t.origin[2],s.push(r)}}const i=s.length;if(!(i>0))return;Uh(t,Ha);const n=t.geometry.foliage;let a,r;n.attributes.position.data.byteLength==4*i*4?(a=n.attributes.position.data,r=n.attributes.info.data):(a=new Float32Array(4*i),n.attributes.position.data=a,r=new Float32Array(1*i),n.attributes.info.data=r),s.forEach((t,e)=>{a.set(t.Zc,4*e),r.set(t.info,1*e)}),n.setDrawRange(0,i),n.updateAttribute(n.attributes.position),n.updateAttribute(n.attributes.info),n.bounds=t.geometry.terrain.bounds},Uh=(t,e)=>{t.geometry.foliage||(t.geometry.foliage=new Bn(e,{info:{size:1,data:new Float32Array(1)},position:{size:4,data:new Float32Array(4)}})),t.meshes.foliage||(t.meshes.foliage=new wa(t.geometry.foliage,zc.foliage,e.POINTS,!0,1e3,null,void 0,gc.LG),ra(t.meshes.foliage.transform,t.meshes.terrain.transform))},Dh=t=>{t.geometry.foliage&&t.geometry.foliage.remove()},Ah=(t,e)=>{const s=t.data.settings.find(t=>"foliagetex"===t.id);s&&Ro("foliage/"+s.value+".png",t=>{zc.foliage.active=!0,zc.foliage.uniforms.zx.value=t})},Rh=[],Lh=[],Oh=(t,e,s,i)=>{const n=Ya.entity(t),a=Ya.entity(e);if(s.fx.effectMissile&&void 0!==n&&void 0!==a&&void 0!==n.visual&&void 0!==a.visual&&(!n.visual.inFog||!a.visual.inFog)){const t={targetid:e,timer:i,effect:_d(s.fx.effectMissile),start:ln([0,0,0],Mn(Ka,[0,0,n.radius],n.rot),n.Zc)};Rh.push(t),Nh(t,Rh.length-1)}},_h=(t,e,s,i)=>{if(s.fx.effectMissile){const n={timer:i,path:t,fractions:e,currentIndex:0,effect:_d(s.fx.effectMissile)};n.effect.data.missile=n,Lh.push(n),Zh(n,Lh.length-1)}},Nh=(t,e)=>{if(!Ya.isEntityIdTaken(t.targetid)||t.timer.done(Ya.smoothtime))return Rh.splice(e,1),t.effect.data.remove=!0,void(t.effect.data.missile=void 0);const s=Ya.entity(t.targetid),i=dn([0,0,0],s.visualPosition,t.start);un(t.effect.position,t.start,i,t.timer.fraction(Ya.smoothtime));const n=Ya.getHeight(t.effect.position[0],t.effect.position[2])+.3;n>t.effect.position[1]&&(t.effect.position[1]=n),ua(t.effect,s.visualPosition,!1,Wa),t.timer.passed(Ya.smoothtime)>.5&&(an(t.start,t.effect.position),t.timer.reset(Ya.smoothtime,t.timer.end-Ya.smoothtime)),ca(t.effect,!1)},Zh=(t,e)=>{if(t.timer.done(Ya.smoothtime))return Lh.splice(e,1),void(t.effect.data.remove=!0);const s=Math.max(0,Math.min(1,t.timer.fraction(Ya.smoothtime)));t.currentIndex=zr(t.effect.position,t.path,s,t.fractions),ca(t.effect,!1)},qh=()=>{Rh.forEach(Nh),Lh.forEach(Zh)},Gh=t=>{Rh.forEach(t=>{t.effect.data.remove=!0}),Lh.forEach(t=>{t.effect.data.remove=!0,t.effect.data.missle=void 0}),Rh.length=0,Lh.length=0};let Hh=void 0,Xh=[];const jh=new id(0,1),Jh=()=>{0!==Xh.length&&(Hh?Hh.ended&&(Vh(Ya),Hh=void 0):jh.done(Ya.smoothtime)&&(0===jh.start?Vh(Ya):Hh=nl({id:"music/"+Go(Xh),pitch:-1,type:"music"})))},Vh=t=>jh.reset(t.smoothtime,qo(1,2)),Yh=(t,e)=>{e&&Hh&&(Hh.stop(),Hh=void 0);const s=t.getSetting("music");void 0!==s&&(Xh=s.split(","))};let Wh;const Qh=()=>{Wh=new wa(void 0,zc.sun,Ha.TRIANGLES),on(Wh.transform.scale,.25),ra(Wh.transform,qc.transform),Wh.transform.visible=!1,To("engine/plane",t=>{const e=new Bn(Ha,t);Wh.geometry=e,Wh.transform.visible=!0})},Kh=()=>{an(Wh.transform.position,lh.dir),hn(Wh.transform.position,Wh.transform.position,.45),ua(Wh.transform,Qa,!1,Wa)},tu={beigerocks:[.8,.31,.6,.48],beigesand:[.8,.54,.73,.43],bluegrass:[1.3,.29,.68,.6],browndirt:[.8,.2,.54,.65],cobblestone:[1.5,.23,.75,.45],darkrocks:[.8,.17,.49,.51],driedmud:[.8,.48,.76,.22],greengrass:[1.3,.22,.52,.71],greyrock:[.8,.24,.47,.57],mossysandstone:[.8,.21,.76,.45],muddyrocks:[.8,.21,.48,.73],orangesand:[.8,.65,.86,.35],purplefungus:[.8,.21,.44,.53],purplerock:[.8,.15,.4,.36],sedimentary:[.8,.33,.59,.42],mossygrass:[1,.22,.52,.6],greysand:[.35,.18,.53,.56]},eu={Jw:{JC:0,tree:!1,double:!1},tree:{JC:0,tree:!0,double:!0},tree_flip:{JC:0,tree:!1,double:!0},tiled:{JC:40,tree:!1,double:!1}},su={default:eu.Jw,"prop/tree_pine":eu.tree_flip,"prop/bush01":eu.tree,"prop/tree_guardstone_small":eu.tree,"prop/tree_guardstone_medium":eu.tree,"prop/tree_guardstone_big":eu.tree,"prop/rocks1":eu.tiled},iu=[0,0,0],nu=[0,0,0],au=[0,0,0],ru=[0,0,0],ou=[0,0,0],lu=[0,0,0],cu=(t,e,s)=>{uu(t,Ha);const i=t.geometry.terrain;if(e){const e=i.attributes.position.data,s=i.attributes.Jw.data,n=i.attributes.index.data;for(let s=0;s<65;++s)for(let i=0;i<65;++i){e[3*(i+65*s)+1]=t.getHeight(i,s)}for(let t=0,e=s.length;t<e;++t)s[t]=0;for(let t=0,i=n.length;t<i;t+=3){const i=3*n[t],a=3*n[t+2],r=3*n[t+1];rn(iu,e[i],e[i+1],e[i+2]),rn(nu,e[a],e[a+1],e[a+2]),rn(au,e[r],e[r+1],e[r+2]),dn(ru,iu,nu),dn(ou,au,nu),bn(lu,ru,ou),s[i]+=lu[0],s[i+1]+=lu[1],s[i+2]+=lu[2],s[a]+=lu[0],s[a+1]+=lu[1],s[a+2]+=lu[2],s[r]+=lu[0],s[r+1]+=lu[1],s[r+2]+=lu[2]}for(let t=0,e=s.length;t<e;t+=3)rn(lu,s[t],s[t+1],s[t+2]),vn(lu,lu),s.set(lu,t);i.updateAttribute(i.attributes.position),i.updateAttribute(i.attributes.Jw)}if(s){const e=i.attributes.MR.data,s=i.attributes.Xm.data;for(let i=0;i<65;++i)for(let n=0;n<65;++n){const a=n+65*i;let r;if(64==i||64==n){const e=t.getNeighborChunk(n,i);if(e&&e.deserialized)r=Mh(e.data.color.readUInt16BE(2*(n%64+i%64*64)));else{const e=Math.min(n,63),s=Math.min(i,63);r=Mh(t.data.color.readUInt16BE(2*(e+64*s)))}}else r=Mh(t.data.color.readUInt16BE(2*(n+64*i)));for(let t=0;t<4;++t)du(e,4*a+t,t,r),du(s,4*a+t,t+4,r)}i.updateAttribute(i.attributes.MR),i.updateAttribute(i.attributes.Xm)}},du=(t,e,s,i)=>{s==i.col1?t[e]=.5+i.val1/8*.5:s==i.col2?t[e]=.5-i.val1/8*.5:s==i.col3?t[e]=(.5-i.val1/8*.5)*(i.val2/8)*.5:t[e]=0},hu={min:[0,0,0],max:[64,64,64],center:[32,32,32],scale:[64,64,64],radius:60,initiated:!0},uu=(t,e)=>{if(t.geometry.terrain||(t.geometry.terrain=new Bn(e,mu(e,64)),Object.assign(t.geometry.terrain.bounds,hu)),!t.meshes.terrain){const s=t.meshes.terrain=new wa(t.geometry.terrain,zc.terrain,e.TRIANGLES,!0,0,zc.shadowTerrain,gc.water,gc.LG);s.frustumCulled=!0,an(s.transform.position,t.origin),s.renderOrder=2e3,ca(s.transform,!1),t.state=3}},mu=(t,e)=>{const s=(e+1)**2,i=e**2,n=new Float32Array(3*s),a=new Float32Array(3*s),r=new Float32Array(2*s),o=new Uint32Array(6*i);let l=0;for(let t=0,s=0;t<=e;++t)for(let i=0;i<=e;++i,++s){if(n[3*s+0]=i,n[3*s+2]=t,r[2*s]=i/e,r[2*s+1]=t/e,i===e||t===e)continue;const a=i+t*(e+1),c=i+(t+1)*(e+1),d=i+(t+1)*(e+1)+1,h=i+t*(e+1)+1;o[6*l]=a,o[6*l+1]=c,o[6*l+2]=h,o[6*l+3]=c,o[6*l+4]=d,o[6*l+5]=h,++l}return{position:{size:3,data:n},Jw:{size:3,data:a},Lz:{size:2,data:r},index:{type:t.UNSIGNED_INT,data:o},MR:{size:4,data:new Float32Array(4*s)},Xm:{size:4,data:new Float32Array(4*s)}}},pu=t=>{t.geometry.terrain&&t.geometry.terrain.remove()},fu=(t,e)=>{const s=t.data.settings.find(t=>"terraintex"===t.id);s&&s.value.split(",").forEach((t,e)=>{Ro("terrain/"+t+".jpg",s=>{Fo.terrain[e]=s;const i=Sc["tinf"+e];ta(i.value,tu[t]),i.state++,zc.terrain.active=!0})})},gu=[],vu=[],yu=()=>{gu[0]=new Bn(Ha,wu(Ha,64)),gu[1]=new Bn(Ha,wu(Ha,8)),gu[2]=new Bn(Ha,wu(Ha,1)),Ro("water.jpg",t=>{zc.water.uniforms.bX.value=t,Ro("water2.jpg",t=>{zc.water.active=!0,zc.water.uniforms.Gj.value=t})})},bu=(t,e)=>{for(let e=0;e<t.data.water.length;++e){let s=vu[e];const i=t.data.water[e];s||(vu[e]=s=new wa(void 0,zc.water,Ha.TRIANGLES,!0,5e3,void 0,void 0,gc.water),Nc(s.transform)),s.geometry=gu[i.Xj],s.uniformData.Xj=i.Xj,s.uniformData.speed=i.speed,s.uniformData.aX=i.aX,s.uniformData.vk=i.vk,s.uniformData.visibility=i.visibility,s.uniformData.Hd=sh(i.Hd),s.uniformData.Rj=sh(i.Rj),s.uniformData.Tp=sh(i.Tp);const n=64*t.chunkAmount;0==i.Xj?(rn(s.transform.position,.5*n,i.Zc[1]/10,.5*n),rn(s.transform.scale,2*n,1,2*n),rn(s.transform.rotation,0,0,0)):(rn(s.transform.position,i.Zc[0],i.Zc[1]/10,i.Zc[2]),rn(s.transform.scale,i.sx,1,i.sz),rn(s.transform.rotation,0,i.rot/(256/(2*Math.PI)),0)),s.transform.position[0]=gr(0,n,s.transform.position[0]),s.transform.position[2]=gr(0,n,s.transform.position[2])}},xu=t=>{vu.forEach(t=>{Zc(t.transform)}),vu.length=0},wu=(t,e)=>{const s=e**2,i=new Float32Array(3*(e+1)**2),n=new Uint32Array(6*s),a=1/e;let r=0;for(let t=0,s=0;t<=e;++t)for(let o=0;o<=e;++o,++s){if(i[3*s+0]=a*o-.5,i[3*s+2]=a*t-.5,o===e||t===e)continue;const l=o+t*(e+1),c=o+(t+1)*(e+1),d=o+(t+1)*(e+1)+1,h=o+t*(e+1)+1;n[6*r]=l,n[6*r+1]=c,n[6*r+2]=h,n[6*r+3]=c,n[6*r+4]=d,n[6*r+5]=h,++r}return{position:{size:3,data:i},index:{type:t.UNSIGNED_INT,data:n}}},ku=()=>{Uo(),xc(),Dc(),dh(),Jc(),yu(),bd(),Kc(),Gc(),Qh()},$u=(t,e,s)=>{wc(),uh(e),qh(),Ad(t,e),Sd(t),td(),cd(t),Hc(),Kh(),el(t),Jh(),Uc(s)},Su=(t,e)=>{fh(t),fu(t),bu(t),Ah(t),Yh(t,e)},Mu=t=>{xu(),Gh(),Zd(),sd(),hd(),hl()},Eu=(t,e,s,i,n)=>{cu(t,e,s),zh(t,i)},Cu=t=>{pu(t),Dh(t)};let Tu=Qi.resolution/100;const Iu=new Qn({width:window.innerWidth,height:window.innerHeight,resolution:Tu,antialias:!1,powerPreference:"high-performance"});Iu.isWebgl2||(alert("WebGL2 problem found."),window.location.href="/technical");const Pu=Iu.gl,Bu=new ba(.1,500,80),Fu=pa(),zu=new Za(Pu,{width:window.innerWidth,height:window.innerHeight,resolution:Tu});let Uu=100;const Du=()=>{ra(Bu.transform,Fu),rn(Bu.transform.position,0,1,-1),Bu.lookAt(Wa,Wa),Fu.matrixAutoUpdate=!0,hr(Pu,Bu,Fu,zu,Iu),ku(),Iu.canvas2dElement.className="l-canvas",Iu.gl.canvas.className="l-canvas",Pu.canvas.style.pointerEvents="all",window.addEventListener("resize",Au,!1),Au(null,!0)};Je.subscribe(t=>{Uu=t**2/10,Bu.Oq=Uu+10,Bu.perspective()}),ne.subscribe(t=>{});const Au=(t,e)=>{e||(Iu.setSize(window.innerWidth,window.innerHeight,Tu),zu.resize({width:window.innerWidth,height:window.innerHeight,dpr:1,resolution:Tu})),Bu.aspect=Pu.canvas.width/Pu.canvas.height,Bu.perspective(),Fc(Pu.canvas.width,Pu.canvas.height)};Ve.subscribe(t=>{const e=t/100,s=Tu!==e;Tu=e,Qi.resolutionScale=e,s&&Au(null,!1)});const Ru=()=>{_c.forEach(t=>{ca(t,!1)}),Qi.shadows&&pc&&(Rc(),Iu.render({scene:_c,camera:bc.water,shadowTarget:fc.water}),Oc(),Ac(),Iu.render({scene:_c,camera:bc.LG,shadowTarget:fc.shadowStatic}),Lc(),kc(!1)),Qi.shadows&&(Pu.bindFramebuffer(Pu.READ_FRAMEBUFFER,fc.shadowStatic.buffer),Pu.bindFramebuffer(Pu.DRAW_FRAMEBUFFER,fc.LG.buffer),Pu.blitFramebuffer(0,0,yc,yc,0,0,yc,yc,Pu.DEPTH_BUFFER_BIT,Pu.NEAREST),Iu.render({scene:_c,clear:!1,camera:bc.LG,sceneCamera:Bu,shadowTarget:fc.LG})),Qi.postProcessing?zu.render({scene:_c,camera:Bu,update:!Qi.shadows}):Iu.render({scene:_c,camera:Bu,update:!Qi.shadows}),Iu.postRender()},Lu=(t,e)=>{$u(t,Uu,Iu)},Ou=(t,e)=>{Su(t,e)},_u=t=>{Mu(),zd()},Nu=(t,e,s,i,n)=>{Eu(t,e,s,i),(e||s||n)&&kc(!0)},Zu=t=>{Cu(t)};function qu(t){let e;return{c(){e=B("div"),e.innerHTML='<div class="bounce1 svelte-twvoek"></div><div class="bounce2 svelte-twvoek"></div><div class="bounce3 svelte-twvoek"></div>',A(e,"class","spinner svelte-twvoek")},m(t,s){T(t,e,s)},p:i,i:i,o:i,d(t){t&&I(e)}}}class Gu extends Ht{constructor(t){super(),Gt(this,t,null,qu,h,{})}}function Hu(t,{delay:e=0,duration:s=400,easing:i=n}){const a=+getComputedStyle(t).opacity;return{delay:e,duration:s,easing:i,css:t=>"opacity: "+t*a}}let Xu=.016;const ju=t=>{Xu=(10*Xu+t)/11};let Ju=.016,Vu=0;const Yu=t=>{Ju=t};let Wu=0;const Qu=t=>{Wu=(2*Wu+t)/3};let Ku=0;const tm=new id(0,.05),em=t=>{Qi.showFpsPing&&tm.done(Ya.time)&&(Vu=(10*Vu+Ju)/11,Ku=(5*Ku+Ya.netData.length)/6,tm.reset(Ya.time),Me.update(t=>(t[0]=gr(Wu>>0,1,999),t[1]=(1e3/Xu).toFixed(1),t[2]=(Vu/1e3).toFixed(1),t[3]=Ya.player?`${~~Ya.player.Zc[0]} ${~~Ya.player.Zc[1]} ${~~Ya.player.Zc[2]}`:"-",t[4]=Ku.toFixed(1),t)))},sm=t=>{tm.reset(t.time)};var im=Object.freeze({__proto__:null,parseFrameDelta:ju,parseBandwidth:Yu,parseLatency:Qu,tick:em,onWorldEnter:sm});const nm=performance,am=()=>nm.now();let rm,om=0,lm=0;const cm={open:[],close:[]};for(const t in mo)cm[mo[t].header]=[];const dm=t=>{},hm=t=>{console.log("Connected"),om=1;for(let e=0,s=cm.open.length;e<s;++e)cm.open[e](t)},um=t=>{console.log("Connection closed:",t.reason,t.code),om=0;for(let e=0,s=cm.close.length;e<s;++e)cm.close[e](t)},mm=t=>{xm(t.data.byteLength),t=Qr(t.data);const e=vo(t),s=e&&cm[e.header];if(s)for(let e=0,i=s.length;e<i;++e)s[e](t)},pm=(t,e)=>{cm[t].push(e)},fm=t=>{void 0!==rm&&1===om&&rm.send(t)},gm=t=>{void 0===rm&&(rm=new WebSocket("wss://"+t+"/play"),rm.binaryType="arraybuffer",rm.onerror=dm,rm.onopen=hm,rm.onclose=um,rm.onmessage=mm,console.log("Connecting to game server"))},vm=()=>{void 0!==rm&&(rm.close(),rm=void 0)};let ym=0,bm=0;const xm=t=>{bm+=t,cr-ym>250&&(lm=4*bm,bm=0,ym=cr,Yu(lm))},wm=()=>{Qi.showFpsPing&&cr-Sm>(Mm.length<10?100:2e3)&&(Sm=cr,Em())},km=t=>{if(Mm[t.id]){const e=am();if(Mm[t.id]<=e){const s=e-Mm[t.id];Qu(s)}}};let $m=0,Sm=0;const Mm=[],Em=()=>{$m>254&&($m=0),Mm[$m]=am(),fm(mo.ping.packData({id:$m})),$m++};function Cm(t){let e,s,i,n,a,r,o,l=t[1]?t[1]+"  ":"";s=new Gu({});let c="askReconnect"===t[0]&&Tm(t),d="number"==typeof t[0]&&Im(t);return{c(){e=B("div"),_t(s.$$.fragment),c&&c.c(),i=B("h5"),d&&d.c(),n=F(l),a=F("\n    0.36.4597 Live"),A(i,"class","version textgrey svelte-qe246z"),A(e,"class","l-ui container svelte-qe246z")},m(t,r){T(t,e,r),Nt(s,e,null),c&&c.m(e,null),C(e,i),d&&d.m(i,null),C(i,n),C(i,a),o=!0},p(t,s){"askReconnect"===t[0]?c?c.p(t,s):(c=Tm(t),c.c(),c.m(e,i)):c&&(c.d(1),c=null),"number"==typeof t[0]?d?d.p(t,s):(d=Im(t),d.c(),d.m(i,n)):d&&(d.d(1),d=null),(!o||2&s)&&l!==(l=t[1]?t[1]+"  ":"")&&O(n,l)},i(t){o||(Tt(s.$$.fragment,t),ft(()=>{r||(r=Ft(e,Hu,{},!0)),r.run(1)}),o=!0)},o(t){It(s.$$.fragment,t),r||(r=Ft(e,Hu,{},!1)),r.run(0),o=!1},d(t){t&&I(e),Zt(s),c&&c.d(),d&&d.d(),t&&r&&r.end()}}}function Tm(t){let e,s,n;return{c(){e=B("div"),e.textContent="Reconnect",A(e,"class","btn primary reconnect svelte-qe246z")},m(i,a){T(i,e,a),s||(n=D(e,"click",t[2]),s=!0)},p:i,d(t){t&&I(e),s=!1,n()}}}function Im(t){let e,s;return{c(){e=F(t[0]),s=F("%  ")},m(t,i){T(t,e,i),T(t,s,i)},p(t,s){1&s&&O(e,t[0])},d(t){t&&I(e),t&&I(s)}}}function Pm(t){let e,s,i=t[0]&&Cm(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),1&s&&Tt(i,1)):(i=Cm(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function Bm(t,e,s){let i,n;p(t,je,t=>s(4,i=t)),p(t,Xe,t=>s(1,n=t));let a=!0;et(()=>{"autoReconnect"==o&&(document.hidden?(s(0,o=!0),setTimeout(()=>{s(0,o="autoReconnect")},1e3)):(a&&setTimeout(r,1e3),a=!1))});const r=async()=>{a=!0,Xe.update(t=>!1),s(0,o=!0);try{if(!i)throw null;const t=await fetch("api/user/join",{method:"POST",body:JSON.stringify({id:i})}),e=await t.json();if(!e.world)throw x(je,i=0),null;Xe.set(e.world)}catch(t){window.location.href="/"}};let{active:o}=e;return t.$$set=t=>{"active"in t&&s(0,o=t.active)},[o,n,r]}class Fm extends Ht{constructor(t){super(),Gt(this,t,Bm,Pm,d,{active:0})}}function zm(t){let e;return{c(){e=B("div"),N(e,"cursor",t[1])},m(s,i){T(s,e,i),t[2](e)},p(t,[s]){2&s&&N(e,"cursor",t[1])},i:i,o:i,d(s){s&&I(e),t[2](null)}}}function Um(t,e,s){let i,n;function a(t){lt[t?"unshift":"push"](()=>{n=t,s(0,n)})}return p(t,ue,t=>s(1,i=t)),st(()=>{n.appendChild(Iu.gl.canvas),n.appendChild(Iu.canvas2dElement)}),[n,i,a]}class Dm extends Ht{constructor(t){super(),Gt(this,t,Um,zm,d,{})}}function Am(t){let e,s,i,n,a;return{c(){e=B("div"),s=B("img"),A(s,"class",i=b(t[2].css)+" svelte-sh553q"),s.src!==(n=t[2].img)&&A(s,"src",n),A(e,"class",a="container border "+t[2].border+" svelte-sh553q"),N(e,"top",t[1]+"px"),N(e,"left",t[0]+"px")},m(t,i){T(t,e,i),C(e,s)},p(t,r){4&r&&i!==(i=b(t[2].css)+" svelte-sh553q")&&A(s,"class",i),4&r&&s.src!==(n=t[2].img)&&A(s,"src",n),4&r&&a!==(a="container border "+t[2].border+" svelte-sh553q")&&A(e,"class",a),2&r&&N(e,"top",t[1]+"px"),1&r&&N(e,"left",t[0]+"px")},d(t){t&&I(e)}}}function Rm(t){let e,s=t[2]&&t[0]&&t[1]&&Am(t);return{c(){s&&s.c(),e=U()},m(t,i){s&&s.m(t,i),T(t,e,i)},p(t,[i]){t[2]&&t[0]&&t[1]?s?s.p(t,i):(s=Am(t),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i:i,o:i,d(t){s&&s.d(t),t&&I(e)}}}function Lm(t,e,s){let i,n,a;p(t,he,t=>s(2,i=t));const r=t=>{(i||n||a)&&(i?(s(0,n=t.clientX-10),s(1,a=t.clientY-10)):(s(0,n=0),s(1,a=0)))};return st(()=>{document.addEventListener("mousemove",r,!1)}),nt(()=>{document.removeEventListener("mousemove",r)}),[n,a,i]}class Om extends Ht{constructor(t){super(),Gt(this,t,Lm,Rm,d,{})}}function _m(t,e,s){const i=t.slice();return i[6]=e[s],i}function Nm(t){let e,s=t[2].opts,i=[];for(let e=0;e<s.length;e+=1)i[e]=Gm(_m(t,s,e));let n=null;return s.length||(n=Zm()),{c(){e=B("div");for(let t=0;t<i.length;t+=1)i[t].c();n&&n.c(),A(e,"class","panel context border grey"),N(e,"left",t[2].x+"px"),N(e,"top",t[2].y+"px")},m(s,a){T(s,e,a);for(let t=0;t<i.length;t+=1)i[t].m(e,null);n&&n.m(e,null),t[4](e)},p(t,a){if(5&a){let r;for(s=t[2].opts,r=0;r<s.length;r+=1){const n=_m(t,s,r);i[r]?i[r].p(n,a):(i[r]=Gm(n),i[r].c(),i[r].m(e,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=s.length,s.length?n&&(n.d(1),n=null):n||(n=Zm(),n.c(),n.m(e,null))}4&a&&N(e,"left",t[2].x+"px"),4&a&&N(e,"top",t[2].y+"px")},d(s){s&&I(e),P(i,s),n&&n.d(),t[4](null)}}}function Zm(t){let e;return{c(){e=B("div"),e.textContent="No options",A(e,"class","choice disabled")},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function qm(t){let e,s,i;return{c(){e=B("img"),i=z(),A(e,"class","svgicon"),e.src!==(s="/assets/ui/icons/"+t[6].icon+".svg?v=4597824")&&A(e,"src",s)},m(t,s){T(t,e,s),T(t,i,s)},p(t,i){4&i&&e.src!==(s="/assets/ui/icons/"+t[6].icon+".svg?v=4597824")&&A(e,"src",s)},d(t){t&&I(e),t&&I(i)}}}function Gm(t){let e,s,i,n,a,r=t[6].name+"",o=t[6].icon&&qm(t);function l(...e){return t[3](t[6],...e)}return{c(){e=B("div"),o&&o.c(),s=F(r),A(e,"class",i="choice "+(t[6].css||""))},m(t,i){T(t,e,i),o&&o.m(e,null),C(e,s),n||(a=D(e,"click",l),n=!0)},p(n,a){(t=n)[6].icon?o?o.p(t,a):(o=qm(t),o.c(),o.m(e,s)):o&&(o.d(1),o=null),4&a&&r!==(r=t[6].name+"")&&O(s,r),4&a&&i!==(i="choice "+(t[6].css||""))&&A(e,"class",i)},d(t){t&&I(e),o&&o.d(),n=!1,a()}}}function Hm(t){let e,s=t[2]&&Nm(t);return{c(){s&&s.c(),e=U()},m(t,i){s&&s.m(t,i),T(t,e,i)},p(t,[i]){t[2]?s?s.p(t,i):(s=Nm(t),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i:i,o:i,d(t){s&&s.d(t),t&&I(e)}}}function Xm(t,e,s){let i,n;p(t,Wt,t=>s(2,i=t));const a=t=>{t.target!=n&&t.target.parentNode!=n&&i&&Wt.set(void 0)},r=t=>{t.fun(),Wt.set(void 0)};st(()=>{document.addEventListener("pointerdown",a,!1)}),nt(()=>{document.removeEventListener("pointerdown",a)});const o=t=>r(t);function l(t){lt[t?"unshift":"push"](()=>{n=t,s(1,n)})}return[r,n,i,o,l]}class jm extends Ht{constructor(t){super(),Gt(this,t,Xm,Hm,d,{opt:0})}get opt(){return this.$$.ctx[0]}}const Jm=(t,e="")=>{fm(mo.clientCommand.packData({command:t,string:e+""}))},Vm={report:{client:!0},partyleave:{},partyinvite:{a:1},partycreate:{},time:{},global:{a:1,chat:!0},party:{a:1,chat:!0},clan:{a:1,chat:!0},faction:{a:1,chat:!0}},Ym={gaingold:{admin:!0,a:1},gainmedals:{admin:!0,a:1},setelo:{admin:!0,a:1},die:{moderator:!0},statreset:{moderator:!0},testchar:{admin:!0,a:3},changeworld:{moderator:!0,a:1},gainfame:{admin:!0,a:1},itemmove:{a:2},itemdrop:{a:1},itemuse:{a:1},itemauctionpost:{a:2},itemauctionfind:{a:6},itemauctionbuy:{a:1},itemauctioncancel:{a:1},itemstash:{a:1},itemunstash:{a:1},itemsplithalf:{a:1},itemsplitone:{a:1},goldunstash:{a:1},goldstash:{a:1},itemtradersell:{a:1},itemtraderbuy:{a:1},itemblacksmithupgrade:{a:1},statincrease:{a:2},skillremove:{a:1},respawn:{},startqueue:{a:1},stopqueue:{a:1},partyaccept:{a:1},partydecline:{a:1},partykick:{a:1},partylink:{},partysetrole:{a:2},summonaccept:{a:1},whisper:{a:2,chat:!0},...Vm},Wm=t=>{navigator.clipboard.writeText(t)},Qm=(t,e,s)=>{Qt.update(i=>(i.push({title:t,text:e,choices:s}),i))};let Km=!0;const tp=(t,e,s,i,n)=>{t?Km&&(Qm(i,n,[{text:i,fun:()=>{Km=!0,Jm(e,""+s)}},{text:tn.ui.decline,fun:()=>{Km=!0}}]),Km=!1):Jm(e,""+s)},ep={Jw:{partyBasedHostility:!1,allowRespawn:!0,pvpprotect:!0,instanced:!1},arena3v3:{name:"Arena 3v3",queue:!0,instanced:!0,groupsize:3,groupcount:2,partyBasedHostility:!0,allowRespawn:!1,pvpprotect:!1},arena5v5:{name:"Arena 5v5",startTimer:30,groupsize:5,groupcount:2,queue:!0,instanced:!0,partyBasedHostility:!0,allowRespawn:!1,pvpprotect:!1},guardstonefind:{name:"Guardstone",queue:!0,partyfind:!0,minlevel:0},headlessfind:{name:"Headless Landing",queue:!0,partyfind:!0,minlevel:25},faivelfind:{name:"Faivel",queue:!0,partyfind:!0,minlevel:35}},sp=(t,e)=>"function"==typeof t?t(e):t;class ip{constructor(t){this.id=t.id,this.cd=void 0!==t.cd?t.cd:0,this.cost=t.cost||{},this.targetMode=t.targetMode||0,this.onCast=t.onCast,this.onPermanent=t.onPermanent,this.range=t.range||0,this.graceRange=this.range+Math.min(.2*this.range,10),this.auto=t.auto||!1,this.engineOnly=t.engineOnly||!1,this.minlevel=t.minlevel||0,this.castLen=t.castLen||0,this.gcd=void 0!==t.gcd?t.gcd:1.5,this.custom=t.custom,this.skilllevels=Math.min(5,t.skilllevels||5),this.goldValue=t.goldValue||0,this.noReward=t.noReward||!1,this.outOfCombat=t.outOfCombat||!1,this.pvpBoundsAdd=t.pvpBoundsAdd||0,this.ignoreGcd=t.ignoreGcd||!1,this.ignoreIncapacitated=t.ignoreIncapacitated||!1,this.disablingBuffs=t.disablingBuffs||[],this.hasteAffected=void 0===t.hasteAffected||t.hasteAffected,this.skillpoints=void 0!==t.skillpoints?t.skillpoints:1}can(t,e,s=0,i){if(this.outOfCombat&&!t.stats.combatTimer.done(Ya.time))return 11;if(this.cost.resources&&!this.cost.resources.reduce((s,i)=>s&&t.stats.getResource(i[0])>=sp(i[1],e),!0))return 5;if(1!==this.targetMode){let e=Ya.getEntityById(s);const n=void 0===e||e.stats.alive,a=void 0===e?-1:t.hostility(e);if(4096===this.targetMode){if((-1===a||0===a)&&n)return 3;if(!t.canCombatInteract(e))return 13}else if(256===this.targetMode){if((-1===a||0!==a)&&n)return 4}else if(16===this.targetMode)e=t;else if(17===this.targetMode&&(void 0===e||e===t))return 3;if(void 0!==e&&!e.stats.alive)return 10;if(e&&s!==t.id&&e!==t&&this.range>0&&!t.combatRangeCheck(e,i?this.range:this.graceRange))return 6}return this.disablingBuffs.some(e=>t.buffs.tags.get(e).size>0)?12:0}}class np extends ip{constructor(t){super(t),this.fx=t.fx||{},this.autoSkillbar=!1!==t.autoSkillBar}}const ap=(t,e,s,i)=>({id:t,minlevel:s,engineOnly:!1,cd:0,custom:i,autoSkillBar:!1,onPermanent:(t,s)=>({id:e,mode:4,caster:t.id,target:t.id,duration:-1,stacks:1,level:s})}),rp=(t,e,s,i,n,a,r)=>({id:t,targetMode:16,minlevel:s,cd:n,cost:{resources:a},fx:r,onCast:(t,s,n)=>({id:e,mode:4,stacks:1,duration:i,caster:t.id,target:t.id,aoe:{faction:!0,party:!0,circleRadius:20,circleHeight:10},level:s})}),op=(t,e,s,i,n,a,r,o=5,l)=>({id:t,targetMode:256,range:30,minlevel:s,cd:n,castLen:i,cost:{resources:r},fx:l,onCast:(t,s,i)=>({id:e,mode:o,stacks:1,caster:t.id,target:i,refresh:!0,duration:a,level:s})}),lp=(t,e,s=0,i=!0,n,a=!1,r=!1,o)=>({id:t,targetMode:16,cd:e,gcd:0,hasteAffected:!1,ignoreIncapacitated:a,ignoreGcd:!0,castLen:s,engineOnly:!0,outOfCombat:n,fx:o});var cp=new np(ap(21,64,1));const dp=[["white","common"],["green","uncommon"],["blue","rare"],["purp","epic"]],hp=t=>t>=90?3:t>=70?2:t>=50?1:0,up=t=>dp[hp(t)],mp={black:sh(0,0),white:sh(16777215,0),deadgrey:sh(3355443,0),teal:sh(3384995,0),magicblue:sh(3362252,0),paleskin:sh(14267315,0),darkskin:sh(8411481,0),slimegreen:sh(2542694,0),mushgreen:sh(2077529,0),linen:sh(13408614,0),woodbrown:sh(4859433,0),woodbrown2:sh(10250315,0),tealsteel:sh(3358797,.5),darksteel:sh(3355443,.5),greysteel:sh(5066061,.5),blacksteel:sh(988178,.5),leather:sh(4337198,0),emerald:sh(22866,-.1),gold:sh(16751616,.9),darkgold:sh(16747008,.9),paper:sh(15129011,0),richpurple:sh(7484623,0),fireorange:sh(14715686,-.7),archergreen:sh(10471258,0),warbrown:sh(15172191,0),bronze:sh(9258571,.5),silver:sh(11583679,.6),shamanblue:sh(3687924,0),mageblue:sh(6607340,0),bone:sh(14535066,.2),bone2:sh(11836267,.2),ice:sh(14610164,-.2),vanguard:sh(2848511,0),bloodlust:sh(14289947,0),pink:sh(16711935,0),warden:sh(14755623,0),evilred:sh(13239043,0),ruby:sh(15733030,1),moss:sh(2925637,.2),rock:sh(5006687,.4),death:sh(3750201,.8),diamond:sh(3076559,.9)},pp=[mp.woodbrown,mp.bronze,mp.greysteel,mp.silver,mp.gold],fp=[mp.diamond,mp.ruby],gp=[mp.leather,mp.greysteel,mp.silver,mp.gold,mp.diamond],vp=function(t,e,s){e%10==0&&t.particle(s,Zo(-20,20),Zo(-20,0),Zo(-20,10),0,.3,0)},yp={cityAmbience:{permanent:!0,Gb:{Zj:[.6,.3,.1],size:5e3}},mysticAmbience:{permanent:!0,Gb:{Zj:[0,.6,0],size:5e3},tick:function(t){vp(this,this.frame,md.floaterGreen)}},evilAmbience:{permanent:!0,Gb:{Zj:[.6,0,0],size:5e3},tick:function(t){vp(this,this.frame,md.floaterRed)}},oceanAmbience:{permanent:!0,sound:{loop:!0,parent:!0,id:"ambient_ocean",distance:100}},campfire:{permanent:!0,Gb:{dynamic:!0,Zj:[2.5,1.8,.3]},sound:{loop:!0,parent:!0,id:"fireloop",distance:7},tick:function(t,e){if(this.time>.1/this.transform.parent.scale[1]**2){this.time=0;const t=Zo(0,.4),e=this.particle(md.fire,Zo(-t,t),Zo(-.6,.1),Zo(-t,t),0,1,0);e&&rn(e.vel,0,.6*this.transform.parent.scale[1]-t,0)}this.Gb.data.val[3]=30+Math.sin(t/600)*Math.sin(t/50)*5}},torch:{permanent:!0,Gb:{dynamic:!0,Zj:[1,.8,.4,500]}},mystical01:{permanent:!0,dynamic:!0,Gb:{Zj:[.1,1.4,2],size:400,dynamic:!0},sound:{loop:!0,parent:!0,id:"mysticalSound",distance:14},tick:function(t,e){this.frame%3==0&&this.particle(md.mystical,3*Math.sin(t/600),1*Math.sin(t/400),3*Math.cos(t/600))}},meleeFlash:{time:-.3,timeout:1,Gb:{Zj:[1,1,1],size:0,dynamic:!0},tick:function(t,e){const s=.8*Math.sin(8*Math.max(0,Math.min(.39,2*this.time-.2)));if(ea(this.Gb.data.val,s,s,s,100),this.fraction(.2,e)){for(let t=0;t<3*this.lod;++t)this.particle(md.meleeFlash,Zo(-.1,.1),.5,0);this.creature.visual.addPushBack(this.dir,4)}}},meleePhys:{time:-.3,timeout:1,tick:function(t,e){if(this.fraction(.2,e)){nl({transform:this.transform,delay:.1,id:"impact_flesh",rnd:3,distance:5});for(let t=0;t<4*this.lod;++t){const t=Zo(0,1);rn(Ka,Zo(5*-t,5*t),10,Zo(5*-t,5*t)),un(Ka,Ka,this.dir,-8),this.particle(md.meleePhys,Zo(-.1,.1),.5,Zo(-.1,.1),Ka[0],Ka[1],Ka[2])}}}},bloodDirectional:{time:-.4,timeout:.01,tick:function(t,e){if(0===this.frame){this.creature.visual.addPushBack(this.dir,4);for(let t=0;t<8*this.lod;++t){const t=Zo(0,1);rn(Ka,Zo(3*-t,3*t),Zo(0,10),Zo(3*-t,3*t)),un(Ka,Ka,this.dir,-2),this.particle(md.blood,Zo(-.2,.2),0,Zo(-.2,.2),Ka[0],Ka[1],Ka[2])}}}},bloodRandom:{time:-.4,timeout:.01,tick:function(t,e){if(0===this.frame){this.creature.visual.addRandomPushback(4);for(let t=0;t<6*this.lod;++t){const t=Zo(0,1);rn(Ka,Zo(3*-t,3*t),Zo(0,10),Zo(3*-t,3*t)),this.particle(md.blood,Zo(-.2,.2),0,Zo(-.2,.2),Ka[0],Ka[1],Ka[2])}}}},arrowImpact:{timeout:1,Gb:{Zj:[1,1,1],size:0,dynamic:!0},tick:function(t,e){const s=.8*Math.sin(8*Math.max(0,Math.min(.39,2*this.time-.2)));if(ea(this.Gb.data.val,s,s,s,100),this.fraction(.2,e)){for(let t=0;t<3*this.lod;++t)this.particle(md.meleeFlash,Zo(-.1,.1),.5,0);this.creature.visual.addPushBack(this.dir,4)}}},arrowPreciseImpact:{timeout:1,Gb:{Zj:[1,1,1],size:0,dynamic:!0},tick:function(t,e){const s=.8*Math.sin(8*Math.max(0,Math.min(.39,2*this.time-.2)));if(ea(this.Gb.data.val,s,s,s,100),this.fraction(.2,e)){for(let t=0;t<3*this.lod;++t)this.particle(md.meleeFlashBig,Zo(-.1,.1),.5,0);this.creature.visual.addPushBack(this.dir,4)}}},physBlock:{time:-.3,timeout:.5,Gb:{Zj:[1,1,1],size:0,dynamic:!0},tick:function(t,e){const s=this.time>.2?5*Math.max(0,.5-this.time):0;if(ea(this.Gb.data.val,s,s,s,400),this.fraction(0,e)&&nl({delay:.2,distance:5,id:"block",transform:this.transform}),this.fraction(.2,e)){this.particle(md.blockCircle);for(let t=0;t<5*this.lod;++t)this.particle(md.blockFlick,0,0,0,Zo(-20,20),Zo(5,10),Zo(-20,20));this.creature.visual.addPushBack(this.dir,4)}}},potionConsume:{timeout:2,tick:function(t,e){this.frame%20==0&&(this.particle(md.healHolySoft,0,.5,0,Zo(-1,1),Zo(.1,.3),Zo(-1,1)),this.particle(md.healHolySparkle,Zo(-1,1),Zo(.1,.3),Zo(-.9,.9)))}},blockBuff:{particles:{amount:4,info:md.blockBuffShield},tick:function(t,e){this.fraction(.1,e)&&this.particle(md.blockBuffFocus),this.particles.forEach((e,s)=>{const i=1.55*s+t/500;this.localize(e.Zc,1.3*Math.sin(i),0,1.3*Math.cos(i))})}},removeCC:{timeout:1.3,Gb:{Zj:[1,1,1],size:0,dynamic:!0},tick:function(t,e){const s=3-this.time/1.3*3;ea(this.Gb.data.val,.7*s,.7*s,s,100),0===this.frame&&(this.particle(md.removeCCFlash),bp(this,8,18,md.removeCC))}},iceBlockBuff:{dynamic:!0,mesh:{id:"character/shield",color:[.3,.8,1,-.5],scale:[.3,.4,.4],Zc:[1.3,0,0],rot:[0,Math.PI,0]},particles:{amount:1,info:md.iceglare},tick:function(t,e){const s=t/400;rn(this.transform.rotation,0,-s,0),this.particles.forEach((t,e)=>{this.localize(t.Zc,1.3*Math.cos(s-this.transform.parent.rotation[1]),0,1.3*Math.sin(s-this.transform.parent.rotation[1]))})}},healOnBlockBuff:{particles:{amount:1,info:md.holyShield},tick:function(t,e){0!==this.particles.length&&this.localize(this.particles[0].Zc,0,.5,0,0,.5+.05*Math.sin(t/200))}},blockEnrageBuff:{tick:function(t,e){this.time>.5/Math.min(10,this.buff.stacks)&&(this.time=0,this.particle(md.blockBuffEnrage,Zo(-1,1),0,Zo(-1,1)))}},plagueSpreaderBuff:{particles:{amount:5,info:md.plaguebones},tick:function(t,e){this.particles.forEach((e,s)=>{if(s>=this.buff.stacks)rn(e.Zc,0,0,0);else{const i=s*(6.28/this.buff.stacks)+t/900;this.localize(e.Zc,1.3*Math.sin(i),.2,1.3*Math.cos(i))}})}},dmgBoostBuff:{particles:{amount:3,info:md.dmgBoostFangs},tick:function(t,e){0===this.frame&&this.particle(md.dmgBoostFangsFlash,0,1,0),this.particles.forEach((e,s)=>{const i=s*(6.28/3)+t/900;this.localize(e.Zc,1.4*Math.sin(i),.2,1.4*Math.cos(i))})}},extraBoltBuff:{particles:{amount:3,info:md.extraBoltParticle},tick:function(t,e){this.particles.forEach((e,s)=>{if(s>=this.buff.stacks)rn(e.Zc,0,0,0);else{const i=s*(6.28/this.buff.stacks)+t/900;this.localize(e.Zc,1.1*Math.sin(i),.2,1.1*Math.cos(i))}})}},temperBuff:{tick:function(t,e){0===this.frame&&nl({distance:5,id:"warrior/temperbuff",transform:this.transform.parent,dynamic:!0}),this.particle(md.dust,Zo(-1,1),0,Zo(-1,1))}},temperBoostBuff:{ribbon:{steps:3,interval:.5,timer:3,permanent:!0,a:[0,.5,-.5],b:[0,-.5,-.5],UO:[1,.2,.1,.8],vX:[1,.2,.1,0]},tick:function(t,e){0===this.frame&&(this.particle(md.iceFlash),nl({distance:7,id:"warrior/temperboostbuff",transform:this.transform.parent,dynamic:!0}),bp(this,7,30,md.dust)),this.frame%10==0&&this.particle(md.blockFlick,Zo(-1,1),0,Zo(-1,1))}},crescentStrike:{Gb:{Zj:[1,1,1],size:0,dynamic:!0},timeout:.5,tick:function(t,e){this.fraction(.1,e)&&this.creature.visual.weapon&&(ra(this.transform,this.creature.visual.weapon),this.transform.position[1]=.8);const s=Math.sin(this.time*Math.PI*.5);if(ea(this.Gb.data.val,.9*s,0,0,300),this.fraction(.01,e,this.time%.1)){const t=this.particle(md.crescentStrike,Zo(-1,1),Zo(.1,.3),Zo(-1,1));t&&Mn(t.vel,[-5,0,0],this.creature.visual.transform.rotation[1]+this.creature.visual.chest.rotation[1])}}},levelUp:{Gb:{Zj:[1,1,1],size:0,dynamic:!0},timeout:2,sound:{distance:5,id:"levelup",parent:!0},tick:function(t,e){const s=2*Math.sin(this.time*Math.PI*.5);ea(this.Gb.data.val,.9*s,s,.7*s,200),this.fraction(.1,e)&&bp(this,8,5,md.levelUp)}},icebolt:{dynamic:!0,ribbon:{steps:3,interval:.4,timer:15,a:[-.2,0,0],b:[.2,0,0],UO:[1,1,2.5,1.5],vX:[0,.2,1,0]},mesh:{id:"character/spike",color:[1.5,1.5,2,-.3],scale:[.4,.4,.4]},tick:function(t,e){this.frame%1==0&&(this.particle(md.iceBig,Zo(-.15,.15),Zo(-.15,.15),0),Math.random()<.4&&this.particle(md.snowflake,Zo(-.3,.3),Zo(-.3,.3),0))}},icicle:{dynamic:!0,Gb:{Zj:[.2,.5,1.5],size:100,dynamic:!0},mesh:{id:"character/disk",color:[1.5,2,1.5,-.3],scale:[.8,.8,.8]},tick:function(t,e){0===this.frame&&nl({distance:5,id:"mage/iciclecast",transform:this.transform,dynamic:!0}),rn(this.transform.rotation,0,t/150,0),this.frame%2==0&&bp(this,5,10,md.icicle,void 0,this.transform.rotation[1])}},icecast:{tick:function(t,e){this.frame%5==0&&this.particle(md.iceBig,Zo(-.2,.2),Zo(-.2,.2),Zo(-.2,.2))}},iceimpact:{timeout:.001,tick:function(t,e){if(0===this.frame){for(let t=0;t<20*this.lod;++t){const t=this.particle(md.snowflake,Zo(-.4,.4),Zo(-.4,.4),Zo(-.4,.4)),e=Zo(8,10);t&&rn(t.vel,Zo(-e,e)-10*this.dir[0],Zo(-5,e)-10*this.dir[1],Zo(-e,e)-10*this.dir[2])}nl({distance:5,id:"mage/iceimpact1",transform:this.transform}),this.creature.visual.addPushBack(this.dir,4)}}},icicleImpact:{timeout:.001,tick:function(t,e){if(0===this.frame){for(let t=0;t<20*this.lod;++t){const t=this.particle(Zo(0,1)<.5?md.iceBig:md.snowflake,Zo(-.4,.4),Zo(-.4,.4),Zo(-.4,.4)),e=Zo(5,10);t&&un(t.vel,[Zo(-e,e),Zo(0,3),Zo(-e,e)],this.dir,-1)}nl({distance:8,id:"mage/iciclehit",rnd:2,transform:this.transform}),this.creature.visual.addPushBack(this.dir,8)}}},arrow:{dynamic:!0,ribbon:{steps:3,interval:.2,timer:15,a:[-.07,0,-.6],b:[.07,0,-.6],UO:[1,1,1,2],vX:[1,1,1,0]},mesh:{id:"character/arrow",color:mp.woodbrown,scale:[.35,.35,.35]}},precisearrow:{dynamic:!0,ribbon:{steps:3,interval:.2,timer:15,a:[-.15,0,-.7],b:[.15,0,-.7],UO:[1,1,.5,2],vX:[1,1,.5,0]},mesh:{id:"character/arrow",color:mp.white,scale:[.6,.6,.6]},tick:function(t,e){this.particle(md.precisesparcle)}},swiftarrow:{dynamic:!0,ribbon:{steps:3,interval:.2,timer:15,a:[-.06,0,-.7],b:[.06,0,-.7],UO:[.3,.7,1,2],vX:[.3,.7,1,0]},mesh:{color:mp.ice,id:"character/arrow",scale:[.4,.4,.4]},tick:function(t,e){this.frame%2==0&&this.particle(md.teleportSparkle)}},naturecast:{tick:function(t,e){this.frame%10==0&&(this.particle(md.healNatureBig,Zo(-.5,.5),Zo(-.5,.5),Zo(-.5,.5)),Math.random()<.4&&this.particle(md.healNatureSparkle,Zo(-.7,.7),Zo(-.3,.7),Zo(-.7,.7)))}},natureHealOneshot:{timeout:1,tick:function(t,e){this.fraction(.01,e)&&(nl({distance:3,id:"shaman/mendImpact",transform:this.transform.parent}),bp(this,5,5,md.healNatureBig)),this.fraction(.05,e,this.time%(.05*this.time+.05))&&(this.particle(md.healNatureBig,Zo(-1,1),Zo(.1,.3),Zo(-1,1)),this.particle(md.healNatureSparkle,Zo(-1,1),Zo(.1,.3),Zo(-1,1)))}},revitalize:{dynamic:!0,ribbon:{steps:10,interval:.06,timer:5,permanent:!0,a:[1,0,0],b:[1.5,0,0],repeat:1,UO:[.1,1,.8,0],vX:[.3,1,.5,1.1]},sound:{distance:2,id:"shaman/revitalizeBuff",parent:!0},tick:function(t,e){rn(this.transform.rotation,.6*Math.cos(t/200),t/130,.6*Math.sin(t/243)),this.frame%10==0&&(this.particle(md.healNatureBig,Zo(.9,1.6),Zo(-.1,.1),Zo(-.1,.1)),Math.random()<.4&&this.particle(md.healNatureSparkle,Zo(.9,1.6),Zo(-.1,.1),Zo(-.1,.1)))}},serpentBuff:{tick:function(t,e){0===this.frame&&this.particle(md.serpentBuffFocus),this.frame%3==0&&this.particle(md.serpentBuff,Math.sin(t/300),.3*Math.sin(t/100),Math.cos(t/300))}},bleedDebuff:{particles:{amount:3,info:md.bloodFloat},tick:function(t,e){this.particles.forEach((e,s)=>{const i=2*s+t/1e3;this.localize(e.Zc,Math.sin(i),.3,Math.cos(i))})}},invigorateBuff:{particles:{amount:1,info:md.invigorateBuff},tick:function(t,e){this.particles.length>0&&this.localize(this.particles[0].Zc,0,.5,0,0,.5+.1*Math.sin(t/100))}},hypothermicBuff:{particles:{amount:1,info:md.hypothermicBuff},tick:function(t,e){0===this.frame&&this.particle(md.iceFlash),this.particles.length>0&&this.localize(this.particles[0].Zc,0,.5,0,0,.5+.1*Math.sin(t/100))}},gainMana:{timeout:.3,tick:function(t,e){this.frame%3==0&&this.particle(md.manaGain,Zo(-1,1),Zo(.1,.3),Zo(-.9,.9))}},blueMarble:{particles:{amount:3,info:md.blueMarble},tick:function(t,e){0===this.frame&&this.particle(md.blueMarbleFlash,0,1,0),this.particles.forEach((e,s)=>{this.localize(e.Zc,.3*Math.sin(t/500+2*s),.3,.3*Math.cos(t/500+2*s))})}},gainHealth:{timeout:.3,tick:function(t,e){this.frame%3==0&&this.particle(md.healHolySparkle,Zo(-1,1),Zo(.1,.3),Zo(-.9,.9))}},soulHarvestCast:{timeout:.8,tick:function(t,e){if(0===this.frame)for(let t=0;t<2*Math.PI;t+=xr/10){const e=Math.sin(t),s=Math.cos(t);Ed(md.soulHarvested,void 0,this.transform.parent.position[0]+10*e,this.transform.parent.position[1],this.transform.parent.position[2]+10*s,-10*e,0,-10*s,!1)}}},soulHarvestMissile:{dynamic:!0,ribbon:{steps:3,interval:.4,timer:15,a:[-.2,0,0],b:[.2,0,0],UO:[0,.6,1.8,2],vX:[0,.4,.8,0]},mesh:{id:"character/wyrmhead",color:[.7,1,1.2,-.4],scale:[.3,.3,.3],Zc:[0,0,0]},tick:function(t,e){this.frame%3==0&&this.particle(this.frame%2==0?md.souls:md.soulCloud,Zo(-.3,.3),0,Zo(-.3,.3))}},soulHarvestImpact:{timeout:1,tick:function(t,e){this.fraction(.01,e)&&(nl({delay:.2,rndDelay:!0,distance:5,id:"shaman/soulHarvestImpact",transform:this.creature.visual.transform}),this.creature.visual.addPushBack(this.dir,6),bp(this,5,5,md.souls))}},soulHarvestReturn:{timeout:1,tick:function(t,e){this.fraction(.01,e)&&(nl({delay:.3,rndDelay:!0,distance:4,id:"shaman/soulHarvestReturnCollect",transform:this.creature.visual.transform}),this.creature.visual.addPushBack(this.dir,3),this.particle(md.soulHarvested,0,-.5,0,0,2,0))}},decayMissile:{dynamic:!0,ribbon:{steps:3,interval:.4,timer:15,a:[-.2,0,0],b:[.2,0,0],UO:[0,2,.4,1.5],vX:[0,1,.4,0]},mesh:{id:"character/wyrmhead",color:[.6,.8,.35,-.1],scale:[.4,.4,.4],Zc:[0,0,0]},tick:function(t,e){this.particle(this.frame%2==0?md.skulls:md.decayCloud,Zo(-.3,.3),0,Zo(-.3,.3))}},decay:{particles:{amount:1,info:md.decay},sound:{distance:5,id:"shaman/decayOnBuff",parent:!0},tick:function(t,e){this.frame%7==0&&this.particle(Zo(0,1)<.5?md.decaySoft:md.skulls,Zo(-1,1),Zo(-.3,.5),Zo(-1,1)),0!==this.particles.length&&this.localize(this.particles[0].Zc,0,0,0,0,1)}},decayImpact:{timeout:.001,tick:function(t,e){0===this.frame&&(bp(this,5,5,md.skulls),nl({distance:5,id:"shaman/decayHit",transform:this.transform}),this.creature.visual.addRandomPushback(4))}},poisonImpact:{timeout:.001,tick:function(t,e){0===this.frame&&(bp(this,5,5,md.poison),nl({distance:5,id:"shaman/decayHit",transform:this.transform}),this.creature.visual.addRandomPushback(4))}},manaBuff:{particles:{amount:3,info:md.mimir},tick:function(t,e){0===this.frame&&bp(this,5,5,md.manaGain),this.particles.forEach((e,s)=>{const i=t/600+.3*Math.sin(s+t/300);this.localize(e.Zc,1.2*Math.sin(i),.2*Math.sin(3*i),1.2*Math.cos(i),0,.2)})}},courageBuff:{particles:{amount:1,info:md.courage},tick:function(t,e){0===this.frame&&this.particle(md.courageFlash),this.particles.length>0&&this.localize(this.particles[0].Zc,.9*Math.sin(Ya.smoothtime),.3,.9*Math.cos(Ya.smoothtime))}},warcryBuff:{particles:{amount:1,info:md.warcry},tick:function(t,e){if(0===this.frame&&this.particle(md.warcryFlash),this.particles.length>0){const t=Ya.smoothtime+3;this.localize(this.particles[0].Zc,.9*Math.sin(t),.3,.9*Math.cos(t))}}},icenova:{timeout:.001,tick:function(t,e){0===this.frame&&(this.particle(md.iceFlash),bp(this,15,20,md.icenova),bp(this,12,20,md.snowflake),nl({delay:.1,distance:5,id:"mage/icenovacast",transform:this.transform.parent}))}},icenovaroot:{mesh:{id:"character/dome",color:mp.ice,Zc:[0,-.9,0]},tick:function(t,e){0===this.frame&&(bp(this,8,15,md.snowflake),nl({delay:Zo(.2,.4),distance:5,id:"mage/icenovafreeze",transform:this.transform.parent}))}},deepfrozen:{mesh:{id:"character/spike",color:mp.ice,scale:[1.5,1.5,.7],Zc:[0,-.5,0],rot:[1.54,0,0]},tick:function(t,e){0===this.frame&&(bp(this,8,10,md.frostflake),nl({delay:Zo(.2,.4),distance:5,id:"mage/deepfreezebuff",transform:this.transform.parent}))}},frozen:{tick:function(t,e){0===this.frame&&(bp(this,5,6,md.frostflake),nl({delay:Zo(.2,.4),distance:5,id:"mage/icenovafreeze",transform:this.transform.parent}))}},enchantment:{particles:{amount:4,info:md.enchant},tick:function(t,e){0===this.frame&&this.particle(md.enchantFlash),this.creature.visual.hands&&this.creature.visual.hands[0].visible?this.particles.forEach((t,e)=>{Zn(t.Zc,this.creature.visual.hands[e%2].cX);const s=.7*e+Ya.smoothtime;t.Zc[0]+=.15*Math.sin(s),t.Zc[2]+=.15*Math.cos(s)}):this.particles.forEach(th)}},arcticaura:{particles:{amount:2,info:md.arcticaura},tick:function(t,e){0===this.frame&&this.particle(md.arcticFlash),this.particles.forEach((t,e)=>{t.uH=Math.sin(Ya.smoothtime);const s=3*e+Ya.smoothtime;this.localize(t.Zc,.15*Math.sin(s),.5,.15*Math.cos(s))})}},incomingDmgReduceAura:{particles:{amount:2,info:md.whiteAura},tick:function(t,e){0===this.frame&&this.particle(md.hardenedEggFlash,0,1,0),this.particles.forEach((t,e)=>{t.uH=Math.sin(Ya.smoothtime);const s=3*e+Ya.smoothtime;this.localize(t.Zc,.15*Math.sin(s),.5,.15*Math.cos(s))})}},moveBoost:{ribbon:{steps:5,interval:.25,timer:5,permanent:!0,a:[0,.5,-.5],b:[0,-.5,-.5],uvTop:.5,UO:[.6,0,1,1],vX:[.6,0,1,0]},tick:function(t,e){0===this.frame&&(this.particle(md.moveBoostFlash,0,1,0),this.ribbon.parent=this.transform.parent.chest||this.transform.parent)}},pathfinding:{ribbon:{steps:5,interval:.25,timer:5,permanent:!0,a:[0,.5,-.5],b:[0,-.5,-.5],UO:[1,1,1,.8],vX:[1,1,1,0]},tick:function(t,e){this.frame%5==0&&this.frame<20&&this.particle(md.pathfindFlash),0===this.frame&&(this.ribbon.parent=this.transform.parent.chest||this.transform.parent)}},temporaldilation:{particles:{amount:2,info:md.temporal},tick:function(t,e){this.frame%5==0&&this.frame<20&&this.particle(md.temporalFlash),this.particles.forEach((t,e)=>{t.uH=Math.sin(Ya.smoothtime);const s=3*e+3*Ya.smoothtime;this.localize(t.Zc,Math.sin(s),.2,Math.cos(s))})}},caninehowl:{particles:{amount:1,info:md.canine},tick:function(t,e){0===this.frame&&this.particle(md.canineFlash),0!==this.particles.length&&this.localize(this.particles[0].Zc,0,0,0,0,.6)}},poisonarrows:{sound:{distance:5,id:"shaman/decayOnBuff",parent:!0},tick:function(t,e){this.frame%7==0&&this.particle(Zo(0,1)<.5?md.poisonSoft:md.poison,Zo(-1,1),Zo(-.3,.5),Zo(-1,1))}},burning:{tick:function(t,e){if(this.frame%7==0){const t=this.transform.parent.scale[0];this.particle(md.fire,Zo(-t,t),Zo(-t,t),Zo(-t,t),0,2,0)}}},flamepit:{dynamic:!0,mesh:{id:"character/disk",color:[1.5,.5,.2,-.3],scale:[.2,.4,.2]},tick:function(t,e){this.missile.currentIndex<1?this.frame%7==0&&this.particle(md.fire,0,0,0):this.time>.3&&(this.time=0,bp(this,10,3,md.fire,void 0,3*Math.random()),xp(this,20,3,md.fire,void 0,3*Math.random()))}},healingtotem:{Gb:{Zj:[.8,1.5,.5],size:300,dynamic:!0},mesh:{id:"character/totem",color:mp.woodbrown,scale:[.8,.8,.8],Zc:[0,0,0]},tick:function(t,e){this.frame%10==0&&this.particle(md.healHolySoft,Zo(-5,5),Zo(.1,.3),Zo(-5,5))}},gainHealthTotem:{timeout:.1,tick:function(t,e){this.frame%3==0&&this.particle(md.healNatureBlink,Zo(-.8,.8),Zo(.1,.3),Zo(-.8,.8))}},teleport:{timeout:.001,tick:function(t,e){if(0===this.frame){this.particle(md.teleportFlash);for(let t=0;t<3;++t)this.particle(md.teleportSparkle,Zo(-.6,.6),1,Zo(-.6,.6));nl({delay:.1,distance:5,id:"mage/teleportcast",transform:this.transform.parent})}}},stunned:{sound:{loop:!1,parent:!0,id:"stundebuff",distance:10},particles:{amount:3,info:md.stun},tick:function(t,e){this.particles.forEach((e,s)=>{const i=2*s+t/250;this.localize(e.Zc,1.2*Math.sin(i),.2,1.2*Math.cos(i),0,.2,0)})}},dazed:{sound:{loop:!1,parent:!0,id:"stundebuff",distance:10},particles:{amount:3,info:md.daze},tick:function(t,e){this.particles.forEach((e,s)=>{const i=2*s+t/350;this.localize(e.Zc,.8*Math.sin(i),.2,.8*Math.cos(i),0,.2,0)})}},charge:{sound:{loop:!1,parent:!0,id:"warrior/chargecast",distance:9},ribbon:{steps:5,interval:.25,timer:5,permanent:!0,a:[-.5,0,-.5],b:[.5,0,-.5],UO:[2,1.5,.5,1.2],vX:[2,.8,1,0]},tick:function(t,e){this.frame%5==0&&this.particle(md.chargeFlash)}},taunt:{timeout:.8,tick:function(t,e){if(this.frame%10==0&&this.particle(md.tauntFlash),0===this.frame){for(let t=0;t<2*Math.PI;t+=xr/10){const e=Math.sin(t),s=Math.cos(t);Ed(md.tauntsparkle,void 0,this.transform.parent.position[0]+10*e,this.transform.parent.position[1],this.transform.parent.position[2]+10*s,-50*e,0,-50*s,!1)}nl({delay:.05,distance:8,id:"warrior/tauntcast",transform:this.transform.parent})}}},transformation:{tick:function(t,e){if(0===this.frame){this.particle(md.teleportFlash);for(let t=0;t<8;++t)this.particle(md.teleportSparkle,0,0,0,Zo(-5,5),Zo(-5,5),Zo(-5,5))}this.frame%20==0&&(this.particle(md.transformationAura,0,0,1),this.particle(md.transformSoft,0,0,2))}},snipe:{sound:{loop:!1,parent:!0,id:"archer/snipeCast",delay:.2,distance:7},particles:{amount:1,info:md.snipe},tick:function(t,e){0!==this.particles.length&&(this.frame%3==0&&this.time<.3&&this.particle(md.dust,Zo(-.3,.3),Zo(-.3,.3),0),this.transform.parent.hands&&this.transform.parent.hands[1].visible?Zn(this.particles[0].Zc,this.transform.parent.hands[1].cX):th(this.particles[0]))}},etherwyrm:{tick:function(t,e){this.frame%7==0&&this.particle(md.etherglow,Zo(-.8,.8),Zo(-.3,.5),Zo(-.8,.8))}},shadowwyrm:{tick:function(t,e){this.frame%7==0&&this.particle(md.shadowglow,Zo(-1,1),Zo(-.3,.5),Zo(-1,1))}},postsummon:{sound:{loop:!1,parent:!0,id:"magic/summonaccept",delay:.05,distance:7},tick:function(t,e){0===this.frame&&(this.particle(md.summonFlash,0,0,0),bp(this,10,8,md.summonSparkle)),this.frame%10==0&&this.particle(md.summonSparkle,Zo(-.3,.3),Zo(-.3,.5),Zo(-.3,.3))}},purplecast:{tick:function(t,e){this.frame%10==0&&this.particle(md.summonSparkle,Zo(-.2,.2),Zo(-.2,.2),Zo(-.2,.2))}}},bp=(t,e,s,i,n=[0,0,0],a=0)=>{for(let r=0;r<2*Math.PI;r+=xr/e)t.particle(i,n[0],n[1],n[2],Math.sin(r+a)*s,0,Math.cos(r+a)*s)},xp=(t,e,s,i,n=[0,0,0],a=0)=>{for(let r=0;r<2*Math.PI;r+=xr/e)t.particle(i,n[0]+Math.sin(r+a)*s,n[1],n[2]+Math.cos(r+a)*s,0,0,0)};var wp=new np({id:2,targetMode:16,minlevel:5,cd:30,gcd:0,cost:{resources:[[7,t=>3+5*t]]},onCast:(t,e,s)=>({id:45,mode:4,stacks:1,duration:9,caster:t.id,target:t.id,level:e})});const kp=t=>.7+.2*t,$p=t=>kp(t)+2.4;var Sp=new np({id:33,targetMode:17,skilllevels:1,minlevel:11,cd:15,range:30,disablingBuffs:[4],cost:{resources:[[7,t=>12]]},custom:[[kp,"s stunned at min range"],[$p,"s stunned at max range"]],onCast:(t,e,s)=>{}}),Mp=new np(rp(20,63,15,300,150,[[7,t=>8*t]])),Ep=new np({id:18,cd:0,minlevel:8,autoSkillBar:!1,fx:{effectImpact:[yp.bloodRandom],impactSound:{distance:5,id:"warrior/bleedImpact",rndDelay:!0,delay:.3}},onPermanent:(t,e)=>({id:60,mode:4,caster:t.id,target:t.id,duration:-1,stacks:1,level:e})}),Cp=new np({id:3,targetMode:1,minlevel:3,cd:6,cost:{resources:[[7,t=>2+2*t]]},fx:{animCast:{id:4,dur:.8,sounds:[{delay:.1,distance:6,id:"warrior/crescent"}]},impactSound:t=>({delay:.1+.3*Math.random(),distance:4,id:"warrior/crescent_hit"}),effectDirImpact:[yp.bloodDirectional,yp.meleeFlash],effectCast:[yp.crescentStrike],weaponRibbon:{steps:10,interval:.02,timer:1,a:[.3,1,0],b:[-.3,0,0],uvTop:.5,UO:[2,.5,.5,3],vX:[1,0,0,0]}},onCast:(t,e,s)=>({id:3,mode:0,caster:t.id,dmg:t.stats.getDamageRoll()*(1+.17*e),type:1,aoe:{faction:!1,circleRadius:2+5*t.size}})}),Tp=new np({id:17,targetMode:16,minlevel:21,cd:25,gcd:0,cost:{resources:[[7,t=>8*t]]},fx:{effectTarget:[yp.gainHealth]},onCast:(t,e,s)=>({id:59,mode:4,stacks:1,duration:10,caster:t.id,target:t.id,level:e})});var Ip=new np({id:1,targetMode:4096,minlevel:1,cd:1,range:2,custom:[[t=>8*t,"% chance to daze target for 3 seconds"]],cost:{resources:[[7,t=>1+t]]},fx:{animCast:{id:1,dur:.8,sounds:[{delay:.1,distance:4,id:"woosh1"}]},impactSound:{distance:5,id:"warrior/slash",delay:.3},effectDirImpact:[yp.meleeFlash,yp.bloodDirectional],weaponRibbon:{steps:9,interval:.03,timer:.5,a:[.3,.7,0],b:[-.3,.2,0],uvTop:.8,UO:[1,1,0,2.5],vX:[1,0,0,.7]}},onCast:(t,e,s)=>{const i=5+t.stats.getDamageRoll()*(.36+.36*e);return{id:1,mode:0,caster:t.id,target:s,dmg:i,type:1}}});const Pp=t=>Math.round(200+t**1.2*100),Bp=(t,e)=>{1===e.type&&(e.resetAllAggro(),e.addAggro(t.caster,Pp(t.level)))};var Fp=new np({id:34,targetMode:1,minlevel:6,cd:15,cost:{resources:[[7,t=>4*t]]},fx:{animCast:{id:9,dur:.7},effectCast:[yp.taunt]},custom:[[Pp," aggro generation"]],onCast:(t,e,s)=>({custom:Bp,id:76,mode:4,stacks:1,caster:t.id,duration:.6+.3*e,level:e,aoe:{faction:!1,circleRadius:10}})}),zp=new np({id:41,targetMode:16,minlevel:25,cd:30,skilllevels:1,gcd:0,cost:{resources:[[7,t=>3+5*t]]},onCast:(t,e,s)=>{}}),Up=new np(rp(19,62,18,300,150,[[7,t=>8*t]])),Dp=new np(rp(22,65,17,300,120,[[7,t=>5+10*t]])),Ap=new np(op(24,67,15,1.5,0,300,[[7,t=>2+3*t]],4,{animCast:{id:9,dur:.7,sounds:[{delay:.1,distance:4,id:"magic/genericcast"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5}})),Rp=new np({id:14,targetMode:1,minlevel:3,cd:25,cost:{resources:[[7,t=>4*t]]},fx:{animCast:{id:9,dur:.6},effectCast:[yp.icenova]},onCast:(t,e,s)=>({id:56,mode:4,stacks:1,caster:t.id,duration:5.5+.5*e,level:e,aoe:{faction:!1,circleRadius:8}})}),Lp=new np({id:16,targetMode:16,minlevel:13,cd:45,gcd:0,fx:{animCast:{id:9,dur:.8}},onCast:(t,e,s)=>({id:58,mode:4,stacks:1,duration:12,caster:t.id,target:t.id,level:e})}),Op=new np({id:4,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,cost:{resources:[[7,t=>1+2*t]]},fx:{animCast:{id:6,dur:.7,sounds:[{delay:.1,distance:3,id:"mage/icecast1"}]},effectDirImpact:[yp.iceimpact],animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:yp.icecast},effectMissile:yp.icebolt},onCast:(t,e,s)=>({id:4,mode:6,speed:25,caster:t.id,target:s,dmg:5+t.stats.getDamageRoll()*(.38+.38*e),type:1}),onPermanent:(t,e,s)=>({id:88,mode:4,stacks:1,duration:-1,caster:t.id,target:t.id,level:e})});const _p=t=>3+t;var Np=new np({id:23,targetMode:16,minlevel:5,cd:60,gcd:0,cost:{resources:[[7,t=>5*t]]},custom:[[_p," attacks blocked"]],fx:{animCast:{id:9,dur:.8,sounds:[{delay:.01,distance:4,id:"mage/iceshieldcast"}]}},onCast:(t,e,s)=>({id:66,mode:4,stacks:_p(e),duration:60,caster:t.id,target:t.id,level:e})}),Zp=new np({id:15,targetMode:1,range:30,minlevel:8,cd:15,castLen:1.5,cost:{resources:[[7,t=>5+5*t]]},fx:{animCast:{id:6,dur:.6},effectDirImpact:[yp.icicleImpact],animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:yp.icecast},effectMissile:yp.icicle},onCast:(t,e,s)=>({id:15,mode:6,speed:10,timeout:2.5,caster:t.id,rot:t.rot,dmg:10+t.stats.getDamageRoll()*(.51+.56*e),type:1,aoe:{circleRadius:4+.5*e,faction:!1,onlyOnce:[]}})});const qp=()=>12;var Gp=new np({id:32,targetMode:1,skilllevels:1,minlevel:5,gcd:.7,cd:12,disablingBuffs:[4],cost:{resources:[[7,t=>4*t]]},fx:{animCast:{id:9,dur:.8},effectCast:[yp.teleport]},custom:[[qp,"m distance"]],onCast:(t,e,s)=>{}}),Hp=new np({id:37,targetMode:4096,range:30,minlevel:15,cd:40,castLen:2.3,cost:{resources:[[7,t=>5+5*t]]},fx:{animCast:{id:6,dur:.6,sounds:[{delay:.1,distance:4,id:"magic/genericcast"},{delay:1,distance:3,id:"shaman/agonizeImpact"}]},effectImpact:[yp.decayImpact],animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:yp.naturecast}},onCast:(t,e,s)=>({id:78,mode:4,stacks:1,caster:t.id,target:s,duration:2.4+1*e,level:e})}),Xp=new np(rp(28,71,12,15,60,[[7,t=>1+3*t]],{animCast:{id:6,dur:.6,sounds:[{delay:.1,distance:4,id:"magic/genericcast"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:yp.naturecast}})),jp=new np({id:12,targetMode:4096,range:25,minlevel:1,castLen:0,cd:3,cost:{resources:[[7,t=>Math.round(1+4.5*t)]]},fx:{animCast:{id:9,dur:.7,sounds:[{delay:.05,distance:4,id:"shaman/decayCast"}]},effectImpact:[yp.decayImpact],effectMissile:yp.decayMissile},onCast:(t,e,s)=>({id:12,mode:6,dmg:5+t.stats.getDamageRoll()*(.03+.13*e),type:1,speed:15,caster:t.id,target:s,level:e})}),Jp=new np({id:30,targetMode:1,range:30,minlevel:18,cd:60,castLen:2.3,cost:{resources:[[7,t=>10+8*t]]},fx:{effectImpact:[yp.gainHealthTotem],animCast:{id:9,dur:1,sounds:[{delay:.1,distance:4,id:"shaman/healingtotemcast"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:yp.naturecast},effectMissile:yp.healingtotem},onCast:(t,e,s)=>({id:30,mode:6,speed:0,timeout:30,caster:t.id,rot:t.rot,interval:new id(0,2),heal:t.stats.getDamageRoll()*(.08+.05*e),type:1,aoe:{circleRadius:30,circleHeight:30,faction:!0,party:!0}})}),Vp=new np(rp(13,55,6,15,120,[])),Yp=new np({id:6,targetMode:256,range:30,minlevel:8,cd:0,castLen:1.7,cost:{resources:[[7,t=>4+4*t]]},fx:{animCast:{id:9,dur:.6,sounds:[{delay:.1,distance:4,id:"magic/genericcast"}]},effectTarget:[yp.natureHealOneshot],animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:yp.naturecast}},onCast:(t,e,s)=>({id:6,mode:2,caster:t.id,target:s,heal:15+t.stats.getDamageRoll()*(.25+.11*e)})});var Wp=new np(ap(43,95,3,[[t=>1+2*t,"% haste per stack"],[t=>1+2*t," jumps"]])),Qp=new np(op(7,47,3,0,0,12,[[7,t=>3+3*t]],5,{animCast:{id:9,dur:.8,sounds:[{delay:.1,distance:4,id:"magic/genericcast"}]}}));var Kp=new np({id:42,targetMode:1,minlevel:8,cd:8,castLen:0,range:25,custom:[[t=>Math.round(1.3*t)," mana gained per soul"]],cost:{resources:[[7,t=>1+3*t]]},fx:{animCast:{id:9,dur:1,sounds:[{delay:.05,distance:4,id:"shaman/soulHarvestCast"}]},effectDirImpact:[yp.soulHarvestImpact],effectCast:[yp.soulHarvestCast]},onCast:(t,e,s)=>{const i=0;return{id:42,mode:1,caster:t.id,target:i,type:1,dmg:4+t.stats.getDamageRoll()*(.2+.3*e),level:e}}}),tf=new np({id:104,engineOnly:!0,cd:0,fx:{effectDirImpact:[yp.soulHarvestReturn],effectMissile:yp.soulHarvestMissile}}),ef=new np({id:36,targetMode:16,minlevel:10,cd:30,gcd:0,cost:{resources:[[7,t=>8+2*t]]},onCast:(t,e,s)=>({id:77,mode:4,stacks:1,duration:5+5*e,caster:t.id,target:t.id,level:e})}),sf=new np({id:35,targetMode:1,skilllevels:1,minlevel:5,cd:120,castLen:5,outOfCombat:!0,hasteAffected:!1,pvpBoundsAdd:5,cost:{resources:[[7,t=>20+5*t]]},fx:{animCast:{id:9,dur:1,sounds:[{delay:.1,distance:4,id:"magic/summoncast"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:yp.purplecast}},onCast:(t,e,s)=>{}}),nf=new np(ap(26,69,15));var af=new np({id:11,targetMode:16,minlevel:7,cd:50,gcd:0,fx:{animCast:{id:9,dur:.8}},custom:[[t=>3+5*t,"% of max mp recovered"]],onCast:(t,e,s)=>({id:53,mode:4,stacks:1,duration:17,caster:t.id,target:t.id,level:e})}),rf=new np(rp(27,70,12,10,100,[[7,t=>5+7*t]])),of=new np({id:29,cd:0,minlevel:9,autoSkillBar:!1,fx:{effectImpact:[yp.poisonImpact],impactSound:{distance:5,id:"warrior/bleedImpact",rndDelay:!0,delay:.3}},onPermanent:(t,e)=>({id:72,mode:4,caster:t.id,target:t.id,duration:-1,stacks:1,level:e})}),lf=new np({id:9,targetMode:4096,range:30,minlevel:3,cd:6,castLen:1.7,cost:{resources:[[7,t=>2+3*t]]},fx:{animCast:{id:7,dur:.3,pre:.1,sounds:[{delay:.005,distance:5,id:"archer/preciseshot"}]},impactSound:{delay:.01,distance:6,id:"archer/preciseimpact"},effectDirImpact:[yp.arrowPreciseImpact],animTimedSound:{distance:2.5,loop:!0,id:"magic/casting"},animTimedCast:{id:5},effectMissile:yp.precisearrow},onCast:(t,e,s)=>({id:9,mode:6,speed:120,caster:t.id,target:s,dmg:5+t.stats.getDamageRoll()*(.6+.46*e),type:1})}),cf=new np({id:10,targetMode:16,minlevel:5,cd:0,autoSkillBar:!1,onPermanent:(t,e,s)=>({id:52,mode:4,stacks:1,duration:-1,caster:t.id,target:t.id,level:e})}),df=new np({id:38,targetMode:16,minlevel:5,skilllevels:1,cd:10,gcd:0,disablingBuffs:[4],cost:{resources:[[7,t=>6]]},fx:{animCast:{id:10,dur:.3}},onCast:(t,e,s)=>!0}),hf=new np({id:31,targetMode:4096,range:30,minlevel:1,cd:0,castLen:1.5,cost:{resources:[[7,t=>1+1*t]]},fx:{animCast:{id:7,dur:.3,pre:.1,sounds:[{delay:.005,distance:5,id:"archer/swiftshot"}]},impactSound:{delay:.01,distance:6,id:"archer/swiftimpact"},effectDirImpact:[yp.arrowPreciseImpact],effectMissile:yp.swiftarrow,animTimedSound:{distance:2.5,loop:!0,id:"magic/casting"},animTimedCast:{id:5}},onCast:(t,e,s)=>({id:31,mode:6,speed:60,caster:t.id,target:s,dmg:5+t.stats.getDamageRoll()*(.28+.28*e),type:1})}),uf=new np(rp(25,68,18,300,120,[[7,t=>5+5*t]]));const mf={medalValue:1e3,goldValue:5e4,buyElo:1600,quality:90,level:45,gs:30,uniqueEquipped:!0},pf=[{id:0,custom:["Use: Removes all movement limiting effects."],useCd:60,incap:!0,effectCast:[yp.removeCC],use:(t,e,s,i)=>{}},{id:1,custom:["Use: Protects you against 30% of incoming damage for 10 seconds."],useCd:60,incap:!1,use:(t,e,s,i)=>{}},{id:2,custom:["Use: Increases your damage by 20% for 10 seconds."],useCd:80,incap:!1,use:(t,e,s,i)=>{}},{id:3,custom:["Use: Speeds up your movement by 45 for 8 seconds."],useCd:50,incap:!1,use:(t,e,s,i)=>{}},{id:4,custom:["Use: Attacks made against you grant 20 MP (up to 200) for 20 seconds."],useCd:60,incap:!1,use:(t,e,s,i)=>{}}],ff=t=>{pf.forEach((e,s)=>{t["charm"+e.id]={...mf,...e,type:"charm",tier:e.id,useSkill:105+s}})},gf=new np(lp(100,30,0,!0,!0,!1,!1,{animCast:{id:3,dur:1,sounds:[{delay:.1,distance:5,id:"potion1"}]},effectTarget:[yp.potionConsume]})),vf=new np(lp(101,1.5,0,!0,!1,!1,!1)),yf=new np(lp(103,1.5,3,!0,!1,!1,!1,{animCast:{id:9,dur:.8,sounds:[{delay:.1,distance:5,id:"item/boxopening"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5}})),bf=new np(lp(102,1.5,1.5,!1,!0,!1,!1,{animCast:{id:9,dur:.8},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5}})),xf=pf.map((t,e)=>new np(lp(105+e,t.useCd,0,!1,!1,t.incap,!0,{animCast:{id:9,dur:.8,sounds:[{delay:.05,distance:4,id:"item/charm"+e}]},effectCast:t.effectCast}))).reduce((t,e)=>({...t,["charm"+e.id]:e}),{});var wf=new np({id:5,targetMode:4096,range:30,engineOnly:!0,auto:!0,cd:t=>100/t.stats.getStat(17),fx:{animCast:{id:8,dur:.4,sounds:[{delay:.01,distance:5,id:"archer/arrow_release1"}]},impactSound:{delay:.01,distance:4,id:"archer/arrow_impact1"},effectDirImpact:[yp.arrowImpact],effectMissile:yp.arrow},onCast:(t,e,s)=>({id:5,mode:6,speed:30,caster:t.id,target:s,dmg:t.stats.getDamageRoll(),type:0})}),kf=new np({id:44,targetMode:1,range:50,minlevel:3,cd:5,engineOnly:!0,castLen:1.5,cost:{resources:[[7,t=>4*t]]},fx:{animCast:{id:9,dur:.6},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:yp.icecast},effectMissile:yp.flamepit}}),$f=new np({id:0,targetMode:4096,engineOnly:!0,auto:!0,range:2,cd:t=>100/t.stats.getStat(17),fx:{animCast:{id:0,dur:1,sounds:[{delay:.3,distance:5,id:"woosh1"}]},impactSound:t=>t.visual.sounds.melee,impactSoundPitchCaster:!0,effectDirImpact:[yp.meleeFlash,yp.meleePhys]},onCast:(t,e,s)=>({id:0,mode:0,caster:t.id,target:s,dmg:t.stats.getDamageRoll(),type:0})}),Sf=new np({id:39,engineOnly:!1,skilllevels:1,minlevel:30,cd:0,goldValue:25e3,skillpoints:0,noReward:!0,autoSkillBar:!1});const Mf={...xf,recall:new np({id:40,targetMode:1,engineOnly:!0,cd:300,castLen:5,outOfCombat:!0,hasteAffected:!1,cost:{resources:[[7,t=>20+5*t]]},fx:{animCast:{id:9,dur:.6},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:yp.purplecast}},onCast:(t,e,s)=>{}}),arrow:wf,melee:$f,potion:gf,book:vf,specialization:new np({id:8,engineOnly:!0,cd:0,onPermanent:(t,e)=>({id:t.class+48,mode:4,caster:t.id,target:t.id,duration:-1,stacks:1,level:e})}),mount:Sf,activatemount:bf,container:yf,boss_flamepits:kf},Ef={temper:zp,taunt:Fp,charge:Sp,warcry:Up,courage:Mp,armorreinforcement:cp,healOnBlock:Tp,slash:Ip,blockBuff:wp,crescentStrike:Cp,crescentBleed:Ep},Cf={teleport:Gp,enchantment:Ap,arcticaura:Dp,iceshield:Np,hypothermic:Lp,frostnova:Rp,icebolt:Op,icicle:Zp},Tf={snipe:df,poisonarrows:of,temporaldilation:uf,pathfinding:rf,preciseShot:lf,serpentArrows:cf,invigorate:af,swiftshot:hf,cranialpunctures:nf},If={soulharvestReturn:tf,plaguespreader:Wp,soulharvest:Kp,agonize:Hp,caninehowl:Xp,mana:Vp,mend:Yp,revitalize:Qp,decay:jp,healingtotem:Jp,summon:sf,spiritanimal:ef},Pf=new Map;[Ef,Cf,Tf,If,Mf].forEach((t,e)=>{for(const s in t)e<=3&&(t[s].class=e),Pf.set(t[s].id,t[s])}),Pf.set(10045,new np({id:10045,engineOnly:!0}));const Bf=(t,e,s,i)=>{window.gtag&&window.gtag("event",t,{event_category:e,event_label:s,value:i})},Ff=[30,60,130,260,470,700,1030,1500,2100,2900,3900,5400,7200,9600,12600,17400,23700,31900,42600,58300,78900,106e3,14e4,184e3,247e3,33e4,43e4,56e4,73e4,96e4,125e4,162e4,209e4,268e4,4e6,62e5,97e5,15e6,229e5,325e5,451e5,615e5,827e5,11e7,1203e5],zf=t=>Ff[gr(t,1,45)-1],Uf=t=>{const e=Object.entries(t);return e.forEach(t=>{t[0]=parseInt(t[0]),"object"==typeof t[1]&&(t[1]=Uf(t[1]))}),new Map(e)};var Df=Uf({0:10,1:10,2:10,3:10,4:10,5:5,15:105,17:10,6:100,7:100,14:50,9:30,8:20,12:15});const Af=[31],Rf=[8,5,40],Lf=Df,Of=Uf({2:1,1:2,6:8});var _f=Object.freeze({__proto__:null,startSkills:Af,engineSkills:Rf,baseStats:Lf,statPerLevel:Of});const Nf=Df,Zf=[4],qf=[8,40],Gf=Uf({3:1,1:2,6:8});var Hf=Object.freeze({__proto__:null,baseStats:Nf,startSkills:Zf,engineSkills:qf,statPerLevel:Gf});const Xf=Uf({0:3,1:5,2:5,3:5,5:5,17:50,15:75,10:1,11:2,7:100,9:80,6:10}),jf=Uf({0:1,12:2,2:4,10:.4,11:.4,6:4}),Jf=Uf({12:.03,6:4.58,10:.04,11:.05});var Vf=Object.freeze({__proto__:null,baseStats:Xf,statPerLevel:jf,statPerLevelExponential:Jf});const Yf=Uf({0:10,1:10,2:10,3:10,4:10,5:10}),Wf=Uf({0:20,1:20,2:20,4:20});var Qf=Object.freeze({__proto__:null,baseStats:Yf,statPerLevel:Wf});const Kf=Df,tg=[12],eg=[8,0,40],sg=Uf({4:1,1:2,6:8});var ig=Object.freeze({__proto__:null,baseStats:Kf,startSkills:tg,engineSkills:eg,statPerLevel:sg});const ng=Df,ag=[1,21],rg=[8,0,40],og=Uf({0:1,1:2,6:8});var lg=[Object.freeze({__proto__:null,baseStats:ng,startSkills:ag,engineSkills:rg,statPerLevel:og}),Hf,_f,ig,Qf,Vf];const cg=(t,e)=>Math.ceil(t/2)+lg[e].startSkills.length,dg=Uf({0:{6:2,8:.3},1:{6:4,12:1},2:{14:.5},3:{14:.4,7:.8},4:{16:.3,7:.8},5:{14:.2,18:.5}}),hg=t=>1+t/1e3,ug=Object.keys({onBlock:0,statsStatic:0,statsConvert:0,statsOverride:0,onInterval:0,multiplyIncomingHeal:0,multiplyIncomingDamage:0,addIncomingHeal:0,addIncomingDamage:0,addIncomingCrit:0,afterDamageEnemy:0,beforeDamageEnemy:0,beforeIncomingDamage:0,movementOverride:0,incapacitated:0,breakOnCast:0,instantCast:0,onCast:0,onEnd:0,onAffectedEnemyDeath:0});class mg{constructor(t){this.id=t.id,this.intervalHaste=!1!==t.intervalHaste,this.intervalDuration=t.intervalDuration,this.maxStacks=t.maxStacks,this.passive=t.passive||!1,this.custom=t.custom,this.unique=t.unique||!1,this.dr=t.dr||0,this.type=t.type||0,this.tags=t.tags||new Set,ug.forEach(e=>{this[e]=t[e]}),this.icon=t.icon||"skills/0",this.visualIncapacitation=t.visualIncapacitation,this.fx=t.fx||{}}onSet(t,e,s){this.tags.forEach(e=>{s.tags.get(e).add(t)}),ug.forEach(e=>{this[e]&&s[e].add(t)})}onRemove(t,e,s){this.tags.forEach(e=>{s.tags.get(e).delete(t)}),ug.forEach(e=>{this[e]&&s[e].delete(t)})}}var pg=new mg({id:64,passive:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(40+20*t.level)),e.addStat(26,Math.round(200+200*t.level))}}),fg=new mg({id:45,icon:"skills/2",fx:{stick:yp.blockBuff,startSound:{id:"warrior/buffBlock",distance:5}},statsStatic:(t,e)=>{e.addStat(13,300+40*t.level)},onBlock:(t,e)=>({id:46,mode:5,stacks:1,duration:8,caster:e.id,target:e.id,refresh:!0,level:t.level})}),gg=new mg({id:46,maxStacks:8,icon:"skills/buffBlock",fx:{stick:yp.blockEnrageBuff},statsStatic:(t,e)=>{e.addStat(25,t.stacks*(2*t.level+2))}});const vg=(t,e)=>{if(t.static)return!1;const s=$h(2*e.data[0],768),i=[s[0]-t.Zc[0],s[1]-t.Zc[2]];return Ra(i)>t.size?(t.setSteer(0,1),t.setRot(Sr(i)),t.setJump(0),!0):(t.setSteer(0,0),!1)};var yg=new mg({id:74,incapacitated:!0,icon:"skills/33",fx:{stick:yp.charge,endSound:{id:"warrior/chargeimpact",distance:10}},statsOverride:(t,e)=>{e.stat.set(15,250)},movementOverride:(t,e,s,i,n)=>{vg(i,n)}}),bg=new mg({id:63,icon:"skills/20",fx:{stick:yp.courageBuff,startSound:{id:"warrior/couragecast",distance:5}},unique:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(10+t.level**1.1*20))}}),xg=new mg({id:60,passive:!0,icon:"skills/17",custom:[[t=>93+32*t,"% as additional damage over 10 seconds"]],afterDamageEnemy:{3:(t,e,s)=>{}}}),wg=new mg({id:61,type:1,tags:new Set([1]),maxStacks:3,icon:"skills/18",fx:{stick:yp.bleedDebuff,color:[.7,.1,.1,.5]},intervalDuration:1.5,onInterval:(t,e,s)=>({id:18,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,noDaze:!0,type:1})}),kg=new mg({id:59,icon:"skills/17",fx:{stick:yp.healOnBlockBuff,stickOffset:.5,startSound:{id:"warrior/healOnBlockCast",distance:5}},onBlock:(t,e)=>({id:17,mode:2,caster:t.caster,target:e.id,heal:7+14*t.level})}),$g=new mg({id:48,passive:!0,icon:"skills/8",statsConvert:[[0,.3,10],[0,.3,11],[0,.3,8]]}),Sg=new mg({id:76,incapacitated:!0,type:1,tags:new Set([6]),dr:3,visualIncapacitation:!0,icon:"skills/34",fx:{stick:yp.stunned,stickOffset:.5},statsOverride:(t,e)=>{e.stat.get(15)>30&&e.stat.set(15,30)},movementOverride:(t,e,s,i,n)=>{vg(i,n)}}),Mg=new mg({id:93,maxStacks:3,icon:"skills/temperBoostBuff",fx:{stick:yp.temperBoostBuff,color:[.2,.2,.25,.95],norefresh:!0},statsStatic:(t,e)=>{e.addStat(15,20)}}),Eg=new mg({id:92,maxStacks:3,tags:new Set([3,4]),icon:"skills/41",fx:{stick:yp.temperBuff,color:[.1,.1,.1,.92],norefresh:!0},statsStatic:(t,e)=>{e.addStat(27,25*t.stacks)},intervalDuration:.5,onInterval:(t,e,s)=>!0}),Cg=new mg({id:62,icon:"skills/19",fx:{stick:yp.warcryBuff,startSound:{id:"warrior/warcrycast",distance:5}},unique:!0,statsStatic:(t,e)=>{e.addStat(10,3*t.level),e.addStat(11,4*t.level),e.addStat(6,50*t.level)}});class Tg{constructor(t){this.transform=pa(),this.transform.matrixAutoUpdate=!0,this.sounds=t.sounds||{},this.entity=t.entity,this.cycleOne=Math.random(),this.cycleRad=Zo(0,1),this.cycleSin=0,this.speed=1,this.meshes=[],this.lastFlags=0,this.deathTimer=new id(0,3),this.hurtSoundTimer=new id(0,5),this.idleSoundTimer=new id(Ya.time+Zo(0,20),20),this.pushBack=[0,0],this.pushBackVel=[0,0],this.pushBackOffset=[0,0],this.cDist=1/0,this.cDistLast=1/0,this.inFog=!0,this.animQueue=[],this.currentAnim=void 0,this.walking=!0,this.falling=!1,this.tickTimer=new id(0,1),this.needsColorUpdate=!1,this.colors=new Set,this.hasDied=!1,this.removed=!1,this.effects=[]}cycle(t){return 0==t?this.cycleSin:Math.sin(this.cycleRad+2*t*Math.PI)}checkCycleReset(t){t!=this.lastFlags&&(this.cycleOne=0),this.lastFlags=t}addPushBack(t,e){this.cDist<50&&(this.pushBackVel[0]-=t[0]*e/this.entity.size,this.pushBackVel[1]-=t[2]*e/this.entity.size)}addRandomPushback(t){this.cDist<50&&(this.pushBackVel[0]-=Zo(-1,1)*t/this.entity.size,this.pushBackVel[1]-=Zo(-1,1)*t/this.entity.size)}tickPushBack(t,e,s){this.cDist<50&&(Aa(this.pushBackVel,this.pushBackVel,this.pushBack,1500*-t/this.entity.size),Da(this.pushBackVel,this.pushBackVel,.7),Aa(this.pushBack,this.pushBack,this.pushBackVel,t),Na(this.pushBackOffset,this.pushBack,-this.entity.rot))}disableVis(t){for(let e=0,s=t.children.length;e<s;++e){const s=t.children[e];s.visible=!1,this.disableVis(s)}}checkVis(t,e,s){for(let i=0,n=t.children.length;i<n;++i){const n=t.children[i];this.meshes.indexOf(n)<0||(n.visible=n.data.lod*e/this.cDist>s,n.visible?this.checkVis(n,e,s):this.disableVis(n))}}updateVisibility(){const t=void 0!==this.entity.mount?1/0:Math.max(60,Math.min(150,.7*Xa.Oq));return this.cDist=mn(this.transform.position,Xa.worldPosition),this.inFog=this.cDist>t,!this.inFog&&Xa.frustumIntersectsSphere(this.entity.visualPosition,this.transform.scale[1])?(!this.hasDied&&Math.abs(this.cDistLast-this.cDist)>1&&(this.cDistLast=this.cDist,this.checkVis(this.transform,Math.max(1,this.transform.scale[1]),1.5/(45+t))),this.transform.visible=!0,!0):(this.cDistLast=0,this.transform.visible&&(this.transform.visible=!1,this.meshes.forEach(t=>t.visible=!1)),!1)}tick(t,e,s){this.updateVisibility()&&(this.needsColorUpdate&&this.colorUpdate(),void 0===this.entity.stats||this.entity.stats.alive?(this.cycleOne=(this.cycleOne+this.speed*t)%1,this.cycleRad=this.cycleOne*Math.PI*2,this.cycleSin=Math.sin(this.cycleRad),this.tickAnimations(t),void 0!==this.sounds.idle&&this.idleSoundTimer.done(e)&&Math.random()<.08&&(this.playSound(this.sounds.idle),this.idleSoundTimer.reset(s.time)),this.falling=this.falling&&!this.entity.onGround||!this.falling&&!this.onGround&&Math.abs(this.entity.vel[1])>6,this.walking=0!=this.entity.steer[0]||0!=this.entity.steer[1],this.tickParts(t,e,s)):this.tickDeath(t,e,s),this.tickOverrides(t,e,s),ca(this.transform,!1))}tickAnimations(t){if(this.currentAnim=this.animQueue[0],this.currentAnim){const e=this.currentAnim.time;this.currentAnim.time+=this.animQueue.length*t,this.currentAnim.sounds&&this.currentAnim.sounds.forEach(t=>{e<t.delay&&this.currentAnim.time>t.delay&&nl({loop:!1,transform:this.transform,...t})}),this.currentAnim.fract=this.currentAnim.time/this.currentAnim.duration,this.currentAnim.time>this.currentAnim.duration&&(this.currentAnim.fract=1,this.currentAnim.loop||this.currentAnim.stop||this.animQueue.shift(),this.currentAnim.loop&&(this.currentAnim.time-=this.currentAnim.duration)),this.currentAnim.anticipate=br.anticipate(this.currentAnim.fract)}}fraction(t,e,s=this.cycleOne){return s>=t&&s-this.speed*e<t}mesh(t,e,s,i,n,a,r,o=!1){const l=Bd({geo:s||"character/cube",program:r||zc.multimeshFlat,ts:o,rs:!1,dynamic:!0,frustum:!1,...a});return l.data.lod=i,l.visible=!1,l.matrixAutoUpdate=e,void 0!==n&&this.changeMeshBaseColor(l,n),null!==t&&(ra(l,t),l.parent.data.lod=Math.max(i,l.parent.data.lod||1)),this.meshes.push(l),l}removeMesh(t,e){t.data.multi.remove(t),e&&this.meshes.splice(this.meshes.indexOf(t),1)}onRemove(){this.meshes.forEach(t=>{this.removeMesh(t,!1)}),this.meshes.length=0,this.effects.forEach(t=>{t.data.remove=!0}),Ud.forEach(t=>{t.parent===this.transform&&(t.data.remove=!0)}),fa(this.transform),this.removed=!0}anim(t){this.transform.visible&&(this.animQueue.push({id:t.id,duration:t.dur,time:0,fract:0,sounds:t.sounds,stop:t.stop||!1,loop:t.loop||!1}),this.animQueue.length>5&&this.animQueue.shift())}clearAnims(){this.animQueue.length=0}playSound(t,e=5){this.inFog||nl({loop:!1,transform:this.transform,delay:.2,distance:e+this.transform.scale[1],force:this.transform.scale[1]>2,pitch:this.getScaleFactor(),...t})}onHurt(t){this.sounds.hurt&&(t>.2||this.hurtSoundTimer.done(Ya.time))&&(this.playSound(this.sounds.hurt),this.hurtSoundTimer.reset(Ya.time))}onEffort(){this.sounds.effort&&Zo(0,1)<.3&&this.playSound(this.sounds.effort)}onAggro(){this.sounds.aggro&&(this.playSound(this.sounds.aggro),this.idleSoundTimer.reset(Ya.time))}onDeath(){this.hasDied=!0,this.sounds.death&&this.playSound(this.sounds.death,8),this.eyes&&(this.removeMesh(this.eyes,!0),this.eyes=void 0),this.addColor(mp.death),this.deathTimer.reset(Ya.time);let t=this.meshes.length;for(;t--;){const e=this.meshes[t];e.data.deathSize=(e.geometry.bounds.initiated?e.geometry.bounds.radius:1)*(e.scale[0]+e.scale[1]+e.scale[2])/3,!e.visible||e.parent&&!e.parent.visible||e.data.deathSize<.5?(this.removeMesh(e,!1),this.meshes.splice(t,1)):(ra(e,null),Zn(e.position,e.cX),qn(e.scale,e.cX),Hn(e.quaternion,e.cX),e.data.deathVel=[Zo(-.5,.5),1,Zo(-.5,.5)],e.matrixAutoUpdate=!0)}}tickDeath(t,e,s){this.meshes.forEach(i=>{if(!i.visible||void 0===i.data.deathVel)return;if(this.deathTimer.done(e))return void this.removeMesh(i,!0);const n=i.data.deathVel,a=i.data.deathSize;un(i.position,i.position,n,t),hn(n,n,1-3*t);const r=s.getHeight(i.position[0],i.position[2])+.5*a;n[1]<0&&i.position[1]<r?n[1]<-1?(n[1]=.7*Math.abs(n[1]),n[0]+=Zo(-1,1)/a,n[2]+=Zo(-1,1)/a):n[1]=-.5:n[1]-=50*t,bn(Ka,n,Wa),un(i.rotation,i.rotation,Ka,5*-t),ca(i,!1)})}getScaleFactor(){return 1/(.7+.3*this.transform.scale[1])}getTopAbsolute(){return 2.5*this.entity.radius}tickFixed(t,e,s){}tickOverrides(t,e,s){}setCrown(){}setHeadgear(){}setCape(){}setGem(){}setShoulders(){}addColor(t){this.colors.add(t),this.needsColorUpdate=!0}removeColor(t){this.colors.delete(t),this.needsColorUpdate=!0}colorUpdate(){this.needsColorUpdate=!1,this.meshes.forEach(t=>this.updateMeshColor(t))}changeMeshBaseColor(t,e){t.data.basecolor=e,void 0!==!t.data.color&&(t.data.color=[0,0,0,0]),this.updateMeshColor(t)}updateMeshColor(t){const e=t.data.color;ta(e,t.data.basecolor),this.colors.forEach(t=>{const s=t[3],i=1-s;e[0]=e[0]*i+t[0]*s,e[1]=e[1]*i+t[1]*s,e[2]=e[2]*i+t[2]*s})}}const Ig={melee:{delay:.3,distance:5,rnd:3,id:"melee/sword"},hurt:{id:"humanoid/hurt",rnd:7},death:{id:"humanoid/death",rnd:2},effort:{id:"humanoid/effort",rnd:7}};class Pg extends Tg{constructor(t){t.sounds||(t.sounds=Ig),super(t),this.chest=this.mesh(this.transform,!0,null,1.4,t.Zj,null,t.shader,!0),this.hands=[],this.legs=[];for(let e=0;e<2;++e){const e=this.mesh(this.chest,!0,"character/hand",.5,this.chest.data.color,null,t.shader),s=this.mesh(this.transform,!0,"character/boot",.6,mp.greysteel,null,t.shader);rn(s.scale,.4,.4,.4),this.legs.push(s),this.hands.push(e)}this.eyes=this.mesh(this.chest,!1,"character/eyes",.7,t.colEyes||mp.black,null,zc.multimeshSimple),this.eyesBlink=0,rn(this.eyes.position,0,-.05,.52),this.hasJustJumped=!1,this.hasJustLanded=!0,this.flip=0,this.capeswing=!0,this.cape=void 0,this.headgear=void 0,this.gem=void 0,this.shouldergems=void 0,this.movementPushback=[0,0,0],this.movementPushbackVel=[0,0,0]}tickFixed(t,e,s){super.tickFixed(t,e,s),this.tickPushBack(t,e,s)}tickPushBack(t,e,s){super.tickPushBack(t,e,s),this.chest.visible&&this.cDist<25&&0===this.entity.type&&(un(this.movementPushback,this.movementPushback,this.movementPushbackVel,60*t),un(this.movementPushbackVel,this.movementPushbackVel,this.movementPushbackVel,-20*t),un(this.movementPushbackVel,this.movementPushbackVel,this.movementPushback,-10*t),this.movementPushbackVel[2]+=.01*this.entity.steer[1],this.movementPushbackVel[0]-=.01*this.entity.steer[0])}tickParts(t,e,s){this.walking=void 0===this.entity.mount&&this.walking,this.checkCycleReset(this.falling<<1|(!this.falling&&this.walking)<<2),this.calculateCycleSpeed(),this.updateChest(),this.updateHands(),this.updateLegs(),this.updateEyes(t),this.tickWalkSounds(t),this.tickLanding(),this.tickEquipment(t,e,s)}tickOverrides(t,e,s){this.chest.visible&&this.entity.buffs.incapacitated.size>0&&Array.from(this.entity.buffs.incapacitated).some(t=>t.logic.visualIncapacitation)&&(cn(this.chest.rotation,.3*(Math.sin(2.2*e)+.3*Math.sin(2.1*e))+1,.3*(Math.sin(2.1*e)+.6*Math.sin(2*e)),.3*(Math.sin(.8*e)+.5*Math.sin(2.3*e))),this.hands.forEach(t=>t.position[1]-=.2))}tickEquipment(t,e,s){const i=this.hands[0];if(i.visible&&(void 0!==this.weapon&&(this.sheathed||(this.entity.mount?this.sheathe(!0):!this.entity.target||this.walking||this.falling?(i.rotation[0]+=.5,i.position[1]-=.2,i.position[0]-=.1):(i.rotation[0]+=1,i.rotation[2]+=.6,i.position[2]-=.3,i.position[1]-=.2,i.position[0]-=.1,this.legs[0].position[0]-=.05,this.legs[1].position[0]+=.05,this.legs[0].position[2]-=.2,this.chest.position[1]+=.05*Math.sin(3*e)-.05,this.chest.rotation[1]-=.05*Math.cos(3*e)))),this.currentAnim)){const t=br.easeInOutCubic(this.currentAnim.fract),e=-Math.sin(7.5*t-1.5),s=-Math.sin(6.28*t),n=-Math.sin(3.14*t),a=br.easeOutExpo(-n);switch(hn(i.rotation,i.rotation,1-a),this.currentAnim.id){case 0:if(void 0!==this.weapon)this.sheathe(!1),cn(i.rotation,1.7*n,1.5*a,e*a+.5*a),i.position[2]-=n-t*a,i.position[1]+=Math.sin(13*t+3)*a*.5,i.position[0]+=(1.5*t-.5)*a,this.chest.rotation[1]+=1.5*s;else{const e=Math.cos(6.28*t);this.chest.position[2]+=(.3+.2*Math.sin(6.28*t-3.14))*a,this.chest.rotation[0]+=.5*Math.sin(3.28*t)*a,this.hands.forEach((s,i)=>{s.visible&&(hn(s.position,s.position,1-a),s.position[2]+=(1-.5*e)*a,s.position[1]+=Math.sin(6.28*t)*(t>.5?.7:1),s.position[0]+=(i?.5+.2*n:-.5-.2*n)*a,rn(s.rotation,0,1.5,0))})}break;case 1:this.sheathe(!1),i.rotation[0]-=1.7*n,i.rotation[1]+=1.5*a-a,i.rotation[2]+=e*a+.5*a,i.position[2]+=a,i.position[0]-=.5*a,this.chest.rotation[1]-=1.5*s-.5*a;break;case 4:this.sheathe(!1),i.rotation[0]+=1.7*n,i.rotation[1]-=1.5*n,i.position[0]-=.5*a,this.chest.rotation[1]=2*t*Math.PI+3*a;break;case 3:this.sheathe(!0),rn(this.chest.rotation,n,0,0),rn(i.position,-.3,0,.7);break;case 9:this.sheathe(!1),rn(i.rotation,0,0,0)}}this.tickShield(),this.tickCape(t)}tickShield(){const t=this.hands[1];void 0!==this.shield&&t.visible&&(!this.entity.target||this.walking||this.falling?(t.rotation[2]-=.1,t.position[1]+=.1):(t.rotation[2]-=.2,t.rotation[1]-=1,t.position[1]+=.1,t.position[2]+=.4))}tickCape(t){void 0!==this.cape&&this.cape.visible&&this.capeswing&&((this.entity.steer[1]>0||this.falling)&&(this.capeoffset+=.5*nn(this.entity.vel)*t),this.capeoffset*=1-3*t,rn(this.cape.rotation,Math.max(0,this.capeoffset),0,0))}tickWalkSounds(t){(this.cDist<20||this.transform.scale[1]>2)&&!this.falling&&this.walking&&(this.fraction(.2,t)||this.fraction(.7,t))&&nl({id:this.transform.scale[1]>2||this.chest.scale[1]>2?"step_giant":"step_grass",rnd:3,loop:!1,transform:this.transform,distance:Math.min(1+3*this.transform.scale[1],10),force:this.transform.scale[1]>2})}tickLanding(){this.hasJustJumped&&this.entity.onGround&&(this.cDist<20&&(0==this.entity.vel[1]||this.entity.vel[1]<-4)&&(nl({id:"land_grass",loop:!1,transform:this.transform,distance:3}),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.15,this.eyesBlink=.3),this.hasJustLanded=!0,this.hasJustJumped=!1,this.flip=0),this.hasJustLanded&&!this.entity.onGround&&(this.entity.vel[1]>5&&(nl({id:"jump_grass",loop:!1,transform:this.transform,distance:3}),Math.random()<.5&&(this.flip=this.entity.steer[1]),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.1,this.eyesBlink=.3,Zo(0,1)<.2&&this.onEffort()),this.hasJustJumped=!0,this.hasJustLanded=!1)}updateEyes(t){if(this.eyes.visible){let e=0;e=this.eyesBlink>0?this.eyesBlink-t:Math.random()<.006?.1:this.eyesBlink,(this.eyesBlink>0&&e<0||e>0&&this.eyesBlink<0)&&(rn(this.eyes.scale,1,e>0?.1:1,.1),this.eyes.matrixNeedsUpdate=!0),this.eyesBlink=e}}updateLegs(){this.legs.forEach((t,e)=>{if(t.visible)if(this.entity.mount)this.entity.mount.mountLegs(t,e);else{const s=Sr(this.entity.steer);if(this.currentAnim&&10===this.currentAnim.id)return void rn(t.position,0,0,0);if(this.falling)if(0==this.flip){const i=.1*Math.max(-1,Math.min(0,.2*this.entity.vel[1])),n=e?.3*this.cycle(0)-i:.3*this.cycle(.5)+i;rn(Ka,e?.3-i:-.3+i,-.65,n),Mn(t.position,Ka,0),rn(t.rotation,-n,s,0)}else rn(t.position,e?.3:-.3,-.3,0),rn(t.rotation,0,0,0);else{if(this.walking){const i=this.entity.steer[1]<0?.4:.6,n=this.cycle(0)*i*1.3;rn(Ka,e?.3:-.3,Math.max(0,.6*Math.cos(this.cycleRad+(e?0:Math.PI)))-.55,this.cycle(e?0:.5)*i),Mn(t.position,Ka,s),rn(t.rotation,e?-n:n,s,0)}else rn(t.rotation,0,e?.1:-.1,0),rn(t.position,e?.45:-.45,-.65,0);this.currentAnim&&!this.walking&&(5!=this.currentAnim.id&&6!=this.currentAnim.id&&9!=this.currentAnim.id||rn(t.position,e?.4:-.55,-.65,e?.2:-.3))}}})}updateChest(){if(this.chest.visible){this.falling&&void 0===this.entity.mount?(this.transform.rotation[0]=this.cycleRad*this.flip,rn(this.chest.position,0,0!=this.flip?.3:.5,0)):(this.walking?rn(this.chest.position,0,.1*Math.cos(2*this.cycleRad)+.4,0):rn(this.chest.position,0,void 0===this.entity.mount?.1*this.cycle(0)+.4:.4,0),0!==this.transform.rotation[0]&&(this.transform.rotation[0]=0)),rn(this.chest.rotation,5*-this.pushBack[1]+this.movementPushback[2],0,5*this.pushBack[0]-this.movementPushback[0]),Br(this.chest.position,this.chest.position,this.pushBackOffset),un(this.chest.position,this.chest.position,this.movementPushback,1);const t=.5*-this.movementPushback[1];if(rn(this.chest.scale,1+t,1-t,1+t),void 0!==this.currentAnim)if(5!=this.currentAnim.id&&6!=this.currentAnim.id||(this.chest.rotation[1]-=.3+.05*this.cycle(.2),this.chest.rotation[0]+=.3+.02*this.cycle(.4),this.chest.position[1]-=.1+.05*this.cycle(.6),this.chest.position[0]-=.05),6==this.currentAnim.id)this.chest.rotation[1]*=1-this.currentAnim.anticipate;else if(10==this.currentAnim.id)rn(this.chest.position,0,.2+.5*Math.sin(this.currentAnim.fract*Math.PI),0),this.chest.rotation[0]+=this.currentAnim.fract*xr,this.chest.rotation[1]+=Sr(this.entity.steer);else if(9==this.currentAnim.id){const t=br.easeOutQuad(gr(2*this.currentAnim.fract,0,1));this.chest.position[1]+=.2*Math.sin(3+5*t),this.chest.rotation[0]+=.5-.5*t}}}updateHands(){this.hands.forEach((t,e)=>{if(t.visible){if(this.falling&&void 0===this.entity.mount)rn(t.position,e?.6:-.6,-gr(this.entity.vel[1],-5,5)/20,0),t.position[0]+=(e?1:-1)*Math.sin(3.1*t.position[1]+.8)*.3,rn(t.rotation,0,e?Math.PI:0,-.3-t.position[1]);else if(this.walking){const s=this.cycle(0),i=this.entity.steer[1]<0?.3:.5,n=Math.sin(2*this.cycleRad+5);rn(t.rotation,0,s*i*1.3+(e?Math.PI:0),0),rn(t.position,(e?.7:-.7)+n*(e?-.2:.2),s*(e?.3:-.3)-.2,.2+s*i*(e?-1.5:1.5)),t.position[0]=e?Math.max(.5,t.position[0]):Math.min(-.5,t.position[0])}else if(this.entity.mount)rn(t.rotation,0,e?-1.3+Math.PI:1.3,.3),rn(t.position,e?.3:-.3,-.5,.7);else{const s=this.cycle(0);rn(t.rotation,0,(e?-.43+Math.PI:.43)+.15*s*(e?1:-1),.3),rn(t.position,e?.7:-.7,.08*s-.3,.15-.1*s)}if(this.currentAnim)if(5==this.currentAnim.id||6==this.currentAnim.id)0==e?(t.position[0]-=.2,t.position[1]-=.2,6==this.currentAnim.id&&(hn(t.position,t.position,1-this.currentAnim.fract),t.position[0]+=.3*-this.currentAnim.fract,t.position[2]+=.6*this.currentAnim.anticipate)):(t.position[0]-=.4,t.position[2]+=.5-.2*this.cycle(.3),t.rotation[1]+=.6+.2*this.cycle(.4),t.rotation[0]-=.8,6==this.currentAnim.id&&(hn(t.position,t.position,1-this.currentAnim.fract),t.position[0]+=.3*this.currentAnim.fract,t.position[2]+=this.currentAnim.fract));else if(9===this.currentAnim.id){const s=br.easeInOutCubic(gr(2*this.currentAnim.fract,0,1));rn(t.rotation,1-s,0,0);const i=Math.sin(3*s);0==e?rn(t.position,-.12-.35*i,1.2*s-.1,.3+i):rn(t.position,.12+.35*i,1.2*s,.3+i)}if(this.shoulders){const s=this.shoulders[e];s.visible&&(ua(s,t.position,!1,Wa),hn(s.rotation,s.rotation,.5),s.rotation[1]-=e?.8:-.8,s.rotation[2]-=e?.5:-.5)}}})}calculateCycleSpeed(){this.falling?this.speed=1.5:this.walking?this.speed=this.entity.speed/20*(-1===this.entity.steer[1]?1.3:1)*.45/(.4+.6*this.entity.size):this.speed=.5}sheathe(t){this.sheathed!==t&&(this.sheathed=t,void 0!==this.weapon&&(ra(this.weapon,t?this.chest:this.hands[0]),this.sheathed?an(this.weapon.position,this.sheathedWeaponPos):an(this.weapon.position,this.unsheathedWeaponPos)),this.shield&&(ra(this.shield,t?this.chest:this.hands[1]),this.sheathed?(rn(this.shield.position,0,-.2,-.65),rn(this.shield.rotation,0,-1.57,0)):(rn(this.shield.position,-.2,0,0),rn(this.shield.rotation,0,0,0))))}setShoulders(t,e=1,s=!1){if(this.hasDied||!1===t)this.hasDied||void 0===this.shoulders||(this.shoulders.forEach(t=>this.removeMesh(t,!0)),this.shoulders=void 0,void 0!==this.shouldergems&&this.removeShouldergems());else{if(!this.shoulders){this.shoulders=[];for(let t=0;t<2;++t)this.shoulders[t]=this.mesh(this.chest,!0,null,.6)}this.shoulders.forEach((s,i)=>{rn(s.position,i?.5:-.5,.4*e-.4,-.05),rn(s.scale,.8*e,.5*e,.5*e),this.changeMeshBaseColor(s,t)})}if(!1!==s){if(!this.shouldergems){this.shouldergems=[];for(let t=0;t<2;++t)this.shouldergems[t]=this.mesh(this.shoulders[t],!1,"character/spike",.3)}this.shouldergems.forEach((t,e)=>{rn(t.rotation,0,3.14,0),rn(t.position,e?.2:-.2,0,-.5),rn(t.scale,.35,.55,.2),this.changeMeshBaseColor(t,s)})}else void 0!==this.shouldergems&&this.removeShouldergems()}removeShouldergems(){this.shouldergems.forEach(t=>this.removeMesh(t,!0)),this.shouldergems=void 0}setCape(t,e){this.hasDied||!1===t?this.hasDied||void 0===this.cape||(this.removeMesh(this.cape,!0),this.cape=void 0):(this.capeoffset=0,void 0===this.cape&&(this.cape=this.mesh(this.chest,!0,"character/cape",.7),rn(this.cape.position,0,.2,-.55)),rn(this.cape.scale,e,e,e),this.changeMeshBaseColor(this.cape,t))}setHeadgear(t){this.hasDied||!1===t?this.hasDied||void 0===this.headgear||(this.removeMesh(this.headgear,!0),this.headgear=void 0):(void 0===this.headgear&&(this.headgear=this.mesh(this.chest,!1,"character/headgear",.5)),this.changeMeshBaseColor(this.headgear,t))}setGem(t,e=1){this.hasDied||!1===t?this.hasDied||void 0===this.gem||(this.removeMesh(this.gem,!0),this.gem=void 0):(void 0===this.gem&&(this.gem=this.mesh(this.chest,!1,"character/spike",.5),rn(this.gem.position,0,.4,.54),rn(this.gem.scale,.3*e,.3*e,.08*e)),this.changeMeshBaseColor(this.gem,t))}setCrown(t){this.hasDied||!1===t?this.hasDied||void 0===this.crown||(this.removeMesh(this.crown,!0),this.crown=void 0):(void 0===this.crown&&(this.crown=this.mesh(this.chest,!1,"character/crown",.8),this.crown.position[1]=.8),this.changeMeshBaseColor(this.crown,t))}}const Bg={death:{id:"undead/death",rnd:2},hurt:{id:"undead/hurt",rnd:3},melee:{delay:.2,distance:4,id:"undead/attack",rnd:3},aggro:{id:"undead/aggro",rnd:2},idle:{id:"undead/idle",rnd:6}};class Fg extends Pg{constructor(t){t.colPrim=t.colPrim||mp.emerald,t.colSec=t.colSec||mp.bone2,t.sounds=Bg,super({Zj:t.colPrim,colEyes:mp.evilred,...t}),this.meat=this.mesh(this.chest,!1,null,.5,t.colSec),rn(this.meat.position,.2,.2,-.2),rn(this.meat.scale,.7,.7,.7),this.setShoulders(t.colSec,.5),this.legs.forEach((e,s)=>{rn(e.scale,.4,.4,.4),this.changeMeshBaseColor(e,s?t.colPrim:t.colSec)}),this.hands.forEach((e,s)=>this.changeMeshBaseColor(e,s?t.colSec:t.colPrim))}tickEquipment(t,e,s){void 0!==this.currentAnim&&0!==this.currentAnim.id||this.hands.forEach((t,e)=>{rn(t.position,e?.5:-.5,e?.1:-.1,1),rn(t.rotation,0,1.5,0)}),super.tickEquipment()}tickParts(t,e,s){super.tickParts(t,e,s),cn(this.chest.rotation,.1*(Math.sin(1.8*e)*Math.cos(2*e)*.3+.3*Math.sin(1.4*e))+.2,.1*(Math.sin(1.3*e)+.6*Math.sin(2.4*e)),.1*(Math.sin(.4*e)+.5*Math.sin(1.9*e))),this.legs.forEach((t,s)=>{t.rotation[1]+=.3*Math.sin(.2*e-s)})}}var zg=new mg({id:78,type:1,tags:new Set([7]),incapacitated:!0,dr:3,icon:"skills/37",fx:{visual:Fg,stick:yp.transformation,startSound:{id:"shaman/spiritAnimalCast",distance:5,dynamic:!0},endSound:{id:"buffEnd",distance:5,dynamic:!0}},statsStatic:(t,e)=>{e.maxStat(27,30+7*t.level),e.maxStat(28,20+5*t.level)}}),Ug=new mg({id:71,icon:"skills/28",fx:{stick:yp.caninehowl,stickOffset:.5,startSound:{id:"shaman/caninehowlcast",distance:5}},unique:!0,statsStatic:(t,e)=>{e.addStat(16,100+60*t.level)}}),Dg=new mg({id:54,type:1,tags:new Set([3,1]),icon:"skills/12",fx:{stick:yp.decay,stickOffset:.5,color:[.5,.4,.05,.5]},statsStatic:(t,e)=>{e.maxStat(27,20+3*t.level)},intervalDuration:1.5,onInterval:(t,e,s)=>({id:12,mode:1,caster:t.caster,target:e.id,dmg:1+s.stats.getDamageRoll()*(.1+.08*t.level),type:1,noDaze:!0})}),Ag=new mg({id:55,icon:"skills/13",fx:{stick:yp.manaBuff,startSound:{id:"shaman/manaBuffCast",distance:5}},intervalDuration:.5,custom:[[t=>40+30*t,"MP recovered"]],onInterval:(t,e,s)=>{}}),Rg=new mg({id:96,maxStacks:5,icon:"skills/43",fx:{stick:yp.plagueSpreaderBuff}}),Lg=new mg({id:95,passive:!0}),Og=new mg({id:47,maxStacks:3,icon:"skills/7",fx:{stick:yp.revitalize},intervalDuration:1,multiplyIncomingHeal:{6:t=>1+.25*t.stacks,7:t=>1+.3*(t.stacks-1)},onInterval:(t,e,s)=>({id:7,mode:2,caster:t.caster,target:e.id,heal:6+s.stats.getDamageRoll()*(.028+.024*t.level)})}),_g=new mg({id:51,passive:!0,icon:"skills/8",statsConvert:[[4,.4,10],[4,.4,11]]});const Ng={death:{id:"blob/death"},hurt:{id:"blob/hurt",rnd:1},melee:{delay:.3,distance:3,id:"blob/attack",rnd:2},aggro:{id:"blob/aggro",rnd:1},idle:{id:"blob/idle",rnd:2}};class Zg extends Tg{constructor(t){t.sounds=Ng,super(t),this.chest=this.mesh(this.transform,!0,t.meshHead||null,1,t.colPrim||mp.slimegreen,void 0,void 0,!0),this.blobs=[];for(let e=0;e<2;++e){const s=this.mesh(null,!0,t.meshHead||null,.9-.1*e,(0==e?t.colSec:t.colPrim)||this.chest.data.color,void 0,void 0,!0);s.visible=!0,this.blobs.push(s)}this.eyes=this.mesh(this.chest,!1,t.meshEyes||"character/eyes",.5,t.colEyes||mp.black,null,zc.multimeshSimple),rn(this.eyes.position,0,-.05,.52)}tickFixed(t,e,s){this.tickPushBack(t,e,s)}tickParts(t,e,s){this.checkCycleReset(this.falling<<1|(!this.falling&&this.walking)<<2),this.walking?this.speed=this.entity.speed/this.entity.size*.012:this.speed=.5;const i=this.cycle(.5);if(rn(this.chest.scale,.1*i+1,1+.1*this.cycleSin,.1*i+1),rn(this.chest.position,0,.1*this.cycleSin-.1,0),rn(this.chest.rotation,5*-this.pushBack[1],0,5*this.pushBack[0]),Br(this.chest.position,this.chest.position,this.pushBackOffset),this.currentAnim){const t=br.easeOutExpo(this.currentAnim.fract**3);switch(this.currentAnim.id){case 0:this.chest.position[2]+=Math.sin(6.28*t-3.14)}}this.blobs.forEach((e,i)=>{if(e.visible=this.transform.visible,!e.visible)return;const n=0==i?this.transform:this.blobs[i-1];dn(Ka,n.position,e.position),rn(er,0,0,.7*-n.scale[0]),Mn(tr,er,n.rotation[1]),ln(Ka,Ka,tr);const a=nn(Ka);a>30*this.entity.size?an(e.position,this.entity.Zc):un(e.position,e.position,Ka,Math.max(0,Math.min(.5,20*t*(a-.7*e.scale[1])))),rn(e.rotation,0,Mr(dn(Ka,n.position,e.position)),0),on(e.scale,.3*(3-i)*(.8+.1*this.cycle(.3*i))*this.transform.scale[0]),e.position[1]=Math.max(s.getHeight(e.position[0],e.position[2])+.5*e.scale[1],e.position[1]-2.5*t),ca(e,!1)})}mountPosition(t){wn(t,[0,.6,-.13],this.chest.cX)}mountLegs(t,e){rn(t.rotation,-1.5,e?.2:-.2,e?.4:-.4),rn(t.position,e?.6:-.6,0,.6)}getTopAbsolute(){return 2*this.entity.radius}}var qg=new mg({id:77,breakOnCast:!0,icon:"skills/36",fx:{visual:Zg,stick:yp.transformation,startSound:{id:"shaman/spiritAnimalCast",distance:5,dynamic:!0},endSound:{id:"buffEnd",distance:5,dynamic:!0}},statsStatic:(t,e)=>{e.addStat(15,8+12*t.level)}}),Gg=new mg({id:69,passive:!0,statsStatic:(t,e)=>{e.addStat(14,Math.round(40*t.level))}}),Hg=new mg({id:53,icon:"skills/11",fx:{stick:yp.invigorateBuff,stickOffset:.5,startSound:{id:"archer/invigoratebuff",distance:4},endSound:{id:"buffEnd",distance:3}},custom:[[t=>9*t,"% increased damage"]]}),Xg=new mg({id:70,icon:"skills/27",fx:{stick:yp.pathfinding,startSound:{id:"archer/pathfindcast",distance:5}},unique:!0,statsStatic:(t,e)=>{e.addStat(15,5+13*t.level)}}),jg=new mg({id:72,passive:!0,icon:"skills/29",custom:[[t=>5+25*t,"% per stack as additional damage over 10 seconds"]],afterDamageEnemy:{9:(t,e,s)=>{}}}),Jg=new mg({id:73,type:1,maxStacks:3,tags:new Set([3,1]),icon:"skills/29",fx:{stick:yp.poisonarrows,color:[.1,1,.3,.3]},statsStatic:(t,e)=>{e.maxStat(27,30)},intervalDuration:1.5,onInterval:(t,e,s)=>({id:29,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,type:1,noDaze:!0})}),Vg=new mg({id:83,maxStacks:4,icon:"skills/31",instantCast:new Set([31]),beforeDamageEnemy:{31:(t,e,s,i)=>{}}}),Yg=new mg({id:52,passive:!0,icon:"skills/10",custom:[[t=>2+1*t," Jumps"],[t=>12+12.5*t,"% damage per Jump"]],afterDamageEnemy:{9:(t,e,s)=>{}}}),Wg=new mg({id:79,icon:"skills/38",fx:{stick:yp.snipe},statsStatic:(t,e)=>{e.addStat(15,30)},instantCast:new Set([9]),onCast:{9:(t,e)=>{}}}),Qg=new mg({id:84,passive:!1,incapacitated:!0,icon:"skills/38",statsOverride:(t,e)=>{e.stat.set(15,400)},movementOverride:(t,e,s,i,n)=>{i.setSteer(n.data[0]-1,n.data[1]-1)}}),Kg=new mg({id:50,passive:!0,icon:"skills/8",statsConvert:[[2,.4,10],[2,.4,11]]}),tv=new mg({id:68,icon:"skills/25",fx:{stick:yp.temporaldilation,startSound:{id:"archer/timedilationcast",distance:5}},unique:!0,statsStatic:(t,e)=>{e.addStat(16,30*t.level)}}),ev=new mg({id:65,icon:"skills/22",fx:{stick:yp.arcticaura,startSound:{id:"mage/arcticauracast",distance:5}},unique:!0,statsStatic:(t,e)=>{e.addStat(14,30*t.level)}}),sv=new mg({id:89,type:1,tags:new Set([6]),incapacitated:!0,dr:1,icon:"skills/deepFrozen",fx:{stick:yp.deepfrozen,color:[.1,.9,.8,.9]},statsStatic:(t,e)=>{e.maxStat(27,100)},multiplyIncomingDamage:{4:t=>1.5,15:t=>1.5}}),iv=new mg({id:67,icon:"skills/24",fx:{stick:yp.enchantment,startSound:{id:"mage/enchantcast",distance:5}},unique:!0,statsStatic:(t,e)=>{e.addStat(10,Math.floor(2+1.5*t.level)),e.addStat(11,Math.floor(3+3.5*t.level))}}),nv=new mg({id:97,icon:"skills/extraBolt",fx:{stickOffset:.15,stick:yp.extraBoltBuff}}),av=new mg({id:56,type:1,tags:new Set([4]),dr:2,icon:"skills/14",fx:{stick:yp.icenovaroot,color:[.7,.7,1,.4]},statsStatic:(t,e)=>{e.maxStat(27,100)},addIncomingCrit:{4:t=>10+30*t.level,15:t=>20+30*t.level},intervalDuration:1.5,onInterval:(t,e,s)=>({id:14,mode:1,caster:t.caster,target:e.id,dmg:s.stats.getDamageRoll()*(.1+.3*t.level),type:1,noDaze:!0})}),rv=new mg({id:87,type:1,tags:new Set([3]),maxStacks:4,icon:"skills/frozenBuff",fx:{stick:yp.frozen,color:[.1,.1,.8,.5]},statsStatic:(t,e)=>{e.maxStat(27,20)}}),ov=new mg({id:58,icon:"skills/16",fx:{stick:yp.hypothermicBuff,stickOffset:.5,startSound:{id:"mage/hypothermicCast",distance:4},endSound:{id:"buffEnd",distance:3}},statsStatic:(t,e)=>{e.addStat(16,30+70*t.level),e.addStat(25,2+7*t.level)}}),lv=new mg({id:88,passive:!0}),cv=new mg({id:66,icon:"skills/23",fx:{stickOffset:.15,stick:yp.iceBlockBuff}}),dv=new mg({id:57,passive:!0}),hv=new mg({id:49,passive:!0,icon:"skills/8",statsConvert:[[3,.4,10],[3,.4,11]]}),uv=new mg({id:101,type:0,icon:"skills/charm4",fx:{norefresh:!0,stick:yp.blueMarble,color:[0,0,1,.7]}}),mv=new mg({id:102,type:1,tags:new Set([1]),maxStacks:10,icon:"skills/firebuff",fx:{stick:yp.burning,color:[2,1,.3,1]}}),pv=new mg({id:81,type:1,tags:new Set([3]),icon:"skills/dazedBuff",fx:{stick:yp.dazed,stickOffset:.5},statsStatic:(t,e)=>{e.maxStat(27,30)}}),fv=new mg({id:99,type:0,icon:"skills/charm2",fx:{stick:yp.dmgBoostBuff,color:[1,0,0,.8]},statsStatic:(t,e)=>{e.addStat(25,t.level)}}),gv=new mg({id:98,type:0,icon:"skills/charm1",fx:{stick:yp.incomingDmgReduceAura,color:[.3,.3,.3,.9]},beforeIncomingDamage:(t,e,s,i)=>s*(t.level/100)});const vv={death:{id:"blob/death"},hurt:{id:"blob/hurt",rnd:1},melee:{delay:.3,distance:3,id:"blob/attack",rnd:2},aggro:{id:"blob/aggro",rnd:1},idle:{id:"blob/idle",rnd:2}};class yv extends Tg{constructor(t){t.sounds=vv,super(t),this.chest=this.mesh(this.transform,!0,t.meshHead||null,.6,t.colPrim||mp.greysteel,void 0,void 0,!0),rn(this.chest.scale,.6,.6,.6),this.chest2=this.mesh(this.chest,!1,t.meshBack||null,1.2,t.colSec||mp.woodbrown),rn(this.chest2.scale,1.2,1.2,1.4),rn(this.chest2.position,0,.1,-1),this.eyes=this.mesh(this.chest,!1,t.meshEyes||"character/spiderEyes",.4,t.colEyes||mp.greysteel,null,zc.multimeshSimple),rn(this.eyes.position,0,-.05,.52),rn(this.eyes.scale,.6,.6,.6),this.legs=[],this.legsize=t.legsize||1;for(let e=0;e<2;++e){const e=this.mesh(this.transform,!0,"character/crawlerLegs",2,t.colSec||mp.woodbrown,null,t.shader,!0);this.legs.push(e),on(e.scale,this.legsize)}this.chestOffset=t.chestOffset||0}tickFixed(t,e,s){this.tickPushBack(t,e,s)}tickParts(t,e,s){if(this.walking&&!this.falling){this.speed=this.entity.speed*(-1===this.entity.steer[1]?-1.2:1)*.04/(.4+.6*this.entity.size+this.legsize);const e=Math.cos(this.cycleRad);rn(this.legs[0].rotation,0,.2*this.cycleSin,.2*this.cycleSin),rn(this.legs[0].position,0,.3*Math.abs(e)+.2,0),rn(this.legs[1].rotation,0,Math.PI+.2*e,.2*e),rn(this.legs[1].position,0,.3*Math.abs(this.cycleSin),0),rn(this.chest.position,.01*this.cycle(.3),.02*this.cycleSin+this.chestOffset,0),rn(this.chest.rotation,0,.01*this.cycleSin,.01*Math.sin(2*this.cycleRad)),this.entity.target>0&&Math.random()<.3&&this.fraction(.1,t)&&nl({id:"crawler/crawlerMove",loop:!1,transform:this.transform,distance:Math.min(1+3*this.transform.scale[1],10),force:this.transform.scale[1]>2})}else if(this.speed=.5,this.currentAnim){const t=br.easeOutExpo(this.currentAnim.fract**3);switch(this.currentAnim.id){case 0:{const e=Math.sin(6.28*t-3.14);rn(this.chest.position,0,Math.max(0,-e)+this.chestOffset,.5*e),this.legs.forEach((t,s)=>{const i=0==s?1:-1,n=1==s?Math.PI:0;rn(t.rotation,i*Math.min(e,0),n+.1*e*i,0),rn(t.position,0,Math.max(0,-e),.5*e)});break}}}else rn(this.chest.position,0,.1*this.cycle(-.1)+this.chestOffset,0),this.legs.forEach((t,e)=>{const s=this.cycle(0==e?0:.5);rn(t.rotation,0,1==e?Math.PI:0,this.falling?.4:0),rn(t.position,0,.1*s,0)});rn(this.chest.rotation,this.chest.rotation[0]-5*this.pushBack[1],this.chest.rotation[1],this.chest.rotation[2]+5*this.pushBack[0])}mountPosition(t){wn(t,[0,.8,-1],this.chest.cX)}mountLegs(t,e){rn(t.rotation,-.9,e?.2:-.2,e?.4:-.4),rn(t.position,e?.6:-.6,-.4,.5)}}const bv=t=>{on(t.chest.scale,.8),on(t.chest2.scale,1.1),rn(t.chest2.position,0,.2,-.8),rn(t.chest2.rotation,0,3.14,0),rn(t.eyes.position,0,-.2,.8),on(t.eyes.scale,.6)},xv=[[30,1e4,50,Zg,{}],[30,2e4,50,yv,{}],[30,5e4,80,yv,{colEyes:sh(11332842,0),colPrim:sh(4772165,-.2),colSec:sh(1351204,-.2)}],[30,5e4,80,yv,{colEyes:sh(16751284,0),colPrim:sh(15737892,.5),colSec:sh(15737892,.5)}],[30,5e4,95,yv,{colEyes:sh(14292553,0),colPrim:sh(4075311,.1),colSec:sh(1970198,.1),legsize:.5,post:t=>{on(t.chest.scale,.8)}}],[30,5e4,90,yv,{colEyes:sh(2029122,0),colPrim:sh(2565674,.3),colSec:sh(2236197,.3),legsize:1.4,post:t=>{rn(t.chest.scale,.6,.6,1),rn(t.chest2.rotation,.5,0,0)}}],[30,5e4,80,Zg,{colEyes:sh(12825266,0),colPrim:sh(11313312,.1),colSec:sh(8221555,.1),meshHead:"character/blob",post:t=>rn(t.eyes.position,0,0,.6)}],[30,5e4,90,Zg,{colEyes:sh(15880973,0),colPrim:mp.fireorange,colSec:mp.fireorange,meshHead:"character/blob",post:t=>{rn(t.eyes.position,0,0,.6);const e=_d(yp.burning,t.transform);e&&t.effects.push(e)}}],[30,5e4,95,Zg,{colEyes:sh(12451327,0),colPrim:sh(3950066,-.4),colSec:sh(3525854,-.4),meshHead:"character/wyrmhead",meshEyes:"character/wyrmEyes",post:t=>{const e=_d(yp.etherwyrm,t.blobs[0]);e&&t.effects.push(e)}}],[30,5e4,95,Zg,{colEyes:sh(2747996,0),colPrim:sh(1907231,.4),colSec:sh(2293580,-.8),meshHead:"character/wyrmhead",meshEyes:"character/wyrmEyes",post:t=>{const e=_d(yp.shadowwyrm,t.blobs[0]);e&&t.effects.push(e)}}],[30,5e4,80,yv,{colEyes:sh(16758891,0),colPrim:sh(15448667,.1),colSec:sh(11370036,.1),legsize:.6,meshHead:"character/wyrmhead",meshBack:"character/wyrmhead",meshEyes:"character/wyrmEyes",chestOffset:.5,post:bv}],[30,5e4,95,yv,{colEyes:sh(16777215,0),colPrim:mp.darksteel,colSec:mp.gold,legsize:.6,meshHead:"character/wyrmhead",meshBack:"character/wyrmhead",meshEyes:"character/wyrmEyes",chestOffset:.5,post:bv}],[30,5e4,95,yv,{colEyes:sh(16750598,0),colPrim:sh(13177876,-.6),colSec:sh(16721931,-.7),legsize:1.1,meshHead:"character/blob",meshBack:"character/wyrmhead",meshEyes:"character/wyrmEyes",post:t=>{on(t.chest2.scale,.7),rn(t.eyes.position,0,-.1,.55),on(t.eyes.scale,.6);const e=_d(yp.burning,t.transform);e&&t.effects.push(e)}}],[30,5e4,85,Zg,{colEyes:mp.fireorange,colPrim:mp.darksteel,colSec:mp.fireorange}],[30,5e4,95,Zg,{colEyes:mp.ice,colPrim:sh(3980543,-.6),colSec:mp.ice,post:t=>{const e=_d(yp.arcticaura,t.blobs[1]);e&&(t.effects.push(e),e.position[1]=-.5)}}]].map(t=>({level:t[0],goldValue:t[1],quality:t[2],visual:t[3],visualData:t[4]})),wv=t=>{xv.forEach((e,s)=>{t["mount"+s]={...e,type:"mount",tier:s,requiredSkills:[39],useSkill:102,use:(t,e,i,n,a)=>({id:80,mode:4,stacks:1,duration:600,caster:t.id,target:t.id,buffdata:[s],sendBuffData:!0,level:e})}})};var kv=new mg({id:80,breakOnCast:!0,icon:"skills/39",fx:{mount:t=>xv[t.data[0]].visual,mountVisualData:t=>xv[t.data[0]].visualData,startSound:{id:"shaman/spiritAnimalCast",distance:5,dynamic:!0},endSound:{id:"buffEnd",distance:5,dynamic:!0}},statsStatic:(t,e)=>{e.addStat(15,60)}}),$v=new mg({id:100,type:0,icon:"skills/charm3",fx:{stick:yp.moveBoost,color:[.3,0,.6,.8]},statsStatic:(t,e)=>{e.addStat(15,t.level)}}),Sv=new mg({id:91,icon:"skills/postsummon",fx:{stick:yp.postsummon},unique:!0,statsStatic:(t,e)=>{e.addStat(15,20)}}),Mv=["potionhp","potionMp"].map((t,e)=>new mg({id:[85,86][e],maxStacks:1,icon:"skills/"+t,intervalHaste:!1,intervalDuration:.5,onInterval:(t,s,i)=>({id:100,mode:[2,3][e],caster:t.caster,target:s.id,heal:1==e?void 0:t.level,mprec:0==e?void 0:t.level,nocrit:!0})})),Ev=new mg({id:82,passive:!0,statsStatic:(t,e)=>{e.addStat(15,100),e.addStat(12,1e4)}}),Cv=new mg({id:75,type:1,tags:new Set([6]),dr:1,incapacitated:!0,visualIncapacitation:!0,icon:"skills/stunBuff",fx:{stick:yp.stunned,stickOffset:.5},movementOverride:(t,e,s,i,n)=>{i.setSteer(0,0),i.setJump(0)}});const Tv={boss_flamepitDebuff:mv,blueMarble:uv,moveBoost:$v,dmgBoost:fv,incomingDmgReduce:gv,postsummon:Sv,suddendeath:new mg({id:90,maxStacks:99,icon:"skills/suddenDeath",statsStatic:(t,e)=>{e.maxStat(28,t.stacks)}}),hppotion:Mv[0],mppotion:Mv[1],stun:Cv,mount:kv,daze:pv,resetting:Ev},Iv={temperBoostBuff:Mg,temperBuff:Eg,tauntDebuff:Sg,chargeBuff:yg,warcryBuff:Cg,courageBuff:bg,armorreinforcementBuff:pg,crescentBleedDebuff:wg,crescentBleedBuff:xg,healOnBlockBuff:kg,blockBuff:fg,blockBuffEnrage:gg,specializationWarrior:$g},Pv={plaguespreaderBuff:Rg,plaguespreaderBuffPassive:Lg,agonizeDebuff:zg,spiritanimalBuff:qg,caninehowlBuff:Ug,manaBuff:Ag,revitalizeBuff:Og,specializationShaman:_g,decayBuff:Dg},Bv={extraboltBuff:nv,deepFrozenBuff:sv,iceboltBuff:lv,frozenBuff:rv,enchantmentBuff:iv,arcticauraBuff:ev,iceshieldBuff:cv,icicleBuff:dv,frostnovaBuff:av,specializationMage:hv,hypothermicBuff:ov},Fv={snipeMoveBuff:Qg,preciseshotBuff:Vg,snipeBuff:Wg,poisonarrowsBuff:jg,poisonarrowsDebuff:Jg,temporaldilationBuff:tv,pathfindingBuff:Xg,cranialpuncturesBuff:Gg,specializationArcher:Kg,serpentArrowsBuff:Yg,invigorateBuff:Hg},zv=new Map;[Tv,Iv,Pv,Bv,Fv].forEach(t=>{for(const e in t)zv.set(t[e].id,t[e])});class Uv{constructor(t){this.entity=t,this.buffs=new Map,this.casters=new Map,ug.forEach(t=>{this[t]=new Set}),this.tags=new Map;for(let t=0;t<8;++t)this.tags.set(t,new Set)}tick(t,e,s){}setBuff(t,e,s,i,n,a){s<=0&&console.error("buff with zero or less stacks");const r=this.buffs.get(t)||this.buffs.set(t,new Map).get(t),o=r.get(e)||{};if(o.caster=e,o.id=t,o.level=a,o.stacks=s,o.logic=zv.get(t),o.timer=new id(i,n),o.active=!0,o.uniqueInstances=0,o.remove=!1,void 0!==o.logic.intervalDuration){let t=i;o.interval&&(t=o.interval.start);const s=Ya.entity(e);o.interval=new id(t,o.logic.intervalHaste&&void 0!==s?o.logic.intervalDuration/hg(s.stats.getStat(16)):o.logic.intervalDuration)}else o.interval=new id(0,0);return r.set(e,o),o.logic.onSet(o,e,this),(this.casters.get(e)||this.casters.set(e,new Map).get(e)).set(t,o),o.logic.unique&&this.updateUniqueState(t),o}removeBuff(t,e){const s=this.buffs.get(t);if(s){const i=s.get(e);if(i){i.logic.onRemove(i,e,this),s.delete(e),0===s.size&&this.buffs.delete(t);const n=this.casters.get(e);return n.delete(t),0===n.size&&this.casters.delete(e),i.logic.unique&&this.updateUniqueState(t),i}}}updateUniqueState(t){const e=this.buffs.get(t);if(e){let t;e.forEach((s,i)=>{(!t||s.level>t.level)&&(t=s),s.active=!1,s.uniqueInstances=e.size}),t.active=!0}}clear(t){this.buffs.forEach((e,s)=>{e.forEach((e,i)=>{e.logic.passive==t&&this.removeBuff(s,i)})})}clearTempBuffs(){this.clear(!1)}clearPassiveBuffs(){this.clear(!0)}onDeath(){this.clearTempBuffs()}}class Dv extends Uv{constructor(t){super(t),this.stickEffects=new Map,this.effects=new Set}addEffectBuff(t,e){if(e.logic.fx.stick)if(this.stickEffects.has(t))this.stickEffects.get(t).data.buff=e;else{const s=_d(e.logic.fx.stick,this.entity.visual.transform);s.data.creature=this.entity,e.logic.fx.stickOffset&&(s.position[1]+=this.entity.radius*e.logic.fx.stickOffset/.7),s.data.time=Math.max(0,e.timer.passed(Ya.time)),s.data.buff=e,this.stickEffects.set(t,s)}this.effects.has(t)||(e.logic.fx.visual&&this.entity.visual.constructor!==e.logic.fx.visual&&this.changeEntityVisual(e.logic.fx.visual),e.logic.fx.mount&&this.changeEntityMount(e.logic.fx.mount(e),e.logic.fx.mountVisualData(e)),e.logic.fx.color&&this.entity.visual.addColor(e.logic.fx.color),this.effects.add(t))}removeEffectBuff(t,e){if(this.stickEffects.has(t)){const e=this.stickEffects.get(t);this.buffs.has(t)?e.data.buff=this.buffs.get(t).values().next().value:(e.data.remove=!0,ra(e,null),this.stickEffects.delete(t))}this.effects.has(t)&&(e.fx.visual&&this.entity.visual.constructor===e.fx.visual&&this.changeEntityVisual(),e.fx.mount&&this.changeEntityMount(),e.fx.color&&this.entity.visual.removeColor(e.fx.color),this.effects.delete(t))}setBuff(t,e,s,i,n,a,r,o){const l=super.setBuff(t,e,s,i,n,a);l.data=o,this.entity.buffDisplayDirty=!0,1!==r||l.logic.fx.norefresh||void 0===l.logic.fx.startSound||void 0===this.entity.visual||this.entity.visual.inFog||nl({...l.logic.fx.startSound,transform:this.entity.visual.transform}),this.entity.visual&&this.addEffectBuff(t,l)}removeBuff(t,e){const s=super.removeBuff(t,e);s&&(this.entity.buffDisplayDirty=!0,this.removeEffectBuff(t,s.logic),s.logic.fx.endSound&&nl({...s.logic.fx.endSound,transform:this.entity.visual.transform}))}changeEntityVisual(t){this.entity.skills.cleanUpCastingEffect();const e=this.entity.visual;this.entity.remakeTransform(t),this.entity.visual.animQueue=e.animQueue,this.stickEffects.forEach(t=>{t.data.remove=!1,ra(t,this.entity.visual.transform)})}changeEntityMount(t,e){this.entity.mount&&(this.entity.mount.onRemove(),this.entity.mount=void 0,this.entity.updateVisualPosition(0,Ya.time,Ya,!0)),t&&(this.entity.mount=new t({entity:this.entity,...e}),void 0!==e.post&&e.post(this.entity.mount),this.entity.updateTransformScale(),this.entity.updateVisualPosition(0,Ya.time,Ya,!0),this.entity.updateTransformRotation(.016),this.entity.updateMountRotation(.016))}}class Av{constructor(t){this.id=t.id||0,this.type=t.type,this.Zc=[0,0,0],this.vel=[0,0,0],this.rot=this.size=this.radius=-0,this.setSize(t.size),this.name=t.name}async init(t){this.name=t.name||""}preFixed(t,e,s){}tickFixed(t,e,s){}postFixed(t,e,s){}preDelta(t,e,s){}tickDelta(t,e,s){}postDelta(t,e,s){}onRemove(){}setPos(t){this.Zc[0]=t[0],this.Zc[1]=t[1],this.Zc[2]=t[2]}setRot(t){this.rot=kr(t)}onTarget(t){return!0}setName(t){this.name=t}clampWorldPos(){Ya.clampV3(this.Zc),this.Zc[1]=Math.max(this.Zc[1],this.getWorldYBody(Ya,this.Zc[0],this.Zc[2]))}getWorldYBody(t,e,s){return t.getHeight(e,s)}setSize(t){this.size=t,this.radius=t/2}distanceV2(t){return Ua(rr,t,Pr(or,this.Zc)),Ra(rr)}distanceV3(t){return dn(Ka,t,this.Zc),nn(Ka)}squaredDistanceV2(t){return Ua(rr,t,Pr(or,this.Zc)),La(rr)}squaredDistance(t){return dn(Ka,t,this.Zc),fn(Ka)}rotationToV2(t){return Ua(rr,t,Pr(or,this.Zc)),Oa(rr,rr),Sr(rr)}rotationToV3(t){return dn(Ka,t,this.Zc),vn(Ka,Ka),Mr(Ka)}}class Rv extends Av{constructor(t){super(t),this.hudPos=[0,0,0],this.netDeletion=new id(0,0)}handleMovementData(t,e){an(this.Zc,t.Zc),an(this.vel,t.vel)}onRemove(){this.visual&&this.visual.onRemove()}}class Lv{constructor(t){this.entity=t,this.skills=new Map,this.skillIds=[],this.timedCast=new id,this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,this.gcdEnd=0}tick(t,e,s){}add(t,e=0,s=0,i){let n=this.skills.get(t);return n=Object.assign(n||{},{level:void 0!==i?i:n?n.level+1:1,logic:Pf.get(t),cd:new id(e,s-e)}),this.skills.set(t,n),n}remove(t){this.skills.delete(t)}compileSkillIds(){this.skillIds.length=0,this.skills.forEach((t,e)=>{if(!t.logic.engineOnly)for(let s=0;s<t.level;++s)this.skillIds.push(e)})}globalCd(t,e){this.skills.forEach(s=>{s.logic.auto||s.logic.ignoreGcd||(s.cd.end<t&&(s.cd.start=t),s.cd.end<e&&(s.cd.end=e),s.cd.duration=s.cd.end-s.cd.start)}),this.gcdEnd=e}clearGlobalCd(){this.skills.forEach(t=>{t.logic.auto||t.logic.ignoreGcd||t.cd.end===this.gcdEnd&&(t.cd.end=t.cd.start,t.cd.duration=0)})}startTimedCast(t,e,s,i){this.timedCast.reset(e,i),this.timedSkill=t,this.timedTarget=s,this.entity.steer[0]=0,this.entity.steer[1]=0,this.pvpBoundModifier=Pf.get(t.id).pvpBoundsAdd}interruptTimedCast(t,e){this.timedCast.reset(0,0),this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0,e&&this.clearGlobalCd()}finishTimedCast(t){return this.interruptTimedCast(!1,!1)}onDeath(){this.interruptTimedCast(!0,!1)}clear(){}hasInstantCast(t){return this.entity.buffs.instantCast.size>0&&Array.from(this.entity.buffs.instantCast).some(e=>e.logic.instantCast.has(t))}}const Ov=new Map;class _v extends Lv{constructor(t){super(t)}tick(t,e,s){if(super.tick(t,e,s),this.isPlayer){const t=this.entity.buffs.incapacitated.size>0;this.skills.forEach((s,i)=>{const n=Ov.get(i)||Ov.set(i,new Map).get(i),a=new Map;let r=0;if(t&&!s.logic.ignoreIncapacitated?r=9:(r=s.logic.can(this.entity,s.level,this.entity.target,!0),3!==r&&4!==r||(r=s.logic.can(this.entity,s.level,this.entity.id,!0))),r!==s.status&&(s.status=r,n.get("status")!==r&&a.set("status",r)),s.cd.done(e))s.cd.icondone||(s.cd.icondone=!0,void 0!==n.get("cd")&&a.set("cd",void 0),void 0!==n.get("remaining")&&a.set("remaining",void 0));else{s.cd.icondone=!1;const t=Math.round(100-100*s.cd.fraction(e));let i=void 0;s.cd.duration>1.5&&(i=s.cd.remaining(e),i=i<=3?Math.ceil(10*i)/10:Math.ceil(i)),n.get("cd")!==t&&a.set("cd",t),n.get("remaining")!==i&&a.set("remaining",i)}a.size>0&&ye.update(t=>(a.forEach((e,i)=>{n.set(i,e),t[s.logic.id][i]=e}),t))})}this.timedSkill&&(this.entity.uiFrameDirty=!0,this.timedSkill.fx&&this.timedSkill.fx.animCast&&(!this.entity.visual.currentAnim||this.entity.visual.currentAnim.id!==this.timedSkill.fx.animCast.id)&&(this.timedCast.remaining(e)<=(void 0!==this.timedSkill.fx.animCast.pre?this.timedSkill.fx.animCast.pre:.5*this.timedSkill.fx.animCast.dur)||this.timedCast.done(e))&&(this.entity.visual.clearAnims(),this.entity.visual.anim(this.timedSkill.fx.animCast)))}add(t,e=0,s=0,i){if(super.add(t,e,s,i),this.isPlayer){this.compileSkillIds(),ye.update(e=>(e[t]={},e));const e=this.skills.get(t);e.logic.id<100&&be.update(t=>(t.indexOf(e)<0&&t.push(e),t))}}remove(t){if(this.isPlayer){this.compileSkillIds(),ye.update(e=>(e[t]=void 0,e));const e=this.skills.get(t);e&&be.update(t=>t=t.filter(t=>t!=e))}super.remove(t)}cd(t,e,s){this.skills.get(t).cd.set(e,s)}clearSkillInfo(){be.update(t=>(t.length=0,t))}startTimedCast(t,e,s,i){this.cleanUpCastingEffect(),super.startTimedCast(t,e,s,i),this.entity.uiFrameDirty=!0,this.entity.visual&&(this.timedSkill.fx&&this.timedSkill.fx.animTimedCast&&(this.entity.visual.anim({id:this.timedSkill.fx.animTimedCast.id,loop:!0,dur:i}),this.timedSkill.fx.animTimedCast.effect&&this.entity.visual.hands&&!this.entity.visual.inFog&&this.entity.visual.hands.forEach(t=>{const e=_d(this.timedSkill.fx.animTimedCast.effect);ra(e,t),t.data.timedCastEffect=e})),this.timedSkill.fx&&this.timedSkill.fx.animTimedSound&&(this.animTimedSound=nl({transform:this.entity.visual.transform,...this.timedSkill.fx.animTimedSound})))}interruptTimedCast(t,e){this.cleanUpCastingEffect(),super.interruptTimedCast(t,e),this.entity.uiFrameDirty=!0,t&&this.entity.visual&&this.entity.visual.clearAnims()}clear(){super.clear(),this.cleanUpCastingEffect()}cleanUpCastingEffect(){this.timedSkill&&(this.entity.visual&&this.entity.visual.hands&&this.entity.visual.hands.forEach(t=>{void 0!==t.data.timedCastEffect&&(t.data.timedCastEffect.data.remove=!0),t.data.timedCastEffect=void 0}),this.animTimedSound&&(this.animTimedSound.stop(),this.animTimedSound=void 0))}}class Nv{constructor(t){this.entity=t,this.alive=!0,this.stat=new Map,this.resource=new Map,this.combatTimer=new id(-1,6)}tick(t,e){this.combatTimer.start>0&&this.combatTimer.done(e)&&this.onCombatEnd(e)}die(){return!!this.alive&&(this.alive=!1,this.entity.skills.onDeath(),this.entity.buffs.onDeath(),!0)}getStat(t){return 0|this.stat.get(t)}getResource(t){return 0|this.resource.get(t)}addStat(t,e){this.stat.set(t,(0|this.stat.get(t))+e)}maxStat(t,e){this.stat.set(t,Math.max(0|this.stat.get(t),e))}multiplyStat(t,e){this.stat.set(t,(0|this.stat.get(t))*e)}setResource(t,e){const s=Math.round(gr(e,0,this.getStat(t)));return this.resource.set(t,s),s}changeResource(t,e){return this.setResource(t,this.getResource(t)+e)}respawn(){this.alive=!0,this.onCombatEnd()}clear(){}refreshCombatTimer(t,e){this.combatTimer.end<t+e&&this.combatTimer.reset(t,e)}onCombatEnd(){this.combatTimer.reset(-1)}getDamageRoll(){return Math.round((this.getStat(10)+this.getStat(11))/2)}}class Zv extends Nv{constructor(t){super(t)}setStat(t,e){this.stat.set(t,e),this.entity.statsDirty=!0,20==t?this.entity.setPrestige(e):21==t?this.entity.setElo(e):6==t||7==t?this.entity.uiFrameDirty=!0:19==t&&this.entity.inventory?this.entity.inventory.setSize(e):24==t&&this.entity.updatePvPLevel(e)}setResource(t,e){super.setResource(t,e),this.entity.uiFrameDirty=!0}die(){super.die(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.visual.onDeath()}respawn(){super.respawn(),this.entity.uiFrameDirty=!0,this.entity.visual&&this.entity.remakeTransform()}refreshCombatTimer(t,e){super.refreshCombatTimer(t,e),this.entity.uiFrameDirty=!0}onCombatEnd(){super.onCombatEnd(),this.entity.uiFrameDirty=!0}}const qv=()=>[-0,-0,-0,-0,-0,-0],Gv=qv(),Hv=(t,e)=>!(t[3]<e[0]||t[0]>e[3]||t[4]<e[1]||t[1]>e[4]||t[5]<e[2]||t[2]>e[5]),Xv=(t,e,s,i,n)=>(t[0]=e[0],t[3]=e[0]+s,t[1]=e[1],t[4]=e[1]+i,t[2]=e[2],t[5]=e[2]+n,t),jv=(t,e)=>{t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0;for(let s=0;s<e.length;++s){const i=e[s];t[0]=Math.min(t[0],i[0]),t[3]=Math.max(t[3],i[0]),t[1]=Math.min(t[1],i[1]),t[4]=Math.max(t[4],i[1]),t[2]=Math.min(t[2],i[2]),t[5]=Math.max(t[5],i[2])}return t},Jv=(t,e,s,i,n)=>(rn(Ka,e[0]-s/2,e[1]-i/2,e[2]-n/2),Xv(t,Ka,s,i,n)),Vv=(t,e,s,i,n)=>{const a=(t[0]-e[0])*s[0],r=(t[1]-e[1])*s[1],o=(t[2]-e[2])*s[2],l=(t[3]-e[0])*s[0],c=(t[4]-e[1])*s[1],d=(t[5]-e[2])*s[2],h=Math.max(i,Math.min(a,l),Math.min(r,c),Math.min(o,d)),u=Math.min(n,Math.max(a,l),Math.max(r,c),Math.max(o,d));return!(u<0||h>u)};class Yv extends Rv{constructor(t){t.spawn&&""!==t.spawn.name&&(t.name=t.spawn.name),super(t),this.stats=new Zv(this),this.buffs=new Dv(this),this.skills=new _v(this),this.steer=[0,0],this.speed=1,this.static=!1,this.jump=0,this.onGround=!0,this.weight=this.size**3,this.target=0,this.level=0,this.pvpLevel=0,this.faction=0,this.posLock=[0,0],this.posLockRadius=0,this.aabb=qv()}setAABB(){Jv(this.aabb,this.Zc,this.size,this.size,this.size)}preFixed(t,e,s){super.preFixed(t,e,s),this.buffs.tick(t,e,s),this.stats.tick(t,e),this.skills.tick(t,e,this)}getStatBasedMoveSpeed(){return Math.max(Math.min(65534,this.stats.getStat(15)))}postFixed(t,e,s){this.handlePosLock()}handlePosLock(){if(this.posLockRadius>0){Ua(or,Pr(rr,this.Zc),this.posLock);const t=Ra(or);if(t>this.posLockRadius){const e=za(or,this.posLock,Da(or,or,this.posLockRadius/t));rn(this.Zc,e[0],this.Zc[1],e[1])}}}hasMovementOverride(){return this.buffs.movementOverride.size>0}buffMovementOverride(t,e,s){this.hasMovementOverride()&&this.buffs.movementOverride.forEach(i=>{i.logic.movementOverride(t,e,s,this,i)})}combatRangeCheck(t,e){const s=this.Zc[0]-t.Zc[0],i=Math.max(0,Math.abs(this.Zc[1]-t.Zc[1])-this.radius),n=this.Zc[2]-t.Zc[2];return Math.sqrt(s*s+i*i+n*n)-(t.radius+this.radius+.5)<e}combatCylinderCheck(t,e,s){return!(this.aabb[1]>t[1]+e||this.aabb[4]<t[1]-e||Math.sqrt((t[0]-this.Zc[0])**2+(t[2]-this.Zc[2])**2)>s+this.radius)}getWorldYBody(t,e,s){return super.getWorldYBody(t,e,s)+this.radius}horizontalSteer(t,e,s){if(this.stats.alive){this.rot=s;const i=Oa(rr,e);e[1]<0&&(i[1]*=.5),Da(i,i,t/20),En(this.vel,i,s)}else this.vel[0]=0,this.vel[2]=0}setSteer(t,e){this.steer[0]=t,this.steer[1]=e}setJump(t){this.jump=t}setRot(t){super.setRot(t)}setSpeed(t){this.speed=t}setTarget(t){const e=t>0&&this.canTarget(Ya.getEntityById(t));return!1!==e&&void 0!==e?e.onTarget(this.id):this.target!==(this.target=0)}onTarget(t){return Ya.getEntityById(t).target=this.id,super.onTarget(t)}getTargetEntity(){return Ya.getEntityById(this.target)}canTarget(t){return t}setFaction(t){this.faction=t}setLevel(t){this.level=t}setClass(t){this.class=t}onRemove(){this.stats.clear(),this.buffs.clearTempBuffs(),this.buffs.clearPassiveBuffs(),this.skills.clear(),super.onRemove()}hostility(t){return(!0===Ya.mode.partyBasedHostility?t.party!==this.party:t.faction!==this.faction)?0===t.type?2:1:0}canCombatInteract(t){return!0}canSupportInteract(t){return!0}die(t,e,s){}setPosLock(t,e,s){this.posLock[0]=~~t,this.posLock[1]=~~e,this.posLockRadius=~~s}}class Wv extends Yv{constructor(t){super(t),this.uiFrameDirty=!0,this.buffDisplayDirty=!0,this.visualPosition=[0,0,0],this.speechTimer=new id(0,5),this.mount=void 0,this.mountRotAdd=0,this.namePlateScale=.5}makeTransform(){}remakeTransform(t,e){void 0!==this.visual&&(this.visual.onRemove(),this.visual=void 0),this.makeTransform(t,e),this.updateTransformScale(),this.updateTransformRotation(.016),this.updateVisualPosition(0,0,Ya,!0)}onRemove(){super.onRemove(),void 0!==this.mount&&this.mount.onRemove()}updateVisualPosition(t,e,s,i=!1){const n=pn(this.Zc,this.visualPosition);(i||n>1e-5)&&(an(this.visualPosition,this.Zc),void 0===this.mount?an(this.visual.transform.position,this.visualPosition):an(this.mount.transform.position,this.visualPosition))}updateTransformScale(){on(this.visual.transform.scale,.7*this.size),void 0!==this.mount&&on(this.mount.transform.scale,.9*this.size)}updateTransformRotation(t){if(this.stats.alive){this.updateMountRotation(t);const e=Er(this.rot+this.mountRotAdd,this.visual.transform.rotation[1]);Math.abs(e)>.01&&(this.visual.transform.rotation[1]-=e*t*20)}}updateMountRotation(t){if(void 0!==this.mount){if(this.onGround&&(0!==this.steer[0]||0!==this.steer[1])){let e=1.5*this.steer[0];0!=this.steer[1]&&(e*=.5*this.steer[1]),this.mountRotAdd-=(this.mountRotAdd-e)*t*10}this.mount.transform.rotation[1]=this.visual.transform.rotation[1]}else this.mountRotAdd=0}tickFixed(t,e,s){super.tickFixed(t,e,s)}postFixed(t,e,s){super.postFixed(t,e,s),void 0!==this.visual&&this.visual.tickFixed(t,e,s),void 0!==this.mount&&this.mount.tickFixed(t,e,s)}postDelta(t,e,s){super.postDelta(t,e,s),this.updateVisuals(t,e,s),this.updateUiParts(e)}updateVisuals(t,e,s){this.updateTransformRotation(t),this.updateVisualPosition(t,e,s),void 0!==this.mount&&(this.mount.tick(t,e,s),this.mount.mountPosition(this.visual.transform.position)),this.visual.tick(t,e,s)}updateUiParts(t){this.uiFrameDirty&&(Ya.player.target==this.id&&this.hydrateUnitStore(le),this==Ya.player?this.hydrateUnitStore(oe):Ya.party.has(this.name)&&this.hydrateUnitStore(Ya.party.get(this.name).unitStore)),(this.buffDisplayDirty||Ya.player===this||Ya.player.target===this.id)&&(Ya.player.target===this.id&&this.hydrateBuffStore(ce,Qi.buffcountUnitframes),this===Ya.player?this.hydrateBuffStore(de,Qi.buffcountUnitframes):(this.buffDisplayDirty||Ya.player.target===this.id)&&Ya.party.has(this.name)&&this.hydrateBuffStore(Ya.party.get(this.name).buffStore,Qi.buffcountParty)),void 0!==this.speechText&&this.speechTimer.done(t)&&(this.speechText=void 0)}setTarget(t){const e=this.target,s=super.setTarget(t);if(e!=this.target&&this==Ya.player&&s){const e=Ya.getEntityById(t);e?(e.hydrateUnitStore(le,Qi.buffcountUnitframes),e.hydrateBuffStore(ce,Qi.buffcountUnitframes)):le.update(t=>(t.visible=!1,t))}return s}hydrateUnitStore(t){t.update(t=>(t.visible=!0,t.name=this.name,t.alive=this.stats.alive,t.hp=this.stats.getResource(6),t.hpMax=this.stats.getStat(6),t.mp=this.stats.getResource(7),t.mpMax=this.stats.getStat(7),t.level=this.level,t.class=this.class,t.id=this.id,t.clan=this.clan,t.faction=this.faction,t.party=this.party,t.role=this.partyrole,t.type=this.type,t.combat=!this.stats.combatTimer.done(Ya.time),t.range=!0,t.powertype=2===this.faction&&void 0!==this.spawn&&(this.spawn.meta[4]||!1),t.timedSkill=this.skills.timedSkill,t.timedCast=this.skills.timedCast,t)),this.uiFrameDirty=!1}hydrateBuffStore(t,e){t.update(t=>Qv(t,this.buffs,e)),this.buffDisplayDirty=!1}speech(t,e){this.speechText=t,this.speechStyle=e,this.speechTimer.reset(Ya.time)}}const Qv=(t,e,s)=>{const i=[];e.buffs.forEach(t=>{t.forEach(t=>{t.logic.passive||Qi.buffsHideIrrelevant&&t.caster!==Ya.player.id&&(e.entity!==Ya.player||1!=t.logic.type)||t.logic.unique&&0!==i.reduce((e,s)=>e+(s.id===t.id?1:0),0)||i.push(t)})});const n=i.sort((t,e)=>e.time-t.time).sort((t,e)=>t.type-e.type).slice(0,s);if(t.length<n.length)for(;t.length<n.length;)t.push(ey());else if(t.length>n.length)for(;t.length>n.length;)sy(t.pop());return n.forEach((e,s)=>{iy(Ya.smoothtime,e,t[s])}),t};let Kv=0;const ty=[],ey=()=>ty.pop()||{id:Kv++,icon:"",type:1,time:0,duration:10,stacks:0},sy=t=>{ty.push(t)},iy=(t,e,s)=>{s.icon=`/assets/ui/${e.logic.icon}.${Po}?v=4597824`,s.type=e.logic.type,s.time=Math.min(e.timer.duration,e.timer.passed(t)),s.duration=e.timer.duration,s.stacks=e.uniqueInstances>1?e.uniqueInstances:e.stacks};class ny extends Wv{constructor(t){super(t),this.static=!0}}class ay extends ny{constructor(t){super(t),this.interactions=t.interactions,this.setDialogue(this.interactions[0].text,this.interactions[0].choices),this.remakeTransform()}interact(t){this.createInteraction()}createInteraction(){te.set({title:this.name,text:this.text,choices:this.choices})}setDialogue(t,e){this.text=t,this.choices=e}}const ry=[1600,1800,2e3,2200],oy=ry.length,ly=t=>{for(let e=0;e<oy;++e)if(ry[e]>t)return e;return Math.max(0,oy)},cy=10,dy=30,hy=240,uy=-.0015,my=930,py=100,fy=t=>cy+Math.round(Math.max(t/dy,hy*(1-Math.exp(uy*(t-my)))-py)),gy=[0,0,1,1,2,3],vy=(t,e)=>"book"+(void 0!==e?e:"")+gy[t%5],yy=(t,e,s,i)=>`/assets/items/${t}/${"book"==t?vy(e,s):t+e}_q${i}.${Po}?v=4597824`,by=t=>`/assets/ui/skills/${t}.${Po}?v=4597824`,xy=t=>`/assets/ui/slotbg/${t}.${Io}?v=4597824`,wy=t=>`/assets/ui/maps/${t}.${Po}?v=4597824`,ky=t=>`/assets/ui/classes/${t}.${Io}?v=4597824`,$y=t=>`/assets/ui/factions/${t}.${Io}?v=4597824`,Sy=t=>`/assets/ui/elo/${ly(t)}.svg?v=4597824`,My="/assets/ui/currency/medal.svg?v=4597824",Ey="/assets/ui/currency/prestige.svg?v=4597824",Cy="/assets/ui/currency/fame.svg?v=4597824",Ty=t=>`/assets/ui/rank/rank${t}.svg?v=4597824`,Iy=t=>{Pf.forEach(e=>{if(!e.engineOnly)for(let s=0;s<e.skilllevels;++s){const i=5*e.id+s;t["book"+i]={type:"book",tier:i,level:e.minlevel+8*s,skillid:e.id,skilllevel:s,class:e.class,noReward:e.noReward||!1,goldValue:e.goldValue||(e.minlevel+5*s<5?4:0),quality:Math.round(Math.min(99,30+s/5*70)),art:vy(i,e.class),useSkill:101,use:(t,s,i,n)=>{Py(t,e.id)}}}})},Py=(t,e,s)=>{},By=[{id:0,storeValue:300,quality:90,level:1,custom:["Contains one random mount of rare or epic quality"]}],Fy=t=>{By.forEach(e=>{t["box"+e.id]={...e,type:"box",tier:e.id,unsellable:!0,useSkill:103,use:(t,e,s,i)=>{}}})},zy=t=>{for(const e in jo)if(jo[e].tiers){const s=jo[e];for(let i=0;i<s.tiers;++i)Dy({type:e,tier:i,stats:s.stats,level:Uy(e,i),class:s.class,quality:s.quality},t)}},Uy=(t,e)=>jo[t].baselvl+Math.floor(e/jo[t].tiers*100),Dy=(t,e)=>{const s={level:t.level,type:t.type,tier:t.tier,stats:t.stats?new Map:void 0,class:t.class,quality:t.quality};t.stats&&Object.keys(t.stats).sort((t,e)=>t-e).forEach(e=>{const i=t.stats[e];s.stats.set(parseInt(e),{min:i.base+t.level*i.min,max:i.base+(t.level+10)*i.max})}),e[t.type+t.tier]=s},Ay=t=>{const e=[250,100,500,200,1e3,300];for(let s=0;s<6;++s){const i=Math.floor(s/2),n=s%2==0;t["misc"+s]={type:"misc",tier:s,level:1+20*i,goldvalue:5**i,quality:15,custom:[e[s]+(n?" HP recovered":" MP recovered")],useSkill:100,use:(t,e,s,i)=>{}}}},Ry={};zy(Ry),Ay(Ry),Iy(Ry),wv(Ry),ff(Ry),Fy(Ry);const Ly=Object.values(Ry);Ly.forEach((t,e)=>t.logicId=e);const Oy=[];for(const t in Ry){const e=Ry[t];"book"===e.type&&0===e.skilllevel?Oy.push({item:e,stacks:1}):"misc"===e.type?Oy.push({item:e,stacks:5}):"box"===e.type?Oy.push({item:e,bind:1,rolls:!0,maxquality:0}):"mount"===e.type&&e.tier<2?Oy.push({item:e,rolls:!0,maxquality:0,bind:1}):"charm"===e.type&&Oy.push({item:e,rolls:!0,maxquality:0,bind:2})}class _y extends ay{constructor(t){super({type:8,size:1.2,name:"Trader",...t}),this.items=Oy}}const Ny=[{step:10,fun:()=>fl.fwd.down||fl.left.down||fl.right.down},{step:10,fun:()=>fl.lmb.down||fl.rmb.down,click:!0},{click:!0},{element:"ufplayer",click:!0},{},{element:"uftarget",click:!0},{element:"sk1"},{},{click:!0},{element:"expbar",click:!0},{},{element:"sysbag",step:100,fun:()=>Qi.inventoryOpen},{element:"bag2",click:!0},{click:!0},{element:"syschar",step:100,fun:()=>Qi.charpanelOpen},{element:"equipslots",click:!0},{fixed:()=>Ya.player.stats.getStat(22)>0?100:Math.round(Ya.player.exp/zf(Ya.player.level)*100)},{element:"syschar",step:100,fun:()=>Qi.charpanelOpen},{element:"statpoints"},{step:100,fixed:()=>Math.round(Ya.player.exp/zf(Ya.player.level)*100),fun:()=>Ya.player.level>3},{click:!0},{fixed:()=>Math.round(Ya.player.inventory.gold/32*100)},{fun:()=>Qi.traderWindow},{element:()=>"trader"+Oy.findIndex(t=>"book"===t.item.type&&3===t.item.level&&t.item.class===Ya.player.class)},{element:"bag0",click:!0},{element:"sysbook",step:100,fun:()=>Qi.skillmenuOpen},{element:"skilllist",click:!0},{element:"skillbar",click:!0},{click:!0},{click:!0},{click:!0},{click:!0,element:"partybtn"},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{element:"chat"},{element:"chatinput"},{element:"syscog",step:100,click:!0,fun:()=>Qi.settingsOpen},{click:!0},{step:100,fun:()=>!Qi.settingsOpen},{click:!0},{click:!0},{gate:()=>Ya.player.level>=25,click:!0}];let Zy=!1;const qy=()=>{Hy.reset(Ya.smoothtime),Zy||(Zy=!0,As.subscribe(t=>{const e=Ny[t];e&&(void 0===e.gate||e.gate())?Ie.set(Gy(t)):Ie.set()}))},Gy=t=>(nl({id:"ui/event1",pitch:-1}),{...Ny[t],msg:tn.ui.tutorial.msg[t],uH:0}),Hy=new id(0,.2),Xy=()=>{const t=Ny[Qi.tutprogress];t&&Hy.done(Ya.smoothtime)&&(Hy.reset(Ya.smoothtime),(void 0===t.gate||t.gate())&&(t.gate&&t.gate()&&jy(Qi.tutprogress,void 0,1),t.fun&&t.fun()&&jy(Qi.tutprogress,t.step),t.fixed&&jy(Qi.tutprogress,void 0,t.fixed())))},jy=(t,e,s)=>!(!(s||e>0)||-1!==t&&Qi.tutprogress!==t)&&(Ie.update(i=>i?(i.uH=Math.min(100,s||i.uH+e),i.complete=i.uH>=100,i.complete&&!i.closing&&(i.closing=!0,nl({id:"ui/event2",gain:.4,pitch:-1}),setTimeout(()=>{Ie.set(),setTimeout(()=>{As.update(t=>(Bf("tutorial","completestep",t,Math.round(performance.now()/1e3)),Ny[t+1]&&Ny[t+1].element&&"string"!=typeof Ny[t+1].element&&(Ny[t+1].element=Ny[t+1].element()),t+1))},100)},1e3)),i):Gy(t)),!0);var Jy=Object.freeze({__proto__:null,steps:Ny,onWorldEnter:qy,postTick:Xy,tut:jy});const Vy={partyleave:t=>({name:tn.ui.party.leave,fun:()=>{Jm("partyleave")}}),partyinvite:t=>({name:tn.ui.party.invite,fun:()=>{Jm("partyinvite",t)}}),partykick:t=>({name:tn.ui.party.kick,fun:()=>{Jm("partykick",t)}}),partygiveassistant:t=>({name:tn.ui.party.giveAssistant,fun:()=>{Jm("partysetrole",t+" 1")}}),partygiveleader:t=>({name:tn.ui.party.giveLeader,fun:()=>{Jm("partysetrole",t+" 2")}}),partyremoveassistant:t=>({name:tn.ui.party.removeAssistant,fun:()=>{Jm("partysetrole",t+" 0")}}),partylink:t=>({name:tn.ui.party.link,fun:()=>{Jm("partylink")}}),partycreate:t=>({name:tn.ui.party.create,fun:()=>{Jm("partycreate")}}),whisper:t=>({name:tn.ui.chat.whisper,fun:()=>{cs.set(t)}}),itemdrop:(...t)=>({name:tn.ui.inventory.drop,fun:()=>Ky(...t)}),itemsell:(...t)=>({name:tn.ui.inventory.sell,fun:()=>Qy(...t)}),itemstash:t=>({name:tn.ui.stash.stash,fun:()=>{Jm("itemstash",t)}}),itemmove:(t,e)=>({name:tn.ui.inventory.equip,fun:()=>{jy(13,100),Jm("itemmove",`${t} ${e}`)}}),itemsplithalf:t=>({name:tn.ui.inventory.splithalf,fun:()=>{Jm("itemsplithalf",t)}}),itemsplitone:t=>({name:tn.ui.inventory.splitone,fun:()=>{Jm("itemsplitone",t)}}),itemuse:(t,e)=>({name:Pf.get(e).name||tn.ui.inventory.use,fun:()=>{fm(mo.clientPlayerSkill.packData({id:e,info:[t]}))}}),itemcopyid:t=>({name:tn.ui.inventory.copyitemid,fun:()=>{Wm(t)}}),startqueue:(t,e)=>({name:ep[t].name,css:e?"":"disabled",fun:()=>{Jm("startqueue",t)}}),stopqueue:(t,e)=>({icon:"check",name:ep[t].name,css:e?"":"disabled",fun:()=>{Jm("stopqueue",t)}}),report:(t,e,s)=>({name:"Report",fun:i=>{Ee.set({name:t,reason:0,messageId:e,info:s})}})},Yy=(t,e)=>{const s=[{name:e.name,css:"disabled"}];0===e.type&&(e.id==Ya.player.id?Qi.partyinfo.membercount>0?s.push(Vy.partyleave()):s.push(Vy.partycreate()):(e.faction==Ya.player.faction&&(Ya.party.has(e.name)?Qi.partyinfo.role>e.role&&(2==Qi.partyinfo.role&&s.push(Vy.partykick(e.name)),0==e.role?s.push(Vy.partygiveassistant(e.name)):1==e.role&&s.push(Vy.partyremoveassistant(e.name)),Qi.partyinfo.role>1&&s.push(Vy.partygiveleader(e.name))):s.push(Vy.partyinvite(e.name))),s.push(Vy.report(e.name)),s.push(Vy.whisper(e.name)))),Wt.set({x:t.pageX,y:t.pageY,opts:s})},Wy=(t,e,s,i,n,a,r,o)=>{tp(e>=Qi.itemProtectQuality||s>0,t,i,r,`${o} ${en(n,a)}?`)},Qy=(t,e,s,i,n)=>{Wy("itemtradersell",t,e,s,i,n,"Sell item","Really sell")},Ky=(t,e,s,i,n)=>{Wy("itemdrop",t,e,s,i,n,"Drop item","Really drop")};function tb(t){let e,s;return{c(){e=B("img"),A(e,"class","icon svelte-erbdzy"),e.src!==(s="/assets/ui/icons/gem.svg?v=4597824")&&A(e,"src",s)},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function eb(t){let e,s,n,a,r,o,l,c,d=t[4]&&tb();return{c(){e=B("span"),d&&d.c(),s=B("img"),a=F(t[1]),r=z(),o=B("span"),l=F(t[0]),A(s,"class","icon svelte-erbdzy"),s.src!==(n=ky(t[2]))&&A(s,"src",n),A(e,"class","textwhite"),A(o,"class",c="name textf"+t[3]+" svelte-erbdzy")},m(t,i){T(t,e,i),d&&d.m(e,null),C(e,s),C(e,a),C(e,r),T(t,o,i),C(o,l)},p(t,[i]){t[4]?d||(d=tb(),d.c(),d.m(e,s)):d&&(d.d(1),d=null),4&i&&s.src!==(n=ky(t[2]))&&A(s,"src",n),2&i&&O(a,t[1]),1&i&&O(l,t[0]),8&i&&c!==(c="name textf"+t[3]+" svelte-erbdzy")&&A(o,"class",c)},i:i,o:i,d(t){t&&I(e),d&&d.d(),t&&I(o)}}}function sb(t,e,s){let{name:i}=e,{level:n}=e,{pclass:a}=e,{faction:r}=e,{sub:o=!1}=e;return t.$$set=t=>{"name"in t&&s(0,i=t.name),"level"in t&&s(1,n=t.level),"pclass"in t&&s(2,a=t.pclass),"faction"in t&&s(3,r=t.faction),"sub"in t&&s(4,o=t.sub)},[i,n,a,r,o]}class ib extends Ht{constructor(t){super(),Gt(this,t,sb,eb,d,{name:0,level:1,pclass:2,faction:3,sub:4})}}const{Map:nb}=zt;function ab(t,e,s){const i=t.slice();return i[31]=e[s],i}function rb(t,e,s){const i=t.slice();return i[34]=e[s],i}function ob(t,e,s){const i=t.slice();return i[37]=e[s],i}function lb(t){let e,s,i,n,a;function r(...e){return t[13](t[37],...e)}function o(...e){return t[14](t[37],...e)}return s=new ib({props:{name:t[37].sender,pclass:t[37].cclass,level:t[37].level,faction:t[37].faction,sub:t[37].sub}}),{c(){e=B("span"),_t(s.$$.fragment),A(e,"class","sender svelte-1jc1d13")},m(t,l){T(t,e,l),Nt(s,e,null),i=!0,n||(a=[D(e,"contextmenu",r),D(e,"dblclick",o)],n=!0)},p(e,i){t=e;const n={};64&i[0]&&(n.name=t[37].sender),64&i[0]&&(n.pclass=t[37].cclass),64&i[0]&&(n.level=t[37].level),64&i[0]&&(n.faction=t[37].faction),64&i[0]&&(n.sub=t[37].sub),s.$set(n)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s),n=!1,l(a)}}}function cb(t){let e,s,i,n=t[37].text+"";return{c(){e=B("span"),s=F(n),A(e,"class",i="text"+t[37].channel+" svelte-1jc1d13")},m(t,i){T(t,e,i),C(e,s)},p(t,a){64&a[0]&&n!==(n=t[37].text+"")&&O(s,n),64&a[0]&&i!==(i="text"+t[37].channel+" svelte-1jc1d13")&&A(e,"class",i)},d(t){t&&I(e)}}}function db(t){let e,s,i=t[37].text+"";return{c(){e=B("span"),A(e,"class",s="text"+t[37].channel+" svelte-1jc1d13")},m(t,s){T(t,e,s),e.innerHTML=i},p(t,n){64&n[0]&&i!==(i=t[37].text+"")&&(e.innerHTML=i),64&n[0]&&s!==(s="text"+t[37].channel+" svelte-1jc1d13")&&A(e,"class",s)},d(t){t&&I(e)}}}function hb(t,e){let s,i,n,a,r,o,l,c,d,h,u=e[37].time+"",m=e[37].channel+"",p=e[37].sender&&lb(e);function f(t,e){return t[37].interpolate?db:cb}let g=f(e),v=g(e);return{key:t,first:null,c(){s=B("article"),i=B("div"),n=B("span"),a=F(u),r=B("span"),o=B("span"),l=F(m),c=z(),p&&p.c(),v.c(),A(n,"class","time svelte-1jc1d13"),A(o,"class","capitalize channel svelte-1jc1d13"),A(r,"class",d="text"+e[37].channel+" content svelte-1jc1d13"),A(i,"class","linewrap svelte-1jc1d13"),A(s,"class","line svelte-1jc1d13"),this.first=s},m(t,e){T(t,s,e),C(s,i),C(i,n),C(n,a),C(i,r),C(r,o),C(o,l),C(r,c),p&&p.m(r,null),v.m(i,null),h=!0},p(t,e){(!h||64&e[0])&&u!==(u=t[37].time+"")&&O(a,u),(!h||64&e[0])&&m!==(m=t[37].channel+"")&&O(l,m),t[37].sender?p?(p.p(t,e),64&e[0]&&Tt(p,1)):(p=lb(t),p.c(),Tt(p,1),p.m(r,null)):p&&(Et(),It(p,1,1,()=>{p=null}),Ct()),(!h||64&e[0]&&d!==(d="text"+t[37].channel+" content svelte-1jc1d13"))&&A(r,"class",d),g===(g=f(t))&&v?v.p(t,e):(v.d(1),v=g(t),v&&(v.c(),v.m(i,null)))},i(t){h||(Tt(p),h=!0)},o(t){It(p),h=!1},d(t){t&&I(s),p&&p.d(),v.d()}}}function ub(t){let e,s,i,n,a,r,o=t[34]+"";function l(...e){return t[16](t[34],...e)}return{c(){e=B("div"),s=F("/"),i=F(o),A(e,"class",n="choice textsystem text"+t[34]+" svelte-1jc1d13")},m(t,n){T(t,e,n),C(e,s),C(e,i),a||(r=D(e,"click",l),a=!0)},p(e,s){t=e},d(t){t&&I(e),a=!1,r()}}}function mb(t){let e,s,i,n,a,r=t[31]+"";function o(...e){return t[20](t[31],...e)}return{c(){e=B("small"),s=F(r),A(e,"class",i="btn border black text"+(t[5].indexOf(t[31])<0?t[31]:"grey")+" svelte-1jc1d13")},m(t,i){T(t,e,i),C(e,s),n||(a=D(e,"click",o),n=!0)},p(s,n){t=s,32&n[0]&&i!==(i="btn border black text"+(t[5].indexOf(t[31])<0?t[31]:"grey")+" svelte-1jc1d13")&&A(e,"class",i)},d(t){t&&I(e),n=!1,a()}}}function pb(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b=[],x=new nb,w=t[6];const k=t=>t[37].key;for(let e=0;e<w.length;e+=1){let s=ob(t,w,e),i=k(s);x.set(i,b[e]=hb(i,s))}let $=Object.keys(Vm),S=[];for(let e=0;e<$.length;e+=1)S[e]=ub(rb(t,$,e));let M=t[12],E=[];for(let e=0;e<M.length;e+=1)E[e]=mb(ab(t,M,e));return{c(){e=B("div"),s=B("section");for(let t=0;t<b.length;t+=1)b[t].c();i=B("div"),n=B("section"),a=B("div"),r=B("div");for(let t=0;t<S.length;t+=1)S[t].c();o=B("div"),o.textContent="/[playername]",c=B("div"),d=F(t[4]),u=B("input"),p=B("div");for(let t=0;t<E.length;t+=1)E[t].c();A(s,"id","chat"),A(s,"class","panel frame scrollbar svelte-1jc1d13"),A(o,"class","choice textwhisper"),A(r,"class","panel context commandlist textsystem svelte-1jc1d13"),N(r,"display",t[3]?"block":"none"),A(c,"class",h="command btn black text"+(Ym[t[4]]?Ym[t[4]].chat?t[4]:"system":"whisper")+" svelte-1jc1d13"),A(u,"maxlength","480"),A(u,"type","text"),A(u,"class","svelte-1jc1d13"),A(a,"id","chatinput"),A(a,"class","inputcontainer panel-black border black svelte-1jc1d13"),A(n,"class",m="chatsection "+(t[2]?"":"hidden")+" svelte-1jc1d13"),A(p,"class",f="channelselect "+(t[2]?"hidden":"")+" svelte-1jc1d13"),A(i,"class","lowercontainer svelte-1jc1d13"),A(e,"class","l-corner-ll container uiscaled svelte-1jc1d13")},m(l,h){T(l,e,h),C(e,s);for(let t=0;t<b.length;t+=1)b[t].m(s,null);t[15](s),C(e,i),C(i,n),C(n,a),C(a,r);for(let t=0;t<S.length;t+=1)S[t].m(r,null);C(r,o),C(a,c),C(c,d),C(a,u),t[18](u),C(i,p);for(let t=0;t<E.length;t+=1)E[t].m(p,null);g=!0,v||(y=[D(c,"click",t[17]),D(u,"input",t[19])],v=!0)},p(t,e){if(2368&e[0]){const i=t[6];Et(),b=At(b,e,k,1,t,i,x,s,Dt,hb,null,ob),Ct()}if(512&e[0]){let s;for($=Object.keys(Vm),s=0;s<$.length;s+=1){const i=rb(t,$,s);S[s]?S[s].p(i,e):(S[s]=ub(i),S[s].c(),S[s].m(r,o))}for(;s<S.length;s+=1)S[s].d(1);S.length=$.length}if((!g||8&e[0])&&N(r,"display",t[3]?"block":"none"),(!g||16&e[0])&&O(d,t[4]),(!g||16&e[0]&&h!==(h="command btn black text"+(Ym[t[4]]?Ym[t[4]].chat?t[4]:"system":"whisper")+" svelte-1jc1d13"))&&A(c,"class",h),(!g||4&e[0]&&m!==(m="chatsection "+(t[2]?"":"hidden")+" svelte-1jc1d13"))&&A(n,"class",m),5152&e[0]){let s;for(M=t[12],s=0;s<M.length;s+=1){const i=ab(t,M,s);E[s]?E[s].p(i,e):(E[s]=mb(i),E[s].c(),E[s].m(p,null))}for(;s<E.length;s+=1)E[s].d(1);E.length=M.length}(!g||4&e[0]&&f!==(f="channelselect "+(t[2]?"hidden":"")+" svelte-1jc1d13"))&&A(p,"class",f)},i(t){if(!g){for(let t=0;t<w.length;t+=1)Tt(b[t]);g=!0}},o(t){for(let t=0;t<b.length;t+=1)It(b[t]);g=!1},d(s){s&&I(e);for(let t=0;t<b.length;t+=1)b[t].d();t[15](null),P(S,s),t[18](null),P(E,s),v=!1,l(y)}}}function fb(t,e,s){let i,n,a,r;p(t,re,t=>s(24,i=t)),p(t,cs,t=>s(4,n=t)),p(t,Ns,t=>s(5,a=t));let o,l=!0;et(()=>{l=r&&(r.offsetHeight+r.scrollTop>r.scrollHeight-20||0==r.scrollTop)}),it(()=>{!1!==l&&r.scrollTo(0,r.scrollHeight)});let c=!1,d=[],h=0,u=!1,m="global";const f=new Map([["c","clan"],["p","party"],["g","global"],["f","faction"]]),g=t=>{const e=t.match(/^\/[a-zA-Z0-9]+ /g);if(e){const a=e[0].substring(1,e[0].length-1);if("r"===a||"w"===a)for(let t=i.length-1;t>0;--t){const e=i[t];"from"==e.channel&&(x(cs,n=e.sender),t=0)}else x(cs,n=f.has(a)?f.get(a):a);s(1,o.value=t.substring(e[0].length),o)}},v=t=>Ym[t]&&Ym[t].chat,y=t=>{if(13===t.keyCode)if(t.target==o){if(""!=t.target.value){jy(39,100);const e=t.target.value.match(/^\/[a-zA-Z0-9]+/g);e&&(x(cs,n=e[0].substring(1)),s(1,o.value="",o)),void 0!==Vm[n]&&Vm[n].client?Vm[n].fun(o.value):Jm(n,o.value);const i=`/${n} `+o.value;d[d.length-1]!=i&&(h=d.push(i)),s(1,o.value="",o),s(2,c=!1),o.blur()}else v(n)||Jm(n,o.value),s(2,c=!1),o.blur();v(n)?m=n:x(cs,n=m)}else document.activeElement==document.body&&w();else 38!==t.keyCode&&40!==t.keyCode||!d.length?27===t.keyCode&&(s(2,c=!1),o.blur()):t.target==o&&(h+=38===t.keyCode?-1:1,h=gr(h,0,d.length-1),g(d[h]),t.preventDefault())},b=t=>{o&&o.focus()},w=t=>{t&&x(cs,n=t),s(2,c=!0),pt().then(b),jy(38,100)},k=t=>{x(cs,n=t),s(3,u=!1),o&&o.focus()};st(()=>{document.addEventListener("keydown",y)}),nt(()=>{document.removeEventListener("keydown",y),s(1,o=void 0)});const $=t=>{const e=a.indexOf(t);Ns.update(s=>(e>=0?s.splice(e,1):s.push(t),s))},S=(t,e)=>{const s=[{name:e.sender,css:"disabled"}];Ya.player.name!==e.sender&&(e.faction!=Ya.player.faction||Ya.party.has(e.sender)||s.push(Vy.partyinvite(e.sender)),"to"!==e.channel&&s.push(Vy.report(e.sender,e.id,`Message: ${e.text.length>40?e.text.substring(0,37)+"...":e.text}`)),s.push({name:"Whisper",fun:t=>{w(e.sender)}})),Wt.set({x:t.pageX,y:t.pageY,opts:s}),t.preventDefault()},M=["global","faction","party","clan","pvp","inv"],E=(t,e)=>S(e,t),C=(t,e)=>{w(t.sender)};function T(t){lt[t?"unshift":"push"](()=>{r=t,s(0,r)})}const I=(t,e)=>k(t),P=t=>s(3,u=!u);function B(t){lt[t?"unshift":"push"](()=>{o=t,s(1,o)})}const F=t=>g(t.target.value),z=(t,e)=>$(t);let U;return t.$$.update=()=>{16777248&t.$$.dirty[0]&&s(6,U=i.filter(t=>a.indexOf(t.channel)<0))},[r,o,c,u,n,a,U,g,w,k,$,S,M,E,C,T,I,P,B,F,z]}class gb extends Ht{constructor(t){super(),Gt(this,t,fb,pb,d,{},[-1,-1])}}function vb(t){let e,s;return{c(){e=B("img"),e.src!==(s="/assets/ui/icons/"+t[1]+".svg?v=4597824")&&A(e,"src",s),A(e,"class","titleicon svgicon svelte-1rw636")},m(t,s){T(t,e,s)},p(t,i){2&i&&e.src!==(s="/assets/ui/icons/"+t[1]+".svg?v=4597824")&&A(e,"src",s)},d(t){t&&I(e)}}}function yb(t){let e,s,n,a;return{c(){e=B("img"),e.src!==(s="/assets/ui/icons/cross.svg?v=4597824")&&A(e,"src",s),A(e,"class","btn black svgicon")},m(s,i){T(s,e,i),n||(a=D(e,"click",t[7]),n=!0)},p:i,d(t){t&&I(e),n=!1,a()}}}function bb(t){let e,s,i,n,a,r,o,l,c=t[1]&&vb(t),d=t[2]&&yb(t);const h=t[6].default,u=f(h,t,t[5],null);return{c(){e=B("div"),s=B("div"),c&&c.c(),i=B("div"),n=B("div"),a=F(t[0]),d&&d.c(),r=B("div"),u&&u.c(),A(n,"name","title"),A(i,"class","textprimary title svelte-1rw636"),A(s,"class","titleframe svelte-1rw636"),A(r,"class",o="slot "+(t[3]?"scrollbar":"")+" svelte-1rw636"),A(e,"class","window panel-black svelte-1rw636")},m(t,o){T(t,e,o),C(e,s),c&&c.m(s,null),C(s,i),C(i,n),C(n,a),d&&d.m(s,null),C(e,r),u&&u.m(r,null),l=!0},p(t,[e]){t[1]?c?c.p(t,e):(c=vb(t),c.c(),c.m(s,i)):c&&(c.d(1),c=null),(!l||1&e)&&O(a,t[0]),t[2]?d?d.p(t,e):(d=yb(t),d.c(),d.m(s,null)):d&&(d.d(1),d=null),u&&u.p&&32&e&&y(u,h,t,t[5],e,null,null),(!l||8&e&&o!==(o="slot "+(t[3]?"scrollbar":"")+" svelte-1rw636"))&&A(r,"class",o)},i(t){l||(Tt(u,t),l=!0)},o(t){It(u,t),l=!1},d(t){t&&I(e),c&&c.d(),d&&d.d(),u&&u.d(t)}}}function xb(t,e,s){const i=at();let{title:n="Title"}=e,{icon:a}=e,{close:r=!0}=e,{scroll:o=!1}=e,{$$slots:l={},$$scope:c}=e;const d=()=>i("close");return t.$$set=t=>{"title"in t&&s(0,n=t.title),"icon"in t&&s(1,a=t.icon),"close"in t&&s(2,r=t.close),"scroll"in t&&s(3,o=t.scroll),"$$scope"in t&&s(5,c=t.$$scope)},[n,a,r,o,i,c,l,d]}class wb extends Ht{constructor(t){super(),Gt(this,t,xb,bb,d,{title:0,icon:1,close:2,scroll:3})}}const kb=t=>{const e=(t||0).toString().split("");return{c:e.splice(-2).join(""),s:e.splice(-2).join(""),g:e.join("")}},$b=t=>t>1e3?(t/1e3).toFixed(1)+"k":t+"",Sb=t=>t>1e3?Math.round(t/1e3)+"k":t+"",Mb=t=>t<1e3?t+"":Mb(~~(t/1e3))+","+("00"+~~(t%1e3)).substr(-3,3),Eb=(t,e)=>t.length>e?t.slice(0,e-2)+"...":t,Cb=Uf({14:.1,13:.1,9:.1,8:.1,16:.1}),Tb=Uf({14:"%",13:"%",16:"%",18:"%"}),Ib=(t,e)=>(Cb.has(t)&&(e=(e*=Cb.get(t)).toFixed(e>=.1?1:2)),e+(Tb.get(t)||"")),Pb=t=>t.replace(/\$e(\d+)/g,(t,e)=>Db(e)),Bb=t=>t.replace(/\$g(\d+)/g,(t,e)=>zb(e,!1)),Fb=t=>t.replace(/\$m(\d+)/g,(t,e)=>Ub(e,!1)),zb=(t,e=!1)=>{const{c:s,s:i,g:n}=kb(t);let a="<span/>";return""!=n&&(a+=`<span class=${e?"textred":"textgold"}>${n}</span> <img class=texticon src='/assets/ui/currency/gold.${Io}?v=4597824'/>`),""!=i&&(a+=`<span class=${e?"textred":"textsilver"}>${i}</span> <img class=texticon src='/assets/ui/currency/silver.${Io}?v=4597824'/>`),""!=s&&(a+=`<span class=${e?"textred":"textcopper"}>${s}</span> <img class=texticon src='/assets/ui/currency/copper.${Io}?v=4597824'/>`),a+"</span>"},Ub=(t,e=!1)=>`<span class='${e?"textred":"textgold"}'><img class='svgicon' src='${My}'> ${Mb(t)}</span>`,Db=t=>`<span class='bold textpvp'><img class='svgicon' src='${Sy(t)}'> ${Mb(t)}</span>`,Ab=(t,e)=>`<span class='bold textprimary'><img class='svgicon' src='${Ty(t)}'> ${e}</span>`,Rb=[t=>t.replace(/\$c(\d)/g,(t,e)=>`<img class=texticon src='${ky(e)}'>`),t=>t.replace(/\$l(\d+)/g,(t,e)=>`<span class=textwhite>${e}</span>`),t=>t.replace(/\$f(\d)(\w*)/g,(t,e,s)=>`<span class=textf${e}>${s}</span>`),Bb,t=>t.replace(/\$fm(\d+)/g,(t,e)=>`<span class=textfame><img class=svgicon src='/assets/ui/currency/fame.svg?v=4597824'> ${e}</span>`),t=>t.replace(/\$gt/g,(t,e)=>'<img class="svgicon" src="/assets/ui/icons/check.svg?v=4597824">'),t=>t.replace(/\$sp(\d+)/g,(t,e)=>"<img class=texticon src=/assets/ui/icons/gem.svg?v=4597824/>"+e),Fb,Pb],Lb=t=>Rb.reduce((t,e)=>e(t),t);function Ob(t,e,s){const i=t.slice();return i[4]=e[s],i[6]=s,i}function _b(t){let e,s,i;return s=new wb({props:{title:"Interaction",$$slots:{default:[Zb]},$$scope:{ctx:t}}}),s.$on("close",t[3]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","l-upperLeftModal container uiscaled svelte-uxs0uj")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};129&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function Nb(t){let e,s,i,n,a,r=Lb(t[4])+"";function o(...e){return t[2](t[6],...e)}return{c(){e=B("div"),s=B("span"),A(e,"class","choice"),A(e,"value",i=t[6])},m(t,i){T(t,e,i),C(e,s),s.innerHTML=r,n||(a=D(e,"click",o),n=!0)},p(e,i){t=e,1&i&&r!==(r=Lb(t[4])+"")&&(s.innerHTML=r)},d(t){t&&I(e),n=!1,a()}}}function Zb(t){let e,s,i,n,a,r=t[0].title+"",o=t[0].text+"",l=t[0].choices,c=[];for(let e=0;e<l.length;e+=1)c[e]=Nb(Ob(t,l,e));return{c(){e=B("div"),s=B("h3"),i=F(r),n=B("p"),a=F(o);for(let t=0;t<c.length;t+=1)c[t].c();A(s,"class","textprimary name svelte-uxs0uj"),A(e,"class","container svelte-uxs0uj")},m(t,r){T(t,e,r),C(e,s),C(s,i),C(e,n),C(n,a);for(let t=0;t<c.length;t+=1)c[t].m(e,null)},p(t,s){if(1&s&&r!==(r=t[0].title+"")&&O(i,r),1&s&&o!==(o=t[0].text+"")&&O(a,o),3&s){let i;for(l=t[0].choices,i=0;i<l.length;i+=1){const n=Ob(t,l,i);c[i]?c[i].p(n,s):(c[i]=Nb(n),c[i].c(),c[i].m(e,null))}for(;i<c.length;i+=1)c[i].d(1);c.length=l.length}},d(t){t&&I(e),P(c,t)}}}function qb(t){let e,s,i=t[0]&&_b(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),1&s&&Tt(i,1)):(i=_b(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function Gb(t,e,s){let i;function n(t){fm(mo.clientPlayerInteract.packData({id:t})),x(te,i=void 0)}p(t,te,t=>s(0,i=t));const a=(t,e)=>n(t),r=()=>{x(te,i=void 0)};return[i,n,a,r]}class Hb extends Ht{constructor(t){super(),Gt(this,t,Gb,qb,d,{})}}function Xb(t){let e,s,i,n,a,r,o,l,c;const d=t[7].default,h=f(d,t,t[6],null);return{c(){e=B("div"),s=B("div"),i=B("span"),n=F(t[0]),a=B("span"),r=F(t[1]),h&&h.c(),A(i,"class","left svelte-i7i7g5"),A(a,"class","right svelte-i7i7g5"),A(s,"class",o="progressBar "+t[3]+" svelte-i7i7g5"),N(s,"width",t[2]+"%"),N(s,"font-size",t[4]),A(e,"class",l="bar "+(t[5]?"dark":"")+" svelte-i7i7g5"),N(e,"z-index","hp"==t[3]?"1":"0")},m(t,o){T(t,e,o),C(e,s),C(s,i),C(i,n),C(s,a),C(a,r),h&&h.m(e,null),c=!0},p(t,[i]){(!c||1&i)&&O(n,t[0]),(!c||2&i)&&O(r,t[1]),(!c||8&i&&o!==(o="progressBar "+t[3]+" svelte-i7i7g5"))&&A(s,"class",o),(!c||4&i)&&N(s,"width",t[2]+"%"),(!c||16&i)&&N(s,"font-size",t[4]),h&&h.p&&64&i&&y(h,d,t,t[6],i,null,null),(!c||32&i&&l!==(l="bar "+(t[5]?"dark":"")+" svelte-i7i7g5"))&&A(e,"class",l),(!c||8&i)&&N(e,"z-index","hp"==t[3]?"1":"0")},i(t){c||(Tt(h,t),c=!0)},o(t){It(h,t),c=!1},d(t){t&&I(e),h&&h.d(t)}}}function jb(t,e,s){let{left:i=""}=e,{right:n=""}=e,{fract:a}=e,{barcol:r}=e,{size:o}=e,{darken:l}=e,{$$slots:c={},$$scope:d}=e;return t.$$set=t=>{"left"in t&&s(0,i=t.left),"right"in t&&s(1,n=t.right),"fract"in t&&s(2,a=t.fract),"barcol"in t&&s(3,r=t.barcol),"size"in t&&s(4,o=t.size),"darken"in t&&s(5,l=t.darken),"$$scope"in t&&s(6,d=t.$$scope)},[i,n,a,r,o,l,d,c]}class Jb extends Ht{constructor(t){super(),Gt(this,t,jb,Xb,h,{left:0,right:1,fract:2,barcol:3,size:4,darken:5})}}const Vb=new Map;let Yb=!1;const Wb=()=>{fetch("/assets/ui/circlecooldowns/circlecooldowns.txt?v=4597824").then(async t=>{const e=(await t.text()).split("\n");for(let t=0;t<3;++t){const s=[];for(let t=0;t<101;++t){const t=new Image;t.src=e.shift(),s.push([t])}Vb.set([40,31,23][t],s)}Yb=!0})},Qb=(t,e,s)=>{Yb&&e&&t!==e.step&&(void 0!==e.cdimg&&(Vb.get(s)[e.step].push(e.removeChild(e.cdimg)),e.cdimg=void 0),(e.step=t)>0&&(1===Vb.get(s)[e.step].length?e.cdimg=Vb.get(s)[e.step][0].cloneNode():e.cdimg=Vb.get(s)[e.step].pop(),e.appendChild(e.cdimg)))};var Kb=Object.freeze({__proto__:null,init:Wb,updateCd:Qb});function tx(t){let e,s,i=(t[4]>99?Math.round(t[4]/60)+"'":Math.ceil(t[4]))+"";return{c(){e=B("div"),s=F(i),A(e,"class","time absCentered slottext svelte-1rfiesb")},m(t,i){T(t,e,i),C(e,s)},p(t,e){16&e&&i!==(i=(t[4]>99?Math.round(t[4]/60)+"'":Math.ceil(t[4]))+"")&&O(s,i)},d(t){t&&I(e)}}}function ex(t){let e,s;return{c(){e=B("div"),s=F(t[0]),A(e,"class","stacks slottext svelte-1rfiesb")},m(t,i){T(t,e,i),C(e,s)},p(t,e){1&e&&O(s,t[0])},d(t){t&&I(e)}}}function sx(t){let e,s,n,a,r,o,l,c=t[3]>30&&Qi.cdTextBuffs&&tx(t),d=t[0]>1&&ex(t);return{c(){e=B("div"),s=B("div"),c&&c.c(),n=B("img"),r=B("div"),d&&d.c(),A(n,"class","icon svelte-1rfiesb"),n.src!==(a=t[1])&&A(n,"src",a),N(n,"max-width",t[3]+"px"),A(r,"class","overlay svelte-1rfiesb"),A(s,"class",o="slot border "+(1===t[2]?"negative":"positive")+" svelte-1rfiesb"),A(e,"class",l="container "+(t[4]<Qi.buffCdFlashingDuration&&t[4]%Qi.buffCdFlashingInterval*2>Qi.buffCdFlashingInterval?"soon":"")+" svelte-1rfiesb")},m(i,a){T(i,e,a),C(e,s),c&&c.m(s,null),C(s,n),C(s,r),t[8](r),d&&d.m(s,null)},p(t,[i]){t[3]>30&&Qi.cdTextBuffs?c?c.p(t,i):(c=tx(t),c.c(),c.m(s,n)):c&&(c.d(1),c=null),2&i&&n.src!==(a=t[1])&&A(n,"src",a),8&i&&N(n,"max-width",t[3]+"px"),t[0]>1?d?d.p(t,i):(d=ex(t),d.c(),d.m(s,null)):d&&(d.d(1),d=null),4&i&&o!==(o="slot border "+(1===t[2]?"negative":"positive")+" svelte-1rfiesb")&&A(s,"class",o),16&i&&l!==(l="container "+(t[4]<Qi.buffCdFlashingDuration&&t[4]%Qi.buffCdFlashingInterval*2>Qi.buffCdFlashingInterval?"soon":"")+" svelte-1rfiesb")&&A(e,"class",l)},i:i,o:i,d(s){s&&I(e),c&&c.d(),t[8](null),d&&d.d()}}}function ix(t,e,s){let i,{stacks:n}=e,{duration:a}=e,{time:r}=e,{icon:o}=e,{type:l}=e,{size:c}=e,d=0;function h(t){lt[t?"unshift":"push"](()=>{i=t,s(5,i)})}return t.$$set=t=>{"stacks"in t&&s(0,n=t.stacks),"duration"in t&&s(6,a=t.duration),"time"in t&&s(7,r=t.time),"icon"in t&&s(1,o=t.icon),"type"in t&&s(2,l=t.type),"size"in t&&s(3,c=t.size)},t.$$.update=()=>{232&t.$$.dirty&&(s(4,d=a-r),Qb(Math.round(r/a*100),i,c))},[n,o,l,c,d,i,a,r,h]}class nx extends Ht{constructor(t){super(),Gt(this,t,ix,sx,h,{stacks:0,duration:6,time:7,icon:1,type:2,size:3})}}const ax=[0,0,0],rx={enemy:[1,0,0],friendly:[0,1,0],dead:[.6,.6,.6]},ox=t=>{if(Ya&&Ya.player){const e=mo.clientPlayerChangeTarget.packData({target:t});if(t!==Ya.player.target)if(t>0){const e=Ya.entity(t);void 0!==e&&(3===e.type?e.canBePickedUpBy(Ya.player)&&nl({id:"ui/pickup",pitch:-1}):(nl({id:"ui/target",pitch:-1}),2===e.faction&&jy(4,100)))}else 0===t&&nl({id:"ui/detarget",pitch:-1});hx=Ya.player.target,dx.reset(Ya.time),Ya.player.setTarget(t),fm(e)}};let lx=0,cx=!1;const dx=new id(0,1);let hx=0;const ux=t=>{hx!==t&&(hx=t,dx.done(Ya.time)?Ya.player.setTarget(t):dx.reset(Ya.time,gr(dx.passed(Ya.time)+.5,.5,2)))};let mx=0;const px=()=>{fl.lmb.onPress(t=>{mx=Ya.time}),fl.lmb.onRelease(t=>{lx>0&&kl<20&&Ya.time-mx<.3&&ox(lx)}),fl.nextTarget.onPress(t=>{$x=t.shiftKey?1:2}),fl.untarget.onPress(t=>{ox(0)})},fx=(t,e=!0)=>{lx=t,cx=e&&lx>0,ue.set(cx?"pointer":"auto"),Se.set(lx)},gx=()=>{rn(ax,ul[0],ul[1],.5),Xa.unproject(ax),dn(ax,ax,Xa.worldPosition),vn(ax,ax);const t=lx;lx=0;let e=1/0,s=!1;for(let t=0,i=Ya.entities.array.length;t<i;++t){const i=Ya.entities.array[t];if(i.visual.transform.visible){const t=an(er,i.visual.transform.position);t[1]+=.3*i.size;const n=pn(t,Tr(Xa.worldPosition,ax,t));(void 0===i.stats||i.stats.alive)&&n<e&&n<(i.size+.7)**2&&i.hudPos[2]<1&&(e=n,lx=i.id,s=3!==i.type||i.canBePickedUpBy(Ya.player))}}t==lx&&s===cx||fx(lx,s)},vx=t=>{dx.done(Ya.time)&&Ya.player.target!==hx&&Ya.player.setTarget(hx),fl.shift.down||(Ml?lx>0&&(kl>=20||Ya.time-mx>.3)&&fx(0,!1):gx())};let yx=void 0,bx=0,xx=0;const wx=[1,1,1,.3],kx=t=>{if(!Ya.player)return;const e=Ya.player.target,s=lx>0?Ya.getEntityById(lx):void 0;if(void 0!==s?s!==yx&&(void 0!==yx&&void 0!==yx.visual&&3!==yx.type&&yx.visual.removeColor(wx),void 0!==s.visual&&3!==s.type&&s.visual.addColor(wx),yx=s):void 0!==yx&&void 0!==yx.visual&&(3!==yx.type&&yx.visual.removeColor(wx),yx=void 0),e!==bx?(bx=e,xx=1):xx=Math.max(xx*(1-10*t),0),e>0){const t=Ya.getEntityById(e);if(void 0!==t){rn(Sc.Zb.value,t.visual.transform.position[0],.5*t.size+.5+xx,t.visual.transform.position[2]);const e=t.stats&&t.stats.alive?Ya.player.hostility(t)>0?rx.enemy:rx.friendly:rx.dead;ea(Sc.YQ.value,...e,1-xx)}}else rn(Sc.Zb.value,0,0,0)};let $x=0;const Sx=t=>{if($x>0){let e=0,s=0;t=t.filter(t=>void 0!==t.visual&&void 0!==t.stats&&t.stats.alive&&t!==Ya.player&&Ya.player.canCombatInteract(t)&&Math.abs(Er(Ya.player.rot,Ya.player.rotationToV3(t.Zc)))<.7);let i=0===Ya.player.target;for(let n=t.length-1;n>=0;--n){const a=t[n];1===$x!=Ya.player.hostility(a)>0&&(i&&(e=a.id),Ya.player.target===a.id&&(i=!0),s||(s=a.id),0!==e&&(n=0))}0===e&&0!==s&&(e=s),ox(e),$x=0}},Mx=()=>{hx=0,dx.reset(0),yx=void 0,bx=0,xx=0};var Ex=Object.freeze({__proto__:null,Td:ax,setTarget:ox,get hovertarget(){return lx},get hoverinteractive(){return cx},targetSwitchNetTimer:dx,targetSwitchConciliate:ux,init:px,setHoverTarget:fx,preTick:vx,tick:kx,parseHudTargets:Sx,onWorldDestroy:Mx});function Cx(t,e,s){const i=t.slice();return i[27]=e[s],i}function Tx(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y=[],b=new Map,x="default"==t[2]&&Ix();o=new Jb({props:{size:"1.3em",fract:t[7],barcol:t[12],left:t[9],right:t[5],darken:!1,$$slots:{default:[Bx]},$$scope:{ctx:t}}});let w=("default"==t[2]||t[18])&&Fx(t);function k(t,e){return t[14].role>=1?Dx:Ux}let $=k(t),S=$(t),M="default"==t[2]&&t[14].combat&&t[14].alive&&Ax(),E=t[19];const P=t=>t[27].id;for(let e=0;e<E.length;e+=1){let s=Cx(t,E,e),i=P(s);b.set(i,y[e]=Rx(i,s))}return{c(){e=B("div"),s=B("div"),x&&x.c(),i=B("img"),r=B("div"),_t(o.$$.fragment),w&&w.c(),c=U(),S.c(),d=U(),M&&M.c(),h=B("div");for(let t=0;t<y.length;t+=1)y[t].c();A(i,"class",n="pclass icon border black bgc"+t[14].class+" svelte-1thy474"),i.src!==(a=(!1!==t[14].powertype?"/assets/ui/mobpower/"+t[14].powertype:"/assets/ui/classes/"+t[14].class)+"."+Io)&&A(i,"src",a),A(s,"class","iconcontainer svelte-1thy474"),A(h,"class",u="buffarray "+t[2]+" svelte-1thy474"),A(r,"class",m="panel-black bars "+(t[17]&&t[14].id==t[17].id&&"party"==t[2]?"target":"")+" "+(t[14].id&&t[14].range?"targetable":"")+" svelte-1thy474"),A(e,"id",t[4]),A(e,"class",p="grid "+(t[3]?"right":"left")+" svelte-1thy474"),N(e,"font-size",t[16]+"%"),N(e,"opacity",t[14].range?"":.5)},m(n,a){T(n,e,a),C(e,s),x&&x.m(s,null),C(s,i),C(e,r),Nt(o,r,null),w&&w.m(r,null),C(r,c),S.m(r,null),C(r,d),M&&M.m(r,null),C(r,h);for(let t=0;t<y.length;t+=1)y[t].m(h,null);f=!0,g||(v=[D(e,"click",t[20]),D(e,"contextmenu",t[21])],g=!0)},p(t,l){"default"==t[2]?x||(x=Ix(),x.c(),x.m(s,i)):x&&(x.d(1),x=null),(!f||16384&l&&n!==(n="pclass icon border black bgc"+t[14].class+" svelte-1thy474"))&&A(i,"class",n),(!f||16384&l&&i.src!==(a=(!1!==t[14].powertype?"/assets/ui/mobpower/"+t[14].powertype:"/assets/ui/classes/"+t[14].class)+"."+Io))&&A(i,"src",a);const g={};if(128&l&&(g.fract=t[7]),4096&l&&(g.barcol=t[12]),512&l&&(g.left=t[9]),32&l&&(g.right=t[5]),1073754244&l&&(g.$$scope={dirty:l,ctx:t}),o.$set(g),"default"==t[2]||t[18]?w?(w.p(t,l),262148&l&&Tt(w,1)):(w=Fx(t),w.c(),Tt(w,1),w.m(r,c)):w&&(Et(),It(w,1,1,()=>{w=null}),Ct()),$===($=k(t))&&S?S.p(t,l):(S.d(1),S=$(t),S&&(S.c(),S.m(r,d))),"default"==t[2]&&t[14].combat&&t[14].alive?M||(M=Ax(),M.c(),M.m(r,h)):M&&(M.d(1),M=null),524292&l){const e=t[19];Et(),y=At(y,l,P,1,t,e,b,h,Dt,Rx,null,Cx),Ct()}(!f||4&l&&u!==(u="buffarray "+t[2]+" svelte-1thy474"))&&A(h,"class",u),(!f||147460&l&&m!==(m="panel-black bars "+(t[17]&&t[14].id==t[17].id&&"party"==t[2]?"target":"")+" "+(t[14].id&&t[14].range?"targetable":"")+" svelte-1thy474"))&&A(r,"class",m),(!f||16&l)&&A(e,"id",t[4]),(!f||8&l&&p!==(p="grid "+(t[3]?"right":"left")+" svelte-1thy474"))&&A(e,"class",p),(!f||65536&l)&&N(e,"font-size",t[16]+"%"),(!f||16384&l)&&N(e,"opacity",t[14].range?"":.5)},i(t){if(!f){Tt(o.$$.fragment,t),Tt(w);for(let t=0;t<E.length;t+=1)Tt(y[t]);f=!0}},o(t){It(o.$$.fragment,t),It(w);for(let t=0;t<y.length;t+=1)It(y[t]);f=!1},d(t){t&&I(e),x&&x.d(),Zt(o),w&&w.d(),S.d(),M&&M.d();for(let t=0;t<y.length;t+=1)y[t].d();g=!1,l(v)}}}function Ix(t){let e;return{c(){e=B("div"),A(e,"class","deco svelte-1thy474")},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function Px(t){let e,s,i;return{c(){e=B("div"),A(e,"class",s="progressBar "+t[12]+" hpdelta svelte-1thy474"),A(e,"style",i=(t[13]?"transition:none;":"")+"width:"+t[7]+"%;")},m(t,s){T(t,e,s)},p(t,n){4096&n&&s!==(s="progressBar "+t[12]+" hpdelta svelte-1thy474")&&A(e,"class",s),8320&n&&i!==(i=(t[13]?"transition:none;":"")+"width:"+t[7]+"%;")&&A(e,"style",i)},d(t){t&&I(e)}}}function Bx(t){let e,s="default"==t[2]&&Px(t);return{c(){s&&s.c(),e=U()},m(t,i){s&&s.m(t,i),T(t,e,i)},p(t,i){"default"==t[2]?s?s.p(t,i):(s=Px(t),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},d(t){s&&s.d(t),t&&I(e)}}}function Fx(t){let e,s;return e=new Jb({props:{size:"0.7em",fract:t[8],barcol:t[15],left:t[10],right:t[6],darken:!0,$$slots:{default:[zx]},$$scope:{ctx:t}}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};256&s&&(i.fract=t[8]),32768&s&&(i.barcol=t[15]),1024&s&&(i.left=t[10]),64&s&&(i.right=t[6]),1073743872&s&&(i.$$scope={dirty:s,ctx:t}),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function zx(t){let e;return{c(){e=B("div"),A(e,"class","progressBar bgspell castbar svelte-1thy474"),N(e,"width",t[11]+"%"),N(e,"display",t[11]>0?"inherit":"none")},m(t,s){T(t,e,s)},p(t,s){2048&s&&N(e,"width",t[11]+"%"),2048&s&&N(e,"display",t[11]>0?"inherit":"none")},d(t){t&&I(e)}}}function Ux(t){let e,s,i;return{c(){e=B("img"),A(e,"class",s="tag icon border black bgf"+t[14].faction+" round svelte-1thy474"),e.src!==(i="/assets/ui/factions/"+t[14].faction+"."+Io)&&A(e,"src",i)},m(t,s){T(t,e,s)},p(t,n){16384&n&&s!==(s="tag icon border black bgf"+t[14].faction+" round svelte-1thy474")&&A(e,"class",s),16384&n&&e.src!==(i="/assets/ui/factions/"+t[14].faction+"."+Io)&&A(e,"src",i)},d(t){t&&I(e)}}}function Dx(t){let e,s;return{c(){e=B("img"),A(e,"class","tag icon border black bgblack round svelte-1thy474"),e.src!==(s="/assets/ui/icons/"+(2==t[14].role?"star":"starsilver")+"."+Io)&&A(e,"src",s)},m(t,s){T(t,e,s)},p(t,i){16384&i&&e.src!==(s="/assets/ui/icons/"+(2==t[14].role?"star":"starsilver")+"."+Io)&&A(e,"src",s)},d(t){t&&I(e)}}}function Ax(t){let e;return{c(){e=B("div"),A(e,"class","tag icon border black round combat svelte-1thy474")},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function Rx(t,e){let s,i,n;const r=[e[27],{size:"default"==e[2]?31:23}];let o={};for(let t=0;t<r.length;t+=1)o=a(o,r[t]);return i=new nx({props:o}),{key:t,first:null,c(){s=U(),_t(i.$$.fragment),this.first=s},m(t,e){T(t,s,e),Nt(i,t,e),n=!0},p(t,e){const s=524292&e?Rt(r,[524288&e&&Lt(t[27]),4&e&&{size:"default"==t[2]?31:23}]):{};i.$set(s)},i(t){n||(Tt(i.$$.fragment,t),n=!0)},o(t){It(i.$$.fragment,t),n=!1},d(t){t&&I(s),Zt(i,t)}}}function Lx(t){let e,s,i=t[14].visible&&Tx(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[14].visible?i?(i.p(t,s),16384&s&&Tt(i,1)):(i=Tx(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function Ox(t,e,s){let n,a,r,o,l=i,c=()=>(l(),l=m(u,t=>s(14,n=t)),u),d=i,h=()=>(d(),d=m(f,t=>s(19,o=t)),f);p(t,le,t=>s(17,a=t)),p(t,ti,t=>s(18,r=t)),t.$$.on_destroy.push(()=>l()),t.$$.on_destroy.push(()=>d());let{unit:u}=e;c();let{buffs:f}=e;h();let g,v,y,b,x,w,k,$,S,M,{mode:E="default"}=e,{order:C=0}=e,{id:T=""}=e,I=!1,P=0;const B=t=>{n.id&&ox(n.id)},F=t=>Yy(t,n);let z,U,D;return t.$$set=t=>{"unit"in t&&c(s(0,u=t.unit)),"buffs"in t&&h(s(1,f=t.buffs)),"mode"in t&&s(2,E=t.mode),"order"in t&&s(3,C=t.order),"id"in t&&s(4,T=t.id)},t.$$.update=()=>{16384&t.$$.dirty&&s(25,z=n.world==Ya.id?!n.alive&&"Dead":n.world),37765124&t.$$.dirty&&(s(22,g=n.hpMax?"default"==E?$b(n.hp)+"/"+$b(n.hpMax):$b(n.hp):"?"),s(5,y=z||g),s(7,x="offline"!=z?~~(n.hpMax?n.hp/n.hpMax*100:100):0),s(12,M=z?"bggrey":(Ya.mode.partyBasedHostility?n.party===Ya.player.party:n.faction===Ya.player.faction)?"bghealth":"bgenemy")),16388&t.$$.dirty&&s(23,v=n.mpMax?"default"==E?$b(n.mp)+"/"+$b(n.mpMax):$b(n.mp):"?"),16384&t.$$.dirty&&s(9,k=n.name?Eb(n.name,10):""),16384&t.$$.dirty&&s(10,$=n.timedSkill?(tn.ui.hiddenskills[n.timedSkill.id]||tn.items.book[n.timedSkill.id]).name:"Lv. "+n.level),41959424&t.$$.dirty&&s(6,b=z||(n.timedSkill?n.timedCast.remaining(Ya.smoothtime).toFixed(1):v)),33570816&t.$$.dirty&&s(8,w="offline"!=z?~~(n.mpMax?n.mp/n.mpMax*100:100):0),33570816&t.$$.dirty&&s(11,S="offline"!=z&&n.timedSkill?100*n.timedCast.fraction(Ya.smoothtime):0),33554432&t.$$.dirty&&s(15,U=z?"bggrey":"bgmana"),4&t.$$.dirty&&s(16,D=Math.round("default"==E?100:85)),16793600&t.$$.dirty&&(s(13,I=P!=n.id),s(24,P=n.id))},[u,f,E,C,T,y,b,x,w,k,$,S,M,I,n,U,D,a,r,o,B,F]}class _x extends Ht{constructor(t){super(),Gt(this,t,Ox,Lx,d,{unit:0,buffs:1,mode:2,order:3,id:4})}}function Nx(t){let e,s,n,a;return s=new _x({props:{id:"ufplayer",order:0,unit:oe,buffs:de}}),n=new _x({props:{id:"uftarget",order:1,unit:le,buffs:ce}}),{c(){e=B("div"),_t(s.$$.fragment),_t(n.$$.fragment),A(e,"class","targetframes svelte-17up9g6")},m(t,i){T(t,e,i),Nt(s,e,null),Nt(n,e,null),a=!0},p:i,i(t){a||(Tt(s.$$.fragment,t),Tt(n.$$.fragment,t),a=!0)},o(t){It(s.$$.fragment,t),It(n.$$.fragment,t),a=!1},d(t){t&&I(e),Zt(s),Zt(n)}}}class Zx extends Ht{constructor(t){super(),Gt(this,t,null,Nx,h,{})}}function qx(t){let e,s;return{c(){e=B("span"),s=F(t[2]),A(e,"class","slottext key")},m(t,i){T(t,e,i),C(e,s)},p(t,e){4&e[0]&&O(s,t[2])},d(t){t&&I(e)}}}function Gx(t){let e,s;return{c(){e=B("span"),s=F(t[3]),A(e,"class","slottext stacks")},m(t,i){T(t,e,i),C(e,s)},p(t,e){8&e[0]&&O(s,t[3])},d(t){t&&I(e)}}}function Hx(t){let e,s,i=(t[5]>99?Math.round(t[5]/60)+"'":t[5]<=3?t[5].toFixed(1):Math.ceil(t[5]))+"";return{c(){e=B("div"),s=F(i),A(e,"class","time absCentered slottext svelte-18ojcpo")},m(t,i){T(t,e,i),C(e,s)},p(t,e){32&e[0]&&i!==(i=(t[5]>99?Math.round(t[5]/60)+"'":t[5]<=3?t[5].toFixed(1):Math.ceil(t[5]))+"")&&O(s,i)},d(t){t&&I(e)}}}function Xx(t){let e;return{c(){e=B("div"),A(e,"class","autocast svelte-18ojcpo")},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function jx(t){let e,s,i;const n=t[29].default,a=f(n,t,t[28],null);return{c(){e=B("div"),a&&a.c(),A(e,"class",s="border "+t[6]+" slotdescription svelte-18ojcpo"),A(e,"style",t[10])},m(s,n){T(s,e,n),a&&a.m(e,null),t[31](e),i=!0},p(t,r){a&&a.p&&268435456&r[0]&&y(a,n,t,t[28],r,null,null),(!i||64&r[0]&&s!==(s="border "+t[6]+" slotdescription svelte-18ojcpo"))&&A(e,"class",s),(!i||1024&r[0])&&A(e,"style",t[10])},i(t){i||(Tt(a,t),i=!0)},o(t){It(a,t),i=!1},d(s){s&&I(e),a&&a.d(s),t[31](null)}}}function Jx(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y=void 0!==t[2]&&qx(t),b=void 0!==t[3]&&Gx(t),x=Qi.cdTextSkills&&void 0!==t[5]&&Hx(t),w=t[11]&&Xx(),k=t[9]&&t[0]&&!t[16]&&jx(t);return{c(){e=B("div"),y&&y.c(),s=U(),b&&b.c(),i=U(),x&&x.c(),n=B("div"),r=B("div"),c=B("div"),w&&w.c(),h=B("img"),k&&k.c(),A(n,"class",a="overlay "+(void 0!==t[4]?"":"hidden")+" svelte-18ojcpo"),A(r,"class",o="overlay "+t[17]+" svelte-18ojcpo"),A(c,"class",d="overlay "+(!t[14]||t[4]>0&&t[4]<10?"hidden":"offCd")+" svelte-18ojcpo"),A(h,"class",u="icon "+t[7]+" svelte-18ojcpo"),h.src!==(m=t[15])&&A(h,"src",m),A(e,"id",t[8]),A(e,"class",p="border "+t[6]+" "+(t[16]&&t[16].data==t[1]?"grey":"")+" slot "+(t[1]?"filled":"")+" svelte-18ojcpo")},m(a,o){T(a,e,o),y&&y.m(e,null),C(e,s),b&&b.m(e,null),C(e,i),x&&x.m(e,null),C(e,n),t[30](n),C(e,r),C(e,c),w&&w.m(e,null),C(e,h),k&&k.m(e,null),f=!0,g||(v=[D(e,"pointerenter",t[20]),D(e,"pointerleave",t[21]),D(e,"pointerdown",t[18]),D(e,"pointerup",t[19])],g=!0)},p(t,l){void 0!==t[2]?y?y.p(t,l):(y=qx(t),y.c(),y.m(e,s)):y&&(y.d(1),y=null),void 0!==t[3]?b?b.p(t,l):(b=Gx(t),b.c(),b.m(e,i)):b&&(b.d(1),b=null),Qi.cdTextSkills&&void 0!==t[5]?x?x.p(t,l):(x=Hx(t),x.c(),x.m(e,n)):x&&(x.d(1),x=null),(!f||16&l[0]&&a!==(a="overlay "+(void 0!==t[4]?"":"hidden")+" svelte-18ojcpo"))&&A(n,"class",a),(!f||131072&l[0]&&o!==(o="overlay "+t[17]+" svelte-18ojcpo"))&&A(r,"class",o),(!f||16400&l[0]&&d!==(d="overlay "+(!t[14]||t[4]>0&&t[4]<10?"hidden":"offCd")+" svelte-18ojcpo"))&&A(c,"class",d),t[11]?w||(w=Xx(),w.c(),w.m(e,h)):w&&(w.d(1),w=null),(!f||128&l[0]&&u!==(u="icon "+t[7]+" svelte-18ojcpo"))&&A(h,"class",u),(!f||32768&l[0]&&h.src!==(m=t[15]))&&A(h,"src",m),t[9]&&t[0]&&!t[16]?k?(k.p(t,l),66049&l[0]&&Tt(k,1)):(k=jx(t),k.c(),Tt(k,1),k.m(e,null)):k&&(Et(),It(k,1,1,()=>{k=null}),Ct()),(!f||256&l[0])&&A(e,"id",t[8]),(!f||65602&l[0]&&p!==(p="border "+t[6]+" "+(t[16]&&t[16].data==t[1]?"grey":"")+" slot "+(t[1]?"filled":"")+" svelte-18ojcpo"))&&A(e,"class",p)},i(t){f||(Tt(k),f=!0)},o(t){It(k),f=!1},d(s){s&&I(e),y&&y.d(),b&&b.d(),x&&x.d(),t[30](null),w&&w.d(),k&&k.d(),g=!1,l(v)}}}function Vx(t,e,s){let i;p(t,he,t=>s(16,i=t));let{data:n}=e,{key:a}=e,{stacks:r}=e,{cd:o}=e,{remaining:l}=e,{border:c="grey"}=e,{img:d}=e,{meta:h}=e,{css:u=""}=e,{id:m=""}=e,{describe:f=!0}=e,{queued:g=!1}=e,{pickable:v=!0}=e,{descRoot:y}=e,{descPos:b="bottom: 100%; right: 100%;"}=e,{auto:w=!1}=e,{status:k=0}=e,{hover:$=!1}=e,S=!1;const M=(t,e)=>t?"queued":5==e?"oom":6==e?"range":11==e||9==e?"combat":"hidden";let E;const C=t=>{S=!0,F(!1),U("click",h)},T=t=>{2==t.button?fl.shift.down||fl.ctrl.down?U("use",{e:t,...h}):U("context",{e:t,...h}):i?(i.data.type&&dl(i.data.type),U("move",{from:i.meta,to:h}),i.meta&&i.meta.store&&i.meta.store.set(),x(he,i=void 0)):z(),S=!1},I=t=>{F(!0)},P=()=>{U("discard")},B=t=>{F(!1),n&&S&&(S=!1,z())},F=t=>{"force"!==$&&s(0,$=t)},z=()=>{n&&!1!==v&&(n.moving||x(he,i={data:n,img:d,meta:h,border:c,css:u,discard:P}),n.type&&dl(n.type))},U=at();let D,A,R,L,{$$slots:O={},$$scope:_}=e;function N(t){lt[t?"unshift":"push"](()=>{D=t,s(13,D)})}function Z(t){lt[t?"unshift":"push"](()=>{E=t,s(12,E)})}return t.$$set=t=>{"data"in t&&s(1,n=t.data),"key"in t&&s(2,a=t.key),"stacks"in t&&s(3,r=t.stacks),"cd"in t&&s(4,o=t.cd),"remaining"in t&&s(5,l=t.remaining),"border"in t&&s(6,c=t.border),"img"in t&&s(22,d=t.img),"meta"in t&&s(23,h=t.meta),"css"in t&&s(7,u=t.css),"id"in t&&s(8,m=t.id),"describe"in t&&s(9,f=t.describe),"queued"in t&&s(24,g=t.queued),"pickable"in t&&s(25,v=t.pickable),"descRoot"in t&&s(26,y=t.descRoot),"descPos"in t&&s(10,b=t.descPos),"auto"in t&&s(11,w=t.auto),"status"in t&&s(27,k=t.status),"hover"in t&&s(0,$=t.hover),"$$scope"in t&&s(28,_=t.$$scope)},t.$$.update=()=>{16400&t.$$.dirty[0]&&s(14,A=A||o>0),138477585&t.$$.dirty[0]&&s(15,R=d?i&&$||o>0||-1==k?d.replace(".","_grey.").replace(/_q[0-9]/g,""):d:`/assets/ui/slotbg/bg.${Po}?v=4597824`),150996992&t.$$.dirty[0]&&s(17,L=M(w||g,k)),67112960&t.$$.dirty[0]&&E&&y&&y.appendChild(E),8208&t.$$.dirty[0]&&Qb(Math.floor(o||0),D,40)},[$,n,a,r,o,l,c,u,m,f,b,w,E,D,A,R,i,L,C,T,I,B,d,h,g,v,y,k,_,O,N,Z]}class Yx extends Ht{constructor(t){super(),Gt(this,t,Vx,Jx,h,{data:1,key:2,stacks:3,cd:4,remaining:5,border:6,img:22,meta:23,css:7,id:8,describe:9,queued:24,pickable:25,descRoot:26,descPos:10,auto:11,status:27,hover:0},[-1,-1])}}function Wx(t,e,s){const i=t.slice();return i[13]=e[s],i}function Qx(t,e,s){const i=t.slice();return i[16]=e[s],i}function Kx(t,e,s){const i=t.slice();return i[19]=e[s],i}function tw(t,e,s){const i=t.slice();return i[19]=e[s],i}function ew(t,e,s){const i=t.slice();return i[27]=e[s],i}function sw(t,e,s){const i=t.slice();return i[24]=e[s],i}function iw(t,e,s){const i=t.slice();return i[27]=e[s],i}function nw(t,e,s){const i=t.slice();return i[24]=e[s],i}function aw(t,e,s){const i=t.slice();return i[27]=e[s],i}function rw(t,e,s){const i=t.slice();return i[34]=e[s],i}function ow(t,e,s){const i=t.slice();return i[39]=e[s],i}function lw(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S=!t[2]&&void 0===t[0].parent&&dw(t),M=t[0].actiontype&&hw(t),E=t[0].auto&&uw(),F=t[0].cost&&t[0].cost.resources&&mw(t),z=t[0].castLen&&fw(t),D=t[0].cd&&gw(t),R=t[0].duration>0&&vw(t),L=t[0].unique&&yw(),O=t[0].refresh&&bw(),_=t[0].range&&xw(t),N=t[7][t[0].targetMode]&&ww(t),Z=t[0].maxStacks&&kw(t),q=t[0].dmg&&$w(t),G=t[0].heal&&Sw(t),H=[t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage],X=[];for(let e=0;e<2;e+=1)X[e]=Ew(rw(t,H,e));let j=[t[0].addIncomingHeal,t[0].addIncomingDamage],J=[];for(let e=0;e<2;e+=1)J[e]=Tw(nw(t,j,e));let V=[t[0].addIncomingCrit],Y=[];for(let e=0;e<1;e+=1)Y[e]=Pw(sw(t,V,e));let W=t[0].statsStatic&&Bw(t),Q=t[0].statsConvert&&zw(t),K=t[0].custom&&Dw(t),tt=t[0].aoe&&t[0].aoe.circleRadius&&Rw(t),et=!t[0].parent&&Lw(t),st=t[3],it=[];for(let e=0;e<st.length;e+=1)it[e]=Ow(Wx(t,st,e));const nt=t=>It(it[t],1,1,()=>{it[t]=null});return{c(){S&&S.c(),e=B("div"),M&&M.c(),s=U(),E&&E.c(),i=U(),F&&F.c(),n=U(),z&&z.c(),a=U(),D&&D.c(),r=U(),R&&R.c(),o=U(),L&&L.c(),l=U(),O&&O.c(),c=B("div"),_&&_.c(),d=U(),N&&N.c(),Z&&Z.c(),h=U(),q&&q.c(),u=U(),G&&G.c(),m=U();for(let t=0;t<2;t+=1)X[t].c();p=U();for(let t=0;t<2;t+=1)J[t].c();f=U();for(let t=0;t<1;t+=1)Y[t].c();g=U(),W&&W.c(),v=U(),Q&&Q.c(),y=U(),K&&K.c(),b=U(),tt&&tt.c(),x=U(),et&&et.c(),w=U();for(let t=0;t<it.length;t+=1)it[t].c();k=U(),A(e,"class","pad textgreen svelte-14w0l4b")},m(t,I){S&&S.m(t,I),T(t,e,I),M&&M.m(e,null),C(e,s),E&&E.m(e,null),C(e,i),F&&F.m(e,null),C(e,n),z&&z.m(e,null),C(e,a),D&&D.m(e,null),C(e,r),R&&R.m(e,null),C(e,o),L&&L.m(e,null),C(e,l),O&&O.m(e,null),C(e,c),_&&_.m(c,null),C(c,d),N&&N.m(c,null),Z&&Z.m(t,I),T(t,h,I),q&&q.m(t,I),T(t,u,I),G&&G.m(t,I),T(t,m,I);for(let e=0;e<2;e+=1)X[e].m(t,I);T(t,p,I);for(let e=0;e<2;e+=1)J[e].m(t,I);T(t,f,I);for(let e=0;e<1;e+=1)Y[e].m(t,I);T(t,g,I),W&&W.m(t,I),T(t,v,I),Q&&Q.m(t,I),T(t,y,I),K&&K.m(t,I),T(t,b,I),tt&&tt.m(t,I),T(t,x,I),et&&et.m(t,I),T(t,w,I);for(let e=0;e<it.length;e+=1)it[e].m(t,I);T(t,k,I),$=!0},p(t,$){if(t[2]||void 0!==t[0].parent?S&&(S.d(1),S=null):S?S.p(t,$):(S=dw(t),S.c(),S.m(e.parentNode,e)),t[0].actiontype?M?M.p(t,$):(M=hw(t),M.c(),M.m(e,s)):M&&(M.d(1),M=null),t[0].auto?E||(E=uw(),E.c(),E.m(e,i)):E&&(E.d(1),E=null),t[0].cost&&t[0].cost.resources?F?F.p(t,$):(F=mw(t),F.c(),F.m(e,n)):F&&(F.d(1),F=null),t[0].castLen?z?z.p(t,$):(z=fw(t),z.c(),z.m(e,a)):z&&(z.d(1),z=null),t[0].cd?D?D.p(t,$):(D=gw(t),D.c(),D.m(e,r)):D&&(D.d(1),D=null),t[0].duration>0?R?R.p(t,$):(R=vw(t),R.c(),R.m(e,o)):R&&(R.d(1),R=null),t[0].unique?L||(L=yw(),L.c(),L.m(e,l)):L&&(L.d(1),L=null),t[0].refresh?O||(O=bw(),O.c(),O.m(e,c)):O&&(O.d(1),O=null),t[0].range?_?_.p(t,$):(_=xw(t),_.c(),_.m(c,d)):_&&(_.d(1),_=null),t[7][t[0].targetMode]?N?N.p(t,$):(N=ww(t),N.c(),N.m(c,null)):N&&(N.d(1),N=null),t[0].maxStacks?Z?Z.p(t,$):(Z=kw(t),Z.c(),Z.m(h.parentNode,h)):Z&&(Z.d(1),Z=null),t[0].dmg?q?q.p(t,$):(q=$w(t),q.c(),q.m(u.parentNode,u)):q&&(q.d(1),q=null),t[0].heal?G?G.p(t,$):(G=Sw(t),G.c(),G.m(m.parentNode,m)):G&&(G.d(1),G=null),257&$[0]){let e;for(H=[t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage],e=0;e<2;e+=1){const s=rw(t,H,e);X[e]?X[e].p(s,$):(X[e]=Ew(s),X[e].c(),X[e].m(p.parentNode,p))}for(;e<2;e+=1)X[e].d(1)}if(257&$[0]){let e;for(j=[t[0].addIncomingHeal,t[0].addIncomingDamage],e=0;e<2;e+=1){const s=nw(t,j,e);J[e]?J[e].p(s,$):(J[e]=Tw(s),J[e].c(),J[e].m(f.parentNode,f))}for(;e<2;e+=1)J[e].d(1)}if(257&$[0]){let e;for(V=[t[0].addIncomingCrit],e=0;e<1;e+=1){const s=sw(t,V,e);Y[e]?Y[e].p(s,$):(Y[e]=Pw(s),Y[e].c(),Y[e].m(g.parentNode,g))}for(;e<1;e+=1)Y[e].d(1)}if(t[0].statsStatic?W?W.p(t,$):(W=Bw(t),W.c(),W.m(v.parentNode,v)):W&&(W.d(1),W=null),t[0].statsConvert?Q?Q.p(t,$):(Q=zw(t),Q.c(),Q.m(y.parentNode,y)):Q&&(Q.d(1),Q=null),t[0].custom?K?K.p(t,$):(K=Dw(t),K.c(),K.m(b.parentNode,b)):K&&(K.d(1),K=null),t[0].aoe&&t[0].aoe.circleRadius?tt?tt.p(t,$):(tt=Rw(t),tt.c(),tt.m(x.parentNode,x)):tt&&(tt.d(1),tt=null),t[0].parent?et&&(et.d(1),et=null):et?et.p(t,$):(et=Lw(t),et.c(),et.m(w.parentNode,w)),10&$[0]){let e;for(st=t[3],e=0;e<st.length;e+=1){const s=Wx(t,st,e);it[e]?(it[e].p(s,$),Tt(it[e],1)):(it[e]=Ow(s),it[e].c(),Tt(it[e],1),it[e].m(k.parentNode,k))}for(Et(),e=st.length;e<it.length;e+=1)nt(e);Ct()}},i(t){if(!$){for(let t=0;t<st.length;t+=1)Tt(it[t]);$=!0}},o(t){it=it.filter(Boolean);for(let t=0;t<it.length;t+=1)It(it[t]);$=!1},d(t){S&&S.d(t),t&&I(e),M&&M.d(),E&&E.d(),F&&F.d(),z&&z.d(),D&&D.d(),R&&R.d(),L&&L.d(),O&&O.d(),_&&_.d(),N&&N.d(),Z&&Z.d(t),t&&I(h),q&&q.d(t),t&&I(u),G&&G.d(t),t&&I(m),P(X,t),t&&I(p),P(J,t),t&&I(f),P(Y,t),t&&I(g),W&&W.d(t),t&&I(v),Q&&Q.d(t),t&&I(y),K&&K.d(t),t&&I(b),tt&&tt.d(t),t&&I(x),et&&et.d(t),t&&I(w),P(it,t),t&&I(k)}}}function cw(t){let e,s,n=t[0].item+"";return{c(){e=B("div"),s=F(n)},m(t,i){T(t,e,i),C(e,s)},p(t,e){1&e[0]&&n!==(n=t[0].item+"")&&O(s,n)},i:i,o:i,d(t){t&&I(e)}}}function dw(t){let e,s,i,n,a,r,o=tn.items.book[t[0].id].name+"",l=t[0].engineOnly?"":" Lv. "+t[1];return{c(){e=B("div"),s=B("img"),n=z(),a=F(o),r=F(l),A(s,"class","texticon"),s.src!==(i=by(t[0].id))&&A(s,"src",i),A(e,"class","slottitle textprimary")},m(t,i){T(t,e,i),C(e,s),C(e,n),C(e,a),C(e,r)},p(t,e){1&e[0]&&s.src!==(i=by(t[0].id))&&A(s,"src",i),1&e[0]&&o!==(o=tn.items.book[t[0].id].name+"")&&O(a,o),3&e[0]&&l!==(l=t[0].engineOnly?"":" Lv. "+t[1])&&O(r,l)},d(t){t&&I(e)}}}function hw(t){let e,s,i,n,a=t[9][t[0].mode]+"",r=t[0].actiontype+"";return{c(){e=B("div"),s=F(a),i=z(),n=F(r),A(e,"class","textwhite")},m(t,a){T(t,e,a),C(e,s),C(e,i),C(e,n)},p(t,e){1&e[0]&&a!==(a=t[9][t[0].mode]+"")&&O(s,a),1&e[0]&&r!==(r=t[0].actiontype+"")&&O(n,r)},d(t){t&&I(e)}}}function uw(t){let e;return{c(){e=B("div"),e.textContent="Auto cast"},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function mw(t){let e,s,i=t[0].cost.resources,n=[];for(let e=0;e<i.length;e+=1)n[e]=pw(ow(t,i,e));return{c(){e=B("div"),s=F("Cost: ");for(let t=0;t<n.length;t+=1)n[t].c()},m(t,i){T(t,e,i),C(e,s);for(let t=0;t<n.length;t+=1)n[t].m(e,null)},p(t,s){if(259&s[0]){let a;for(i=t[0].cost.resources,a=0;a<i.length;a+=1){const r=ow(t,i,a);n[a]?n[a].p(r,s):(n[a]=pw(r),n[a].c(),n[a].m(e,null))}for(;a<n.length;a+=1)n[a].d(1);n.length=i.length}},d(t){t&&I(e),P(n,t)}}}function pw(t){let e,s,i,n,a=t[8](t[39][1],t[1])+"",r=tn.ui.stats.array[t[39][0]]+"";return{c(){e=F(a),s=z(),i=F(r),n=z()},m(t,a){T(t,e,a),T(t,s,a),T(t,i,a),T(t,n,a)},p(t,s){3&s[0]&&a!==(a=t[8](t[39][1],t[1])+"")&&O(e,a),1&s[0]&&r!==(r=tn.ui.stats.array[t[39][0]]+"")&&O(i,r)},d(t){t&&I(e),t&&I(s),t&&I(i),t&&I(n)}}}function fw(t){let e,s,i,n=t[8](t[0].castLen)+"";return{c(){e=B("div"),s=F(n),i=F("s Cast time")},m(t,n){T(t,e,n),C(e,s),C(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].castLen)+"")&&O(s,n)},d(t){t&&I(e)}}}function gw(t){let e,s,i,n=t[8](t[0].cd)+"";return{c(){e=B("div"),s=F(n),i=F("s Cooldown")},m(t,n){T(t,e,n),C(e,s),C(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].cd)+"")&&O(s,n)},d(t){t&&I(e)}}}function vw(t){let e,s,i,n=t[8](t[0].duration)+"";return{c(){e=B("div"),s=F(n),i=F("s Duration")},m(t,n){T(t,e,n),C(e,s),C(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].duration)+"")&&O(s,n)},d(t){t&&I(e)}}}function yw(t){let e;return{c(){e=B("div"),e.textContent="Unique"},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function bw(t){let e;return{c(){e=B("div"),e.textContent="Stacks refresh duration"},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function xw(t){let e,s,i,n=t[8](t[0].range)+"";return{c(){e=B("span"),s=F(n),i=F("m range ")},m(t,n){T(t,e,n),C(e,s),C(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].range)+"")&&O(s,n)},d(t){t&&I(e)}}}function ww(t){let e,s,i=t[7][t[0].targetMode]+"";return{c(){e=B("span"),s=F(i)},m(t,i){T(t,e,i),C(e,s)},p(t,e){1&e[0]&&i!==(i=t[7][t[0].targetMode]+"")&&O(s,i)},d(t){t&&I(e)}}}function kw(t){let e,s,i,n,a,r,o,l=t[5].stacks+"";return{c(){e=B("div"),s=B("u"),i=F("At "),n=F(l),a=F(" stacks"),r=F(":"),o=B("span"),o.textContent="(Press shift to toggle)",A(e,"class","pad textsecondary svelte-14w0l4b"),A(o,"class","textgrey")},m(t,l){T(t,e,l),C(e,s),C(s,i),C(s,n),C(s,a),C(e,r),T(t,o,l)},p(t,e){32&e[0]&&l!==(l=t[5].stacks+"")&&O(n,l)},d(t){t&&I(e),t&&I(o)}}}function $w(t){let e,s,i,n=t[8](t[0].dmg)+"";return{c(){e=B("div"),s=F(n),i=F(" DMG"),A(e,"class","textgreen")},m(t,n){T(t,e,n),C(e,s),C(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].dmg)+"")&&O(s,n)},d(t){t&&I(e)}}}function Sw(t){let e,s,i,n=t[8](t[0].heal)+"";return{c(){e=B("div"),s=F(n),i=F(" Heal"),A(e,"class","textgreen")},m(t,n){T(t,e,n),C(e,s),C(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].heal)+"")&&O(s,n)},d(t){t&&I(e)}}}function Mw(t){let e,s,i,n,a,r,o=tn.items.book[t[27]].name+"",l=Math.round(100*t[8](t[34][t[27]](t[0]))-100)+"";return{c(){e=B("div"),s=F("Empower "),i=F(o),n=F(" by "),a=F(l),r=F("%"),A(e,"class","textcyan")},m(t,o){T(t,e,o),C(e,s),C(e,i),C(e,n),C(e,a),C(e,r)},p(t,e){1&e[0]&&o!==(o=tn.items.book[t[27]].name+"")&&O(i,o),1&e[0]&&l!==(l=Math.round(100*t[8](t[34][t[27]](t[0]))-100)+"")&&O(a,l)},d(t){t&&I(e)}}}function Ew(t){let e,s=Object.keys(t[34]||{}),i=[];for(let e=0;e<s.length;e+=1)i[e]=Mw(aw(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=U()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);T(t,e,s)},p(t,n){if(257&n[0]){let a;for(s=Object.keys(t[34]||{}),a=0;a<s.length;a+=1){const r=aw(t,s,a);i[a]?i[a].p(r,n):(i[a]=Mw(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){P(i,t),t&&I(e)}}}function Cw(t){let e,s,i,n,a,r=tn.items.book[t[27]].name+"",o=t[8](t[24][t[27]](t[0]))+"";return{c(){e=B("div"),s=F("Empower "),i=F(r),n=F(" by "),a=F(o),A(e,"class","textcyan")},m(t,r){T(t,e,r),C(e,s),C(e,i),C(e,n),C(e,a)},p(t,e){1&e[0]&&r!==(r=tn.items.book[t[27]].name+"")&&O(i,r),1&e[0]&&o!==(o=t[8](t[24][t[27]](t[0]))+"")&&O(a,o)},d(t){t&&I(e)}}}function Tw(t){let e,s=Object.keys(t[24]||{}),i=[];for(let e=0;e<s.length;e+=1)i[e]=Cw(iw(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=U()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);T(t,e,s)},p(t,n){if(257&n[0]){let a;for(s=Object.keys(t[24]||{}),a=0;a<s.length;a+=1){const r=iw(t,s,a);i[a]?i[a].p(r,n):(i[a]=Cw(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){P(i,t),t&&I(e)}}}function Iw(t){let e,s,i,n,a,r=tn.items.book[t[27]].name+"",o=Ib(14,t[8](t[24][t[27]](t[0])))+"";return{c(){e=B("div"),s=F("Empower Crit% of "),i=F(r),n=F(" by "),a=F(o),A(e,"class","textcyan")},m(t,r){T(t,e,r),C(e,s),C(e,i),C(e,n),C(e,a)},p(t,e){1&e[0]&&r!==(r=tn.items.book[t[27]].name+"")&&O(i,r),1&e[0]&&o!==(o=Ib(14,t[8](t[24][t[27]](t[0])))+"")&&O(a,o)},d(t){t&&I(e)}}}function Pw(t){let e,s=Object.keys(t[24]||{}),i=[];for(let e=0;e<s.length;e+=1)i[e]=Iw(ew(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=U()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);T(t,e,s)},p(t,n){if(257&n[0]){let a;for(s=Object.keys(t[24]||{}),a=0;a<s.length;a+=1){const r=ew(t,s,a);i[a]?i[a].p(r,n):(i[a]=Iw(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){P(i,t),t&&I(e)}}}function Bw(t){let e,s=Array.from(t[4].stat),i=[];for(let e=0;e<s.length;e+=1)i[e]=Fw(tw(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=U()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);T(t,e,s)},p(t,n){if(16&n[0]){let a;for(s=Array.from(t[4].stat),a=0;a<s.length;a+=1){const r=tw(t,s,a);i[a]?i[a].p(r,n):(i[a]=Fw(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){P(i,t),t&&I(e)}}}function Fw(t){let e,s,i,n,a,r,o=Ib(t[19][0],t[19][1])+"",l=tn.ui.stats.array[t[19][0]]+"";return{c(){e=B("div"),s=F("+"),i=F(o),n=z(),a=F(l),r=z(),A(e,"class","textcyan")},m(t,o){T(t,e,o),C(e,s),C(e,i),C(e,n),C(e,a),C(e,r)},p(t,e){16&e[0]&&o!==(o=Ib(t[19][0],t[19][1])+"")&&O(i,o),16&e[0]&&l!==(l=tn.ui.stats.array[t[19][0]]+"")&&O(a,l)},d(t){t&&I(e)}}}function zw(t){let e,s=t[0].statsConvert,i=[];for(let e=0;e<s.length;e+=1)i[e]=Uw(Kx(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=U()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);T(t,e,s)},p(t,n){if(1&n[0]){let a;for(s=t[0].statsConvert,a=0;a<s.length;a+=1){const r=Kx(t,s,a);i[a]?i[a].p(r,n):(i[a]=Uw(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){P(i,t),t&&I(e)}}}function Uw(t){let e,s,i,n,a,r,o,l=tn.ui.stats.array[t[19][0]]+"",c=Ib(t[19][0],t[19][1])+"",d=tn.ui.stats.array[t[19][2]]+"";return{c(){e=B("div"),s=F("For 1 "),i=F(l),n=F(" gain "),a=F(c),r=z(),o=F(d),A(e,"class","textcyan")},m(t,l){T(t,e,l),C(e,s),C(e,i),C(e,n),C(e,a),C(e,r),C(e,o)},p(t,e){1&e[0]&&l!==(l=tn.ui.stats.array[t[19][0]]+"")&&O(i,l),1&e[0]&&c!==(c=Ib(t[19][0],t[19][1])+"")&&O(a,c),1&e[0]&&d!==(d=tn.ui.stats.array[t[19][2]]+"")&&O(o,d)},d(t){t&&I(e)}}}function Dw(t){let e,s=t[0].custom,i=[];for(let e=0;e<s.length;e+=1)i[e]=Aw(Qx(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=U()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);T(t,e,s)},p(t,n){if(259&n[0]){let a;for(s=t[0].custom,a=0;a<s.length;a+=1){const r=Qx(t,s,a);i[a]?i[a].p(r,n):(i[a]=Aw(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){P(i,t),t&&I(e)}}}function Aw(t){let e,s,i,n=t[8](t[16][0](t[1]))+"",a=t[16][1]+"";return{c(){e=B("div"),s=F(n),i=F(a),A(e,"class","textcyan")},m(t,n){T(t,e,n),C(e,s),C(e,i)},p(t,e){3&e[0]&&n!==(n=t[8](t[16][0](t[1]))+"")&&O(s,n),1&e[0]&&a!==(a=t[16][1]+"")&&O(i,a)},d(t){t&&I(e)}}}function Rw(t){let e,s,i,n,a,r,o=t[0].aoe.faction?t[0].aoe.party?"party members":"allies":"enemies",l=t[8](t[0].aoe.circleRadius)+"";return{c(){e=B("div"),s=F("All "),i=F(o),n=F(" within "),a=F(l),r=F("m"),A(e,"class","textpvp")},m(t,o){T(t,e,o),C(e,s),C(e,i),C(e,n),C(e,a),C(e,r)},p(t,e){1&e[0]&&o!==(o=t[0].aoe.faction?t[0].aoe.party?"party members":"allies":"enemies")&&O(i,o),1&e[0]&&l!==(l=t[8](t[0].aoe.circleRadius)+"")&&O(a,l)},d(t){t&&I(e)}}}function Lw(t){let e,s,i,n,a=tn.items.book[t[0].id].description+"";return{c(){e=B("div"),s=B("u"),s.textContent="Effect",i=F(": "),n=F(a),A(e,"class","textsecondary pad svelte-14w0l4b")},m(t,a){T(t,e,a),C(e,s),C(e,i),C(e,n)},p(t,e){1&e[0]&&a!==(a=tn.items.book[t[0].id].description+"")&&O(n,a)},d(t){t&&I(e)}}}function Ow(t){let e,s,i;return s=new Zw({props:{level:t[1],skill:t[13]}}),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","pad svelte-14w0l4b")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};2&e[0]&&(i.level=t[1]),8&e[0]&&(i.skill=t[13]),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function _w(t){let e,s,i,n;const a=[cw,lw],r=[];function o(t,e){return t[0].item?0:1}return s=o(t),i=r[s]=a[s](t),{c(){e=B("div"),i.c(),A(e,"class","container textsecondary svelte-14w0l4b")},m(t,i){T(t,e,i),r[s].m(e,null),n=!0},p(t,n){let l=s;s=o(t),s===l?r[s].p(t,n):(Et(),It(r[l],1,1,()=>{r[l]=null}),Ct(),i=r[s],i||(i=r[s]=a[s](t),i.c()),Tt(i,1),i.m(e,null))},i(t){n||(Tt(i),n=!0)},o(t){It(i),n=!1},d(t){t&&I(e),r[s].d()}}}function Nw(t,e,s){let i,{skill:n}=e,{level:a}=e,{asItemDescription:r=!1}=e,o=fl.shift.store;p(t,o,t=>s(10,i=t));const l={1:"Requires no target",16:"Self cast",256:"on Allies",4096:"on Enemy"},c=(t,e=Ya&&Ya.player)=>{if(!e)return"?";const s=sp(t,e);return s%1==0?s:s.toFixed(1)},d={0:"Melee attack",1:"Magic attack",2:"Heal",4:"Buff",5:"Stackable buff",6:"Ranged missile"};let h,u=[],m={};const f=t=>{if(Ya)return t.onCast&&g("on cast",t.onCast,Ya.player,a),t.onBlock&&g("on block",t.onBlock,m,Ya.player),t.onInterval&&g(`every ${t.intervalDuration.toFixed(1)}s`,t.onInterval,m,Ya.player,Ya.player),t.onPermanent&&g("permanently",t.onPermanent,Ya.player,a),t},g=(t,e,i,a,r)=>{const o=e(i,a,r);if(!o||!0===o)return;const l=Object.assign({},o);if(l.actiontype=t,l.parent||(l.parent=[]),l.parent.push(n),4==l.mode||5==l.mode){const t=zv.get(l.id);u.unshift(f({...l,...t}))}else if(n.id===l.id)n.parent||(l.parent=void 0),s(0,n={...n,...l});else{if(n.parent){const t=n.parent.find(t=>t.id==l.id);if(t)return t.parent||(l.parent=void 0),void Object.assign(t,l)}u.unshift(f(l))}};return t.$$set=t=>{"skill"in t&&s(0,n=t.skill),"level"in t&&s(1,a=t.level),"asItemDescription"in t&&s(2,r=t.asItemDescription)},t.$$.update=()=>{1075&t.$$.dirty[0]&&(s(5,m={stacks:1,level:a}),s(5,m.stacks=n.maxStacks?i?1:n.maxStacks:1,m),s(0,n.stacks=m.stacks,n),s(3,u=[]),n.parent||f(n),n.statsStatic&&(s(4,h=new Nv),n.statsStatic(m,h)))},[n,a,r,u,h,m,o,l,c,d]}class Zw extends Ht{constructor(t){super(),Gt(this,t,Nw,_w,d,{skill:0,level:1,asItemDescription:2},[-1,-1])}}function qw(t){let e;return{c(){e=B("span")},m(s,i){T(s,e,i),e.innerHTML=t[0]},p(t,[s]){1&s&&(e.innerHTML=t[0])},i:i,o:i,d(t){t&&I(e)}}}function Gw(t,e,s){let i;p(t,me,t=>s(4,i=t));let n,a,{amount:r}=e,{isPrice:o=!1}=e;return t.$$set=t=>{"amount"in t&&s(1,r=t.amount),"isPrice"in t&&s(2,o=t.isPrice)},t.$$.update=()=>{22&t.$$.dirty&&s(3,n=o&&r>i),10&t.$$.dirty&&s(0,a=zb(r,n))},[a,r,o]}class Hw extends Ht{constructor(t){super(),Gt(this,t,Gw,qw,h,{amount:1,isPrice:2})}}function Xw(t){let e;return{c(){e=B("span")},m(s,i){T(s,e,i),e.innerHTML=t[0]},p(t,[s]){1&s&&(e.innerHTML=t[0])},i:i,o:i,d(t){t&&I(e)}}}function jw(t,e,s){let i;p(t,pe,t=>s(4,i=t));let n,a,{amount:r}=e,{isPrice:o=!1}=e;return t.$$set=t=>{"amount"in t&&s(1,r=t.amount),"isPrice"in t&&s(2,o=t.isPrice)},t.$$.update=()=>{22&t.$$.dirty&&s(3,n=o&&r>i),10&t.$$.dirty&&s(0,a=Ub(r,n))},[a,r,o]}class Jw extends Ht{constructor(t){super(),Gt(this,t,jw,Xw,h,{amount:1,isPrice:2})}}function Vw(t){let e,s,n,a,r,o;return{c(){e=B("span"),s=B("img"),a=B("span"),r=F(t[0]),A(s,"class","svgicon texticon"),s.src!==(n="/assets/ui/icons/gem.svg?v=4597824")&&A(s,"src",n),A(a,"class",o=!t[1]||t[0]<t[2]?"textprimary":"textred")},m(t,i){T(t,e,i),C(e,s),C(e,a),C(a,r)},p(t,[e]){1&e&&O(r,t[0]),7&e&&o!==(o=!t[1]||t[0]<t[2]?"textprimary":"textred")&&A(a,"class",o)},i:i,o:i,d(t){t&&I(e)}}}function Yw(t,e,s){let i;p(t,fe,t=>s(2,i=t));let{amount:n}=e,{isPrice:a=!1}=e;return t.$$set=t=>{"amount"in t&&s(0,n=t.amount),"isPrice"in t&&s(1,a=t.isPrice)},[n,a,i]}class Ww extends Ht{constructor(t){super(),Gt(this,t,Yw,Vw,h,{amount:0,isPrice:1})}}function Qw(t,e,s){const i=t.slice();return i[10]=e[s],i}function Kw(t,e,s){const i=t.slice();return i[13]=e[s],i}function tk(t,e,s){const i=t.slice();return i[13]=e[s],i}function ek(t,e,s){const i=t.slice();return i[18]=e[s],i}function sk(t,e,s){const i=t.slice();return i[10]=e[s],i}function ik(t){let e,s,i,n,a=t[0].gs+"";return{c(){e=B("span"),s=F("GS: "),i=F(a),n=z(),A(e,"class","textgreen")},m(t,a){T(t,e,a),C(e,s),C(e,i),T(t,n,a)},p(t,e){1&e&&a!==(a=t[0].gs+"")&&O(i,a)},d(t){t&&I(e),t&&I(n)}}}function nk(t){let e,s,i,n=t[0].dbid+"";return{c(){e=B("span"),s=F("ID: "),i=F(n),A(e,"class","textgrey")},m(t,n){T(t,e,n),C(e,s),C(e,i)},p(t,e){1&e&&n!==(n=t[0].dbid+"")&&O(i,n)},d(t){t&&I(e)}}}function ak(t){let e,s,i,n,a,r,o,l="bonus"==t[10][1].type?"+ ":"",c=Ib(t[10][0],t[10][1].value)+"",d=tn.ui.stats.array[t[10][0]]+"",h="bonus"==t[10][1].type&&t[4]&&ok(t);return{c(){e=B("div"),s=F(l),i=F(c),n=z(),a=F(d),r=z(),h&&h.c(),A(e,"class",o="text"+up(t[10][1].qual)[0]+" svelte-e3ao5j")},m(t,o){T(t,e,o),C(e,s),C(e,i),C(e,n),C(e,a),C(e,r),h&&h.m(e,null)},p(t,s){"bonus"==t[10][1].type&&t[4]?h?h.p(t,s):(h=ok(t),h.c(),h.m(e,null)):h&&(h.d(1),h=null)},d(t){t&&I(e),h&&h.d()}}}function rk(t){let e,s,i,n,a,r,o,l,c,d,h,u,m=t[0].stats.get(10).value+"",p=t[0].stats.get(11).value+"",f=tn.ui.stats.misc.damage+"";return{c(){e=B("div"),s=B("span"),i=F(m),a=F(" - "),r=B("span"),o=F(p),c=z(),d=B("span"),h=F(f),A(s,"class",n="text"+up(t[0].stats.get(10).qual)[0]+" svelte-e3ao5j"),A(r,"class",l="text"+up(t[0].stats.get(11).qual)[0]+" svelte-e3ao5j"),A(d,"class",u="text"+up(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-e3ao5j")},m(t,n){T(t,e,n),C(e,s),C(s,i),C(e,a),C(e,r),C(r,o),C(e,c),C(e,d),C(d,h)},p(t,e){1&e&&m!==(m=t[0].stats.get(10).value+"")&&O(i,m),1&e&&n!==(n="text"+up(t[0].stats.get(10).qual)[0]+" svelte-e3ao5j")&&A(s,"class",n),1&e&&p!==(p=t[0].stats.get(11).value+"")&&O(o,p),1&e&&l!==(l="text"+up(t[0].stats.get(11).qual)[0]+" svelte-e3ao5j")&&A(r,"class",l),1&e&&u!==(u="text"+up(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-e3ao5j")&&A(d,"class",u)},d(t){t&&I(e)}}}function ok(t){let e,s,n,a=Math.round(t[10][1].qual)+"";return{c(){e=B("span"),s=F(a),n=F("%")},m(t,i){T(t,e,i),C(e,s),C(e,n)},p:i,d(t){t&&I(e)}}}function lk(t){let e,s;function i(t,s){return(null==e||1&s)&&(e=!(10!=t[10][0]||!t[0].stats.has(11))),e?rk:ak}let n=i(t,-1),a=n(t);return{c(){a.c(),s=U()},m(t,e){a.m(t,e),T(t,s,e)},p(t,e){n===(n=i(t,e))&&a?a.p(t,e):(a.d(1),a=n(t),a&&(a.c(),a.m(s.parentNode,s)))},d(t){a.d(t),t&&I(s)}}}function ck(t){let e,s=t[0].logic.custom,i=[];for(let e=0;e<s.length;e+=1)i[e]=dk(ek(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=U()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);T(t,e,s)},p(t,n){if(1&n){let a;for(s=t[0].logic.custom,a=0;a<s.length;a+=1){const r=ek(t,s,a);i[a]?i[a].p(r,n):(i[a]=dk(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){P(i,t),t&&I(e)}}}function dk(t){let e,s,i=t[18]+"";return{c(){e=B("span"),s=F(i),A(e,"class","textgreen")},m(t,i){T(t,e,i),C(e,s)},p(t,e){1&e&&i!==(i=t[18]+"")&&O(s,i)},d(t){t&&I(e)}}}function hk(t){let e,s,i,n=t[13][0]+"";return{c(){e=B("div"),s=F(n),A(e,"class",i=t[13][1]?"textgreen":"textred")},m(t,i){T(t,e,i),C(e,s)},p(t,a){1&a&&n!==(n=t[13][0]+"")&&O(s,n),1&a&&i!==(i=t[13][1]?"textgreen":"textred")&&A(e,"class",i)},d(t){t&&I(e)}}}function uk(t){let e,s,i=tn.ui.inventory.bindlevel[t[0].bound]+"";return{c(){e=B("div"),s=F(i),A(e,"class","textgreen")},m(t,i){T(t,e,i),C(e,s)},p(t,e){1&e&&i!==(i=tn.ui.inventory.bindlevel[t[0].bound]+"")&&O(s,i)},d(t){t&&I(e)}}}function mk(t){let e,s=t[0].buyReasons(Ya&&Ya.player),i=[];for(let e=0;e<s.length;e+=1)i[e]=pk(Kw(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=U()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);T(t,e,s)},p(t,n){if(1&n){let a;for(s=t[0].buyReasons(Ya&&Ya.player),a=0;a<s.length;a+=1){const r=Kw(t,s,a);i[a]?i[a].p(r,n):(i[a]=pk(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){P(i,t),t&&I(e)}}}function pk(t){let e,s,i=t[13][0]+"";return{c(){e=B("div"),A(e,"class",s=t[13][1]?"textgreen":"textred")},m(t,s){T(t,e,s),e.innerHTML=i},p(t,n){1&n&&i!==(i=t[13][0]+"")&&(e.innerHTML=i),1&n&&s!==(s=t[13][1]?"textgreen":"textred")&&A(e,"class",s)},d(t){t&&I(e)}}}function fk(t){let e,s,i;return s=new Jw({props:{amount:t[0].medalValue(),isPrice:!0}}),{c(){e=B("div"),_t(s.$$.fragment)},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};1&e&&(i.amount=t[0].medalValue()),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function gk(t){let e,s,i;return s=new Ww({props:{amount:t[0].storeValue(),isPrice:!0}}),{c(){e=B("div"),_t(s.$$.fragment)},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};1&e&&(i.amount=t[0].storeValue()),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function vk(t){let e,s,i;return s=new Hw({props:{amount:t[0].goldValue(t[1]),isPrice:t[1]}}),{c(){e=B("div"),_t(s.$$.fragment)},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};3&e&&(i.amount=t[0].goldValue(t[1])),2&e&&(i.isPrice=t[1]),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function yk(t){let e,s,i,n,a;const r=[wk,xk],o=[];function l(t,e){return"book"==t[0].type?0:1}e=l(t),s=o[e]=r[e](t);let c=t[5]&&kk();return{c(){s.c(),i=U(),c&&c.c(),n=U()},m(t,s){o[e].m(t,s),T(t,i,s),c&&c.m(t,s),T(t,n,s),a=!0},p(t,a){let d=e;e=l(t),e===d?o[e].p(t,a):(Et(),It(o[d],1,1,()=>{o[d]=null}),Ct(),s=o[e],s||(s=o[e]=r[e](t),s.c()),Tt(s,1),s.m(i.parentNode,i)),t[5]?c||(c=kk(),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null)},i(t){a||(Tt(s),a=!0)},o(t){It(s),a=!1},d(t){o[e].d(t),t&&I(i),c&&c.d(t),t&&I(n)}}}function bk(t){let e,s,n=t[3],a=[];for(let e=0;e<n.length;e+=1)a[e]=$k(Qw(t,n,e));return{c(){e=B("div"),s=B("div"),s.textContent="Equipping this item will have these effects:";for(let t=0;t<a.length;t+=1)a[t].c();A(s,"class","textgrey"),A(e,"class","pack svelte-e3ao5j")},m(t,i){T(t,e,i),C(e,s);for(let t=0;t<a.length;t+=1)a[t].m(e,null)},p(t,s){if(8&s){let i;for(n=t[3],i=0;i<n.length;i+=1){const r=Qw(t,n,i);a[i]?a[i].p(r,s):(a[i]=$k(r),a[i].c(),a[i].m(e,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=n.length}},i:i,o:i,d(t){t&&I(e),P(a,t)}}}function xk(t){let e,s,n=sn(t[0].type,t[0].tier)+"";return{c(){e=B("div"),s=F(n),A(e,"class","pack description svelte-e3ao5j")},m(t,i){T(t,e,i),C(e,s)},p(t,e){1&e&&n!==(n=sn(t[0].type,t[0].tier)+"")&&O(s,n)},i:i,o:i,d(t){t&&I(e)}}}function wk(t){let e,s;return e=new Zw({props:{level:t[0].logic.skilllevel+1,skill:Pf.get(t[0].logic.skillid),asItemDescription:!0}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};1&s&&(i.level=t[0].logic.skilllevel+1),1&s&&(i.skill=Pf.get(t[0].logic.skillid)),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function kk(t){let e;return{c(){e=B("div"),e.textContent="Press Shift to compare item.",A(e,"class","pack svelte-e3ao5j")},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function $k(t){let e,s,i,n,a,r,o=t[10][1]>0?"+":"",l=Ib(t[10][0],t[10][1])+"",c=tn.ui.stats.array[t[10][0]]+"";return{c(){e=B("div"),s=F(o),i=F(l),n=z(),a=F(c),A(e,"class",r="text"+(t[10][1]>0?"green":"red"))},m(t,r){T(t,e,r),C(e,s),C(e,i),C(e,n),C(e,a)},p(t,n){8&n&&o!==(o=t[10][1]>0?"+":"")&&O(s,o),8&n&&l!==(l=Ib(t[10][0],t[10][1])+"")&&O(i,l),8&n&&c!==(c=tn.ui.stats.array[t[10][0]]+"")&&O(a,c),8&n&&r!==(r="text"+(t[10][1]>0?"green":"red"))&&A(e,"class",r)},d(t){t&&I(e)}}}function Sk(t){let e,s,i,n;return s=new Ck({props:{item:t[2],comparison:!0}}),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class",i="slotdescription border "+up(t[2].quality)[0]+" comparecontainer svelte-e3ao5j")},m(t,i){T(t,e,i),Nt(s,e,null),n=!0},p(t,a){const r={};4&a&&(r.item=t[2]),s.$set(r),(!n||4&a&&i!==(i="slotdescription border "+up(t[2].quality)[0]+" comparecontainer svelte-e3ao5j"))&&A(e,"class",i)},i(t){n||(Tt(s.$$.fragment,t),n=!0)},o(t){It(s.$$.fragment,t),n=!1},d(t){t&&I(e),Zt(s)}}}function Mk(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,D,R,L,_,N=t[4]?"T"+(t[0].tier+1)+" ":"",Z=en(t[0].type,t[0].tier)+"",q=t[0].upgrade?" +"+t[0].upgrade:"",G=(t[0].stacks?"":up(t[0].quality)[1])+"",H=t[0].type+"",X=t[0].quality&&!t[0].stacks?t[0].quality+"%":"",j=t[0].medalValue()>0&&t[1],J=t[0].storeValue()>0&&t[1],V=t[0].canBeSold(),Y=t[0].gs>0&&ik(t),W=t[0].dbid&&nk(t),Q=t[7],K=[];for(let e=0;e<Q.length;e+=1)K[e]=lk(sk(t,Q,e));let tt=void 0!==t[0].logic.custom&&ck(t),et=t[0].equipReasons(Ya&&Ya.player),st=[];for(let e=0;e<et.length;e+=1)st[e]=hk(tk(t,et,e));let it=t[0].bound>0&&uk(t),nt=t[1]&&mk(t),at=j&&fk(t),rt=J&&gk(t),ot=V&&vk(t);const lt=[bk,yk],ct=[];function dt(t,e){return t[2]?0:1}D=dt(t),R=ct[D]=lt[D](t);let ht=t[2]&&Sk(t);return{c(){e=B("div"),s=B("div"),i=B("div"),n=F(N),a=F(Z),r=B("span"),o=F(q),c=B("div"),d=F(G),h=z(),u=F(H),m=z(),p=B("span"),f=F(X),g=B("small"),Y&&Y.c(),v=U(),W&&W.c(),y=z(),b=B("div");for(let t=0;t<K.length;t+=1)K[t].c();x=U(),tt&&tt.c(),w=B("div");for(let t=0;t<st.length;t+=1)st[t].c();k=U(),it&&it.c(),$=B("div"),nt&&nt.c(),S=U(),at&&at.c(),M=U(),rt&&rt.c(),E=U(),ot&&ot.c(),R.c(),ht&&ht.c(),L=U(),A(r,"class","textprimary"),A(i,"class",l="slottitle text"+up(t[0].quality)[0]+" svelte-e3ao5j"),A(c,"class","type textwhite svelte-e3ao5j"),A(s,"class","pack svelte-e3ao5j"),A(b,"class","pack svelte-e3ao5j"),A(w,"class","pack svelte-e3ao5j"),A($,"class","panel value pack svelte-e3ao5j"),A(e,"class","container svelte-e3ao5j")},m(t,l){T(t,e,l),C(e,s),C(s,i),C(i,n),C(i,a),C(i,r),C(r,o),C(s,c),C(c,d),C(c,h),C(c,u),C(c,m),C(c,p),C(p,f),C(s,g),Y&&Y.m(g,null),C(g,v),W&&W.m(g,null),C(s,y),C(e,b);for(let t=0;t<K.length;t+=1)K[t].m(b,null);C(b,x),tt&&tt.m(b,null),C(e,w);for(let t=0;t<st.length;t+=1)st[t].m(w,null);C(w,k),it&&it.m(w,null),C(e,$),nt&&nt.m($,null),C($,S),at&&at.m($,null),C($,M),rt&&rt.m($,null),C($,E),ot&&ot.m($,null),ct[D].m(e,null),ht&&ht.m(t,l),T(t,L,l),_=!0},p(t,[s]){if((!_||17&s)&&N!==(N=t[4]?"T"+(t[0].tier+1)+" ":"")&&O(n,N),(!_||1&s)&&Z!==(Z=en(t[0].type,t[0].tier)+"")&&O(a,Z),(!_||1&s)&&q!==(q=t[0].upgrade?" +"+t[0].upgrade:"")&&O(o,q),(!_||1&s&&l!==(l="slottitle text"+up(t[0].quality)[0]+" svelte-e3ao5j"))&&A(i,"class",l),(!_||1&s)&&G!==(G=(t[0].stacks?"":up(t[0].quality)[1])+"")&&O(d,G),(!_||1&s)&&H!==(H=t[0].type+"")&&O(u,H),(!_||1&s)&&X!==(X=t[0].quality&&!t[0].stacks?t[0].quality+"%":"")&&O(f,X),t[0].gs>0?Y?Y.p(t,s):(Y=ik(t),Y.c(),Y.m(g,v)):Y&&(Y.d(1),Y=null),t[0].dbid?W?W.p(t,s):(W=nk(t),W.c(),W.m(g,null)):W&&(W.d(1),W=null),145&s){let e;for(Q=t[7],e=0;e<Q.length;e+=1){const i=sk(t,Q,e);K[e]?K[e].p(i,s):(K[e]=lk(i),K[e].c(),K[e].m(b,x))}for(;e<K.length;e+=1)K[e].d(1);K.length=Q.length}if(void 0!==t[0].logic.custom?tt?tt.p(t,s):(tt=ck(t),tt.c(),tt.m(b,null)):tt&&(tt.d(1),tt=null),1&s){let e;for(et=t[0].equipReasons(Ya&&Ya.player),e=0;e<et.length;e+=1){const i=tk(t,et,e);st[e]?st[e].p(i,s):(st[e]=hk(i),st[e].c(),st[e].m(w,k))}for(;e<st.length;e+=1)st[e].d(1);st.length=et.length}t[0].bound>0?it?it.p(t,s):(it=uk(t),it.c(),it.m(w,null)):it&&(it.d(1),it=null),t[1]?nt?nt.p(t,s):(nt=mk(t),nt.c(),nt.m($,S)):nt&&(nt.d(1),nt=null),3&s&&(j=t[0].medalValue()>0&&t[1]),j?at?(at.p(t,s),3&s&&Tt(at,1)):(at=fk(t),at.c(),Tt(at,1),at.m($,M)):at&&(Et(),It(at,1,1,()=>{at=null}),Ct()),3&s&&(J=t[0].storeValue()>0&&t[1]),J?rt?(rt.p(t,s),3&s&&Tt(rt,1)):(rt=gk(t),rt.c(),Tt(rt,1),rt.m($,E)):rt&&(Et(),It(rt,1,1,()=>{rt=null}),Ct()),1&s&&(V=t[0].canBeSold()),V?ot?(ot.p(t,s),1&s&&Tt(ot,1)):(ot=vk(t),ot.c(),Tt(ot,1),ot.m($,null)):ot&&(Et(),It(ot,1,1,()=>{ot=null}),Ct());let r=D;D=dt(t),D===r?ct[D].p(t,s):(Et(),It(ct[r],1,1,()=>{ct[r]=null}),Ct(),R=ct[D],R||(R=ct[D]=lt[D](t),R.c()),Tt(R,1),R.m(e,null)),t[2]?ht?(ht.p(t,s),4&s&&Tt(ht,1)):(ht=Sk(t),ht.c(),Tt(ht,1),ht.m(L.parentNode,L)):ht&&(Et(),It(ht,1,1,()=>{ht=null}),Ct())},i(t){_||(Tt(at),Tt(rt),Tt(ot),Tt(R),Tt(ht),_=!0)},o(t){It(at),It(rt),It(ot),It(R),It(ht),_=!1},d(t){t&&I(e),Y&&Y.d(),W&&W.d(),P(K,t),tt&&tt.d(),P(st,t),it&&it.d(),nt&&nt.d(),at&&at.d(),rt&&rt.d(),ot&&ot.d(),ct[D].d(),ht&&ht.d(t),t&&I(L)}}}function Ek(t,e,s){let i,{item:n}=e,{comparison:a=!1}=e,{isTrader:r=!1}=e,o=fl.shift.store;p(t,o,t=>s(4,i=t));let l,c,d=n.stats.has(10)?Array.from(n.stats).filter(t=>11!==t[0]):Array.from(n.stats);const h=t=>{const e=new Map;return n.stats.forEach((t,s)=>{e.set(s,t.value)}),t.stats.forEach((t,s)=>{const i=(e.get(s)||0)-t.value;0!==i?e.set(s,i):e.delete(s)}),Array.from(e)};let u;return t.$$set=t=>{"item"in t&&s(0,n=t.item),"comparison"in t&&s(8,a=t.comparison),"isTrader"in t&&s(1,r=t.isTrader)},t.$$.update=()=>{if(273&t.$$.dirty)if(Ya&&i&&!a){const t=n.getEquipSlot();if(void 0!==t&&Ya.player.inventory.slots.has(t)){const e=Ya.player.inventory.slots.get(t);s(2,l=void 0!==e.type?e:void 0),s(3,c=h(e))}}else s(2,l=void 0),s(3,c=void 0);257&t.$$.dirty&&s(5,u=!a&&void 0!==n.getEquipSlot())},[n,r,l,c,i,u,o,d,a]}class Ck extends Ht{constructor(t){super(),Gt(this,t,Ek,Mk,d,{item:0,comparison:8,isTrader:1})}}function Tk(t){let e,s;return e=new Zw({props:{level:t[10]||1,skill:{...Pf.get(t[2].id)}}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};1024&s[0]&&(i.level=t[10]||1),4&s[0]&&(i.skill={...Pf.get(t[2].id)}),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function Ik(t){let e,s;return e=new Ck({props:{item:t[6]}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};64&s[0]&&(i.item=t[6]),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function Pk(t){let e,s,i,n;const a=[Ik,Tk],r=[];function o(t,e){return t[6]?0:t[2].id>=0?1:-1}return~(e=o(t))&&(s=r[e]=a[e](t)),{c(){s&&s.c(),i=U()},m(t,s){~e&&r[e].m(t,s),T(t,i,s),n=!0},p(t,n){let l=e;e=o(t),e===l?~e&&r[e].p(t,n):(s&&(Et(),It(r[l],1,1,()=>{r[l]=null}),Ct()),~e?(s=r[e],s||(s=r[e]=a[e](t),s.c()),Tt(s,1),s.m(i.parentNode,i)):s=null)},i(t){n||(Tt(s),n=!0)},o(t){It(s),n=!1},d(t){~e&&r[e].d(t),t&&I(i)}}}function Bk(t){let e,s;return e=new Yx({props:{describe:t[2].id>=0&&!t[2].item||void 0!==t[6],descPos:"bottom:100%;left:50%;transform:translateX(-50%);",",":!0,status:t[13]?-1:void 0!==t[4]?t[4].status:0,id:"sk"+t[2].hotkey,data:t[2].id>=0||void 0!==t[6]?t[2]:void 0,auto:t[15],queued:t[14],meta:t[1],css:t[5],stacks:t[8],cd:t[11],img:t[7],remaining:t[12],key:t[2].hotkey,border:t[14]||t[9]?"auto":t[13]||t[15]||t[3]||t[11]?"grey":t[6]?up(t[6].quality)[0]:"white",$$slots:{default:[Pk]},$$scope:{ctx:t}}}),e.$on("discard",t[17]),e.$on("move",t[18]),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};68&s[0]&&(i.describe=t[2].id>=0&&!t[2].item||void 0!==t[6]),8208&s[0]&&(i.status=t[13]?-1:void 0!==t[4]?t[4].status:0),4&s[0]&&(i.id="sk"+t[2].hotkey),68&s[0]&&(i.data=t[2].id>=0||void 0!==t[6]?t[2]:void 0),32768&s[0]&&(i.auto=t[15]),16384&s[0]&&(i.queued=t[14]),2&s[0]&&(i.meta=t[1]),32&s[0]&&(i.css=t[5]),256&s[0]&&(i.stacks=t[8]),2048&s[0]&&(i.cd=t[11]),128&s[0]&&(i.img=t[7]),4096&s[0]&&(i.remaining=t[12]),4&s[0]&&(i.key=t[2].hotkey),59976&s[0]&&(i.border=t[14]||t[9]?"auto":t[13]||t[15]||t[3]||t[11]?"grey":t[6]?up(t[6].quality)[0]:"white"),1092&s[0]|8&s[1]&&(i.$$scope={dirty:s,ctx:t}),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function Fk(t,e,s){let n,a,r,o,l,c,d=i,h=()=>(d(),d=m(u,t=>s(2,n=t)),u);p(t,ye,t=>s(25,a=t)),p(t,ve,t=>s(27,r=t)),p(t,be,t=>s(28,o=t)),p(t,we,t=>s(29,l=t)),p(t,ke,t=>s(30,c=t)),t.$$.on_destroy.push(()=>d());let{skill:u}=e;h();let{skillslot:f}=e,g=void 0,v=void 0,y=void 0,b=void 0;it(()=>{if(n.hotkey!==g&&(void 0!==v&&$(),g=n.hotkey,void 0!==g)){b=fl[g],null==b&&(b=fl[g]={});const t=bl(g,b);v=t.onPress(w),y=t.onRelease(k)}});const w=()=>{if(Ya.player&&n.id>=0){if(n.item){const t=Ya.player.inventory.findFirstSlotOfType(n.item.type,n.item.tier);if(void 0===t)return;x(u,n.info[0]=t,n)}fm(mo.clientPlayerSkill.packData({id:n.id,info:n.info})),s(9,D=!0),nl({id:"ui/pressbtn"})}},k=()=>{s(9,D=!1)},$=()=>{b&&b.mappings&&(b.mappings=b.mappings.filter(t=>t!=g)),b&&b.press&&(b.press=b.press.filter(t=>t!=v)),b&&b.release&&(b.release=b.release.filter(t=>t!=y)),g=void 0,v=void 0,y=void 0};function S(e){rt(t,e)}function M(e){rt(t,e)}let E,C,T,I,P,B,F,z,U,D,A,R,L,O,_,N;return nt($),t.$$set=t=>{"skill"in t&&h(s(0,u=t.skill)),"skillslot"in t&&s(16,f=t.skillslot)},t.$$.update=()=>{65540&t.$$.dirty[0]&&s(1,E={type:"skill",slot:f,skill:n}),4&t.$$.dirty[0]&&s(3,C=n.id<0),4&t.$$.dirty[0]&&s(24,T=n.item),33554444&t.$$.dirty[0]&&s(4,I=C?void 0:a[n.id]),16&t.$$.dirty[0]&&(P=I?I.status:0),4&t.$$.dirty[0]&&s(5,B=n.item?"slotitem":"slotskill"),134217732&t.$$.dirty[0]&&s(6,F=r&&n.item&&Ya.player?Ya.player.inventory.findFirstItemOfType(n.item.type,n.item.tier):void 0),16777292&t.$$.dirty[0]&&s(7,z=C?void 0:T?F?yy(F.type,F.tier,F.logic.class,hp(F.quality)):yy(T.type,T.tier,0,0):by(n.id)),150995008&t.$$.dirty[0]&&s(8,U=void 0!==F&&void 0!==F.stacks?r[T.type+T.tier]||0:void 0),268435468&t.$$.dirty[0]&&s(10,A=n.item||C?0:o.reduce((t,e)=>t+(e.logic.id===n.id&&e.level),0)),16&t.$$.dirty[0]&&s(11,R=I?I.cd:void 0),16&t.$$.dirty[0]&&s(12,L=I?I.remaining:void 0),1348&t.$$.dirty[0]&&s(13,O=n.item&&(!F||0===U)||!n.item&&0===A),536870916&t.$$.dirty[0]&&s(14,_=void 0!==l&&l===n.id),1073741828&t.$$.dirty[0]&&s(15,N=void 0!==c&&c===n.id)},s(9,D=!1),[u,E,n,C,I,B,F,z,U,D,A,R,L,O,_,N,f,S,M]}class zk extends Ht{constructor(t){super(),Gt(this,t,Fk,Bk,d,{skill:0,skillslot:16},[-1,-1])}}function Uk(t,e,s){const i=t.slice();return i[8]=e[s],i[10]=s,i}function Dk(t){let e,s;return e=new zk({props:{skill:t[8],skillslot:t[10]}}),e.$on("discard",t[1]),e.$on("move",t[0]),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p:i,i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function Ak(t){let e,s,i=He,n=[];for(let e=0;e<i.length;e+=1)n[e]=Dk(Uk(t,i,e));const a=t=>It(n[t],1,1,()=>{n[t]=null});return{c(){e=B("div");for(let t=0;t<n.length;t+=1)n[t].c();A(e,"id","skillbar"),A(e,"class","panel-black bar svelte-1v6qmvo")},m(t,i){T(t,e,i);for(let t=0;t<n.length;t+=1)n[t].m(e,null);s=!0},p(t,[s]){if(3&s){let r;for(i=He,r=0;r<i.length;r+=1){const a=Uk(t,i,r);n[r]?(n[r].p(a,s),Tt(n[r],1)):(n[r]=Dk(a),n[r].c(),Tt(n[r],1),n[r].m(e,null))}for(Et(),r=i.length;r<n.length;r+=1)a(r);Ct()}},i(t){if(!s){for(let t=0;t<i.length;t+=1)Tt(n[t]);s=!0}},o(t){n=n.filter(Boolean);for(let t=0;t<n.length;t+=1)It(n[t]);s=!1},d(t){t&&I(e),P(n,t)}}}function Rk(t,e,s){let i,n,a;p(t,Ss,t=>s(3,i=t)),p(t,Mi,t=>s(4,n=t)),p(t,he,t=>s(5,a=t));const r=Ya.player.name;let o=i[r];o||(o=x(Ss,i[r]=[],i));for(let t=0;t<n;++t)if(void 0===i[r][t]){const e=lg[Ya.player.class].startSkills[t];i[r].push({id:void 0!==e&&Pf.get(e).autoSkillbar?e:-1,type:0,info:[]}),4===t||5===t?(x(Ss,i[r][t].id=100,i),x(Ss,i[r][t].item={type:"misc",tier:t-4},i)):11===t&&x(Ss,i[r][11].id=40,i)}for(let t=0;t<n;++t)void 0===He[t]&&He.push(jt({id:-1,type:0,info:[]}));i[r].forEach((t,e)=>{He[e]&&(t.hotkey=Qi["kbSkillbar"+(e+1)],He[e].set(t))}),He.forEach((t,e)=>{t.subscribe(t=>{Ss.update(s=>(s[r][e]=t,s))})});const l=t=>{const{from:e,to:s}=t.detail;e!==s&&("item"==e.type?He[s.slot].update(t=>(t.id=e.item.logic.useSkill,t.item={type:e.item.type,tier:e.item.tier},t)):"skill"==e.type&&(He[s.slot].update(t=>(t.id=e.skill.id,t.item=e.skill.item,t)),void 0!==e.slot&&He[e.slot].update(c)))},c=t=>(t.id=-1,t.item=void 0,t);return[l,t=>{He[a.meta.slot].update(c)}]}class Lk extends Ht{constructor(t){super(),Gt(this,t,Rk,Ak,h,{})}}function Ok(t){let e,s;return e=new Ck({props:{isTrader:t[6],item:t[9]}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};64&s&&(i.isTrader=t[6]),512&s&&(i.item=t[9]),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function _k(t){let e,s,i=t[9]&&Ok(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,s){t[9]?i?(i.p(t,s),512&s&&Tt(i,1)):(i=Ok(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function Nk(t){let e,s;return e=new Yx({props:{describe:void 0!==t[9],cd:t[14],id:t[7],hover:t[5],descPos:t[4],descRoot:t[3],pickable:t[1],status:t[11]?-1:0,meta:t[10],img:t[8],border:t[12],stacks:t[13],data:t[9],key:t[2],$$slots:{default:[_k]},$$scope:{ctx:t}}}),e.$on("discard",t[18]),e.$on("use",t[19]),e.$on("click",t[20]),e.$on("context",t[21]),e.$on("move",t[22]),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,[s]){const i={};512&s&&(i.describe=void 0!==t[9]),16384&s&&(i.cd=t[14]),128&s&&(i.id=t[7]),32&s&&(i.hover=t[5]),16&s&&(i.descPos=t[4]),8&s&&(i.descRoot=t[3]),2&s&&(i.pickable=t[1]),2048&s&&(i.status=t[11]?-1:0),1024&s&&(i.meta=t[10]),256&s&&(i.img=t[8]),4096&s&&(i.border=t[12]),8192&s&&(i.stacks=t[13]),512&s&&(i.data=t[9]),4&s&&(i.key=t[2]),67109440&s&&(i.$$scope={dirty:s,ctx:t}),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function Zk(t,e,s){let n,a,r=i,o=()=>(r(),r=m(l,t=>s(9,n=t)),l);p(t,ye,t=>s(24,a=t)),t.$$.on_destroy.push(()=>r());let{item:l}=e;o();let{filter:c=""}=e,{invslot:d}=e,{pickable:h=!0}=e,{text:u}=e,{descRoot:f}=e,{descPos:g}=e,{hover:v}=e,{isTrader:y=!1}=e,{clearOnMove:b=!1}=e,{id:x=""}=e;const w=t=>!(!0!==t&&!n.moving)||!!t&&!(n.type.includes(t)||n.logic.level>t||tn.items[n.type]["book"===n.type?n.logic.skillid:n.tier].name.toLowerCase().includes(t));function k(e){rt(t,e)}function $(e){rt(t,e)}function S(e){rt(t,e)}function M(e){rt(t,e)}function E(e){rt(t,e)}let C,T,I,P,B,F,z;return t.$$set=t=>{"item"in t&&o(s(0,l=t.item)),"filter"in t&&s(15,c=t.filter),"invslot"in t&&s(16,d=t.invslot),"pickable"in t&&s(1,h=t.pickable),"text"in t&&s(2,u=t.text),"descRoot"in t&&s(3,f=t.descRoot),"descPos"in t&&s(4,g=t.descPos),"hover"in t&&s(5,v=t.hover),"isTrader"in t&&s(6,y=t.isTrader),"clearOnMove"in t&&s(17,b=t.clearOnMove),"id"in t&&s(7,x=t.id)},t.$$.update=()=>{66048&t.$$.dirty&&s(8,C=n?yy(n.type,n.tier,n.logic?n.logic.class:0,hp(n.quality)):d>100?xy(d):void 0),197121&t.$$.dirty&&s(10,T={type:"item",slot:d,item:n,store:b?l:void 0}),33344&t.$$.dirty&&s(11,I=n&&(y?!n.canEquipClass(Ya.player):w(c))),2624&t.$$.dirty&&s(12,P=n?up(n.quality)[0]+(I?" grey":y?n.canEquip(Ya.player)?"":" red":""):"grey"),512&t.$$.dirty&&s(13,B=n&&(n.upgrade?"+"+n.upgrade:n.stacks)),16777728&t.$$.dirty&&s(23,F=n&&n.logic.use?n.logic.useSkill&&a[n.logic.useSkill]:void 0),8388608&t.$$.dirty&&s(14,z=F?F.cd:void 0)},[l,h,u,f,g,v,y,x,C,n,T,I,P,B,z,c,d,b,k,$,S,M,E]}class qk extends Ht{constructor(t){super(),Gt(this,t,Zk,Nk,d,{item:0,filter:15,invslot:16,pickable:1,text:2,descRoot:3,descPos:4,hover:5,isTrader:6,clearOnMove:17,id:7})}}function Gk(t,e,s){const i=t.slice();return i[15]=e[s],i[17]=s,i}function Hk(t){let e,s;return e=new qk({props:{id:"bag"+t[17],item:t[15],invslot:t[17],filter:t[0].toLowerCase()}}),e.$on("use",t[8]),e.$on("context",t[7]),e.$on("move",t[6]),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};2&s&&(i.item=t[15]),1&s&&(i.filter=t[0].toLowerCase()),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function Xk(t){let e,s,i,n,a,r,o,l,c,d=t[1].filter(Jk),h=[];for(let e=0;e<d.length;e+=1)h[e]=Hk(Gk(t,d,e));const u=t=>It(h[t],1,1,()=>{h[t]=null});return n=new Hw({props:{amount:t[4]}}),r=new Ww({props:{amount:t[5]}}),{c(){e=B("input"),s=B("div");for(let t=0;t<h.length;t+=1)h[t].c();i=B("div"),_t(n.$$.fragment),a=B("a"),_t(r.$$.fragment),A(e,"class","filter svelte-1axz35n"),A(e,"type","text"),A(e,"placeholder","Filter"),A(s,"class","slotcontainer svelte-1axz35n"),N(s,"grid-template-columns","repeat("+t[3]+", auto)"),A(i,"class","panel-black gold svelte-1axz35n"),A(a,"class","panel-black gold svelte-1axz35n"),N(a,"margin-right","3px"),A(a,"target","_blank"),A(a,"href","/store")},m(d,u){T(d,e,u),_(e,t[0]),T(d,s,u);for(let t=0;t<h.length;t+=1)h[t].m(s,null);T(d,i,u),Nt(n,i,null),T(d,a,u),Nt(r,a,null),o=!0,l||(c=D(e,"input",t[9]),l=!0)},p(t,i){if(1&i&&e.value!==t[0]&&_(e,t[0]),451&i){let e;for(d=t[1].filter(Jk),e=0;e<d.length;e+=1){const n=Gk(t,d,e);h[e]?(h[e].p(n,i),Tt(h[e],1)):(h[e]=Hk(n),h[e].c(),Tt(h[e],1),h[e].m(s,null))}for(Et(),e=d.length;e<h.length;e+=1)u(e);Ct()}(!o||8&i)&&N(s,"grid-template-columns","repeat("+t[3]+", auto)");const a={};16&i&&(a.amount=t[4]),n.$set(a);const l={};32&i&&(l.amount=t[5]),r.$set(l)},i(t){if(!o){for(let t=0;t<d.length;t+=1)Tt(h[t]);Tt(n.$$.fragment,t),Tt(r.$$.fragment,t),o=!0}},o(t){h=h.filter(Boolean);for(let t=0;t<h.length;t+=1)It(h[t]);It(n.$$.fragment,t),It(r.$$.fragment,t),o=!1},d(t){t&&I(e),t&&I(s),P(h,t),t&&I(i),Zt(n),t&&I(a),Zt(r),l=!1,c()}}}function jk(t){let e,s,i;return s=new wb({props:{title:"Inventory",pad:"5",icon:"bag",$$slots:{default:[Xk]},$$scope:{ctx:t}}}),s.$on("close",t[10]),{c(){e=B("div"),_t(s.$$.fragment),N(e,"display",t[2]?"block":"none"),A(e,"class","l-corner-lr container svelte-1axz35n")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,[n]){const a={};262203&n&&(a.$$scope={dirty:n,ctx:t}),s.$set(a),(!i||4&n)&&N(e,"display",t[2]?"block":"none")},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}const Jk=(t,e)=>e<101;function Vk(t,e,s){let i,n,a,r,o,l,c,d,h;p(t,ge,t=>s(1,i=t)),p(t,he,t=>s(11,n=t)),p(t,De,t=>s(12,a=t)),p(t,Re,t=>s(13,r=t)),p(t,Pe,t=>s(14,o=t)),p(t,ms,t=>s(2,l=t)),p(t,us,t=>s(3,c=t)),p(t,me,t=>s(4,d=t)),p(t,fe,t=>s(5,h=t));let u="";const m=t=>{const{from:e,to:s}=t.detail;if(e!==s&&"item"==e.type){if(Jm("itemmove",`${e.slot} ${s.slot}`),e.slot>=101)return;e.item.stacks&&(e.item.stacks=""),e.item.moving=!0,s.item?(s.item.stacks&&(s.item.stacks=""),i[e.slot].set(s.item),s.item.moving=!0):i[e.slot]&&i[e.slot].set(void 0),i[s.slot].set(e.item)}};function f(){u=this.value,s(0,u)}const g=t=>x(ms,l=!1);return[u,i,l,c,d,h,m,t=>{if(!t.detail.item||n)return;const e=[];if(a)e.push(Vy.itemstash(t.detail.slot));else{if(t.detail.item.canEquip(Ya.player)){const s=t.detail.item.getBestEquipslot(Ya.player.inventory);void 0!==s&&e.push(Vy.itemmove(t.detail.slot,s)),t.detail.item.logic.use&&e.push(Vy.itemuse(t.detail.slot,t.detail.item.logic.useSkill))}r&&t.detail.item.canBeSold()&&e.push(Vy.itemsell(t.detail.item.quality,t.detail.item.upgrade,t.detail.slot,t.detail.item.type,t.detail.item.tier)),t.detail.item.stacks>1&&(e.push(Vy.itemsplithalf(t.detail.slot)),e.push(Vy.itemsplitone(t.detail.slot))),e.push(Vy.itemcopyid(t.detail.item.dbid)),t.detail.item.canBeDropped()&&e.push(Vy.itemdrop(t.detail.item.quality,t.detail.item.upgrade,t.detail.slot,t.detail.item.type,t.detail.item.tier))}Wt.set({x:t.detail.e.pageX-t.detail.e.layerX,y:t.detail.e.pageY+(46-t.detail.e.layerY),opts:e})},t=>{t.detail.item&&(a?Jm("itemstash",""+t.detail.slot):o?Fe.set(t.detail.item):r&&t.detail.item.canBeSold()?Qy(t.detail.item.quality,t.detail.item.upgrade,t.detail.slot,t.detail.item.type,t.detail.item.tier):t.detail.item.canBeDropped()&&Ky(t.detail.item.quality,t.detail.item.upgrade,t.detail.slot,t.detail.item.type,t.detail.item.tier))},f,g]}class Yk extends Ht{constructor(t){super(),Gt(this,t,Vk,jk,d,{})}}const Wk=new Map,Qk=new id(0,.5),Kk=()=>{Wk.clear(),Qk.reset(0)},t$=Kk,e$=t=>{Qi.dpsmeterOpen&&Qk.done(Ya.time)&&(Qk.reset(Ya.time),Wk.forEach((t,e)=>{if(t.ooc)return void(Ya.time-t.start>5&&Wk.delete(e));!Ya.entity(t.id)||Ya.time-t.last>5?(t.ooc=!0,t.start=Ya.time):t.dps=Math.ceil(t.amount/Math.max(5,Ya.time-t.start))}),Ze.set(Array.from(Wk).sort((t,e)=>e[1].dps-t[1].dps).slice(0,10)))},s$=(t,e)=>{if(void 0===t.name||!Qi.dpsmeterOpen||0!==t.type)return;if(Qi.dpsmeterParty&&(0===Ya.player.party&&t!==Ya.player||t.party!==Ya.player.party))return;let s=void 0;Wk.has(t.name)?s=Wk.get(t.name):(Wk.set(t.name,s={}),s.amount=0,s.start=0,s.class=t.class,s.dps=0,s.id=t.id,s.ooc=!0),s.ooc?(s.start=Ya.time,s.ooc=!1,s.amount=e):s.amount+=e,s.last=Ya.time};var i$=Object.freeze({__proto__:null,values:Wk,init:Kk,onWorldEnter:t$,tick:e$,add:s$});function n$(t,e,s){const i=t.slice();return i[8]=e[s],i[10]=s,i}function a$(t){let e,s,i;return s=new wb({props:{title:t[1],pad:"5",icon:"trophy",$$slots:{default:[o$]},$$scope:{ctx:t}}}),s.$on("close",t[7]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","l-corner-lr container svelte-wamtsw")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};2&e&&(i.title=t[1]),2062&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function r$(t,e){let s,i,n;return i=new Jb({props:{size:"0.9em",fract:Math.round(100*e[8][1].dps/e[2][0][1].dps),barcol:"bgc"+e[8][1].class,left:`${e[10]+1}. ${e[8][0]}`,right:`${Sb(e[8][1].amount)} (${Mb(e[8][1].dps)})`}}),{key:t,first:null,c(){s=U(),_t(i.$$.fragment),this.first=s},m(t,e){T(t,s,e),Nt(i,t,e),n=!0},p(t,e){const s={};4&e&&(s.fract=Math.round(100*t[8][1].dps/t[2][0][1].dps)),4&e&&(s.barcol="bgc"+t[8][1].class),4&e&&(s.left=`${t[10]+1}. ${t[8][0]}`),4&e&&(s.right=`${Sb(t[8][1].amount)} (${Mb(t[8][1].dps)})`),i.$set(s)},i(t){n||(Tt(i.$$.fragment,t),n=!0)},o(t){It(i.$$.fragment,t),n=!1},d(t){t&&I(s),Zt(i,t)}}}function o$(t){let e,s,i,n,a,r,o,c,d,h,u,m=[],p=new Map,f=t[2];const g=t=>t[8][1].id;for(let e=0;e<f.length;e+=1){let s=n$(t,f,e),i=g(s);p.set(i,m[e]=r$(i,s))}return{c(){e=B("div");for(let t=0;t<m.length;t+=1)m[t].c();s=B("div"),i=B("div"),n=F(t[1]),a=B("div"),r=F("Party"),c=B("div"),c.textContent="Reset",A(e,"class","wrapper svelte-wamtsw"),A(i,"class","btn grey"),A(a,"class",o="btn "+(t[3]?"grey active":"black")),A(c,"class","btn grey"),A(s,"class","grid buttons marg-top svelte-wamtsw"),N(s,"grid-template-columns","2fr 1fr 1fr")},m(o,l){T(o,e,l);for(let t=0;t<m.length;t+=1)m[t].m(e,null);T(o,s,l),C(s,i),C(i,n),C(s,a),C(a,r),C(s,c),d=!0,h||(u=[D(i,"click",t[4]),D(a,"click",t[5]),D(c,"click",t[6])],h=!0)},p(t,s){if(4&s){const i=t[2];Et(),m=At(m,s,g,1,t,i,p,e,Dt,r$,null,n$),Ct()}(!d||2&s)&&O(n,t[1]),(!d||8&s&&o!==(o="btn "+(t[3]?"grey active":"black")))&&A(a,"class",o)},i(t){if(!d){for(let t=0;t<f.length;t+=1)Tt(m[t]);d=!0}},o(t){for(let t=0;t<m.length;t+=1)It(m[t]);d=!1},d(t){t&&I(e);for(let t=0;t<m.length;t+=1)m[t].d();t&&I(s),h=!1,l(u)}}}function l$(t){let e,s,i=t[0]&&a$(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),1&s&&Tt(i,1)):(i=a$(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function c$(t,e,s){let i,n,a,r;p(t,gs,t=>s(0,i=t)),p(t,ks,t=>s(1,n=t)),p(t,Ze,t=>s(2,a=t)),p(t,ws,t=>s(3,r=t));const o=t=>x(ws,r=!r),l=t=>x(gs,i=!1);return[i,n,a,r,t=>{Wt.set({x:t.pageX,y:t.pageY-50,opts:["Damage","Healing"].map(t=>({name:t,fun:()=>{ks.set(t),Wk.clear()}}))})},o,t=>Wk.clear(),l]}class d$ extends Ht{constructor(t){super(),Gt(this,t,c$,l$,d,{})}}function h$(t){let e,s,i,n,a,r=t[0].Tz+"";return{c(){e=B("p"),s=F(r),n=z(),A(e,"class","text location textgreen svelte-dujqu3")},m(t,i){T(t,e,i),C(e,s),T(t,n,i),a=!0},p(t,e){(!a||1&e)&&r!==(r=t[0].Tz+"")&&O(s,r)},i(t){a||(ft(()=>{i||(i=Ft(e,Hu,{},!0)),i.run(1)}),a=!0)},o(t){i||(i=Ft(e,Hu,{},!1)),i.run(0),a=!1},d(t){t&&I(e),t&&i&&i.end(),t&&I(n)}}}function u$(t){let e,s,i,n,a=t[0].error+"";return{c(){e=B("p"),s=F(a),A(e,"class","text error textred svelte-dujqu3")},m(t,i){T(t,e,i),C(e,s),n=!0},p(t,e){(!n||1&e)&&a!==(a=t[0].error+"")&&O(s,a)},i(t){n||(i&&i.end(1),n=!0)},o(t){i=Bt(e,Hu,{}),n=!1},d(t){t&&I(e),t&&i&&i.end()}}}function m$(t){let e,s,i,n=t[0].Tz&&h$(t),a=t[0].error&&u$(t);return{c(){e=B("div"),n&&n.c(),s=U(),a&&a.c(),A(e,"class","l-ui")},m(t,r){T(t,e,r),n&&n.m(e,null),C(e,s),a&&a.m(e,null),i=!0},p(t,[i]){t[0].Tz?n?(n.p(t,i),1&i&&Tt(n,1)):(n=h$(t),n.c(),Tt(n,1),n.m(e,s)):n&&(Et(),It(n,1,1,()=>{n=null}),Ct()),t[0].error?a?(a.p(t,i),1&i&&Tt(a,1)):(a=u$(t),a.c(),Tt(a,1),a.m(e,null)):a&&(Et(),It(a,1,1,()=>{a=null}),Ct())},i(t){i||(Tt(n),Tt(a),i=!0)},o(t){It(n),It(a),i=!1},d(t){t&&I(e),n&&n.d(),a&&a.d()}}}function p$(t,e,s){let i={},n={};return Kt.subscribe(t=>{s(0,i[t.type]=t.text,i),n[t.type]&&clearTimeout(n[t.type]),n[t.type]=setTimeout(()=>{s(0,i[t.type]=void 0,i)},t.time||1e3)}),[i]}class f$ extends Ht{constructor(t){super(),Gt(this,t,p$,m$,d,{})}}function g$(t,e,s){const i=t.slice();return i[6]=e[s],i}function v$(t){let e,s,i,n,a,r;return s=new wb({props:{title:"Request",close:!1,$$slots:{default:[b$]},$$scope:{ctx:t}}}),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","absCentered container svelte-cy0tay")},m(i,o){T(i,e,o),Nt(s,e,null),n=!0,a||(r=D(e,"outroend",t[5]),a=!0)},p(t,e){const i={};518&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){n||(Tt(s.$$.fragment,t),ft(()=>{i||(i=Ft(e,Hu,{duration:100},!0)),i.run(1)}),n=!0)},o(t){It(s.$$.fragment,t),i||(i=Ft(e,Hu,{duration:100},!1)),i.run(0),n=!1},d(t){t&&I(e),Zt(s),t&&i&&i.end(),a=!1,r()}}}function y$(t){let e,s,i,n,a,r,o=t[6].text+"",l=t[6].nocombat&&t[2].combat?" (Must leave combat)":"";function c(...e){return t[4](t[6],...e)}return{c(){e=B("div"),s=F(o),i=F(l),A(e,"class",n="choice "+(t[6].nocombat&&t[2].combat?"nocombat textgrey":"")+" svelte-cy0tay")},m(t,n){T(t,e,n),C(e,s),C(e,i),a||(r=D(e,"click",c),a=!0)},p(a,r){t=a,2&r&&o!==(o=t[6].text+"")&&O(s,o),6&r&&l!==(l=t[6].nocombat&&t[2].combat?" (Must leave combat)":"")&&O(i,l),6&r&&n!==(n="choice "+(t[6].nocombat&&t[2].combat?"nocombat textgrey":"")+" svelte-cy0tay")&&A(e,"class",n)},d(t){t&&I(e),a=!1,r()}}}function b$(t){let e,s,i,n,a=t[1][0].title+"",r=t[1][0].text+"",o=t[1][0].choices,l=[];for(let e=0;e<o.length;e+=1)l[e]=y$(g$(t,o,e));return{c(){e=B("div"),s=B("h3"),i=F(a),n=B("p");for(let t=0;t<l.length;t+=1)l[t].c();A(s,"class","textprimary"),A(e,"class","container svelte-cy0tay")},m(t,a){T(t,e,a),C(e,s),C(s,i),C(e,n),n.innerHTML=r;for(let t=0;t<l.length;t+=1)l[t].m(e,null)},p(t,s){if(2&s&&a!==(a=t[1][0].title+"")&&O(i,a),2&s&&r!==(r=t[1][0].text+"")&&(n.innerHTML=r),14&s){let i;for(o=t[1][0].choices,i=0;i<o.length;i+=1){const n=g$(t,o,i);l[i]?l[i].p(n,s):(l[i]=y$(n),l[i].c(),l[i].m(e,null))}for(;i<l.length;i+=1)l[i].d(1);l.length=o.length}},d(t){t&&I(e),P(l,t)}}}function x$(t){let e,s,i=t[1].length&&!t[0]&&v$(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[1].length&&!t[0]?i?(i.p(t,s),3&s&&Tt(i,1)):(i=v$(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function w$(t,e,s){let i,n;p(t,Qt,t=>s(1,i=t)),p(t,oe,t=>s(2,n=t));let a=!1;const r=async t=>{t&&await t(),Qt.update(t=>(t.shift(),t)),s(0,a=!0)},o=t=>{r(t.fun)},l=()=>{s(0,a=!1)};return[a,i,n,r,o,l]}class k$ extends Ht{constructor(t){super(),Gt(this,t,w$,x$,d,{})}}function $$(t){let e,s,i,n,a=t[0][0].text+"",r=t[0][0].icon&&S$(t);return{c(){e=B("div"),r&&r.c(),s=B("div"),A(e,"class","notification panel-black border grey svelte-9nlpzp")},m(o,l){T(o,e,l),r&&r.m(e,null),C(e,s),s.innerHTML=a,i||(n=D(e,"click",t[2]),i=!0)},p(t,i){t[0][0].icon?r?r.p(t,i):(r=S$(t),r.c(),r.m(e,s)):r&&(r.d(1),r=null),1&i&&a!==(a=t[0][0].text+"")&&(s.innerHTML=a)},d(t){t&&I(e),r&&r.d(),i=!1,n()}}}function S$(t){let e,s,i;return{c(){e=B("img"),A(e,"class",s="icon "+t[0][0].css+" svelte-9nlpzp"),e.src!==(i="/assets/ui/"+t[0][0].icon)&&A(e,"src",i)},m(t,s){T(t,e,s)},p(t,n){1&n&&s!==(s="icon "+t[0][0].css+" svelte-9nlpzp")&&A(e,"class",s),1&n&&e.src!==(i="/assets/ui/"+t[0][0].icon)&&A(e,"src",i)},d(t){t&&I(e)}}}function M$(t){let e,s=t[0].length&&!t[1]&&$$(t);return{c(){s&&s.c(),e=U()},m(t,i){s&&s.m(t,i),T(t,e,i)},p(t,[i]){t[0].length&&!t[1]?s?s.p(t,i):(s=$$(t),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i:i,o:i,d(t){s&&s.d(t),t&&I(e)}}}function E$(t,e,s){let i,n;return p(t,Jt,t=>s(0,i=t)),p(t,ne,t=>s(1,n=t)),[i,n,()=>{Jt.update(t=>(t.shift(),t))}]}class C$ extends Ht{constructor(t){super(),Gt(this,t,E$,M$,d,{})}}function T$(t,e,s){const i=t.slice();return i[5]=e[s],i}function I$(t){let e,s;return{c(){e=B("div"),s=F(t[0]),A(e,"class","btn border grey")},m(t,i){T(t,e,i),C(e,s)},p(t,e){1&e&&O(s,t[0])},d(t){t&&I(e)}}}function P$(t){let e,s,i,n,a,r;function o(...e){return t[2](t[5],...e)}function c(...e){return t[4](t[5],...e)}return{c(){e=B("div"),s=B("img"),A(s,"class","svgicon"),s.src!==(i="/assets/ui/icons/"+t[5].img+".svg?v=4597824")&&A(s,"src",i),A(e,"id",n="sys"+t[5].img),A(e,"class","btn border black")},m(i,n){T(i,e,n),C(e,s),a||(r=[D(e,"mouseenter",o),D(e,"mouseleave",t[3]),D(e,"click",c)],a=!0)},p(e,s){t=e},d(t){t&&I(e),a=!1,l(r)}}}function B$(t){let e,s,n=""!==t[0]&&I$(t),a=t[1],r=[];for(let e=0;e<a.length;e+=1)r[e]=P$(T$(t,a,e));return{c(){e=B("div"),n&&n.c(),s=U();for(let t=0;t<r.length;t+=1)r[t].c();A(e,"class","btnbar svelte-133q4bd")},m(t,i){T(t,e,i),n&&n.m(e,null),C(e,s);for(let t=0;t<r.length;t+=1)r[t].m(e,null)},p(t,[i]){if(""!==t[0]?n?n.p(t,i):(n=I$(t),n.c(),n.m(e,s)):n&&(n.d(1),n=null),3&i){let s;for(a=t[1],s=0;s<a.length;s+=1){const n=T$(t,a,s);r[s]?r[s].p(n,i):(r[s]=P$(n),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=a.length}},i:i,o:i,d(t){t&&I(e),n&&n.d(),P(r,t)}}}function F$(t,e,s){let i="";const n=(t,e)=>s(0,i=t.desc),a=t=>s(0,i="");return[i,[{img:"gem",store:ys,desc:"Elixir"},{img:"char",store:$s,desc:"Character"},{img:"book",store:fs,desc:"Skills"},{img:"bag",store:ms,desc:"Inventory"},{img:"pvp",store:xs,desc:"PVP"},{img:"clan",store:bs,desc:"Clan"},{img:"trophy",store:gs,desc:"DPS Meter"},{img:"cog",store:ps,desc:"Settings"},{img:"fullscreen",fun:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},desc:"Fullscreen"},{img:"back",fun:()=>{document.location.href="/"},desc:"Back to Menu"}],n,a,(t,e)=>{t.fun?t.fun():t.store.update(t=>!t)}]}class z$ extends Ht{constructor(t){super(),Gt(this,t,F$,B$,d,{})}}function U$(t){let e,s,n,a,r,o,l,c;return{c(){e=B("div"),s=B("a"),s.innerHTML='<img class="svgicon" src="/assets/ui/icons/instagram.svg?v=4597824">',n=B("a"),n.innerHTML='<img class="svgicon" src="/assets/ui/icons/reddit.svg?v=4597824">',a=B("a"),a.innerHTML='<img class="svgicon" src="/assets/ui/icons/discord.svg?v=4597824">',r=B("a"),r.innerHTML='<img class="svgicon" src="/assets/ui/icons/twitter.svg?v=4597824">',o=B("div"),o.innerHTML='<img class="svgicon" src="/assets/ui/icons/twitch.svg?v=4597824">',A(s,"class","btn border black"),A(s,"target","_blank"),A(s,"rel","noopener noreferrer"),A(s,"href","https://www.instagram.com/hordesio.official"),A(n,"class","btn border black"),A(n,"target","_blank"),A(n,"rel","noopener noreferrer"),A(n,"href","https://www.reddit.com/r/Hordesio"),A(a,"class","btn border black"),A(a,"target","_blank"),A(a,"rel","noopener noreferrer"),A(a,"href","https://discord.gg/hordes"),A(r,"class","btn border black"),A(r,"target","_blank"),A(r,"rel","noopener noreferrer"),A(r,"href","https://twitter.com/hordesio"),A(o,"class","btn border black"),A(e,"class","btnbar svelte-1wol45y")},m(i,d){T(i,e,d),C(e,s),C(e,n),C(e,a),C(e,r),C(e,o),l||(c=D(o,"click",t[1]),l=!0)},p:i,i:i,o:i,d(t){t&&I(e),l=!1,c()}}}function D$(t,e,s){let i;p(t,vs,t=>s(0,i=t));const n=t=>x(vs,i=!i);return[i,n]}class A$ extends Ht{constructor(t){super(),Gt(this,t,D$,U$,d,{})}}function R$(t){let e,s,n,a;return{c(){e=B("div"),A(e,"class",s="btn checkbox "+(t[2]?"active":""))},m(s,i){T(s,e,i),n||(a=D(e,"click",t[3]),n=!0)},p(t,[i]){4&i&&s!==(s="btn checkbox "+(t[2]?"active":""))&&A(e,"class",s)},i:i,o:i,d(t){t&&I(e),n=!1,a()}}}function L$(t,e,s){let n,a=i,r=()=>(a(),a=m(o,t=>s(2,n=t)),o);t.$$.on_destroy.push(()=>a());let{store:o}=e;r();let{cb:l}=e;const c=t=>{x(o,n=!n),l&&l(n)};return t.$$set=t=>{"store"in t&&r(s(0,o=t.store)),"cb"in t&&s(1,l=t.cb)},[o,l,n,c]}class O$ extends Ht{constructor(t){super(),Gt(this,t,L$,R$,d,{store:0,cb:1})}}function _$(t,e,s){const i=t.slice();return i[65]=e[s],i[67]=s,i}function N$(t,e,s){const i=t.slice();return i[62]=e[s],i}function Z$(t,e,s){const i=t.slice();return i[59]=e[s],i[60]=e,i[61]=s,i}function q$(t,e,s){const i=t.slice();return i[68]=e[s],i}function G$(t){let e,s,i;return s=new wb({props:{title:tn.ui.settings.name,icon:"cog",$$slots:{default:[tS]},$$scope:{ctx:t}}}),s.$on("close",t[58]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","container svelte-ntyx09")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};67108851&e[0]|512&e[2]&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function H$(t){let e,s,i,n,a,r=t[68].name+"";function o(...e){return t[30](t[68],...e)}return{c(){e=B("div"),s=F(r),A(e,"class",i="choice "+(t[68]==t[1]?"active":""))},m(t,i){T(t,e,i),C(e,s),n||(a=D(e,"click",o),n=!0)},p(s,n){t=s,2&n[0]&&i!==(i="choice "+(t[68]==t[1]?"active":""))&&A(e,"class",i)},d(t){t&&I(e),n=!1,a()}}}function X$(t){let e,s,i,n,a,r;s=new O$({props:{store:Rs}});let o=tn.ui.chat.types,l=[];for(let e=0;e<o.length;e+=1)l[e]=W$(_$(t,o,e));return{c(){e=B("div"),e.textContent=""+tn.ui.settings.chatbubbles,_t(s.$$.fragment),i=B("div"),i.textContent=""+tn.ui.settings.combatlog,n=B("div");for(let t=0;t<l.length;t+=1)l[t].c();a=U(),A(i,"class","textprimary")},m(t,o){T(t,e,o),Nt(s,t,o),T(t,i,o),T(t,n,o);for(let e=0;e<l.length;e+=1)l[e].m(t,o);T(t,a,o),r=!0},p(t,e){if(33554432&e[0]){let s;for(o=tn.ui.chat.types,s=0;s<o.length;s+=1){const i=_$(t,o,s);l[s]?l[s].p(i,e):(l[s]=W$(i),l[s].c(),l[s].m(a.parentNode,a))}for(;s<l.length;s+=1)l[s].d(1);l.length=o.length}},i(t){r||(Tt(s.$$.fragment,t),r=!0)},o(t){It(s.$$.fragment,t),r=!1},d(t){t&&I(e),Zt(s,t),t&&I(i),t&&I(n),P(l,t),t&&I(a)}}}function j$(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,U,L,N,q,G,H,X,j,J,V,Y,W,Q,K,tt,et,st,it,nt,at,rt,ot,lt,ct,dt,ht,ut,mt,pt,gt,vt,yt,bt,xt,wt,kt,$t,St,Mt,Et,Ct,Pt,Bt,Ft,zt,Ut,Dt,At,Rt,Lt,Ot,qt,Gt,Ht,Xt,jt,Jt,Vt,Yt,Wt,Qt,Kt,te,ee,se,ie,ne,ae,re,oe,le,ce,de,he,ue,me,pe,fe,ge,ve,ye,be,xe,we,ke,$e,Se,Me,Ee,Ce,Te,Ie,Pe,Be,Fe,ze,Ue,De,Ae,Re,Le=tn.ui.settings.language+"",Oe=t[16].toFixed(1)+"",_e=t[17].toFixed(1)+"",Ne=tn.ui.settings.invwidth+"",Ze=tn.ui.settings.stashwidth+"",qe=tn.ui.settings.stashheight+"",Ge=t[27],He=[];for(let e=0;e<Ge.length;e+=1)He[e]=Q$(N$(t,Ge,e));return v=new O$({props:{store:Hs}}),$=new O$({props:{store:Is}}),M=new O$({props:{store:Fs}}),U=new O$({props:{store:Bs}}),N=new O$({props:{store:zs}}),G=new O$({props:{store:Ps}}),J=new O$({props:{store:Gs}}),ot=new O$({props:{store:Os}}),ct=new O$({props:{store:Ls}}),ht=new O$({props:{store:_s}}),gt=new O$({props:{store:js,cb:t[28]}}),yt=new O$({props:{store:Js}}),xt=new O$({props:{store:ii}}),Ht=new O$({props:{store:Ws}}),Vt=new O$({props:{store:Ks}}),Wt=new O$({props:{store:ti}}),ie=new O$({props:{store:Us}}),ae=new O$({props:{store:Ds}}),{c(){e=B("div"),s=F(Le),i=z(),n=B("br"),a=B("small"),a.textContent="Requires reload",r=B("select");for(let t=0;t<He.length;t+=1)He[t].c();o=B("div"),o.textContent=""+tn.ui.settings.tutorial,c=B("div"),d=B("div"),d.textContent="Restart",h=B("div"),h.textContent=""+tn.ui.settings.resettutorial,u=B("div"),u.textContent="Disable",m=B("div"),m.textContent=""+tn.ui.settings.disabletutorial,p=B("div"),p.textContent="FPS / Ping",f=B("div"),g=B("div"),g.textContent="Show FPS / Ping",_t(v.$$.fragment),y=B("div"),y.textContent="Nameplates",b=B("div"),x=B("div"),x.textContent="Draw range",w=B("input"),k=B("div"),k.textContent="Show monsters",_t($.$$.fragment),S=B("div"),S.textContent="Show friendly bars",_t(M.$$.fragment),E=B("div"),E.textContent="Always show level",_t(U.$$.fragment),L=B("div"),L.textContent="Class color bars",_t(N.$$.fragment),q=B("div"),q.textContent="Transparency",_t(G.$$.fragment),H=B("div"),H.textContent="Drops",X=B("div"),j=B("div"),j.textContent="Show Drop Quality%",_t(J.$$.fragment),V=B("div"),Y=F("Drop Quality% Minimum"),W=B("br"),Q=B("small"),K=F(t[14]),tt=F("%"),et=B("input"),st=B("div"),st.innerHTML='Exclude Drop Types<br><small class="textgrey">Requires reload</small>',it=B("input"),nt=B("div"),nt.textContent="Damage & Healing",at=B("div"),rt=B("div"),rt.textContent="Incoming damage",_t(ot.$$.fragment),lt=B("div"),lt.textContent="Incoming healing",_t(ct.$$.fragment),dt=B("div"),dt.textContent="Incoming mana",_t(ht.$$.fragment),ut=B("div"),ut.textContent="Icons & Buffs",mt=B("div"),pt=B("div"),pt.innerHTML='Cooldown text (skills)<br><small class="textgrey">Requires reload</small>',_t(gt.$$.fragment),vt=B("div"),vt.textContent="Cooldown text (buffs)",_t(yt.$$.fragment),bt=B("div"),bt.textContent="Show your buffs only",_t(xt.$$.fragment),wt=B("div"),kt=F("Buff timeout flash interval"),$t=B("br"),St=B("small"),Mt=F(Oe),Et=F("s"),Ct=B("input"),Pt=B("div"),Bt=F("Buff timeout flash duration"),Ft=B("br"),zt=B("small"),Ut=F(_e),Dt=F("s"),At=B("input"),Rt=B("div"),Rt.textContent="Buff maximum",Lt=B("input"),Ot=B("div"),Ot.textContent="Buff maximum (party)",qt=B("input"),Gt=B("div"),Gt.textContent="Limited party buff update rate",_t(Ht.$$.fragment),Xt=B("div"),Xt.textContent="Unitframes",jt=B("div"),Jt=B("div"),Jt.textContent="Show self in party",_t(Vt.$$.fragment),Yt=B("div"),Yt.textContent="Party mana",_t(Wt.$$.fragment),Qt=B("div"),Qt.textContent="Party frame width",Kt=B("input"),te=B("div"),te.textContent="Map",ee=B("div"),se=B("div"),se.textContent=""+tn.ui.settings.mapshowmonsters,_t(ie.$$.fragment),ne=B("div"),ne.textContent=""+tn.ui.settings.maplowqual,_t(ae.$$.fragment),re=B("div"),re.textContent=""+tn.ui.inventory.name,oe=B("div"),le=B("div"),ce=F("Protected item quality"),de=B("br"),he=B("small"),ue=F(t[21]),me=F("%"),pe=B("input"),fe=B("div"),ge=F(Ne),ve=B("br"),ye=B("small"),be=F(t[22]),xe=B("input"),we=B("div"),we.textContent="Stash",ke=B("div"),$e=B("div"),Se=F(Ze),Me=B("br"),Ee=B("small"),Ce=F(t[23]),Te=B("input"),Ie=B("div"),Pe=F(qe),Be=B("br"),Fe=B("small"),ze=F(t[24]),Ue=B("input"),A(a,"class","textgrey"),void 0===t[12]&&ft(()=>t[42].call(r)),A(o,"class","textprimary"),A(h,"class","btn blue"),A(m,"class","btn orange"),A(p,"class","textprimary"),A(y,"class","textprimary"),A(w,"type","range"),A(H,"class","textprimary"),A(Q,"class","textgrey"),A(et,"type","range"),A(et,"min","0"),A(et,"max","100"),A(it,"type","text"),A(it,"placeholder","misc, gold, ..."),A(nt,"class","textprimary"),A(ut,"class","textprimary"),A(St,"class","textgrey"),A(Ct,"type","range"),A(Ct,"min","0"),A(Ct,"max","1"),A(Ct,"step","0.1"),A(zt,"class","textgrey"),A(At,"type","range"),A(At,"min","0"),A(At,"max","5"),A(At,"step","0.1"),A(Lt,"placeholder","14"),A(Lt,"type","number"),A(Lt,"min","0"),A(qt,"placeholder","8"),A(qt,"type","number"),A(qt,"min","0"),A(Xt,"class","textprimary"),A(Kt,"type","range"),A(Kt,"min","50"),A(Kt,"max","400"),A(te,"class","textprimary"),A(re,"class","textprimary"),A(he,"class","textgrey"),A(pe,"type","range"),A(pe,"min","0"),A(pe,"max","100"),A(ye,"class","textgrey"),A(xe,"type","range"),A(xe,"min","4"),A(xe,"max","10"),A(we,"class","textprimary"),A(Ee,"class","textgrey"),A(Te,"type","range"),A(Te,"min","6"),A(Te,"max","20"),A(Fe,"class","textgrey"),A(Ue,"type","range"),A(Ue,"min","50"),A(Ue,"max","500")},m(l,I){T(l,e,I),C(e,s),C(e,i),C(e,n),C(e,a),T(l,r,I);for(let t=0;t<He.length;t+=1)He[t].m(r,null);Z(r,t[12]),T(l,o,I),T(l,c,I),T(l,d,I),T(l,h,I),T(l,u,I),T(l,m,I),T(l,p,I),T(l,f,I),T(l,g,I),Nt(v,l,I),T(l,y,I),T(l,b,I),T(l,x,I),T(l,w,I),_(w,t[13]),T(l,k,I),Nt($,l,I),T(l,S,I),Nt(M,l,I),T(l,E,I),Nt(U,l,I),T(l,L,I),Nt(N,l,I),T(l,q,I),Nt(G,l,I),T(l,H,I),T(l,X,I),T(l,j,I),Nt(J,l,I),T(l,V,I),C(V,Y),C(V,W),C(V,Q),C(Q,K),C(Q,tt),T(l,et,I),_(et,t[14]),T(l,st,I),T(l,it,I),_(it,t[15]),T(l,nt,I),T(l,at,I),T(l,rt,I),Nt(ot,l,I),T(l,lt,I),Nt(ct,l,I),T(l,dt,I),Nt(ht,l,I),T(l,ut,I),T(l,mt,I),T(l,pt,I),Nt(gt,l,I),T(l,vt,I),Nt(yt,l,I),T(l,bt,I),Nt(xt,l,I),T(l,wt,I),C(wt,kt),C(wt,$t),C(wt,St),C(St,Mt),C(St,Et),T(l,Ct,I),_(Ct,t[16]),T(l,Pt,I),C(Pt,Bt),C(Pt,Ft),C(Pt,zt),C(zt,Ut),C(zt,Dt),T(l,At,I),_(At,t[17]),T(l,Rt,I),T(l,Lt,I),_(Lt,t[18]),T(l,Ot,I),T(l,qt,I),_(qt,t[19]),T(l,Gt,I),Nt(Ht,l,I),T(l,Xt,I),T(l,jt,I),T(l,Jt,I),Nt(Vt,l,I),T(l,Yt,I),Nt(Wt,l,I),T(l,Qt,I),T(l,Kt,I),_(Kt,t[20]),T(l,te,I),T(l,ee,I),T(l,se,I),Nt(ie,l,I),T(l,ne,I),Nt(ae,l,I),T(l,re,I),T(l,oe,I),T(l,le,I),C(le,ce),C(le,de),C(le,he),C(he,ue),C(he,me),T(l,pe,I),_(pe,t[21]),T(l,fe,I),C(fe,ge),C(fe,ve),C(fe,ye),C(ye,be),T(l,xe,I),_(xe,t[22]),T(l,we,I),T(l,ke,I),T(l,$e,I),C($e,Se),C($e,Me),C($e,Ee),C(Ee,Ce),T(l,Te,I),_(Te,t[23]),T(l,Ie,I),C(Ie,Pe),C(Ie,Be),C(Ie,Fe),C(Fe,ze),T(l,Ue,I),_(Ue,t[24]),De=!0,Ae||(Re=[D(r,"change",t[42]),D(r,"change",t[28]),D(h,"click",t[43]),D(m,"click",t[44]),D(w,"change",t[45]),D(w,"input",t[45]),D(et,"change",t[46]),D(et,"input",t[46]),D(it,"input",t[47]),D(it,"change",t[28]),D(Ct,"change",t[48]),D(Ct,"input",t[48]),D(At,"change",t[49]),D(At,"input",t[49]),D(Lt,"input",t[50]),D(qt,"input",t[51]),D(Kt,"change",t[52]),D(Kt,"input",t[52]),D(pe,"change",t[53]),D(pe,"input",t[53]),D(xe,"change",t[54]),D(xe,"input",t[54]),D(Te,"change",t[55]),D(Te,"input",t[55]),D(Ue,"change",t[56]),D(Ue,"input",t[56])],Ae=!0)},p(t,e){if(134217728&e[0]){let s;for(Ge=t[27],s=0;s<Ge.length;s+=1){const i=N$(t,Ge,s);He[s]?He[s].p(i,e):(He[s]=Q$(i),He[s].c(),He[s].m(r,null))}for(;s<He.length;s+=1)He[s].d(1);He.length=Ge.length}134221824&e[0]&&Z(r,t[12]),8192&e[0]&&_(w,t[13]),(!De||16384&e[0])&&O(K,t[14]),16384&e[0]&&_(et,t[14]),32768&e[0]&&it.value!==t[15]&&_(it,t[15]),(!De||65536&e[0])&&Oe!==(Oe=t[16].toFixed(1)+"")&&O(Mt,Oe),65536&e[0]&&_(Ct,t[16]),(!De||131072&e[0])&&_e!==(_e=t[17].toFixed(1)+"")&&O(Ut,_e),131072&e[0]&&_(At,t[17]),262144&e[0]&&R(Lt.value)!==t[18]&&_(Lt,t[18]),524288&e[0]&&R(qt.value)!==t[19]&&_(qt,t[19]),1048576&e[0]&&_(Kt,t[20]),(!De||2097152&e[0])&&O(ue,t[21]),2097152&e[0]&&_(pe,t[21]),(!De||4194304&e[0])&&O(be,t[22]),4194304&e[0]&&_(xe,t[22]),(!De||8388608&e[0])&&O(Ce,t[23]),8388608&e[0]&&_(Te,t[23]),(!De||16777216&e[0])&&O(ze,t[24]),16777216&e[0]&&_(Ue,t[24])},i(t){De||(Tt(v.$$.fragment,t),Tt($.$$.fragment,t),Tt(M.$$.fragment,t),Tt(U.$$.fragment,t),Tt(N.$$.fragment,t),Tt(G.$$.fragment,t),Tt(J.$$.fragment,t),Tt(ot.$$.fragment,t),Tt(ct.$$.fragment,t),Tt(ht.$$.fragment,t),Tt(gt.$$.fragment,t),Tt(yt.$$.fragment,t),Tt(xt.$$.fragment,t),Tt(Ht.$$.fragment,t),Tt(Vt.$$.fragment,t),Tt(Wt.$$.fragment,t),Tt(ie.$$.fragment,t),Tt(ae.$$.fragment,t),De=!0)},o(t){It(v.$$.fragment,t),It($.$$.fragment,t),It(M.$$.fragment,t),It(U.$$.fragment,t),It(N.$$.fragment,t),It(G.$$.fragment,t),It(J.$$.fragment,t),It(ot.$$.fragment,t),It(ct.$$.fragment,t),It(ht.$$.fragment,t),It(gt.$$.fragment,t),It(yt.$$.fragment,t),It(xt.$$.fragment,t),It(Ht.$$.fragment,t),It(Vt.$$.fragment,t),It(Wt.$$.fragment,t),It(ie.$$.fragment,t),It(ae.$$.fragment,t),De=!1},d(t){t&&I(e),t&&I(r),P(He,t),t&&I(o),t&&I(c),t&&I(d),t&&I(h),t&&I(u),t&&I(m),t&&I(p),t&&I(f),t&&I(g),Zt(v,t),t&&I(y),t&&I(b),t&&I(x),t&&I(w),t&&I(k),Zt($,t),t&&I(S),Zt(M,t),t&&I(E),Zt(U,t),t&&I(L),Zt(N,t),t&&I(q),Zt(G,t),t&&I(H),t&&I(X),t&&I(j),Zt(J,t),t&&I(V),t&&I(et),t&&I(st),t&&I(it),t&&I(nt),t&&I(at),t&&I(rt),Zt(ot,t),t&&I(lt),Zt(ct,t),t&&I(dt),Zt(ht,t),t&&I(ut),t&&I(mt),t&&I(pt),Zt(gt,t),t&&I(vt),Zt(yt,t),t&&I(bt),Zt(xt,t),t&&I(wt),t&&I(Ct),t&&I(Pt),t&&I(At),t&&I(Rt),t&&I(Lt),t&&I(Ot),t&&I(qt),t&&I(Gt),Zt(Ht,t),t&&I(Xt),t&&I(jt),t&&I(Jt),Zt(Vt,t),t&&I(Yt),Zt(Wt,t),t&&I(Qt),t&&I(Kt),t&&I(te),t&&I(ee),t&&I(se),Zt(ie,t),t&&I(ne),Zt(ae,t),t&&I(re),t&&I(oe),t&&I(le),t&&I(pe),t&&I(fe),t&&I(xe),t&&I(we),t&&I(ke),t&&I($e),t&&I(Te),t&&I(Ie),t&&I(Ue),Ae=!1,l(Re)}}}function J$(t){let e,s,n,a,r,o,c,d;return{c(){e=B("div"),e.textContent=""+tn.ui.settings.sfxvolume,s=B("input"),n=B("div"),n.textContent=""+tn.ui.settings.musicvolume,a=B("input"),r=B("div"),r.textContent=""+tn.ui.settings.ambiencevolume,o=B("input"),A(s,"type","range"),A(a,"type","range"),A(o,"type","range")},m(i,l){T(i,e,l),T(i,s,l),_(s,t[9]),T(i,n,l),T(i,a,l),_(a,t[10]),T(i,r,l),T(i,o,l),_(o,t[11]),c||(d=[D(s,"change",t[39]),D(s,"input",t[39]),D(a,"change",t[40]),D(a,"input",t[40]),D(o,"change",t[41]),D(o,"input",t[41])],c=!0)},p(t,e){512&e[0]&&_(s,t[9]),1024&e[0]&&_(a,t[10]),2048&e[0]&&_(o,t[11])},i:i,o:i,d(t){t&&I(e),t&&I(s),t&&I(n),t&&I(a),t&&I(r),t&&I(o),c=!1,l(d)}}}function V$(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,R,L,N,Z,q,G,H,X,j=tn.ui.settings.mousesensitivity+"",J=t[7].toFixed(2)+"";h=new O$({props:{store:ai}}),m=new O$({props:{store:ri}}),f=new O$({props:{store:oi}}),v=new O$({props:{store:li}});let V=Object.keys(t[0]).filter(sS).map(t[36]),Y=[];for(let e=0;e<V.length;e+=1)Y[e]=K$(Z$(t,V,e));return{c(){e=B("div"),e.textContent=""+tn.ui.settings.camera,s=B("div"),i=B("div"),n=F(j),a=z(),r=B("span"),o=F(J),c=B("input"),d=B("div"),d.textContent=""+tn.ui.settings.invertmousex,_t(h.$$.fragment),u=B("div"),u.textContent=""+tn.ui.settings.invertmousey,_t(m.$$.fragment),p=B("div"),p.textContent=""+tn.ui.settings.lockedcamera,_t(f.$$.fragment),g=B("div"),g.textContent=""+tn.ui.settings.pointerlock,_t(v.$$.fragment),y=B("div"),y.textContent="Skillbar",b=B("div"),x=B("div"),w=F("Skillbar slots "),k=B("span"),$=F(t[8]),S=B("br"),M=B("small"),M.textContent="Requires reload",E=B("input"),R=B("div"),R.textContent=""+tn.ui.settings.keybindings,L=B("div"),N=B("small"),N.textContent="Requires reload",Z=B("small"),Z.textContent="To reset, leave field blank.";for(let t=0;t<Y.length;t+=1)Y[t].c();q=U(),A(e,"class","textprimary"),A(r,"class","textgrey"),A(c,"type","range"),A(c,"step","0.05"),A(c,"min","0.1"),A(c,"max","3"),A(y,"class","textprimary"),A(k,"class","textgrey"),A(M,"class","textgrey"),A(E,"type","range"),A(E,"min","10"),A(E,"max","24"),A(R,"class","textprimary"),A(N,"class","textgrey"),A(Z,"class","textprimary")},m(l,I){T(l,e,I),T(l,s,I),T(l,i,I),C(i,n),C(i,a),C(i,r),C(r,o),T(l,c,I),_(c,t[7]),T(l,d,I),Nt(h,l,I),T(l,u,I),Nt(m,l,I),T(l,p,I),Nt(f,l,I),T(l,g,I),Nt(v,l,I),T(l,y,I),T(l,b,I),T(l,x,I),C(x,w),C(x,k),C(k,$),C(x,S),C(x,M),T(l,E,I),_(E,t[8]),T(l,R,I),T(l,L,I),T(l,N,I),T(l,Z,I);for(let t=0;t<Y.length;t+=1)Y[t].m(l,I);T(l,q,I),G=!0,H||(X=[D(c,"change",t[34]),D(c,"input",t[34]),D(E,"change",t[35]),D(E,"input",t[35]),D(E,"change",t[28])],H=!0)},p(t,e){if((!G||128&e[0])&&J!==(J=t[7].toFixed(2)+"")&&O(o,J),128&e[0]&&_(c,t[7]),(!G||256&e[0])&&O($,t[8]),256&e[0]&&_(E,t[8]),536870913&e[0]){let s;for(V=Object.keys(t[0]).filter(sS).map(t[36]),s=0;s<V.length;s+=1){const i=Z$(t,V,s);Y[s]?Y[s].p(i,e):(Y[s]=K$(i),Y[s].c(),Y[s].m(q.parentNode,q))}for(;s<Y.length;s+=1)Y[s].d(1);Y.length=V.length}},i(t){G||(Tt(h.$$.fragment,t),Tt(m.$$.fragment,t),Tt(f.$$.fragment,t),Tt(v.$$.fragment,t),G=!0)},o(t){It(h.$$.fragment,t),It(m.$$.fragment,t),It(f.$$.fragment,t),It(v.$$.fragment,t),G=!1},d(t){t&&I(e),t&&I(s),t&&I(i),t&&I(c),t&&I(d),Zt(h,t),t&&I(u),Zt(m,t),t&&I(p),Zt(f,t),t&&I(g),Zt(v,t),t&&I(y),t&&I(b),t&&I(x),t&&I(E),t&&I(R),t&&I(L),t&&I(N),t&&I(Z),P(Y,t),t&&I(q),H=!1,l(X)}}}function Y$(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,P,z,U,R,L,O,N,Z,q,G,H,X,j,J,V,Y,W,Q=tn.ui.settings.ssao+"",K=tn.ui.settings.grass+"",tt=tn.ui.settings.clouds+"",et=tn.ui.settings.detailprops+"",st=tn.ui.settings.shadows+"";return r=new O$({props:{store:Qe}}),u=new O$({props:{cb:t[28],store:es}}),v=new O$({props:{cb:t[28],store:Ke}}),k=new O$({props:{cb:t[28],store:ss}}),P=new O$({props:{cb:t[28],store:ns}}),U=new O$({props:{store:is}}),G=new O$({props:{cb:t[28],store:ts}}),J=new O$({props:{store:We}}),{c(){e=B("div"),e.textContent=""+tn.ui.settings.resolution,s=B("input"),i=B("div"),i.textContent=""+tn.ui.settings.viewrange,n=B("input"),a=B("div"),a.textContent=""+tn.ui.settings.postprocessing,_t(r.$$.fragment),o=B("div"),c=F(Q),d=B("br"),h=B("small"),h.textContent="Requires reload",_t(u.$$.fragment),m=B("div"),p=F(K),f=B("br"),g=B("small"),g.textContent="Requires reload",_t(v.$$.fragment),y=B("div"),b=F(tt),x=B("br"),w=B("small"),w.textContent="Requires reload",_t(k.$$.fragment),$=B("div"),S=F(et),M=B("br"),E=B("small"),E.textContent="Requires reload",_t(P.$$.fragment),z=B("div"),z.textContent=""+tn.ui.settings.particles,_t(U.$$.fragment),R=B("div"),R.textContent="Shadows",L=B("div"),O=B("div"),N=F(st),Z=B("br"),q=B("small"),q.textContent="Requires reload",_t(G.$$.fragment),H=B("div"),H.innerHTML='Shadow resolution<br><small class="textgrey">Requires reload</small>',X=B("input"),j=B("div"),j.innerHTML="Real time environment shadows<br>",_t(J.$$.fragment),A(s,"type","range"),A(s,"min","30"),A(s,"step","10"),A(n,"type","range"),A(n,"min","20"),A(h,"class","textgrey"),A(g,"class","textgrey"),A(w,"class","textgrey"),A(E,"class","textgrey"),A(R,"class","textprimary"),A(q,"class","textgrey"),A(X,"type","range"),A(X,"min","0"),A(X,"max","4")},m(l,I){T(l,e,I),T(l,s,I),_(s,t[4]),T(l,i,I),T(l,n,I),_(n,t[5]),T(l,a,I),Nt(r,l,I),T(l,o,I),C(o,c),C(o,d),C(o,h),Nt(u,l,I),T(l,m,I),C(m,p),C(m,f),C(m,g),Nt(v,l,I),T(l,y,I),C(y,b),C(y,x),C(y,w),Nt(k,l,I),T(l,$,I),C($,S),C($,M),C($,E),Nt(P,l,I),T(l,z,I),Nt(U,l,I),T(l,R,I),T(l,L,I),T(l,O,I),C(O,N),C(O,Z),C(O,q),Nt(G,l,I),T(l,H,I),T(l,X,I),_(X,t[6]),T(l,j,I),Nt(J,l,I),V=!0,Y||(W=[D(s,"change",t[31]),D(s,"input",t[31]),D(n,"change",t[32]),D(n,"input",t[32]),D(X,"change",t[33]),D(X,"input",t[33]),D(X,"change",t[28])],Y=!0)},p(t,e){16&e[0]&&_(s,t[4]),32&e[0]&&_(n,t[5]),64&e[0]&&_(X,t[6])},i(t){V||(Tt(r.$$.fragment,t),Tt(u.$$.fragment,t),Tt(v.$$.fragment,t),Tt(k.$$.fragment,t),Tt(P.$$.fragment,t),Tt(U.$$.fragment,t),Tt(G.$$.fragment,t),Tt(J.$$.fragment,t),V=!0)},o(t){It(r.$$.fragment,t),It(u.$$.fragment,t),It(v.$$.fragment,t),It(k.$$.fragment,t),It(P.$$.fragment,t),It(U.$$.fragment,t),It(G.$$.fragment,t),It(J.$$.fragment,t),V=!1},d(t){t&&I(e),t&&I(s),t&&I(i),t&&I(n),t&&I(a),Zt(r,t),t&&I(o),Zt(u,t),t&&I(m),Zt(v,t),t&&I(y),Zt(k,t),t&&I($),Zt(P,t),t&&I(z),Zt(U,t),t&&I(R),t&&I(L),t&&I(O),Zt(G,t),t&&I(H),t&&I(X),t&&I(j),Zt(J,t),Y=!1,l(W)}}}function W$(t){let e,s,i,n,a,r,o=t[65]+"";function l(...e){return t[57](t[67],...e)}return{c(){e=B("div"),s=F(o),i=B("div"),A(i,"class",n="btn checkbox "+(t[25][t[67]]?"active":""))},m(t,n){T(t,e,n),C(e,s),T(t,i,n),a||(r=D(i,"click",l),a=!0)},p(e,s){t=e,33554432&s[0]&&n!==(n="btn checkbox "+(t[25][t[67]]?"active":""))&&A(i,"class",n)},d(t){t&&I(e),t&&I(i),a=!1,r()}}}function Q$(t){let e,s,n,a=t[62].name+"";return{c(){e=B("option"),s=F(a),e.__value=n=t[62].val,e.value=e.__value},m(t,i){T(t,e,i),C(e,s)},p:i,d(t){t&&I(e)}}}function K$(t){let e,s,i,n,a,r=t[59].k.slice(2)+"";function o(){t[37].call(i,t[59])}function c(...e){return t[38](t[59],...e)}return{c(){e=B("div"),s=F(r),i=B("input"),A(i,"type","text")},m(r,l){T(r,e,l),C(e,s),T(r,i,l),_(i,t[0].current[t[59].k]),n||(a=[D(i,"input",o),D(i,"change",c)],n=!0)},p(e,n){t=e,1&n[0]&&r!==(r=t[59].k.slice(2)+"")&&O(s,r),1&n[0]&&i.value!==t[0].current[t[59].k]&&_(i,t[0].current[t[59].k])},d(t){t&&I(e),t&&I(i),n=!1,l(a)}}}function tS(t){let e,s,i,n,a,r,o,l,c,d=t[1].name+"",h=t[26],u=[];for(let e=0;e<h.length;e+=1)u[e]=H$(q$(t,h,e));const m=[Y$,V$,J$,j$,X$],p=[];function f(t,e){return"gfx"==t[1].id?0:"controls"==t[1].id?1:"audio"==t[1].id?2:"ui"==t[1].id?3:"chat"==t[1].id?4:-1}return~(o=f(t))&&(l=p[o]=m[o](t)),{c(){e=B("div"),s=B("div");for(let t=0;t<u.length;t+=1)u[t].c();i=B("div"),n=B("h3"),a=F(d),r=B("div"),l&&l.c(),A(n,"class","textprimary"),A(r,"class","settings svelte-ntyx09"),A(i,"class","menu panel-black scrollbar svelte-ntyx09"),A(e,"class","divide svelte-ntyx09")},m(t,l){T(t,e,l),C(e,s);for(let t=0;t<u.length;t+=1)u[t].m(s,null);C(e,i),C(i,n),C(n,a),C(i,r),~o&&p[o].m(r,null),c=!0},p(t,e){if(67108866&e[0]){let i;for(h=t[26],i=0;i<h.length;i+=1){const n=q$(t,h,i);u[i]?u[i].p(n,e):(u[i]=H$(n),u[i].c(),u[i].m(s,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=h.length}(!c||2&e[0])&&d!==(d=t[1].name+"")&&O(a,d);let i=o;o=f(t),o===i?~o&&p[o].p(t,e):(l&&(Et(),It(p[i],1,1,()=>{p[i]=null}),Ct()),~o?(l=p[o],l||(l=p[o]=m[o](t),l.c()),Tt(l,1),l.m(r,null)):l=null)},i(t){c||(Tt(l),c=!0)},o(t){It(l),c=!1},d(t){t&&I(e),P(u,t),~o&&p[o].d()}}}function eS(t){let e,s,i=t[3]&&G$(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,s){t[3]?i?(i.p(t,s),8&s[0]&&Tt(i,1)):(i=G$(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}const sS=t=>"kb"==t.slice(0,2);function iS(t,e,s){let i,n,a,r,o,l,c,d,h,u,m,f,g,v,y,b,w,k,$,S,M,E,C;p(t,ps,t=>s(3,i=t)),p(t,Ve,t=>s(4,n=t)),p(t,Je,t=>s(5,a=t)),p(t,Ye,t=>s(6,r=t)),p(t,ni,t=>s(7,o=t)),p(t,Mi,t=>s(8,l=t)),p(t,rs,t=>s(9,c=t)),p(t,os,t=>s(10,d=t)),p(t,as,t=>s(11,h=t)),p(t,ls,t=>s(12,u=t)),p(t,Ts,t=>s(13,m=t)),p(t,qs,t=>s(14,f=t)),p(t,Zs,t=>s(15,g=t)),p(t,Vs,t=>s(16,v=t)),p(t,Ys,t=>s(17,y=t)),p(t,ei,t=>s(18,b=t)),p(t,si,t=>s(19,w=t)),p(t,Qs,t=>s(20,k=t)),p(t,Xs,t=>s(21,$=t)),p(t,us,t=>s(22,S=t)),p(t,ds,t=>s(23,M=t)),p(t,hs,t=>s(24,E=t)),p(t,Ms,t=>s(25,C=t));const T=[{id:"ui",name:tn.ui.settings.interface},{id:"gfx",name:tn.ui.settings.graphics},{id:"controls",name:tn.ui.settings.controls},{id:"chat",name:tn.ui.settings.chat},{id:"audio",name:tn.ui.settings.audio}];let I=T[0];const P=[{val:"en",name:"English"},{val:"de",name:"German"},{val:"nl",name:"Dutch"},{val:"ru",name:"Russian"},{val:"pt",name:"Portugese"},{val:"es",name:"Spanish"},{val:"fr",name:"French"},{val:"ro",name:"Romanian"},{val:"it",name:"Italian"}];let B=!1;const F=()=>{s(2,B=!0)},z=(t,e)=>{e.set(""===t?void 0:t),s(2,B=!0)},U=(t,e)=>{s(1,I=t)};function D(){n=R(this.value),Ve.set(n)}function A(){a=R(this.value),Je.set(a)}function L(){r=R(this.value),Ye.set(r)}function O(){o=R(this.value),ni.set(o)}function _(){l=R(this.value),Mi.set(l)}function N(t){Qi[t.k]=this.value,s(0,Ki)}const Z=(t,e)=>{z(Qi[t.k],t.s)};function G(){c=R(this.value),rs.set(c)}function H(){d=R(this.value),os.set(d)}function X(){h=R(this.value),as.set(h)}function j(){u=q(this),ls.set(u),s(27,P)}function J(){m=R(this.value),Ts.set(m)}function V(){f=R(this.value),qs.set(f)}function Y(){g=this.value,Zs.set(g)}function W(){v=R(this.value),Vs.set(v)}function Q(){y=R(this.value),Ys.set(y)}function K(){b=R(this.value),ei.set(b)}function tt(){w=R(this.value),si.set(w)}function et(){k=R(this.value),Qs.set(k)}function st(){$=R(this.value),Xs.set($)}function it(){S=R(this.value),us.set(S)}function nt(){M=R(this.value),ds.set(M)}function at(){E=R(this.value),hs.set(E)}const rt=(t,e)=>x(Ms,C[t]=C[t]?0:1,C),ot=()=>{x(ps,i=!1),B&&window.location.reload()};return[Ki,I,B,i,n,a,r,o,l,c,d,h,u,m,f,g,v,y,b,w,k,$,S,M,E,C,T,P,F,z,U,D,A,L,O,_,t=>({k:t,s:Ki[t]}),N,Z,G,H,X,j,t=>As.set(0),t=>As.set(Ny.length),J,V,Y,W,Q,K,tt,et,st,it,nt,at,rt,ot]}class nS extends Ht{constructor(t){super(),Gt(this,t,iS,eS,d,{},[-1,-1,-1])}}function aS(t,e,s){const i=t.slice();return i[11]=e[s],i}function rS(t,e,s){const i=t.slice();return i[11]=e[s],i}function oS(t){let e,s,i;return s=new wb({props:{title:"Skills",icon:"book",$$slots:{default:[uS]},$$scope:{ctx:t}}}),s.$on("close",t[9]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","l-upperLeftModal container svelte-r0v48m")},m(n,a){T(n,e,a),Nt(s,e,null),t[10](e),i=!0},p(t,e){const i={};65563&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(i){i&&I(e),Zt(s),t[10](null)}}}function lS(t){let e,s;return e=new Zw({props:{level:t[11].level,skill:t[11].logic}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};16&s&&(i.level=t[11].level),16&s&&(i.skill=t[11].logic),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function cS(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f=tn.items.book[t[11].logic.id].name+"",g=t[11].logic.engineOnly?"Default":"Lv. "+t[11].level,v=void 0!==t[11].logic.onCast?"Spell":"Passive";function y(...e){return t[7](t[11],...e)}return s=new Yx({props:{descPos:"left:100%;top:0;",descRoot:t[0],border:"white",data:{},pickable:void 0!==t[11].logic.onCast,meta:{type:"skill",skill:t[11].logic},css:"slotskill",img:`/assets/ui/skills/${t[11].logic.id}.${Po}?v=4597824`,$$slots:{default:[lS]},$$scope:{ctx:t}}}),{c(){e=B("div"),_t(s.$$.fragment),i=B("div"),n=B("div"),a=F(f),r=B("span"),o=B("div"),l=F(g),c=z(),d=F(v),A(r,"class","textgrey"),A(n,"class","textprimary name svelte-r0v48m"),A(o,"class","textgrey"),A(e,"class",h=(t[11].logic.engineOnly?"panel-black":"btn")+" grid "+(t[1]==t[11]?"grey":"black")+" svelte-r0v48m")},m(t,h){T(t,e,h),Nt(s,e,null),C(e,i),C(i,n),C(n,a),C(n,r),C(i,o),C(o,l),C(o,c),C(o,d),u=!0,m||(p=D(e,"click",y),m=!0)},p(i,n){t=i;const r={};1&n&&(r.descRoot=t[0]),16&n&&(r.pickable=void 0!==t[11].logic.onCast),16&n&&(r.meta={type:"skill",skill:t[11].logic}),16&n&&(r.img=`/assets/ui/skills/${t[11].logic.id}.${Po}?v=4597824`),65552&n&&(r.$$scope={dirty:n,ctx:t}),s.$set(r),(!u||16&n)&&f!==(f=tn.items.book[t[11].logic.id].name+"")&&O(a,f),(!u||16&n)&&g!==(g=t[11].logic.engineOnly?"Default":"Lv. "+t[11].level)&&O(l,g),(!u||16&n)&&v!==(v=void 0!==t[11].logic.onCast?"Spell":"Passive")&&O(d,v),(!u||18&n&&h!==(h=(t[11].logic.engineOnly?"panel-black":"btn")+" grid "+(t[1]==t[11]?"grey":"black")+" svelte-r0v48m"))&&A(e,"class",h)},i(t){u||(Tt(s.$$.fragment,t),u=!0)},o(t){It(s.$$.fragment,t),u=!1},d(t){t&&I(e),Zt(s),m=!1,p()}}}function dS(t){let e,s;return e=new Zw({props:{level:1,skill:t[11]}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};16&s&&(i.skill=t[11]),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function hS(t){let e,s,i,n,a,r,o,l,c,d=tn.items.book[t[11].id].name+"",h=t[11].minlevel+"";return s=new Yx({props:{descPos:"left:100%;top:0;",descRoot:t[0],border:"grey filtered",data:{},pickable:!1,meta:{type:"skill",skill:t[11]},css:"slotskill",img:`/assets/ui/skills/${t[11].id}.${Po}?v=4597824`,$$slots:{default:[dS]},$$scope:{ctx:t}}}),{c(){e=B("div"),_t(s.$$.fragment),i=B("div"),n=B("div"),a=F(d),r=B("div"),o=F("Requires Lv. "),l=F(h),A(n,"class","name svelte-r0v48m"),A(i,"class","textgrey"),A(e,"class","panel-black grid svelte-r0v48m")},m(t,d){T(t,e,d),Nt(s,e,null),C(e,i),C(i,n),C(n,a),C(i,r),C(r,o),C(r,l),c=!0},p(t,e){const i={};1&e&&(i.descRoot=t[0]),16&e&&(i.meta={type:"skill",skill:t[11]}),16&e&&(i.img=`/assets/ui/skills/${t[11].id}.${Po}?v=4597824`),65552&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i),(!c||16&e)&&d!==(d=tn.items.book[t[11].id].name+"")&&O(a,d),(!c||16&e)&&h!==(h=t[11].minlevel+"")&&O(l,h)},i(t){c||(Tt(s.$$.fragment,t),c=!0)},o(t){It(s.$$.fragment,t),c=!1},d(t){t&&I(e),Zt(s)}}}function uS(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f=t[3][23]+"",g=t[4],v=[];for(let e=0;e<g.length;e+=1)v[e]=cS(rS(t,g,e));const y=t=>It(v[t],1,1,()=>{v[t]=null});let b=Array.from(Pf.values()).filter(t[8]).sort(pS),x=[];for(let e=0;e<b.length;e+=1)x[e]=hS(aS(t,b,e));const w=t=>It(x[t],1,1,()=>{x[t]=null});return{c(){e=B("div"),s=B("div"),i=B("span"),n=F("Skill points: "),a=F(f),r=B("div"),o=F("Unlearn"),c=z(),d=B("div");for(let t=0;t<v.length;t+=1)v[t].c();h=B("div"),h.textContent="Learnable through books:";for(let t=0;t<x.length;t+=1)x[t].c();A(r,"class",l="btn primary unlearn "+(void 0===t[1]||t[1].logic.engineOnly?"disabled":"")),A(s,"class","panel-black textprimary bar svelte-r0v48m"),A(h,"class","learndiv textgrey textcenter svelte-r0v48m"),A(d,"id","skilllist"),A(d,"class","scrollbar"),A(e,"class","flexer svelte-r0v48m")},m(l,f){T(l,e,f),C(e,s),C(s,i),C(i,n),C(i,a),C(s,r),C(r,o),C(e,c),C(e,d);for(let t=0;t<v.length;t+=1)v[t].m(d,null);C(d,h);for(let t=0;t<x.length;t+=1)x[t].m(d,null);u=!0,m||(p=D(r,"click",t[6]),m=!0)},p(t,e){if((!u||8&e)&&f!==(f=t[3][23]+"")&&O(a,f),(!u||2&e&&l!==(l="btn primary unlearn "+(void 0===t[1]||t[1].logic.engineOnly?"disabled":"")))&&A(r,"class",l),19&e){let s;for(g=t[4],s=0;s<g.length;s+=1){const i=rS(t,g,s);v[s]?(v[s].p(i,e),Tt(v[s],1)):(v[s]=cS(i),v[s].c(),Tt(v[s],1),v[s].m(d,h))}for(Et(),s=g.length;s<v.length;s+=1)y(s);Ct()}if(17&e){let s;for(b=Array.from(Pf.values()).filter(t[8]).sort(pS),s=0;s<b.length;s+=1){const i=aS(t,b,s);x[s]?(x[s].p(i,e),Tt(x[s],1)):(x[s]=hS(i),x[s].c(),Tt(x[s],1),x[s].m(d,null))}for(Et(),s=b.length;s<x.length;s+=1)w(s);Ct()}},i(t){if(!u){for(let t=0;t<g.length;t+=1)Tt(v[t]);for(let t=0;t<b.length;t+=1)Tt(x[t]);u=!0}},o(t){v=v.filter(Boolean);for(let t=0;t<v.length;t+=1)It(v[t]);x=x.filter(Boolean);for(let t=0;t<x.length;t+=1)It(x[t]);u=!1},d(t){t&&I(e),P(v,t),P(x,t),m=!1,p()}}}function mS(t){let e,s,i=t[2]&&oS(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[2]?i?(i.p(t,s),4&s&&Tt(i,1)):(i=oS(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}const pS=(t,e)=>t.minlevel-e.minlevel;function fS(t,e,s){let i,n,a,r,o;p(t,fs,t=>s(2,i=t)),p(t,Ne,t=>s(3,n=t)),p(t,be,t=>s(4,a=t));const l=t=>{Jm("skillremove",""+t.logic.id),s(1,o=void 0)},c=t=>l(o),d=(t,e)=>t.logic.engineOnly||s(1,o=t),h=t=>t.class===Ya.player.class&&!t.engineOnly&&!a.some(e=>e.logic.id===t.id),u=()=>{x(fs,i=!1)};function m(t){lt[t?"unshift":"push"](()=>{r=t,s(0,r)})}return[r,o,i,n,a,l,c,d,h,u,m]}class gS extends Ht{constructor(t){super(),Gt(this,t,fS,mS,d,{})}}const vS=t=>9+Math.ceil(.015*t);function yS(t,e,s){const i=t.slice();return i[47]=e[s],i}function bS(t,e,s){const i=t.slice();return i[50]=e[s],i}function xS(t){let e,s,i;return s=new wb({props:{title:"Merchant",$$slots:{default:[TS]},$$scope:{ctx:t}}}),s.$on("close",t[40]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","l-upperLeftModal container svelte-wy3b00")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};114687&e[0]|4194304&e[1]&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function wS(t){let e,s,i,n,a,r=t[50]+"";function o(...e){return t[34](t[50],...e)}return{c(){e=B("div"),s=F(r),A(e,"class",i="choice "+(t[50]==t[1]?"active":"")+" svelte-wy3b00")},m(t,i){T(t,e,i),C(e,s),n||(a=D(e,"click",o),n=!0)},p(s,n){t=s,2&n[0]&&i!==(i="choice "+(t[50]==t[1]?"active":"")+" svelte-wy3b00")&&A(e,"class",i)},d(t){t&&I(e),n=!1,a()}}}function kS(t){let e,s;return e=new Gu({}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function $S(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g=en(t[47].temp.type,t[47].temp.tier)+"",v=t[47].temp.owner+"",y=t[22](t[47].temp.auction.getTime())+"";function b(...e){return t[38](t[47],...e)}return s=new qk({props:{descPos:"right:0;top:0;",descRoot:t[0],pickable:!1,item:t[47]}}),h=new Hw({props:{amount:t[47].temp.auctionprice}}),{c(){e=B("div"),_t(s.$$.fragment),i=B("span"),n=F(g),r=B("span"),o=F(v),l=B("span"),c=F(y),d=B("div"),_t(h.$$.fragment),A(i,"class",a="marg text"+up(t[47].temp.quality)[0]+" svelte-wy3b00"),A(r,"class","marg svelte-wy3b00"),A(l,"class","marg svelte-wy3b00"),A(d,"class","marg svelte-wy3b00"),N(d,"text-align","end"),A(e,"class",u="buy "+(t[12]==t[47]?"selected":"")+" item panel-black svelte-wy3b00")},m(t,a){T(t,e,a),Nt(s,e,null),C(e,i),C(i,n),C(e,r),C(r,o),C(e,l),C(l,c),C(e,d),Nt(h,d,null),m=!0,p||(f=D(e,"click",b),p=!0)},p(r,l){t=r;const d={};1&l[0]&&(d.descRoot=t[0]),2048&l[0]&&(d.item=t[47]),s.$set(d),(!m||2048&l[0])&&g!==(g=en(t[47].temp.type,t[47].temp.tier)+"")&&O(n,g),(!m||2048&l[0]&&a!==(a="marg text"+up(t[47].temp.quality)[0]+" svelte-wy3b00"))&&A(i,"class",a),(!m||2048&l[0])&&v!==(v=t[47].temp.owner+"")&&O(o,v),(!m||2048&l[0])&&y!==(y=t[22](t[47].temp.auction.getTime())+"")&&O(c,y);const p={};2048&l[0]&&(p.amount=t[47].temp.auctionprice),h.$set(p),(!m||6144&l[0]&&u!==(u="buy "+(t[12]==t[47]?"selected":"")+" item panel-black svelte-wy3b00"))&&A(e,"class",u)},i(t){m||(Tt(s.$$.fragment,t),Tt(h.$$.fragment,t),m=!0)},o(t){It(s.$$.fragment,t),It(h.$$.fragment,t),m=!1},d(t){t&&I(e),Zt(s),Zt(h),p=!1,f()}}}function SS(t){let e,s,i,n;const a=[CS,ES],r=[];function o(t,e){return t[12].temp.owner!==Ya.player.name?0:1}return s=o(t),i=r[s]=a[s](t),{c(){e=B("section"),i.c(),A(e,"class","confirm panel-black svelte-wy3b00")},m(t,i){T(t,e,i),r[s].m(e,null),n=!0},p(t,n){let l=s;s=o(t),s===l?r[s].p(t,n):(Et(),It(r[l],1,1,()=>{r[l]=null}),Ct(),i=r[s],i||(i=r[s]=a[s](t),i.c()),Tt(i,1),i.m(e,null))},i(t){n||(Tt(i),n=!0)},o(t){It(i),n=!1},d(t){t&&I(e),r[s].d()}}}function MS(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b,x,w,k=(t[13]?en(t[13].type,t[13].tier):tn.ui.merchant.dragitem)+"",$=tn.ui.merchant.price+"",S=tn.ui.merchant.fee+"",M=tn.ui.merchant.post+"";return s=new qk({props:{descPos:"left:100%;bottom:100%;",clearOnMove:!0,invslot:t[13]?t[10]:void 0,pickable:!0,item:Fe}}),s.$on("discard",t[21]),s.$on("move",t[20]),d=new Hw({props:{amount:t[9]}}),p=new Hw({props:{amount:t[15]}}),{c(){e=B("section"),_t(s.$$.fragment),i=B("span"),n=F(k),r=B("div"),o=B("span"),c=F($),_t(d.$$.fragment),h=B("br"),u=B("span"),m=F(S),_t(p.$$.fragment),f=B("input"),g=B("div"),v=F(M),A(i,"class",a="marg text"+(t[13]?up(t[13].quality)[0]:"grey")+" svelte-wy3b00"),A(o,"class","textwhite"),A(u,"class","textgrey"),A(r,"class","marg svelte-wy3b00"),N(r,"text-align","end"),A(f,"class","marg svelte-wy3b00"),A(f,"type","number"),A(f,"placeholder","Set price"),A(g,"class",y="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-wy3b00"),A(e,"class","post panel-black svelte-wy3b00")},m(a,l){T(a,e,l),Nt(s,e,null),C(e,i),C(i,n),C(e,r),C(r,o),C(o,c),Nt(d,o,null),C(r,h),C(r,u),C(u,m),Nt(p,u,null),C(e,f),_(f,t[9]),C(e,g),C(g,v),b=!0,x||(w=[D(f,"input",t[39]),D(g,"click",t[19])],x=!0)},p(t,e){const r={};9216&e[0]&&(r.invslot=t[13]?t[10]:void 0),s.$set(r),(!b||8192&e[0])&&k!==(k=(t[13]?en(t[13].type,t[13].tier):tn.ui.merchant.dragitem)+"")&&O(n,k),(!b||8192&e[0]&&a!==(a="marg text"+(t[13]?up(t[13].quality)[0]:"grey")+" svelte-wy3b00"))&&A(i,"class",a);const o={};512&e[0]&&(o.amount=t[9]),d.$set(o);const l={};32768&e[0]&&(l.amount=t[15]),p.$set(l),512&e[0]&&R(f.value)!==t[9]&&_(f,t[9]),(!b||65536&e[0]&&y!==(y="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-wy3b00"))&&A(g,"class",y)},i(t){b||(Tt(s.$$.fragment,t),Tt(d.$$.fragment,t),Tt(p.$$.fragment,t),b=!0)},o(t){It(s.$$.fragment,t),It(d.$$.fragment,t),It(p.$$.fragment,t),b=!1},d(t){t&&I(e),Zt(s),Zt(d),Zt(p),x=!1,l(w)}}}function ES(t){let e,s,n,a,r,o,c,d,h,u,m=tn.items[t[12].temp.type]["book"===t[12].temp.type?t[12].temp.logic.skillid:t[12].temp.tier].name+"";return{c(){e=B("span"),s=F("Stop "),n=B("span"),a=F(m),o=F(" from being listed?"),c=B("div"),c.textContent=""+tn.ui.cancel,d=B("div"),d.textContent=""+tn.ui.merchant.delist,A(n,"class",r="text"+up(t[12].temp.quality)[0]+" svelte-wy3b00"),A(e,"class","marg svelte-wy3b00"),A(c,"class","marg btn formatted grey svelte-wy3b00"),A(d,"class","marg btn formatted orange svelte-wy3b00")},m(i,r){T(i,e,r),C(e,s),C(e,n),C(n,a),C(e,o),T(i,c,r),T(i,d,r),h||(u=[D(c,"click",t[24]),D(d,"click",t[26])],h=!0)},p(t,e){4096&e[0]&&m!==(m=tn.items[t[12].temp.type]["book"===t[12].temp.type?t[12].temp.logic.skillid:t[12].temp.tier].name+"")&&O(a,m),4096&e[0]&&r!==(r="text"+up(t[12].temp.quality)[0]+" svelte-wy3b00")&&A(n,"class",r)},i:i,o:i,d(t){t&&I(e),t&&I(c),t&&I(d),h=!1,l(u)}}}function CS(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f=tn.items[t[12].temp.type]["book"===t[12].temp.type?t[12].temp.logic.skillid:t[12].temp.tier].name+"";return o=new Hw({props:{amount:t[12].temp.auctionprice}}),{c(){e=B("span"),s=F("Buy "),i=B("span"),n=F(f),r=F("\n          for "),_t(o.$$.fragment),c=F("?"),d=B("div"),d.textContent=""+tn.ui.cancel,h=B("div"),h.textContent=""+tn.ui.merchant.buy,A(i,"class",a="text"+up(t[12].temp.quality)[0]+" svelte-wy3b00"),A(e,"class","marg svelte-wy3b00"),A(d,"class","marg btn formatted grey svelte-wy3b00"),A(h,"class","marg btn formatted secondary svelte-wy3b00")},m(a,l){T(a,e,l),C(e,s),C(e,i),C(i,n),C(e,r),Nt(o,e,null),C(e,c),T(a,d,l),T(a,h,l),u=!0,m||(p=[D(d,"click",t[24]),D(h,"click",t[25])],m=!0)},p(t,e){(!u||4096&e[0])&&f!==(f=tn.items[t[12].temp.type]["book"===t[12].temp.type?t[12].temp.logic.skillid:t[12].temp.tier].name+"")&&O(n,f),(!u||4096&e[0]&&a!==(a="text"+up(t[12].temp.quality)[0]+" svelte-wy3b00"))&&A(i,"class",a);const s={};4096&e[0]&&(s.amount=t[12].temp.auctionprice),o.$set(s)},i(t){u||(Tt(o.$$.fragment,t),u=!0)},o(t){It(o.$$.fragment,t),u=!1},d(t){t&&I(e),Zt(o),t&&I(d),t&&I(h),m=!1,l(p)}}}function TS(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,U,L,Z,q,G,H,X,j,J,V,Y=tn.ui.merchant.filtermine+"",W=tn.ui.merchant.search+"",Q=t[27](t[7],"tier",t[8])+"",K=t[27](t[7],"auction",t[8])+"",tt=t[27](t[7],"auctionprice",t[8])+"",et=t[17],st=[];for(let e=0;e<et.length;e+=1)st[e]=wS(bS(t,et,e));let it=!t[6]&&kS(),nt=t[11],at=[];for(let e=0;e<nt.length;e+=1)at[e]=$S(yS(t,nt,e));const rt=t=>It(at[t],1,1,()=>{at[t]=null}),ot=[MS,SS],lt=[];function ct(t,e){return t[12]?1:0}return H=ct(t),X=lt[H]=ot[H](t),{c(){e=B("div"),s=B("section"),i=B("input"),n=B("span"),n.textContent="Lv.",a=B("input"),r=B("span"),r.textContent="",o=B("input"),c=B("span"),d=B("div"),h=B("div"),m=z(),p=F(Y),f=B("div"),g=F(W),y=B("section");for(let t=0;t<st.length;t+=1)st[t].c();b=B("section"),x=B("div"),w=B("span"),it&&it.c(),k=B("span"),$=F(Q),S=F("Item"),M=B("span"),M.textContent="Owner",E=B("span"),U=F(K),L=F("Time left"),Z=B("span"),q=F(tt),G=F("Price");for(let t=0;t<at.length;t+=1)at[t].c();X.c(),A(i,"class","marg svelte-wy3b00"),A(i,"type","search"),A(i,"placeholder","Name"),A(n,"class","marg svelte-wy3b00"),A(a,"class","marg svelte-wy3b00"),A(a,"type","number"),A(r,"class","marg svelte-wy3b00"),A(o,"class","marg svelte-wy3b00"),A(o,"type","number"),A(h,"class",u="btn checkbox "+(t[5]?"active":"disabled")),A(d,"class","marg svelte-wy3b00"),A(f,"class",v="btn marg formatted secondary "+(t[6]?"":"disabled")+" svelte-wy3b00"),A(s,"class","search panel-black svelte-wy3b00"),A(y,"class","choices border grey scrollbar svelte-wy3b00"),N(w,"position","relative"),N(Z,"text-align","end"),A(x,"class","buy panel-black svelte-wy3b00"),A(b,"class","items border grey scrollbar svelte-wy3b00"),A(e,"class","layout svelte-wy3b00")},m(l,u){T(l,e,u),C(e,s),C(s,i),_(i,t[4]),C(s,n),C(s,a),_(a,t[2]),C(s,r),C(s,o),_(o,t[3]),C(s,c),C(s,d),C(d,h),C(d,m),C(d,p),C(s,f),C(f,g),t[33](s),C(e,y);for(let t=0;t<st.length;t+=1)st[t].m(y,null);C(e,b),C(b,x),C(x,w),it&&it.m(w,null),C(x,k),C(k,$),C(k,S),C(x,M),C(x,E),C(E,U),C(E,L),C(x,Z),C(Z,q),C(Z,G);for(let t=0;t<at.length;t+=1)at[t].m(b,null);lt[H].m(e,null),j=!0,J||(V=[D(i,"input",t[29]),D(a,"input",t[30]),D(o,"input",t[31]),D(d,"click",t[32]),D(f,"click",t[18]),D(k,"click",t[35]),D(E,"click",t[36]),D(Z,"click",t[37])],J=!0)},p(t,s){if(16&s[0]&&_(i,t[4]),4&s[0]&&R(a.value)!==t[2]&&_(a,t[2]),8&s[0]&&R(o.value)!==t[3]&&_(o,t[3]),(!j||32&s[0]&&u!==(u="btn checkbox "+(t[5]?"active":"disabled")))&&A(h,"class",u),(!j||64&s[0]&&v!==(v="btn marg formatted secondary "+(t[6]?"":"disabled")+" svelte-wy3b00"))&&A(f,"class",v),131074&s[0]){let e;for(et=t[17],e=0;e<et.length;e+=1){const i=bS(t,et,e);st[e]?st[e].p(i,s):(st[e]=wS(i),st[e].c(),st[e].m(y,null))}for(;e<st.length;e+=1)st[e].d(1);st.length=et.length}if(t[6]?it&&(Et(),It(it,1,1,()=>{it=null}),Ct()):it?64&s[0]&&Tt(it,1):(it=kS(),it.c(),Tt(it,1),it.m(w,null)),(!j||384&s[0])&&Q!==(Q=t[27](t[7],"tier",t[8])+"")&&O($,Q),(!j||384&s[0])&&K!==(K=t[27](t[7],"auction",t[8])+"")&&O(U,K),(!j||384&s[0])&&tt!==(tt=t[27](t[7],"auctionprice",t[8])+"")&&O(q,tt),12589057&s[0]){let e;for(nt=t[11],e=0;e<nt.length;e+=1){const i=yS(t,nt,e);at[e]?(at[e].p(i,s),Tt(at[e],1)):(at[e]=$S(i),at[e].c(),Tt(at[e],1),at[e].m(b,null))}for(Et(),e=nt.length;e<at.length;e+=1)rt(e);Ct()}let n=H;H=ct(t),H===n?lt[H].p(t,s):(Et(),It(lt[n],1,1,()=>{lt[n]=null}),Ct(),X=lt[H],X||(X=lt[H]=ot[H](t),X.c()),Tt(X,1),X.m(e,null))},i(t){if(!j){Tt(it);for(let t=0;t<nt.length;t+=1)Tt(at[t]);Tt(X),j=!0}},o(t){It(it),at=at.filter(Boolean);for(let t=0;t<at.length;t+=1)It(at[t]);It(X),j=!1},d(s){s&&I(e),t[33](null),P(st,s),it&&it.d(),P(at,s),lt[H].d(),J=!1,l(V)}}}function IS(t){let e,s,i=t[14]&&xS(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,s){t[14]?i?(i.p(t,s),16384&s[0]&&Tt(i,1)):(i=xS(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function PS(t,e,s){let i,n,a,r,o;p(t,Fe,t=>s(13,i=t)),p(t,ze,t=>s(44,n=t)),p(t,Pe,t=>s(14,a=t)),p(t,Be,t=>s(45,r=t));let l=Object.keys(jo).filter(t=>"gold"!=t);l.unshift("all");let c=l[0],d=0,h=100,u="",m=[],f=!1,g=!0,v="auctionprice",y="asc";const b=()=>{if(g&&a){let t=u.toLowerCase();if(t.length&&(m=Ly.filter(e=>en(e.type,e.tier).toLowerCase().includes(t)),m.length)){const t=m[0];s(1,c=t.type),s(2,d=t.level),s(3,h=t.level)}Jm("itemauctionfind",`${c} ${d} ${h} ${f?1:0} ${v} ${y}`),s(6,g=!1)}};let w;const k=()=>{Q&&Jm("itemauctionpost",`${i.dbid} ${w}`)},$=t=>{const{from:e,to:i}=t.detail;e!==i&&"item"==e.type&&(Fe.set(e.item),s(10,M=e.slot))},S=t=>{Fe.set(),s(10,M=void 0)};let M,E,C=[],T=[];const I=()=>{if(E=Date.now(),r.length){const t=r.map(t=>t.dbid);fetch("/api/item/get",{method:"POST",body:JSON.stringify({auction:1,ids:t})}).then(async t=>{const e=await t.json();e.fail?console.error(e):(s(11,T.length=0,T),r.forEach((t,s)=>{const i=e.find(e=>e.id===t.dbid);i&&(i.store=C[s]||(C[s]=jt()),i.store.temp=t,t.hydrate(i),T.push(i.store))}),s(6,g=!0))})}else s(6,g=!0),s(11,T.length=0,T)},P=t=>{let e=Math.ceil((t-E)/6e4);return e<60?e+" minutes":Math.ceil(e/60)+" hours"};let B;const F=t=>{s(12,B=t)},z=()=>{s(12,B=void 0)},U=()=>{Jm("itemauctionbuy",B.temp.dbid+""),z()},D=()=>{Jm("itemauctioncancel",B.temp.dbid+""),z()},A=(t,e,s)=>t==e?"asc"==s?" ":" ":"",L=t=>{t==v?s(8,y="asc"==y?"desc":"asc"):s(7,v=t),b()};function O(){u=this.value,s(4,u)}function _(){d=R(this.value),s(2,d),s(3,h)}function N(){h=R(this.value),s(3,h),s(2,d)}const Z=t=>s(5,f=!f);function q(t){lt[t?"unshift":"push"](()=>{o=t,s(0,o)})}const G=(t,e)=>{s(1,c=t)},H=t=>L("tier"),X=t=>L("auction"),j=t=>L("auctionprice"),J=(t,e)=>F(t);function V(){w=R(this.value),s(9,w),s(13,i),s(14,a)}const Y=()=>{x(Pe,a=void 0),s(2,d=0),s(3,h=100),s(4,u="")};let W,Q;return t.$$.update=()=>{16384&t.$$.dirty[0]&&(a?s(12,B=void 0):x(Fe,i=void 0)),8192&t.$$.dirty[0]&&i&&s(1,c=i.type),12&t.$$.dirty[0]&&(s(2,d=Math.min(Math.max(0,d||0),100)),s(3,h=Math.min(Math.max(0,h)||100,100))),16386&t.$$.dirty[0]|8192&t.$$.dirty[1]&&a&&b(),8704&t.$$.dirty[0]&&s(9,w=i?gr(0,2147483646,w):0),512&t.$$.dirty[0]&&s(15,W=Number.isInteger(w)?vS(w):0),8704&t.$$.dirty[0]&&s(16,Q=Number.isInteger(w)&&w>0&&i&&i.canBeTraded()),16384&t.$$.dirty[1]&&I()},[o,c,d,h,u,f,g,v,y,w,M,T,B,i,a,W,Q,l,b,k,$,S,P,F,z,U,D,A,L,O,_,N,Z,q,G,H,X,j,J,V,Y]}class BS extends Ht{constructor(t){super(),Gt(this,t,PS,IS,d,{},[-1,-1])}}let FS=0;const zS=new id(0,10),US=(t,e,s=!1,i,n,a,r,o,l=0)=>{re.update(c=>{c.length>100&&c.shift(),s&&(e=Lb(e)),"from"===t&&(zS.done(Ya.time)&&nl({id:"ui/msg",pitch:-1}),zS.reset(Ya.time));const d=new Date;return c.push({channel:t,time:`${String(d.getHours()).padStart(2,"0")}.${String(d.getMinutes()).padStart(2,"0")}`,text:e,key:++FS,sender:i,sub:o,faction:n,cclass:a,level:r,interpolate:s,id:l}),c})},DS=[{name:"Year",description:"one year",days:365,price:9e3},{name:"Month",description:"one month",days:30,price:900}],AS=[{sub:!1,stash:15,inventory:15,auction:10,auctionHours:12},{sub:!0,stash:100,inventory:25,auction:100,auctionHours:24}];function RS(t,e,s){const i=t.slice();return i[29]=e[s],i}function LS(t){let e,s,i,n,a;return s=new wb({props:{title:"Stash",pad:"5",icon:"bag",$$slots:{default:[qS]},$$scope:{ctx:t}}}),s.$on("close",t[19]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","l-upperLeftModal container svelte-1ilvxqc")},m(r,o){T(r,e,o),Nt(s,e,null),t[20](e),i=!0,n||(a=D(e,"pointerup",t[11]),n=!0)},p(t,e){const i={};2047&e[0]|2&e[1]&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(i){i&&I(e),Zt(s),t[20](null),n=!1,a()}}}function OS(t){let e;return{c(){e=B("div")},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function _S(t){let e,s;return e=new qk({props:{descPos:"left:100%;top:0;",descRoot:t[0],pickable:!1,text:t[12](t[29].temp?t[29].temp.getStashTime():0),item:t[29],filter:!t[3]||!t[29].temp||t[29].temp.getStashTime()>t[1]||""}}),e.$on("click",t[13]),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};1&s[0]&&(i.descRoot=t[0]),4&s[0]&&(i.text=t[12](t[29].temp?t[29].temp.getStashTime():0)),4&s[0]&&(i.item=t[29]),14&s[0]&&(i.filter=!t[3]||!t[29].temp||t[29].temp.getStashTime()>t[1]||""),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function NS(t){let e,s,n;return{c(){e=B("span"),e.innerHTML='Upgrade <img class="svgicon texticon" src="/assets/ui/icons/gem.svg?v=4597824">',A(e,"class","btn textwhite")},m(i,a){T(i,e,a),s||(n=D(e,"click",t[15]),s=!0)},p:i,d(t){t&&I(e),s=!1,n()}}}function ZS(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g=(1==t[4]?tn.ui.stash.deposit:tn.ui.stash.withdraw)+"",v=(1==t[4]?tn.ui.stash.deposit:tn.ui.stash.withdraw)+"";return a=new Hw({props:{amount:t[4]>0?t[5]:0}}),{c(){e=B("div"),s=B("span"),i=F(g),n=z(),_t(a.$$.fragment),r=F(" ?"),o=B("div"),c=B("input"),d=B("div"),h=F(v),N(c,"width","150px"),A(c,"class","navbtn formatted"),A(c,"type","number"),A(d,"class",u="btn "+(!t[3]||t[5]<=0?"disabled":"")+" "+(1==t[4]?"blue":"green")+" formatted"),A(o,"class","marg-top formelements svelte-1ilvxqc"),A(e,"class","panel-black marg-top"),N(e,"text-align","right")},m(l,u){T(l,e,u),C(e,s),C(s,i),C(s,n),Nt(a,s,null),C(s,r),C(e,o),C(o,c),_(c,t[5]),C(o,d),C(d,h),m=!0,p||(f=[D(c,"input",t[18]),D(d,"click",t[14])],p=!0)},p(t,e){(!m||16&e[0])&&g!==(g=(1==t[4]?tn.ui.stash.deposit:tn.ui.stash.withdraw)+"")&&O(i,g);const s={};48&e[0]&&(s.amount=t[4]>0?t[5]:0),a.$set(s),32&e[0]&&R(c.value)!==t[5]&&_(c,t[5]),(!m||16&e[0])&&v!==(v=(1==t[4]?tn.ui.stash.deposit:tn.ui.stash.withdraw)+"")&&O(h,v),(!m||56&e[0]&&u!==(u="btn "+(!t[3]||t[5]<=0?"disabled":"")+" "+(1==t[4]?"blue":"green")+" formatted"))&&A(d,"class",u)},i(t){m||(Tt(a.$$.fragment,t),m=!0)},o(t){It(a.$$.fragment,t),m=!1},d(t){t&&I(e),Zt(a),p=!1,l(f)}}}function qS(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S=t[2].length+"",M=(t[7].subscribed_until?AS[1].stash:AS[0].stash)+"",E=t[2],z=[];for(let e=0;e<E.length;e+=1)z[e]=_S(RS(t,E,e));const R=t=>It(z[t],1,1,()=>{z[t]=null});let L=null;E.length||(L=OS());let _=!t[7].subscribed_until&&NS(t);h=new Hw({props:{amount:t[6].gold}});let Z=t[4]>0&&ZS(t);return{c(){e=B("div");for(let t=0;t<z.length;t+=1)z[t].c();L&&L.c(),s=B("div"),i=B("div"),n=B("span"),a=F(S),r=F(" / "),o=F(M),_&&_.c(),d=B("div"),_t(h.$$.fragment),u=B("div"),m=B("img"),g=B("div"),v=B("img"),Z&&Z.c(),x=U(),A(e,"class","panel-black slotcontainer scrollbar svelte-1ilvxqc"),N(e,"width",t[2].length?"fit-content":"auto"),N(e,"grid-template-columns","repeat("+Math.min(t[2].length,t[8])+", auto)"),N(e,"max-height",t[9]+"px"),A(n,"class",c=t[2].length<(t[7].subscribed_until?AS[1].stash:AS[0].stash)?"textgreen":"textred"),A(i,"class","navbtn panel-black border black gold svelte-1ilvxqc"),N(i,"margin-right","auto"),A(d,"class","navbtn panel-black border black gold svelte-1ilvxqc"),A(m,"class","svgicon"),m.src!==(p="/assets/ui/icons/deposit.svg?v=4597824")&&A(m,"src",p),A(u,"class",f="navbtn btn grey gold "+(1==t[4]?"active":"")+" svelte-1ilvxqc"),A(v,"class","svgicon"),v.src!==(y="/assets/ui/icons/withdraw.svg?v=4597824")&&A(v,"src",y),A(g,"class",b="navbtn btn grey gold "+(2==t[4]?"active":"")+" svelte-1ilvxqc"),A(s,"class","formelements svelte-1ilvxqc")},m(l,c){T(l,e,c);for(let t=0;t<z.length;t+=1)z[t].m(e,null);L&&L.m(e,null),T(l,s,c),C(s,i),C(i,n),C(n,a),C(n,r),C(n,o),_&&_.m(n,null),C(s,d),Nt(h,d,null),C(s,u),C(u,m),C(s,g),C(g,v),Z&&Z.m(l,c),T(l,x,c),w=!0,k||($=[D(u,"click",t[16]),D(g,"click",t[17])],k=!0)},p(t,s){if(12303&s[0]){let i;for(E=t[2],i=0;i<E.length;i+=1){const n=RS(t,E,i);z[i]?(z[i].p(n,s),Tt(z[i],1)):(z[i]=_S(n),z[i].c(),Tt(z[i],1),z[i].m(e,null))}for(Et(),i=E.length;i<z.length;i+=1)R(i);Ct(),E.length?L&&(L.d(1),L=null):L||(L=OS(),L.c(),L.m(e,null))}(!w||4&s[0])&&N(e,"width",t[2].length?"fit-content":"auto"),(!w||260&s[0])&&N(e,"grid-template-columns","repeat("+Math.min(t[2].length,t[8])+", auto)"),(!w||512&s[0])&&N(e,"max-height",t[9]+"px"),(!w||4&s[0])&&S!==(S=t[2].length+"")&&O(a,S),(!w||128&s[0])&&M!==(M=(t[7].subscribed_until?AS[1].stash:AS[0].stash)+"")&&O(o,M),t[7].subscribed_until?_&&(_.d(1),_=null):_?_.p(t,s):(_=NS(t),_.c(),_.m(n,null)),(!w||132&s[0]&&c!==(c=t[2].length<(t[7].subscribed_until?AS[1].stash:AS[0].stash)?"textgreen":"textred"))&&A(n,"class",c);const i={};64&s[0]&&(i.amount=t[6].gold),h.$set(i),(!w||16&s[0]&&f!==(f="navbtn btn grey gold "+(1==t[4]?"active":"")+" svelte-1ilvxqc"))&&A(u,"class",f),(!w||16&s[0]&&b!==(b="navbtn btn grey gold "+(2==t[4]?"active":"")+" svelte-1ilvxqc"))&&A(g,"class",b),t[4]>0?Z?(Z.p(t,s),16&s[0]&&Tt(Z,1)):(Z=ZS(t),Z.c(),Tt(Z,1),Z.m(x.parentNode,x)):Z&&(Et(),It(Z,1,1,()=>{Z=null}),Ct())},i(t){if(!w){for(let t=0;t<E.length;t+=1)Tt(z[t]);Tt(h.$$.fragment,t),Tt(Z),w=!0}},o(t){z=z.filter(Boolean);for(let t=0;t<z.length;t+=1)It(z[t]);It(h.$$.fragment,t),It(Z),w=!1},d(t){t&&I(e),P(z,t),L&&L.d(),t&&I(s),_&&_.d(),Zt(h),Z&&Z.d(t),t&&I(x),k=!1,l($)}}}function GS(t){let e,s,i=t[6]&&t[7]&&LS(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,s){t[6]&&t[7]?i?(i.p(t,s),192&s[0]&&Tt(i,1)):(i=LS(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function HS(t,e,s){let i,n,a,r,o,l,c,d,h,u;p(t,Ae,t=>s(23,i=t)),p(t,he,t=>s(24,n=t)),p(t,De,t=>s(6,a=t)),p(t,me,t=>s(25,r=t)),p(t,Ge,t=>s(7,o=t)),p(t,ds,t=>s(8,l=t)),p(t,hs,t=>s(9,c=t)),p(t,ys,t=>s(10,d=t));let m=[],f=[],g=!1,v=void 0;const y=async()=>{if(s(1,u=Date.now()),i.length){const t=await fetch("/api/item/get",{method:"POST",body:JSON.stringify({stash:1,ids:i.map(t=>t.dbid)})}),e=await t.json();if(e.fail)console.error(e);else{s(2,f.length=0,f);let t=new Map(i.map(t=>[t.dbid,t]));e.forEach((e,i)=>{e.store=m[i]||(m[i]=jt()),s(2,f[i]=m[i],f),t.has(e.id)&&(t.get(e.id).hydrate(e),s(2,f[i].temp=t.get(e.id),f))})}}else s(2,f.length=0,f);C()},b=t=>{n&&(Jm("itemstash",""+n.meta.slot),x(he,n=void 0))},w=t=>t<u?void 0:Math.ceil((t-u)/6e4)+"m",k=t=>{g&&(t.detail.item.getStashTime()>Date.now()?US("system",tn.ui.stash.waitunstash):(Jm("itemunstash",t.detail.item.dbid+""),E()))},$=t=>{g&&(Jm(1==S?"goldstash":"goldunstash",M+""),E())};let S=2,M=0;const E=()=>{s(3,g=!1),v=setTimeout(()=>{s(3,g=!0)},500)},C=()=>{s(3,g=!0),v&&(clearTimeout(v),v=void 0)},T=t=>x(ys,d=!0),I=t=>s(4,S=1),P=t=>s(4,S=2);function B(){M=R(this.value),s(5,M),s(6,a),s(4,S),s(25,r)}const F=t=>x(De,a=!1);function z(t){lt[t?"unshift":"push"](()=>{h=t,s(0,h)})}return t.$$.update=()=>{8388608&t.$$.dirty[0]&&y(),33554544&t.$$.dirty[0]&&s(5,M=a?Math.min(1==S?r:a.gold,M):0)},[h,u,f,g,S,M,a,o,l,c,d,b,w,k,$,T,I,P,B,F,z]}class XS extends Ht{constructor(t){super(),Gt(this,t,HS,GS,d,{},[-1,-1])}}function jS(t,e,s){const i=t.slice();return i[7]=e[s],i[9]=s,i}function JS(t){let e,s,i,n,a;return s=new wb({props:{title:"Trader",icon:"bag",$$slots:{default:[tM]},$$scope:{ctx:t}}}),s.$on("close",t[5]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","l-upperLeftModal container svelte-46w0ts")},m(r,o){T(r,e,o),Nt(s,e,null),t[6](e),i=!0,n||(a=D(e,"pointerup",t[3]),n=!0)},p(t,e){const i={};1027&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(i){i&&I(e),Zt(s),t[6](null),n=!1,a()}}}function VS(t){let e,s;return e=new qk({props:{id:"trader"+t[9],descPos:"left:100%;top:0;",descRoot:t[0],isTrader:!0,pickable:!1,item:t[7]}}),e.$on("click",t[4]),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};1&s&&(i.descRoot=t[0]),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function YS(t){let e;return{c(){e=B("span"),e.textContent="Select an item to sell",A(e,"class","textgrey")},m(t,s){T(t,e,s)},p:i,i:i,o:i,d(t){t&&I(e)}}}function WS(t){let e,s,i,n,a;const r=[KS,QS],o=[];function l(t,s){return 2&s&&(e=!!t[1].data.canBeSold()),e?0:1}return s=l(t,-1),i=o[s]=r[s](t),{c(){i.c(),n=U()},m(t,e){o[s].m(t,e),T(t,n,e),a=!0},p(t,e){let a=s;s=l(t,e),s===a?o[s].p(t,e):(Et(),It(o[a],1,1,()=>{o[a]=null}),Ct(),i=o[s],i||(i=o[s]=r[s](t),i.c()),Tt(i,1),i.m(n.parentNode,n))},i(t){a||(Tt(i),a=!0)},o(t){It(i),a=!1},d(t){o[s].d(t),t&&I(n)}}}function QS(t){let e;return{c(){e=B("span"),e.textContent="The trader does not want this item",A(e,"class","textred")},m(t,s){T(t,e,s)},p:i,i:i,o:i,d(t){t&&I(e)}}}function KS(t){let e,s;return e=new Hw({props:{amount:t[1].data.goldValue()}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};2&s&&(i.amount=t[1].data.goldValue()),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function tM(t){let e,s,i,n,a,r,o,l,c,d=Ya.player.getTargetEntity().itemStores,h=[];for(let e=0;e<d.length;e+=1)h[e]=VS(jS(t,d,e));const u=t=>It(h[t],1,1,()=>{h[t]=null}),m=[WS,YS],p=[];function f(t,e){return t[1]&&"item"===t[1].meta.type?0:1}return o=f(t),l=p[o]=m[o](t),{c(){e=B("p"),e.textContent=""+tn.npcs.trader.buy,s=B("div");for(let t=0;t<h.length;t+=1)h[t].c();i=B("div"),n=B("p"),n.textContent=""+tn.npcs.trader.info,a=B("p"),a.textContent=""+tn.npcs.trader.price,r=B("span"),l.c(),A(e,"class","textprimary textcenter"),A(s,"class","panel-black slotcontainer svelte-46w0ts"),A(n,"class","textprimary"),A(r,"class","panel-black formatted info svelte-46w0ts"),A(i,"class","textcenter")},m(t,l){T(t,e,l),T(t,s,l);for(let t=0;t<h.length;t+=1)h[t].m(s,null);T(t,i,l),C(i,n),C(i,a),C(i,r),p[o].m(r,null),c=!0},p(t,e){if(17&e){let i;for(d=Ya.player.getTargetEntity().itemStores,i=0;i<d.length;i+=1){const n=jS(t,d,i);h[i]?(h[i].p(n,e),Tt(h[i],1)):(h[i]=VS(n),h[i].c(),Tt(h[i],1),h[i].m(s,null))}for(Et(),i=d.length;i<h.length;i+=1)u(i);Ct()}let i=o;o=f(t),o===i?p[o].p(t,e):(Et(),It(p[i],1,1,()=>{p[i]=null}),Ct(),l=p[o],l||(l=p[o]=m[o](t),l.c()),Tt(l,1),l.m(r,null))},i(t){if(!c){for(let t=0;t<d.length;t+=1)Tt(h[t]);Tt(l),c=!0}},o(t){h=h.filter(Boolean);for(let t=0;t<h.length;t+=1)It(h[t]);It(l),c=!1},d(t){t&&I(e),t&&I(s),P(h,t),t&&I(i),p[o].d()}}}function eM(t){let e,s,i=t[2]&&JS(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[2]?i?(i.p(t,s),4&s&&Tt(i,1)):(i=JS(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function sM(t,e,s){let i,n;p(t,he,t=>s(1,i=t)),p(t,Re,t=>s(2,n=t));const a=t=>{i&&(Jm("itemtradersell",""+i.meta.slot),x(he,i=void 0))};let r;const o=t=>x(Re,n=!1);function l(t){lt[t?"unshift":"push"](()=>{r=t,s(0,r)})}return[r,i,n,a,t=>{Jm("itemtraderbuy",""+t.detail.item.traderslot)},o,l]}class iM extends Ht{constructor(t){super(),Gt(this,t,sM,eM,d,{})}}const nM=t=>void 0===t.stacks&&t.rolls.length>0&&!jo[t.type].noupgrade,aM=t=>t<101,rM=t=>{if(!nM(t))return 0;const e=Ry[t.type+t.tier];return Math.ceil(((1+e.level*(1+t.upgrade))/jo[t.type].drop)**(1.2+.2*t.upgrade))+100},oM=t=>{if(nM(t)){const e=[];for(let s=0;s<Math.max(1,Math.min(t.upgrade,3));++s)e.push({type:"rune",tier:s+Math.max(0,t.upgrade-3),stacks:Math.min(t.upgrade+1,3-s)});return e}return[]},lM=(t,e,s,i,n)=>cM(t,i,n)&&dM(s,i,n)&&fM(e,i,n)&&vM(e,i,n)&&pM(e,t,i,n,s),cM=(t,e,s)=>t>=Ry[e+s].level,dM=(t,e,s)=>void 0===Ry[e+s].class||t===Ry[e+s].class,hM=(t,e)=>t+Pf.get(e).skillpoints,uM=t=>t.reduce(hM,0),mM=(t,e)=>Pf.get(Ry[t+e].skillid).skillpoints,pM=(t,e,s,i,n)=>"book"!==s||cg(e,n)>=uM(t)+mM(s,i),fM=(t,e,s)=>"book"!==e||gM(t,Ry[e+s].skillid)===Ry[e+s].skilllevel,gM=(t,e)=>t.reduce((t,s)=>t+(s===e),0),vM=(t,e,s)=>!Ry[e+s].requiredSkills||!Ry[e+s].requiredSkills.some(e=>t.indexOf(e)<0),yM=(t,e,s)=>void 0===Ry[e+s].buyElo||t>=Ry[e+s].buyElo,bM=(t,e,s,i)=>Math.ceil(t.goldValue||(.4*(t.level**1.3+.4*e))**(1.1+e/100)/jo[t.type].drop)*(s||1)*(i?8:1);class xM{constructor(t){this.dbid=t,this.stats=new Map,this.dirty=!0}hydrate(t){if(this.dirty=!1,this.bound=t.bound,this.type=t.type,this.tier=t.tier,this.logic=Ry[this.type+this.tier],this.auction=t.auction?new Date(t.auction):void 0,this.auctionprice=t.auctionprice,this.owner=t.name,this.stash=t.stash?new Date(t.stash):void 0,void 0===this.logic)throw"Unknown item "+t.type+t.tier;if(this.upgrade=t.upgrade,this.stats.clear(),t.rolls){if(this.setRolls(t.rolls),this.quality=this.nextRoll(),this.logic.stats){this.logic.stats.forEach((t,e)=>{this.stats.set(e,{type:"base",qual:this.quality,value:Math.floor(t.min+(t.max-t.min)*(this.quality/100)**2+Yo[e]*this.upgrade)})});const t=Math.round((this.quality/100)**1.5*3.6);for(let e=0;e<t;++e){let t=this.nextRoll(),e=-1;for(;-1===e||this.stats.has(e);)e=parseInt(Ho(wM,t/101)),t=(t+5)%100;const s=(this.nextRoll()+this.quality)/2;this.stats.set(e,{type:"bonus",qual:s,value:Math.ceil(Math.max((Vo[e].min+(Vo[e].max-Vo[e].min)*(s/100)**2)*this.logic.level*jo[this.type].weight,Yo[e])+Yo[e]*this.upgrade)})}}this.quality=this.logic.quality||this.quality,this.stacks=void 0}else this.stacks=t.stacks,this.quality=this.logic.quality||0;this.gs=0,this.logic.gs?this.gs=this.logic.gs:this.stats.forEach((t,e)=>{if(17===e)return;let s=t.value/Yo[e];"shield"==this.type&&"base"==t.type&&(s*=.5),"orb"==this.type&&"base"==t.type&&(s*=.7),this.gs+=s}),this.gs=Math.round(this.gs)}setRolls(t){this.rolls=t,this.currentRoll=0}nextRoll(){if(this.currentRoll==this.rolls.length)throw"roll maximum reached";return this.rolls[this.currentRoll++]}use(t){this.logic.use&&this.logic.use(t)}goldValue(t){if(!this.canBeSold())throw"Item cant have value because it cant be sold";return bM(this.logic,this.quality,this.stacks,t)}storeValue(){return this.logic.storeValue||0}medalValue(){return this.logic.medalValue||0}canEquip(t){return lM(t.level,t.skills.skillIds,t.class,this.type,this.tier)}canEquipClass(t){return dM(t.class,this.type,this.tier)}equipReasons(t){const e=[];return this.logic.level&&e.push(["Lv. "+this.logic.level,!0]),e}canBeDropped(){return!jo[this.type].undroppable&&!this.bound}canBeTraded(){return!this.bound}canBeSold(){return!this.logic.unsellable}getStashTime(){return this.dirty?0:void 0!==this.stash?this.stash.getTime():0}getEquipSlot(){return void 0!==jo[this.type].slot?jo[this.type].slot[0]:void 0}}const wM=Object.keys(Vo),kM=(t,e,s)=>{if(t&&t.type)switch(e){case 13:t.rolls&&t.quality>=70&&nl({id:"item/"+(t.quality<90?"discoverRare":"discoverEpic"),pitch:-1});case 1:Qi.chat[7]&&US("inv",tn.ui.inventory.pick.replace("$1",en(t.type,t.tier)),!0),jy(10,100),dl(t.type),Ny[12].element="bag"+s,"book"==t.type&&jy(23,100)&&(Ny[24].element="bag"+s);break;case 10:t.rolls&&Oe.update(e=>(_e.set(t.upgrade-e.upgrade),t))}},$M=(t,e)=>{if(t&&t.type)switch(e){case 7:Qi.chat[8]&&US("inv",tn.ui.stash.stashed.replace("$1",en(t.type,t.tier))),dl(t.type);break;case 6:Fe.set(),ze.update(t=>!t),Qi.chat[8]&&US("inv",tn.ui.merchant.auctionpost.replace("$1",en(t.type,t.tier)));break;case 9:Qi.chat[8]&&US("inv",tn.ui.inventory.sold.replace("$1",en(t.type,t.tier))),dl(t.type);break;case 2:Qi.chat[7]&&US("inv",tn.ui.inventory.throw.replace("$1",en(t.type,t.tier))),dl(t.type)}},SM=(t,e,s,i)=>{switch(0!=s&&dl("gold"),e=i+e,s){case 1:Qi.chat[9]&&US("inv",tn.ui.inventory.pick.replace("$1",e),!0);break;case 4:ze.update(t=>!t),Qi.chat[10]&&US("inv",tn.ui.merchant.auctionbuy.replace("$1",e),!0);break;case 12:case 3:Qi.chat[10]&&US("inv",tn.ui.inventory.spend.replace("$1",e),!0);break;case 11:Qi.chat[10]&&US("inv",tn.ui.inventory.death.replace("$1",e),!0);break;case 9:Qi.chat[10]&&US("inv",tn.ui.inventory.receive.replace("$1",e),!0)}};class MM extends xM{constructor(t){super(t)}hydrate(t){super.hydrate(t),t.store?t.store.set(this):console.error("no store for item",t),kM(this,this.reason,t.slot)}equipReasons(t){const e=[];if(void 0!==this.logic.class&&e.push(["Class: "+tn.classes[this.logic.class].name,dM(t.class,this.type,this.tier)]),this.logic.level&&e.push(["Requires Lv. "+this.logic.level,cM(t.level,this.type,this.tier)]),this.logic.requiredSkills&&e.push(["Must know: "+this.logic.requiredSkills.map(t=>tn.items.book[t].name).join(", "),vM(t.skills.skillIds,this.type,this.tier)]),dM(t.class,this.type,this.tier)&&"book"==this.type){const s=fM(t.skills.skillIds,this.type,this.tier),i=gM(t.skills.skillIds,this.logic.skillid);e.push([s?"Use book to learn skill":i>=this.logic.skilllevel?"You already know this skill":`Must learn book Lv. ${this.logic.skilllevel} first`,s]);const n=pM(t.skills.skillIds,t.level,this.type,this.tier,t.class);e.push([n?`Requires ${mM(this.type,this.tier)||"no"} skill point`:"Not enough skill points",n])}return e}buyReasons(t){const e=[];return void 0!==this.logic.buyElo&&e.push(["Min. Rating: "+Db(this.logic.buyElo),yM(t.elo,this.type,this.tier)]),e}getBestEquipslot(t){const e=jo[this.type].slot;if(void 0!==e)return e.find(e=>void 0===t.slots.get(e))||e[0]}}function EM(t,e,s){const i=t.slice();return i[18]=e[s],i}function CM(t){let e,s,i;return s=new wb({props:{title:"Blacksmith",pad:"5",icon:"bag",$$slots:{default:[PM]},$$scope:{ctx:t}}}),s.$on("close",t[12]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","absCentered container textcenter svelte-1u9u6qj")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};2097407&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function TM(t){let e;return{c(){e=B("div")},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function IM(t){let e,s;return e=new qk({props:{pickable:!1,item:t[18],filter:t[18].filter}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};2&s&&(i.item=t[18]),2&s&&(i.filter=t[18].filter),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function PM(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b=(t[5]||"Place an item into the upgrade slot")+"";r=new qk({props:{clearOnMove:!0,invslot:t[7]?t[0]:void 0,pickable:!0,item:Oe,filter:!!t[3]||""}}),r.$on("discard",t[10]),r.$on("move",t[9]);let x=t[1],w=[];for(let e=0;e<x.length;e+=1)w[e]=IM(EM(t,x,e));const k=t=>It(w[t],1,1,()=>{w[t]=null});let $=null;return x.length||($=TM()),u=new Hw({props:{isPrice:!0,amount:t[7]?rM(t[7]):0}}),{c(){e=B("h3"),e.textContent="Upgrade Item",s=B("span"),i=F(b),a=B("div"),_t(r.$$.fragment),l=B("div"),c=B("span"),c.textContent="Cost:",d=B("div");for(let t=0;t<w.length;t+=1)w[t].c();$&&$.c(),h=B("div"),_t(u.$$.fragment),m=B("div"),p=F("Upgrade"),A(e,"class","textwhite"),A(s,"class",n="panel-black upgradetext "+t[6]+" svelte-1u9u6qj"),A(a,"class",o="upgradeslot "+t[4]+" svelte-1u9u6qj"),A(d,"class","panel-black costgrid svelte-1u9u6qj"),N(d,"grid-template-columns","repeat("+(t[1].length||3)+", 30px)"),A(m,"class",f="btn primary formatted textcenter upgradebutton "+(t[2]?"":"disabled")+" svelte-1u9u6qj"),A(l,"class","upgrade svelte-1u9u6qj")},m(n,o){T(n,e,o),T(n,s,o),C(s,i),T(n,a,o),Nt(r,a,null),T(n,l,o),C(l,c),C(l,d);for(let t=0;t<w.length;t+=1)w[t].m(d,null);$&&$.m(d,null),C(l,h),Nt(u,h,null),C(l,m),C(m,p),g=!0,v||(y=D(m,"click",t[11]),v=!0)},p(t,e){(!g||32&e)&&b!==(b=(t[5]||"Place an item into the upgrade slot")+"")&&O(i,b),(!g||64&e&&n!==(n="panel-black upgradetext "+t[6]+" svelte-1u9u6qj"))&&A(s,"class",n);const l={};if(129&e&&(l.invslot=t[7]?t[0]:void 0),8&e&&(l.filter=!!t[3]||""),r.$set(l),(!g||16&e&&o!==(o="upgradeslot "+t[4]+" svelte-1u9u6qj"))&&A(a,"class",o),2&e){let s;for(x=t[1],s=0;s<x.length;s+=1){const i=EM(t,x,s);w[s]?(w[s].p(i,e),Tt(w[s],1)):(w[s]=IM(i),w[s].c(),Tt(w[s],1),w[s].m(d,null))}for(Et(),s=x.length;s<w.length;s+=1)k(s);Ct(),x.length?$&&($.d(1),$=null):$||($=TM(),$.c(),$.m(d,null))}(!g||2&e)&&N(d,"grid-template-columns","repeat("+(t[1].length||3)+", 30px)");const c={};128&e&&(c.amount=t[7]?rM(t[7]):0),u.$set(c),(!g||4&e&&f!==(f="btn primary formatted textcenter upgradebutton "+(t[2]?"":"disabled")+" svelte-1u9u6qj"))&&A(m,"class",f)},i(t){if(!g){Tt(r.$$.fragment,t);for(let t=0;t<x.length;t+=1)Tt(w[t]);Tt(u.$$.fragment,t),g=!0}},o(t){It(r.$$.fragment,t),w=w.filter(Boolean);for(let t=0;t<w.length;t+=1)It(w[t]);It(u.$$.fragment,t),g=!1},d(t){t&&I(e),t&&I(s),t&&I(a),Zt(r),t&&I(l),P(w,t),$&&$.d(),Zt(u),v=!1,y()}}}function BM(t){let e,s,i=t[8]&&CM(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[8]?i?(i.p(t,s),256&s&&Tt(i,1)):(i=CM(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function FM(t,e,s){let i,n,a,r,o;p(t,Oe,t=>s(7,i=t)),p(t,Le,t=>s(8,n=t)),p(t,_e,t=>s(13,a=t)),p(t,me,t=>s(14,r=t)),p(t,ve,t=>s(15,o=t));const l=t=>{const{from:e,to:i}=t.detail;e!==i&&"item"==e.type&&(Oe.set(e.item),s(0,d=e.slot))},c=t=>{Oe.set(),s(0,d=void 0)};let d,h=[],u=!1,m=!1;const f=()=>{const t=nM(i),e=r>=rM(i),n=aM(d);s(2,u=t&&e&&n);const a=oM(i);a.forEach((t,e)=>{const i=h[e]||s(1,h[e]=jt(),h),n=new MM;n.hydrate({...t,store:i}),i.filter=!(o[n.type+n.tier]>=n.stacks)||"",i.filter&&s(2,u=!1)}),s(1,h=h.slice(0,a.length)),u||s(5,y="You lack the required materials"),t||s(5,y="This item type cannot be upgraded"),e||s(5,y="You do not have enough gold"),n||s(5,y="You must un-equip the item first"),u?(s(6,b="textgreen"),s(5,y="Ready to upgrade")):s(6,b="textred")},g=()=>{i&&u&&!m&&(s(3,m=!0),x(_e,a=void 0),s(5,y="Upgrading..."),s(6,b="textprimary"),nl({id:"anvil",loop:!1,gain:!0}),setTimeout(()=>Jm("itemblacksmithupgrade",""+i.dbid),1e3))};let v,y,b;const w=()=>{nl({id:a>0?"upgrade_success":"upgrade_fail",loop:!1,gain:!0}),s(4,v=a>0?"flash_success":"flash_fail"),s(5,y=(a>0?"Success! ":"Fail! ")+(a<0?"-":"+")+a),s(6,b=a>0?"textgreen":"textred")},k=t=>x(Le,n=!1);return t.$$.update=()=>{256&t.$$.dirty&&(n||(x(Oe,i=void 0),x(_e,a=void 0))),128&t.$$.dirty&&(s(2,u=!0),i?f():(s(1,h.length=0,h),s(2,u=!1),s(6,b=void 0),s(5,y=void 0)),s(3,m=!1)),8192&t.$$.dirty&&(void 0!==a?w():(s(4,v=""),s(6,b="")))},[d,h,u,m,v,y,b,i,n,l,c,g,k]}class zM extends Ht{constructor(t){super(),Gt(this,t,FM,BM,d,{})}}function UM(t){let e;return{c(){e=B("span")},m(s,i){T(s,e,i),e.innerHTML=t[0]},p(t,[s]){1&s&&(e.innerHTML=t[0])},i:i,o:i,d(t){t&&I(e)}}}function DM(t,e,s){let i,{amount:n}=e;return t.$$set=t=>{"amount"in t&&s(1,n=t.amount)},t.$$.update=()=>{2&t.$$.dirty&&s(0,i=Db(n))},[i,n]}class AM extends Ht{constructor(t){super(),Gt(this,t,DM,UM,h,{amount:1})}}function RM(t){let e,s,n,a,r,o=tn.ui.stats.array[t[1]]+"",l=(t[3]?"+"+Ib(t[1],t[0].get(t[2]).get(t[1])):Ib(t[1],t[4][t[1]]||0))+"";return{c(){e=B("span"),s=F(o),n=B("span"),a=F(l),A(n,"class",r="statnumber "+(t[3]?"textgreen":t[0]?"textprimary":"textgreen"))},m(t,i){T(t,e,i),C(e,s),T(t,n,i),C(n,a)},p(t,[e]){2&e&&o!==(o=tn.ui.stats.array[t[1]]+"")&&O(s,o),31&e&&l!==(l=(t[3]?"+"+Ib(t[1],t[0].get(t[2]).get(t[1])):Ib(t[1],t[4][t[1]]||0))+"")&&O(a,l),9&e&&r!==(r="statnumber "+(t[3]?"textgreen":t[0]?"textprimary":"textgreen"))&&A(n,"class",r)},i:i,o:i,d(t){t&&I(e),t&&I(n)}}}function LM(t,e,s){let i;p(t,Ne,t=>s(4,i=t));let n,{relmap:a}=e,{id:r}=e,{relation:o}=e;return t.$$set=t=>{"relmap"in t&&s(0,a=t.relmap),"id"in t&&s(1,r=t.id),"relation"in t&&s(2,o=t.relation)},t.$$.update=()=>{7&t.$$.dirty&&s(3,n=void 0!==o&&void 0!==a.get(o).get(r))},[a,r,o,n,i]}class OM extends Ht{constructor(t){super(),Gt(this,t,LM,RM,d,{relmap:0,id:1,relation:2})}}const _M=[4e3,8e3,12e3,16e3,2e4,24e3,28e3,32e3,36e3,4e4,44e3,48e3],NM=_M.length,ZM=t=>{for(let e=0;e<NM;++e)if(_M[e]>t)return e;return Math.max(0,NM)},qM=t=>0===t?0:_M[t-1],GM=t=>{for(let e=0;e<NM;++e)if(_M[e]>t)return _M[e];return _M[NM-1]},HM=[1,.8,.63,.479,.342,.23,.146,.085,.045,.024,.01,.003,0],XM=t=>0===t?"No Bracket":t===HM.length?HM.length+" (Faction Leader)":`${t} (Top ${(100*HM[t-1]).toFixed(1)}%)`;function jM(t,e,s){const i=t.slice();return i[16]=e[s],i}function JM(t,e,s){const i=t.slice();return i[13]=e[s],i[15]=s,i}function VM(t,e,s){const i=t.slice();return i[19]=e[s],i[21]=s,i}function YM(t,e,s){const i=t.slice();return i[16]=e[s],i}function WM(t){let e,s,i;return s=new wb({props:{title:"Character",icon:"char",$$slots:{default:[iE]},$$scope:{ctx:t}}}),s.$on("close",t[12]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","l-upperLeftModal container uiscaled svelte-ggsnc")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};16777455&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function QM(t){let e,s,i,n,a,r,o;function c(...e){return t[9](t[16],...e)}function d(...e){return t[11](t[16],...e)}return e=new OM({props:{id:t[16]}}),{c(){_t(e.$$.fragment),s=B("img"),s.src!==(i="/assets/ui/icons/arrow.svg?v=4597824")&&A(s,"src",i),A(s,"class",n="btn "+(t[1][22]>0?"green":"disabled")+" svgicon statbtn svelte-ggsnc")},m(i,n){Nt(e,i,n),T(i,s,n),a=!0,r||(o=[D(s,"pointerenter",c),D(s,"pointerleave",t[10]),D(s,"click",d)],r=!0)},p(e,i){t=e,(!a||2&i&&n!==(n="btn "+(t[1][22]>0?"green":"disabled")+" svgicon statbtn svelte-ggsnc"))&&A(s,"class",n)},i(t){a||(Tt(e.$$.fragment,t),a=!0)},o(t){It(e.$$.fragment,t),a=!1},d(t){Zt(e,t),t&&I(s),r=!1,l(o)}}}function KM(t){let e,s;return e=new qk({props:{descPos:"left:100%;top:0;",item:t[19],invslot:101+t[21]}}),e.$on("use",cE),e.$on("context",cE),e.$on("move",lE),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};128&s&&(i.item=t[19]),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function tE(t){let e,s;return e=new OM({props:{id:t[16],relmap:rE,relation:t[0]}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};1&s&&(i.relation=t[0]),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function eE(t){let e,s,i,n=`${t[3]} (${Math.max(t[3]-5,1)} ~ ${Math.min(t[3]+5,45)})`;return{c(){e=B("span"),e.textContent="PvP Level",s=B("span"),i=F(n),A(s,"class","statnumber textprimary")},m(t,n){T(t,e,n),T(t,s,n),C(s,i)},p(t,e){8&e&&n!==(n=`${t[3]} (${Math.max(t[3]-5,1)} ~ ${Math.min(t[3]+5,45)})`)&&O(i,n)},d(t){t&&I(e),t&&I(s)}}}function sE(t){let e,s,i,n=t[13],a=[];for(let e=0;e<n.length;e+=1)a[e]=tE(jM(t,n,e));const r=t=>It(a[t],1,1,()=>{a[t]=null});let o=2==t[15]&&eE(t);return{c(){e=B("div");for(let t=0;t<a.length;t+=1)a[t].c();s=U(),o&&o.c(),A(e,"class","statcol panel-black svelte-ggsnc")},m(t,n){T(t,e,n);for(let t=0;t<a.length;t+=1)a[t].m(e,null);C(e,s),o&&o.m(e,null),i=!0},p(t,i){if(1&i){let o;for(n=t[13],o=0;o<n.length;o+=1){const r=jM(t,n,o);a[o]?(a[o].p(r,i),Tt(a[o],1)):(a[o]=tE(r),a[o].c(),Tt(a[o],1),a[o].m(e,s))}for(Et(),o=n.length;o<a.length;o+=1)r(o);Ct()}2==t[15]&&o.p(t,i)},i(t){if(!i){for(let t=0;t<n.length;t+=1)Tt(a[t]);i=!0}},o(t){a=a.filter(Boolean);for(let t=0;t<a.length;t+=1)It(a[t]);i=!1},d(t){t&&I(e),P(a,t),o&&o.d()}}}function iE(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,D,R,L,_,Z,q,G,H,X,j,J,V,Y,W,Q,K,tt,et,st,it,nt,at,rt,ot=t[5].name+"",lt=t[5].level+"",ct=tn.classes[t[5].class].name+"",dt=tn.factions[t[5].faction].name+"",ht=Mb(t[1][20]||0)+"",ut=t[2]<NM?"/ "+$b(_M[t[2]]):"",mt=(t[2]||"None")+"";V=new AM({props:{amount:t[1][21]||0}}),W=new Jw({props:{amount:2*fy(t[1][21]||0),isPrice:!1}}),tt=new Jw({props:{amount:t[6],isPrice:!1}});let pt=[0,1,2,3,4,5],ft=[];for(let e=0;e<6;e+=1)ft[e]=QM(YM(t,pt,e));const gt=t=>It(ft[t],1,1,()=>{ft[t]=null});it=new OM({props:{id:22}});let vt=t[7].filter(dE),yt=[];for(let e=0;e<vt.length;e+=1)yt[e]=KM(VM(t,vt,e));const bt=t=>It(yt[t],1,1,()=>{yt[t]=null});let xt=oE,wt=[];for(let e=0;e<xt.length;e+=1)wt[e]=sE(JM(t,xt,e));const kt=t=>It(wt[t],1,1,()=>{wt[t]=null});return{c(){e=B("div"),s=B("div"),i=B("span"),i.textContent="Name",n=B("span"),a=F(ot),r=B("span"),r.textContent="Level",o=B("span"),l=F(lt),c=B("span"),c.textContent="Class",d=B("span"),h=B("img"),m=z(),p=F(ct),g=B("span"),g.textContent="Faction",v=B("span"),y=B("img"),x=z(),w=F(dt),$=B("span"),$.textContent="Prestige",S=B("span"),M=B("img"),D=z(),R=F(ht),L=z(),_=F(ut),Z=F(" (Rank "),q=F(mt),G=F("/"),H=F(NM),X=F(")"),j=B("span"),j.textContent="Rating",J=B("span"),_t(V.$$.fragment),Y=F(" ("),_t(W.$$.fragment),Q=F(" per day)"),K=B("span"),K.textContent="Medals",_t(tt.$$.fragment),et=B("div");for(let t=0;t<6;t+=1)ft[t].c();st=U(),_t(it.$$.fragment),nt=B("div");for(let t=0;t<yt.length;t+=1)yt[t].c();at=B("div");for(let t=0;t<wt.length;t+=1)wt[t].c();A(n,"class","bold textwhite"),A(o,"class","bold textwhite"),A(h,"class","texticon"),h.src!==(u=ky(t[5].class))&&A(h,"src",u),A(d,"class",f="bold textc"+t[5].class+" svelte-ggsnc"),A(y,"class","texticon"),y.src!==(b=$y(t[5].faction))&&A(y,"src",b),A(v,"class",k="bold textf"+t[5].faction+" svelte-ggsnc"),A(M,"class","texticon"),M.src!==(E=Ey)&&A(M,"src",E),A(S,"class","bold textprestige"),A(s,"class","statcol panel-black svelte-ggsnc"),N(s,"grid-template-columns","1fr 2fr"),A(et,"id","statpoints"),A(et,"class","statcol panel-black svelte-ggsnc"),N(et,"grid-template-columns","1fr auto auto"),A(e,"class","grid"),N(e,"grid-template-columns","3fr 2fr"),A(nt,"id","equipslots"),A(nt,"class","items svelte-ggsnc"),A(at,"class","grid three stats2 svelte-ggsnc")},m(t,u){T(t,e,u),C(e,s),C(s,i),C(s,n),C(n,a),C(s,r),C(s,o),C(o,l),C(s,c),C(s,d),C(d,h),C(d,m),C(d,p),C(s,g),C(s,v),C(v,y),C(v,x),C(v,w),C(s,$),C(s,S),C(S,M),C(S,D),C(S,R),C(S,L),C(S,_),C(S,Z),C(S,q),C(S,G),C(S,H),C(S,X),C(s,j),C(s,J),Nt(V,J,null),C(J,Y),Nt(W,J,null),C(J,Q),C(s,K),Nt(tt,s,null),C(e,et);for(let t=0;t<6;t+=1)ft[t].m(et,null);C(et,st),Nt(it,et,null),T(t,nt,u);for(let t=0;t<yt.length;t+=1)yt[t].m(nt,null);T(t,at,u);for(let t=0;t<wt.length;t+=1)wt[t].m(at,null);rt=!0},p(t,e){(!rt||32&e)&&ot!==(ot=t[5].name+"")&&O(a,ot),(!rt||32&e)&&lt!==(lt=t[5].level+"")&&O(l,lt),(!rt||32&e&&h.src!==(u=ky(t[5].class)))&&A(h,"src",u),(!rt||32&e)&&ct!==(ct=tn.classes[t[5].class].name+"")&&O(p,ct),(!rt||32&e&&f!==(f="bold textc"+t[5].class+" svelte-ggsnc"))&&A(d,"class",f),(!rt||32&e&&y.src!==(b=$y(t[5].faction)))&&A(y,"src",b),(!rt||32&e)&&dt!==(dt=tn.factions[t[5].faction].name+"")&&O(w,dt),(!rt||32&e&&k!==(k="bold textf"+t[5].faction+" svelte-ggsnc"))&&A(v,"class",k),(!rt||2&e)&&ht!==(ht=Mb(t[1][20]||0)+"")&&O(R,ht),(!rt||4&e)&&ut!==(ut=t[2]<NM?"/ "+$b(_M[t[2]]):"")&&O(_,ut),(!rt||4&e)&&mt!==(mt=(t[2]||"None")+"")&&O(q,mt);const s={};2&e&&(s.amount=t[1][21]||0),V.$set(s);const i={};2&e&&(i.amount=2*fy(t[1][21]||0)),W.$set(i);const n={};if(64&e&&(n.amount=t[6]),tt.$set(n),259&e){let s;for(pt=[0,1,2,3,4,5],s=0;s<6;s+=1){const i=YM(t,pt,s);ft[s]?(ft[s].p(i,e),Tt(ft[s],1)):(ft[s]=QM(i),ft[s].c(),Tt(ft[s],1),ft[s].m(et,st))}for(Et(),s=6;s<6;s+=1)gt(s);Ct()}if(128&e){let s;for(vt=t[7].filter(dE),s=0;s<vt.length;s+=1){const i=VM(t,vt,s);yt[s]?(yt[s].p(i,e),Tt(yt[s],1)):(yt[s]=KM(i),yt[s].c(),Tt(yt[s],1),yt[s].m(nt,null))}for(Et(),s=vt.length;s<yt.length;s+=1)bt(s);Ct()}if(9&e){let s;for(xt=oE,s=0;s<xt.length;s+=1){const i=JM(t,xt,s);wt[s]?(wt[s].p(i,e),Tt(wt[s],1)):(wt[s]=sE(i),wt[s].c(),Tt(wt[s],1),wt[s].m(at,null))}for(Et(),s=xt.length;s<wt.length;s+=1)kt(s);Ct()}},i(t){if(!rt){Tt(V.$$.fragment,t),Tt(W.$$.fragment,t),Tt(tt.$$.fragment,t);for(let t=0;t<6;t+=1)Tt(ft[t]);Tt(it.$$.fragment,t);for(let t=0;t<vt.length;t+=1)Tt(yt[t]);for(let t=0;t<xt.length;t+=1)Tt(wt[t]);rt=!0}},o(t){It(V.$$.fragment,t),It(W.$$.fragment,t),It(tt.$$.fragment,t),ft=ft.filter(Boolean);for(let t=0;t<6;t+=1)It(ft[t]);It(it.$$.fragment,t),yt=yt.filter(Boolean);for(let t=0;t<yt.length;t+=1)It(yt[t]);wt=wt.filter(Boolean);for(let t=0;t<wt.length;t+=1)It(wt[t]);rt=!1},d(t){t&&I(e),Zt(V),Zt(W),Zt(tt),P(ft,t),Zt(it),t&&I(nt),P(yt,t),t&&I(at),P(wt,t)}}}function nE(t){let e,s,i=t[4]&&WM(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[4]?i?(i.p(t,s),16&s&&Tt(i,1)):(i=WM(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}let aE=!1;const rE=new Map;dg.forEach((t,e)=>{const s=new Map;t.forEach((t,e)=>{s.set(e,t)}),rE.set(e,s)});const oE=[[6,8,7,9,12,13],[10,11,17,14,16],[15,19,18,24]],lE=t=>{const{from:e,to:s}=t.detail;e!==s&&"item"==e.type&&Jm("itemmove",`${e.slot} ${s.slot}`)},cE=t=>{const{item:e}=t.detail;if(void 0!==e){const e=Ya.player.inventory.findFirstEmpty();void 0!==e&&Jm("itemmove",`${t.detail.slot} ${e}`)}},dE=(t,e)=>e>=101;function hE(t,e,s){let i,n,a,r,o;p(t,Ne,t=>s(1,i=t)),p(t,$s,t=>s(4,n=t)),p(t,oe,t=>s(5,a=t)),p(t,pe,t=>s(6,r=t)),p(t,ge,t=>s(7,o=t)),Ya&&Ya.player&&!aE&&(aE=!0,zv.forEach((t,e)=>{e-48==Ya.player.class&&t.statsConvert&&t.statsConvert.forEach(t=>{const e=dg.get(t[0])||new Map;e.set(t[2],(e.get(t[2])||0)+t[1]),rE.set(t[0],e)})}));let l=void 0;const c=t=>{i[22]&&(Jm("statincrease",t+" "+(fl.shift.down?10:1)),s(0,l=void 0),jy(18,50))},d=(t,e)=>s(0,l=t),h=t=>s(0,l=void 0),u=(t,e)=>c(t),m=()=>{x($s,n=!1)};let f,g;return t.$$.update=()=>{2&t.$$.dirty&&s(2,f=ZM(i[20]||0)),2&t.$$.dirty&&s(3,g=i[29])},[l,i,f,g,n,a,r,o,c,d,h,u,m]}class uE extends Ht{constructor(t){super(),Gt(this,t,hE,nE,d,{})}}function mE(t,e,s){const i=t.slice();return i[8]=e[s],i}function pE(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b=t[1]?"Searching...":"Find "+(t[0].membercount<2?"party":"members"),x=t[0].exprate+"",w=0===t[0].membercount?"":"/"+t[0].nearby,k=t[0].itemfind+"",$=[],S=new Map;function M(t,e){return 0===t[0].membercount?gE:fE}let E=M(t),P=E(t),z=t[3];const U=t=>t[8].name;for(let e=0;e<z.length;e+=1){let s=mE(t,z,e),i=U(s);S.set(i,$[e]=vE(i,s))}return{c(){e=B("div"),s=B("div"),s.textContent="Party",i=B("div"),i.textContent="Queue",n=B("div"),a=F(b),P.c(),o=B("div"),c=F(x),d=F("% EXP"),h=F(w),u=B("div"),m=F(k),p=F("% FIND"),f=B("div");for(let t=0;t<$.length;t+=1)$[t].c();A(s,"class","btn party"),A(i,"class","btn purp"),A(n,"id","partybtn"),A(n,"class",r="btn border green "+(t[1]?"active":"")+" textwhite"),A(o,"class","btn border grey disabled textexp"),A(u,"class","btn border grey disabled textcyan"),A(e,"class","btnbar"),A(f,"class","partyframes svelte-1xmlhk"),N(f,"width",t[2]+"px")},m(r,l){T(r,e,l),C(e,s),C(e,i),C(e,n),C(n,a),P.m(e,null),C(e,o),C(o,c),C(o,d),C(o,h),C(e,u),C(u,m),C(u,p),T(r,f,l);for(let t=0;t<$.length;t+=1)$[t].m(f,null);g=!0,v||(y=[D(s,"click",t[4]),D(i,"click",t[5]),D(n,"click",t[6])],v=!0)},p(t,s){if((!g||3&s)&&b!==(b=t[1]?"Searching...":"Find "+(t[0].membercount<2?"party":"members"))&&O(a,b),(!g||2&s&&r!==(r="btn border green "+(t[1]?"active":"")+" textwhite"))&&A(n,"class",r),E===(E=M(t))&&P?P.p(t,s):(P.d(1),P=E(t),P&&(P.c(),P.m(e,o))),(!g||1&s)&&x!==(x=t[0].exprate+"")&&O(c,x),(!g||1&s)&&w!==(w=0===t[0].membercount?"":"/"+t[0].nearby)&&O(h,w),(!g||1&s)&&k!==(k=t[0].itemfind+"")&&O(m,k),8&s){const e=t[3];Et(),$=At($,s,U,1,t,e,S,f,Dt,vE,null,mE),Ct()}(!g||4&s)&&N(f,"width",t[2]+"px")},i(t){if(!g){for(let t=0;t<z.length;t+=1)Tt($[t]);g=!0}},o(t){for(let t=0;t<$.length;t+=1)It($[t]);g=!1},d(t){t&&I(e),P.d(),t&&I(f);for(let t=0;t<$.length;t+=1)$[t].d();v=!1,l(y)}}}function fE(t){let e,s,i,n,a=t[0].nearby+"",r=t[0].membercount+"";return{c(){e=B("div"),s=F(a),i=F("/"),n=F(r),A(e,"class","btn border grey disabled textwhite")},m(t,a){T(t,e,a),C(e,s),C(e,i),C(e,n)},p(t,e){1&e&&a!==(a=t[0].nearby+"")&&O(s,a),1&e&&r!==(r=t[0].membercount+"")&&O(n,r)},d(t){t&&I(e)}}}function gE(t){let e;return{c(){e=B("div"),e.textContent="No party",A(e,"class","btn border grey disabled textgrey")},m(t,s){T(t,e,s)},p:i,d(t){t&&I(e)}}}function vE(t,e){let s,i,n;return i=new _x({props:{mode:"party",unit:e[8].unitStore,buffs:e[8].buffStore}}),{key:t,first:null,c(){s=U(),_t(i.$$.fragment),this.first=s},m(t,e){T(t,s,e),Nt(i,t,e),n=!0},p(t,e){const s={};8&e&&(s.unit=t[8].unitStore),8&e&&(s.buffs=t[8].buffStore),i.$set(s)},i(t){n||(Tt(i.$$.fragment,t),n=!0)},o(t){It(i.$$.fragment,t),n=!1},d(t){t&&I(s),Zt(i,t)}}}function yE(t){let e,s,i=t[0]&&pE(t);return{c(){e=B("div"),i&&i.c(),A(e,"class","l-corner-ul uiscaled")},m(t,n){T(t,e,n),i&&i.m(e,null),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),1&s&&Tt(i,1)):(i=pE(t),i.c(),Tt(i,1),i.m(e,null)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){t&&I(e),i&&i.d()}}}function bE(t,e,s){let i,n,a;p(t,Vt,t=>s(0,i=t)),p(t,Qs,t=>s(2,n=t)),p(t,Yt,t=>s(3,a=t));const r=t=>{const e=[i.membercount?Vy.partyleave():Vy.partycreate()];Wt.set({x:t.pageX,y:t.pageY,opts:e})},o=t=>{const e=[];if(0==i.membercount)return r(t);for(let t in ep){const s=ep[t];if(s.queue){const n=void 0===s.minlevel||Ya.player.level>=s.minlevel;e.push(i.queues.indexOf(t)<0?Vy.startqueue(t,n):Vy.stopqueue(t,n))}}Wt.set({x:t.pageX,y:t.pageY,opts:e})},l=()=>{jy(31,100),d||0!==i.membercount?c():(Jm("partycreate",""),setTimeout(c,1e3))},c=()=>Jm(d?"stopqueue":"startqueue",i.queues[0]||(ep[Ya.id+"find"]?Ya.id+"find":"guardstonefind"));let d;return t.$$.update=()=>{1&t.$$.dirty&&s(1,d=i.queues&&i.queues.length)},[i,d,n,a,r,o,l]}class xE extends Ht{constructor(t){super(),Gt(this,t,bE,yE,d,{})}}function wE(t){let e;return{c(){e=B("div"),A(e,"class","pattern svelte-16344pz")},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function kE(t){let e,s,i;return s=new Jb({props:{size:"0.8em",fract:t[0],barcol:"bgexp",left:t[1],right:t[0]+"%",$$slots:{default:[wE]},$$scope:{ctx:t}}}),{c(){e=B("div"),_t(s.$$.fragment),A(e,"id","expbar"),A(e,"class","container svelte-16344pz")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,[e]){const i={};1&e&&(i.fract=t[0]),2&e&&(i.left=t[1]),1&e&&(i.right=t[0]+"%"),8&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function $E(t,e,s){let i,n,a;return p(t,xe,t=>s(2,i=t)),t.$$.update=()=>{4&t.$$.dirty&&(s(0,n=(100*i.current/i.max).toFixed(2)),s(1,a=`${Mb(i.current)} / ${Mb(i.max)} EXP`))},[n,a]}class SE extends Ht{constructor(t){super(),Gt(this,t,$E,kE,d,{})}}function ME(t){let e,s,i,n,a,r,o,c,d,h,u=t[5].msg+"",m=t[5].fixed||t[5].step||t[5].fixed?"Skip":"Next",p=(t[5].fixed||t[5].step||t[5].fixed)&&EE(t);return{c(){e=B("div"),s=B("div"),p&&p.c(),i=B("div"),n=B("a"),n.textContent="Disable tutorial",a=B("div"),r=F(m),A(s,"class","textprimary msgtext svelte-1trgmuj"),A(n,"class","textgrey"),A(a,"class","textgreen"),N(i,"display","flex"),N(i,"justify-content","space-between"),A(e,"class",o="msg "+(t[5].complete?"complete":"")+" svelte-1trgmuj"),N(e,"cursor","pointer")},m(o,l){T(o,e,l),C(e,s),s.innerHTML=u,p&&p.m(e,null),C(e,i),C(i,n),C(i,a),C(a,r),c=!0,d||(h=[D(n,"click",t[6]),D(e,"click",t[7])],d=!0)},p(t,n){(!c||32&n)&&u!==(u=t[5].msg+"")&&(s.innerHTML=u),t[5].fixed||t[5].step||t[5].fixed?p?(p.p(t,n),32&n&&Tt(p,1)):(p=EE(t),p.c(),Tt(p,1),p.m(e,i)):p&&(Et(),It(p,1,1,()=>{p=null}),Ct()),(!c||32&n)&&m!==(m=t[5].fixed||t[5].step||t[5].fixed?"Skip":"Next")&&O(r,m),(!c||32&n&&o!==(o="msg "+(t[5].complete?"complete":"")+" svelte-1trgmuj"))&&A(e,"class",o)},i(t){c||(Tt(p),c=!0)},o(t){It(p),c=!1},d(t){t&&I(e),p&&p.d(),d=!1,l(h)}}}function EE(t){let e,s;return e=new Jb({props:{size:"0.8em",fract:t[5].uH,barcol:"bgtut",left:"",right:Math.ceil(t[5].uH)+"%"}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};32&s&&(i.fract=t[5].uH),32&s&&(i.right=Math.ceil(t[5].uH)+"%"),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function CE(t){let e,s;return{c(){e=B("div"),A(e,"class",s="border skill tut "+(t[5].complete?"complete":"")+" svelte-1trgmuj"),N(e,"top",t[2]+"px"),N(e,"left",t[1]+"px"),N(e,"width",t[3]+"px"),N(e,"height",t[4]+"px")},m(t,s){T(t,e,s)},p(t,i){32&i&&s!==(s="border skill tut "+(t[5].complete?"complete":"")+" svelte-1trgmuj")&&A(e,"class",s),4&i&&N(e,"top",t[2]+"px"),2&i&&N(e,"left",t[1]+"px"),8&i&&N(e,"width",t[3]+"px"),16&i&&N(e,"height",t[4]+"px")},d(t){t&&I(e)}}}function TE(t){let e,s,i,n=t[5]&&t[5].msg&&ME(t),a=t[0]&&CE(t);return{c(){n&&n.c(),e=U(),a&&a.c(),s=U()},m(t,r){n&&n.m(t,r),T(t,e,r),a&&a.m(t,r),T(t,s,r),i=!0},p(t,[i]){t[5]&&t[5].msg?n?(n.p(t,i),32&i&&Tt(n,1)):(n=ME(t),n.c(),Tt(n,1),n.m(e.parentNode,e)):n&&(Et(),It(n,1,1,()=>{n=null}),Ct()),t[0]?a?a.p(t,i):(a=CE(t),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},i(t){i||(Tt(n),i=!0)},o(t){It(n),i=!1},d(t){n&&n.d(t),t&&I(e),a&&a.d(t),t&&I(s)}}}function IE(t,e,s){let i;p(t,Ie,t=>s(5,i=t));let n,a,r,o,l=!1;return Ie.subscribe(t=>{if(t){const e=document.getElementById(t.element);if(e){s(0,l=!0);const t=e.getBoundingClientRect();s(3,r=t.width+10),s(4,o=t.height+10),s(1,n=t.x-5),s(2,a=t.y-5)}else s(0,l=!1)}else s(0,l=!1)}),[l,n,a,r,o,i,t=>As.set(1e3),t=>{jy(-1,100)}]}class PE extends Ht{constructor(t){super(),Gt(this,t,IE,TE,d,{})}}const BE=async(t,e,s)=>{const i=await fetch(t,{method:void 0!==e?"POST":"GET",body:e?JSON.stringify(e):void 0});return 500===i.status?s(await i.text()):await i.json()};function FE(t,e,s){const i=t.slice();return i[7]=e[s],i[9]=s,i}function zE(t){let e,s,i;return s=new wb({props:{title:"Report a player",$$slots:{default:[LE]},$$scope:{ctx:t}}}),s.$on("close",t[4]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","absCentered"),N(e,"z-index","8")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};1031&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function UE(t){let e,s,n,a=t[7]+"";return{c(){e=B("option"),s=F(a),e.__value=n=t[9],e.value=e.__value},m(t,i){T(t,e,i),C(e,s)},p:i,d(t){t&&I(e)}}}function DE(t){let e,s,i=t[2].info+"";return{c(){e=B("p"),s=F(i),A(e,"class","textprimary")},m(t,i){T(t,e,i),C(e,s)},p(t,e){4&e&&i!==(i=t[2].info+"")&&O(s,i)},d(t){t&&I(e)}}}function AE(t){let e,s,i,n,a,r,o,l=("ok"===t[0].result?"Report submitted.":t[0].result)+"";return{c(){e=B("p"),s=F(l),n=B("div"),a=B("div"),a.textContent="Close",A(e,"class",i="ok"===t[0].result?"textgreen":"textred"),A(a,"class","btn grey navbtn"),A(n,"class","subnav")},m(i,l){T(i,e,l),C(e,s),T(i,n,l),C(n,a),r||(o=D(a,"click",t[4]),r=!0)},p(t,n){1&n&&l!==(l=("ok"===t[0].result?"Report submitted.":t[0].result)+"")&&O(s,l),1&n&&i!==(i="ok"===t[0].result?"textgreen":"textred")&&A(e,"class",i)},d(t){t&&I(e),t&&I(n),r=!1,o()}}}function RE(t){let e,s,i,n,a,r,o,c,d;return{c(){e=B("div"),s=B("div"),i=F("Report"),a=B("div"),r=F("Cancel"),A(s,"class",n="btn grey navbtn "+(t[1]?"disabled":"")),A(a,"class",o="btn grey navbtn "+(t[1]?"disabled":"")),A(e,"class","subnav")},m(n,o){T(n,e,o),C(e,s),C(s,i),C(e,a),C(a,r),c||(d=[D(s,"click",t[3]),D(a,"click",t[4])],c=!0)},p(t,e){2&e&&n!==(n="btn grey navbtn "+(t[1]?"disabled":""))&&A(s,"class",n),2&e&&o!==(o="btn grey navbtn "+(t[1]?"disabled":""))&&A(a,"class",o)},d(t){t&&I(e),c=!1,l(d)}}}function LE(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b,x=t[2].name+"",w=tn.ui.report.info[t[2].reason]+"",k=tn.ui.report.reasons,$=[];for(let e=0;e<k.length;e+=1)$[e]=UE(FE(t,k,e));let S=t[2].info&&DE(t);function M(t,e){return t[0]?AE:RE}let E=M(t),z=E(t);return{c(){e=B("div"),s=B("p"),i=F("Describe what happened with "),n=B("span"),a=F(x),r=F(" as accurately as you can:"),o=B("div"),c=B("select");for(let t=0;t<$.length;t+=1)$[t].c();h=B("p"),u=B("small"),m=F(w),S&&S.c(),p=B("div"),f=B("textarea"),v=B("p"),v.innerHTML='<small>Please do not file false reports. If you are unsure about a players behavior, refer to our <a href="/terms" target="_blank">Conduct Policy</a>.</small>',z.c(),A(n,"class","textprimary"),A(c,"class",d=t[1]?"disabled":""),void 0===t[2].reason&&ft(()=>t[5].call(c)),A(o,"class","subnav"),A(h,"class","textgrey"),A(f,"maxlength","300"),A(f,"class",g="scrollbar reportdescription "+(t[1]?"disabled":"")+" svelte-jnzoj3"),A(f,"rows","4"),A(f,"placeholder","Provide additional context, a little description of the situation helps our moderators."),A(p,"class","subnav"),A(v,"class","textgrey"),A(e,"class","card container svelte-jnzoj3")},m(l,d){T(l,e,d),C(e,s),C(s,i),C(s,n),C(n,a),C(s,r),C(e,o),C(o,c);for(let t=0;t<$.length;t+=1)$[t].m(c,null);Z(c,t[2].reason),C(e,h),C(h,u),C(u,m),S&&S.m(e,null),C(e,p),C(p,f),_(f,t[2].description),C(e,v),z.m(e,null),y||(b=[D(c,"change",t[5]),D(f,"input",t[6])],y=!0)},p(t,s){if(4&s&&x!==(x=t[2].name+"")&&O(a,x),0&s){let e;for(k=tn.ui.report.reasons,e=0;e<k.length;e+=1){const i=FE(t,k,e);$[e]?$[e].p(i,s):($[e]=UE(i),$[e].c(),$[e].m(c,null))}for(;e<$.length;e+=1)$[e].d(1);$.length=k.length}2&s&&d!==(d=t[1]?"disabled":"")&&A(c,"class",d),4&s&&Z(c,t[2].reason),4&s&&w!==(w=tn.ui.report.info[t[2].reason]+"")&&O(m,w),t[2].info?S?S.p(t,s):(S=DE(t),S.c(),S.m(e,p)):S&&(S.d(1),S=null),2&s&&g!==(g="scrollbar reportdescription "+(t[1]?"disabled":"")+" svelte-jnzoj3")&&A(f,"class",g),4&s&&_(f,t[2].description),E===(E=M(t))&&z?z.p(t,s):(z.d(1),z=E(t),z&&(z.c(),z.m(e,null)))},d(t){t&&I(e),P($,t),S&&S.d(),z.d(),y=!1,l(b)}}}function OE(t){let e,s,i=void 0!==t[2]&&zE(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){void 0!==t[2]?i?(i.p(t,s),4&s&&Tt(i,1)):(i=zE(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function _E(t,e,s){let i;p(t,Ee,t=>s(2,i=t));let n,a=!1;const r=async()=>{s(1,a=!0),s(0,n=await BE("/api/report/submit",{name:i.name,reason:i.reason,messageId:i.messageId,description:i.description||""}))},o=()=>{x(Ee,i=void 0),s(0,n=void 0),s(1,a=void 0)};function l(){i.reason=q(this),Ee.set(i)}function c(){i.description=this.value,Ee.set(i)}return[n,a,i,r,o,l,c]}class NE extends Ht{constructor(t){super(),Gt(this,t,_E,OE,d,{})}}const ZE=t=>50*Math.round((10+5*t)**1.85/50),qE=t=>Math.min(100,8+2*t),GE=(t,e=200)=>{let s=void 0;return(i,n)=>{s&&clearTimeout(s),s=setTimeout(e=>t(i),null==n?e:n)}};function HE(t,e,s){const i=t.slice();return i[16]=e[s],i[18]=s,i}function XE(t){let e,s,i,n=t[1],a=[];for(let e=0;e<n.length;e+=1)a[e]=JE(HE(t,n,e));const r=t=>It(a[t],1,1,()=>{a[t]=null});let o=null;return n.length||(o=jE()),{c(){e=B("div");for(let t=0;t<a.length;t+=1)a[t].c();s=U(),o&&o.c(),A(e,"class","divider svelte-1pxrrpt")},m(t,n){T(t,e,n);for(let e=0;e<a.length;e+=1)a[e].m(t,n);T(t,s,n),o&&o.m(t,n),i=!0},p(t,e){if(74&e){let i;for(n=t[1],i=0;i<n.length;i+=1){const r=HE(t,n,i);a[i]?(a[i].p(r,e),Tt(a[i],1)):(a[i]=JE(r),a[i].c(),Tt(a[i],1),a[i].m(s.parentNode,s))}for(Et(),i=n.length;i<a.length;i+=1)r(i);Ct(),n.length?o&&(o.d(1),o=null):o||(o=jE(),o.c(),o.m(s.parentNode,s))}},i(t){if(!i){for(let t=0;t<n.length;t+=1)Tt(a[t]);i=!0}},o(t){a=a.filter(Boolean);for(let t=0;t<a.length;t+=1)It(a[t]);i=!1},d(t){t&&I(e),P(a,t),t&&I(s),o&&o.d(t)}}}function jE(t){let e;return{c(){e=B("div"),e.textContent="No results",A(e,"class","textgrey result svelte-1pxrrpt")},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function JE(t){let e,s,i,n,r,o;const l=[t[16]];let c={};for(let t=0;t<l.length;t+=1)c=a(c,l[t]);function d(...e){return t[13](t[18],...e)}return s=new ib({props:c}),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class",i="result "+(t[18]===t[3]?"sel":"")+" svelte-1pxrrpt")},m(t,i){T(t,e,i),Nt(s,e,null),n=!0,r||(o=D(e,"mousedown",d),r=!0)},p(a,r){t=a;const o=2&r?Rt(l,[Lt(t[16])]):{};s.$set(o),(!n||8&r&&i!==(i="result "+(t[18]===t[3]?"sel":"")+" svelte-1pxrrpt"))&&A(e,"class",i)},i(t){n||(Tt(s.$$.fragment,t),n=!0)},o(t){It(s.$$.fragment,t),n=!1},d(t){t&&I(e),Zt(s),r=!1,o()}}}function VE(t){let e,s,i,n,a,r,o,c=t[2]&&XE(t);return{c(){e=B("div"),s=B("div"),i=B("input"),c&&c.c(),A(i,"placeholder","Enter player name"),A(i,"type","text"),A(i,"class","svelte-1pxrrpt"),A(s,"class",n="container input "+(t[2]?"focus":"")+" svelte-1pxrrpt"),A(e,"class","navbtn wrapper svelte-1pxrrpt")},m(n,l){T(n,e,l),C(e,s),C(s,i),t[9](i),_(i,t[0]),c&&c.m(s,null),a=!0,r||(o=[D(i,"input",t[10]),D(i,"input",t[5]),D(i,"focus",t[11]),D(i,"blur",t[12])],r=!0)},p(t,[e]){1&e&&i.value!==t[0]&&_(i,t[0]),t[2]?c?(c.p(t,e),4&e&&Tt(c,1)):(c=XE(t),c.c(),Tt(c,1),c.m(s,null)):c&&(Et(),It(c,1,1,()=>{c=null}),Ct()),(!a||4&e&&n!==(n="container input "+(t[2]?"focus":"")+" svelte-1pxrrpt"))&&A(s,"class",n)},i(t){a||(Tt(c),a=!0)},o(t){It(c),a=!1},d(s){s&&I(e),t[9](null),c&&c.d(),r=!1,l(o)}}}function YE(t,e,s){const i=GE(async()=>{s(1,c=await BE("api/playerinfo/search",{[o]:r,order:"name",limit:l})),u(c.findIndex(t=>t.name.toLowerCase()==r.toLowerCase()))});let n,a,{name:r=""}=e,{type:o="name"}=e,{limit:l=5}=e,c=[],d=!1,h=-1;const u=t=>{s(3,h=t),h>=0&&(n=c[h],s(0,r=n.name))},m=t=>{t.target==a&&(38!==t.keyCode&&40!==t.keyCode||!c.length?13!=t.keyCode&&27!=t.keyCode||a.blur():(u(vr(h+(38===t.keyCode?-1:1),c.length)),t.preventDefault()))};function p(t){lt[t?"unshift":"push"](()=>{a=t,s(4,a)})}function f(){r=this.value,s(0,r)}st(()=>{document.addEventListener("keydown",m)}),nt(()=>{document.removeEventListener("keydown",m),s(4,a=void 0)});const g=t=>s(2,d=!0),v=t=>s(2,d=!1),y=(t,e)=>u(t);return t.$$set=t=>{"name"in t&&s(0,r=t.name),"type"in t&&s(7,o=t.type),"limit"in t&&s(8,l=t.limit)},[r,c,d,h,a,i,u,o,l,p,f,g,v,y]}class WE extends Ht{constructor(t){super(),Gt(this,t,YE,VE,d,{name:0,type:7,limit:8})}}function QE(t,e,s){const i=t.slice();return i[24]=e[s],i[23]=s,i}function KE(t,e,s){const i=t.slice();return i[21]=e[s],i[23]=s,i}function tC(t,e,s){const i=t.slice();return i[26]=e[s],i[23]=s,i}function eC(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,P,R,L,_,N,Z,q,G,H,X,j,J,V,Y,W,Q,K,tt,et,st,it,nt,at,rt,ot,lt,ct,dt,ht,ut,mt,pt,ft,gt,vt=t[0].tag+"",yt=t[0].name+"",bt=tn.factions[t[0].faction].name+"",xt=t[0].level+"",wt=qE(t[0].level)+"",kt=qE(t[0].level+1)-qE(t[0].level)+"",$t=t[0].tax+"",St=t[0].members.length+"",Mt=`${t[0].online} (+${60*t[0].online} EXP/h)`,Pt=Mb(t[0].prestige)+"";f=new Jb({props:{size:"1em",fract:Math.ceil(t[0].exp/ZE(t[0].level)*100),barcol:"bgpurp",left:`${Mb(t[0].exp)} / ${Mb(ZE(t[0].level))} EXP`,right:Math.ceil(t[0].exp/ZE(t[0].level)*100)+"% "}}),at=new Hw({props:{amount:t[0].gold}});let Bt=t[0].role>-1&&sC(t),Ft=t[0].role>0&&iC(t),zt=t[0].eligibleApply.length>0&&nC(t),Ut=t[1]&&rC(t),Dt=t[0].role>0&&oC(t);const At=[cC,lC],Rt=[];function Lt(t,e){return"members"==t[6]?0:"applications"==t[6]?1:-1}return~(ht=Lt(t))&&(ut=Rt[ht]=At[ht](t)),{c(){e=B("div"),s=B("img"),n=B("div"),a=B("div"),r=B("h1"),o=F(vt),l=B("h3"),c=F(yt),h=B("p"),u=F(bt),m=F(" Clan"),p=B("div"),_t(f.$$.fragment),g=B("div"),v=B("div"),y=B("div"),b=B("span"),b.textContent="Clan Level",x=B("span"),w=F(xt),k=B("span"),k.textContent="Capacity",$=B("span"),S=F(wt),M=B("span"),M.textContent="Next Level",E=B("span"),P=F("+"),R=F(kt),L=F(" Capacity"),_=B("span"),_.textContent="Tax rate",N=B("span"),Z=F($t),q=F("%"),G=B("div"),H=B("div"),X=B("span"),X.textContent="Members",j=B("span"),J=F(St),V=B("span"),V.textContent="Online",Y=B("span"),W=F(Mt),Q=B("span"),Q.textContent="Prestige",K=B("span"),tt=B("img"),st=z(),it=F(Pt),nt=B("span"),nt.textContent="Treasury",_t(at.$$.fragment),Bt&&Bt.c(),rt=U(),Ft&&Ft.c(),ot=U(),zt&&zt.c(),lt=U(),Ut&&Ut.c(),ct=B("div"),dt=B("div"),dt.textContent="Members",Dt&&Dt.c(),ut&&ut.c(),mt=U(),A(s,"class","helmet absCentered svelte-6t8hqd"),s.src!==(i="/assets/ui/factions/"+t[0].faction+".svg?v=4597824")&&A(s,"src",i),A(a,"class",d="textf"+t[0].faction+" svelte-6t8hqd"),A(n,"class","textcenter"),A(e,"class","hero svelte-6t8hqd"),A(p,"class","panel-black svelte-6t8hqd"),A(b,"class","textprimary"),A(k,"class","textprimary"),A(M,"class","textprimary"),A(_,"class","textprimary"),A(y,"class","panel-black grid two svelte-6t8hqd"),A(X,"class","textprimary"),A(V,"class","textprimary"),A(Q,"class","textprimary"),A(tt,"class","svgicon"),tt.src!==(et=Ey)&&A(tt,"src",et),A(K,"class","textprestige"),A(nt,"class","textprimary"),A(H,"class","panel-black grid two svelte-6t8hqd"),A(g,"class","marg-top grid two"),A(dt,"class","btn navbtn grey"),A(ct,"class","subnav")},m(i,d){T(i,e,d),C(e,s),C(e,n),C(n,a),C(a,r),C(r,o),C(a,l),C(l,c),C(n,h),C(h,u),C(h,m),T(i,p,d),Nt(f,p,null),T(i,g,d),C(g,v),C(v,y),C(y,b),C(y,x),C(x,w),C(y,k),C(y,$),C($,S),C(y,M),C(y,E),C(E,P),C(E,R),C(E,L),C(y,_),C(y,N),C(N,Z),C(N,q),C(g,G),C(G,H),C(H,X),C(H,j),C(j,J),C(H,V),C(H,Y),C(Y,W),C(H,Q),C(H,K),C(K,tt),C(K,st),C(K,it),C(H,nt),Nt(at,H,null),Bt&&Bt.m(i,d),T(i,rt,d),Ft&&Ft.m(i,d),T(i,ot,d),zt&&zt.m(i,d),T(i,lt,d),Ut&&Ut.m(i,d),T(i,ct,d),C(ct,dt),Dt&&Dt.m(ct,null),~ht&&Rt[ht].m(i,d),T(i,mt,d),pt=!0,ft||(gt=D(dt,"click",t[14]),ft=!0)},p(t,e){(!pt||1&e&&s.src!==(i="/assets/ui/factions/"+t[0].faction+".svg?v=4597824"))&&A(s,"src",i),(!pt||1&e)&&vt!==(vt=t[0].tag+"")&&O(o,vt),(!pt||1&e)&&yt!==(yt=t[0].name+"")&&O(c,yt),(!pt||1&e&&d!==(d="textf"+t[0].faction+" svelte-6t8hqd"))&&A(a,"class",d),(!pt||1&e)&&bt!==(bt=tn.factions[t[0].faction].name+"")&&O(u,bt);const n={};1&e&&(n.fract=Math.ceil(t[0].exp/ZE(t[0].level)*100)),1&e&&(n.left=`${Mb(t[0].exp)} / ${Mb(ZE(t[0].level))} EXP`),1&e&&(n.right=Math.ceil(t[0].exp/ZE(t[0].level)*100)+"% "),f.$set(n),(!pt||1&e)&&xt!==(xt=t[0].level+"")&&O(w,xt),(!pt||1&e)&&wt!==(wt=qE(t[0].level)+"")&&O(S,wt),(!pt||1&e)&&kt!==(kt=qE(t[0].level+1)-qE(t[0].level)+"")&&O(R,kt),(!pt||1&e)&&$t!==($t=t[0].tax+"")&&O(Z,$t),(!pt||1&e)&&St!==(St=t[0].members.length+"")&&O(J,St),(!pt||1&e)&&Mt!==(Mt=`${t[0].online} (+${60*t[0].online} EXP/h)`)&&O(W,Mt),(!pt||1&e)&&Pt!==(Pt=Mb(t[0].prestige)+"")&&O(it,Pt);const r={};1&e&&(r.amount=t[0].gold),at.$set(r),t[0].role>-1?Bt?Bt.p(t,e):(Bt=sC(t),Bt.c(),Bt.m(rt.parentNode,rt)):Bt&&(Bt.d(1),Bt=null),t[0].role>0?Ft?(Ft.p(t,e),1&e&&Tt(Ft,1)):(Ft=iC(t),Ft.c(),Tt(Ft,1),Ft.m(ot.parentNode,ot)):Ft&&(Et(),It(Ft,1,1,()=>{Ft=null}),Ct()),t[0].eligibleApply.length>0?zt?zt.p(t,e):(zt=nC(t),zt.c(),zt.m(lt.parentNode,lt)):zt&&(zt.d(1),zt=null),t[1]?Ut?Ut.p(t,e):(Ut=rC(t),Ut.c(),Ut.m(ct.parentNode,ct)):Ut&&(Ut.d(1),Ut=null),t[0].role>0?Dt?Dt.p(t,e):(Dt=oC(t),Dt.c(),Dt.m(ct,null)):Dt&&(Dt.d(1),Dt=null);let l=ht;ht=Lt(t),ht===l?~ht&&Rt[ht].p(t,e):(ut&&(Et(),It(Rt[l],1,1,()=>{Rt[l]=null}),Ct()),~ht?(ut=Rt[ht],ut||(ut=Rt[ht]=At[ht](t),ut.c()),Tt(ut,1),ut.m(mt.parentNode,mt)):ut=null)},i(t){pt||(Tt(f.$$.fragment,t),Tt(at.$$.fragment,t),Tt(Ft),Tt(ut),pt=!0)},o(t){It(f.$$.fragment,t),It(at.$$.fragment,t),It(Ft),It(ut),pt=!1},d(t){t&&I(e),t&&I(p),Zt(f),t&&I(g),Zt(at),Bt&&Bt.d(t),t&&I(rt),Ft&&Ft.d(t),t&&I(ot),zt&&zt.d(t),t&&I(lt),Ut&&Ut.d(t),t&&I(ct),Dt&&Dt.d(),~ht&&Rt[ht].d(t),t&&I(mt),ft=!1,gt()}}}function sC(t){let e,s,i,n,a=tn.ui.clan.roles[t[0].role]+"";return{c(){e=B("div"),s=B("span"),s.textContent="Your highest rank: ",i=B("span"),n=F(a),A(s,"class","textprimary"),A(i,"class","textgreen"),A(e,"class","marg-top panel-black svelte-6t8hqd")},m(t,a){T(t,e,a),C(e,s),C(e,i),C(i,n)},p(t,e){1&e&&a!==(a=tn.ui.clan.roles[t[0].role]+"")&&O(n,a)},d(t){t&&I(e)}}}function iC(t){let e,s,i,n,a,r,o,l,c,d,h;function u(e){t[12].call(null,e)}let m={};return void 0!==t[4]&&(m.name=t[4]),n=new WE({props:m}),lt.push(()=>Ot(n,"name",u)),{c(){e=B("div"),s=B("span"),s.textContent="Invite players",i=B("div"),_t(n.$$.fragment),r=B("div"),o=F("Invite player"),A(s,"class","textgrey"),A(r,"class",l="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")),A(i,"class","subnav"),A(e,"class","marg-top panel-black svelte-6t8hqd")},m(a,l){T(a,e,l),C(e,s),C(e,i),Nt(n,i,null),C(i,r),C(r,o),c=!0,d||(h=D(r,"click",t[8]),d=!0)},p(t,e){const s={};!a&&16&e&&(a=!0,s.name=t[4],gt(()=>a=!1)),n.$set(s),(!c||24&e&&l!==(l="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")))&&A(r,"class",l)},i(t){c||(Tt(n.$$.fragment,t),c=!0)},o(t){It(n.$$.fragment,t),c=!1},d(t){t&&I(e),Zt(n),d=!1,h()}}}function nC(t){let e,s,i,n,a,r,o,c,d,h=t[0].eligibleApply,u=[];for(let e=0;e<h.length;e+=1)u[e]=aC(tC(t,h,e));return{c(){e=B("div"),s=B("span"),s.textContent="Apply to clan (request invitation)",i=B("div"),n=B("select");for(let t=0;t<u.length;t+=1)u[t].c();a=B("div"),r=F("Apply"),A(s,"class","textgrey"),A(n,"class","navbtn"),void 0===t[5]&&ft(()=>t[13].call(n)),A(a,"class",o="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":"")),A(i,"class","subnav"),A(e,"class","marg-top panel-black svelte-6t8hqd")},m(o,l){T(o,e,l),C(e,s),C(e,i),C(i,n);for(let t=0;t<u.length;t+=1)u[t].m(n,null);Z(n,t[5]),C(i,a),C(a,r),c||(d=[D(n,"change",t[13]),D(a,"click",t[9])],c=!0)},p(t,e){if(33&e){let s;for(h=t[0].eligibleApply,s=0;s<h.length;s+=1){const i=tC(t,h,s);u[s]?u[s].p(i,e):(u[s]=aC(i),u[s].c(),u[s].m(n,null))}for(;s<u.length;s+=1)u[s].d(1);u.length=h.length}33&e&&Z(n,t[5]),41&e&&o!==(o="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":""))&&A(a,"class",o)},d(t){t&&I(e),P(u,t),c=!1,l(d)}}}function aC(t){let e,s,i,n,a=t[26]+"";return{c(){e=B("option"),s=F(a),e.selected=i=t[5]==t[26],e.__value=n=t[26],e.value=e.__value},m(t,i){T(t,e,i),C(e,s)},p(t,r){1&r&&a!==(a=t[26]+"")&&O(s,a),33&r&&i!==(i=t[5]==t[26])&&(e.selected=i),1&r&&n!==(n=t[26])&&(e.__value=n,e.value=e.__value)},d(t){t&&I(e)}}}function rC(t){let e,s,i,n,a;return{c(){e=B("div"),s=B("span"),i=F(t[1]),A(s,"class",n="text"+t[2]+" svelte-6t8hqd"),A(e,"class",a="marg-top panel-black border "+t[2]+" svelte-6t8hqd")},m(t,n){T(t,e,n),C(e,s),C(s,i)},p(t,r){2&r&&O(i,t[1]),4&r&&n!==(n="text"+t[2]+" svelte-6t8hqd")&&A(s,"class",n),4&r&&a!==(a="marg-top panel-black border "+t[2]+" svelte-6t8hqd")&&A(e,"class",a)},d(t){t&&I(e)}}}function oC(t){let e,s,i,n,a,r,o,l=t[0].applications.length+"";return{c(){e=B("div"),s=F("Applications ("),i=F(l),n=F(")"),a=z(),A(e,"class","btn navbtn grey")},m(l,c){T(l,e,c),C(e,s),C(e,i),C(e,n),T(l,a,c),r||(o=D(e,"click",t[15]),r=!0)},p(t,e){1&e&&l!==(l=t[0].applications.length+"")&&O(i,l)},d(t){t&&I(e),t&&I(a),r=!1,o()}}}function lC(t){let e,s,i,n,a,r=[],o=new Map,l=t[0].applications;const c=t=>t[24].name;for(let e=0;e<l.length;e+=1){let s=QE(t,l,e),i=c(s);o.set(i,r[e]=dC(i,s))}return{c(){e=B("div"),e.textContent="This is a list of active applications to your clan. Right click to accept an application and invite the player to your clan",s=B("table"),i=B("thead"),i.innerHTML='<tr class="textprimary"><th width="70%">Player</th></tr>',n=B("tbody");for(let t=0;t<r.length;t+=1)r[t].c();A(e,"class","marg-top textgrey"),A(s,"class","marg-top panel-black svelte-6t8hqd")},m(t,o){T(t,e,o),T(t,s,o),C(s,i),C(s,n);for(let t=0;t<r.length;t+=1)r[t].m(n,null);a=!0},p(t,e){if(1025&e){const s=t[0].applications;Et(),r=At(r,e,c,1,t,s,o,n,Dt,dC,null,QE),Ct()}},i(t){if(!a){for(let t=0;t<l.length;t+=1)Tt(r[t]);a=!0}},o(t){for(let t=0;t<r.length;t+=1)It(r[t]);a=!1},d(t){t&&I(e),t&&I(s);for(let t=0;t<r.length;t+=1)r[t].d()}}}function cC(t){let e,s,i,n,a,r=[],o=new Map,l=t[0].members;const c=t=>t[21].name;for(let e=0;e<l.length;e+=1){let s=KE(t,l,e),i=c(s);o.set(i,r[e]=hC(i,s))}return{c(){e=B("div"),e.textContent="This is a list of active members of this clan. Right click the members for additional options.",s=B("table"),i=B("thead"),i.innerHTML='<tr class="textprimary"><th width="70%">Member</th><th>Rank</th></tr>',n=B("tbody");for(let t=0;t<r.length;t+=1)r[t].c();A(e,"class","marg-top textgrey"),A(s,"class","marg-top panel-black svelte-6t8hqd")},m(t,o){T(t,e,o),T(t,s,o),C(s,i),C(s,n);for(let t=0;t<r.length;t+=1)r[t].m(n,null);a=!0},p(t,e){if(129&e){const s=t[0].members;Et(),r=At(r,e,c,1,t,s,o,n,Dt,hC,null,KE),Ct()}},i(t){if(!a){for(let t=0;t<l.length;t+=1)Tt(r[t]);a=!0}},o(t){for(let t=0;t<r.length;t+=1)It(r[t]);a=!1},d(t){t&&I(e),t&&I(s);for(let t=0;t<r.length;t+=1)r[t].d()}}}function dC(t,e){let s,i,n,a,r,o;function l(...t){return e[17](e[24],...t)}return n=new ib({props:{name:e[24].name,pclass:e[24].class,level:e[24].level,faction:e[0].faction}}),{key:t,first:null,c(){s=B("tr"),i=B("td"),_t(n.$$.fragment),A(s,"class","striped"),this.first=s},m(t,e){T(t,s,e),C(s,i),Nt(n,i,null),a=!0,r||(o=D(s,"mousedown",l),r=!0)},p(t,s){e=t;const i={};1&s&&(i.name=e[24].name),1&s&&(i.pclass=e[24].class),1&s&&(i.level=e[24].level),1&s&&(i.faction=e[0].faction),n.$set(i)},i(t){a||(Tt(n.$$.fragment,t),a=!0)},o(t){It(n.$$.fragment,t),a=!1},d(t){t&&I(s),Zt(n),r=!1,o()}}}function hC(t,e){let s,i,n,a,r,o,l,c,d,h,u,m,p=e[21].online?"":"",f=e[21].owned?"":"",g=tn.ui.clan.roles[e[21].clanrole]+"";function v(...t){return e[16](e[21],...t)}return n=new ib({props:{name:e[21].name,pclass:e[21].class,level:e[21].level,faction:e[0].faction}}),{key:t,first:null,c(){s=B("tr"),i=B("td"),_t(n.$$.fragment),a=B("span"),r=F(p),o=F(f),l=B("td"),c=F(g),A(a,"class","textgreen"),A(s,"class",d="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"),this.first=s},m(t,e){T(t,s,e),C(s,i),Nt(n,i,null),C(i,a),C(a,r),C(a,o),C(s,l),C(l,c),h=!0,u||(m=D(s,"mousedown",v),u=!0)},p(t,i){e=t;const a={};1&i&&(a.name=e[21].name),1&i&&(a.pclass=e[21].class),1&i&&(a.level=e[21].level),1&i&&(a.faction=e[0].faction),n.$set(a),(!h||1&i)&&p!==(p=e[21].online?"":"")&&O(r,p),(!h||1&i)&&f!==(f=e[21].owned?"":"")&&O(o,f),(!h||1&i)&&g!==(g=tn.ui.clan.roles[e[21].clanrole]+"")&&O(c,g),(!h||1&i&&d!==(d="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"))&&A(s,"class",d)},i(t){h||(Tt(n.$$.fragment,t),h=!0)},o(t){It(n.$$.fragment,t),h=!1},d(t){t&&I(s),Zt(n),u=!1,m()}}}function uC(t){let e,s,i=t[0]&&eC(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),1&s&&Tt(i,1)):(i=eC(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function mC(t,e,s){let i,n,{tag:a}=e;const r=async()=>{const t=await BE("/api/claninfo/info",{tag:a});t.name&&(s(0,i=t),i.eligibleApply.length&&s(5,p=i.eligibleApply[0]),s(0,i.online=i.members.filter(t=>t.online).length,i)),n&&(clearTimeout(n),n=setTimeout(r,5e3))};n=!0,r(),nt(()=>{clearTimeout(n),n=void 0});const o=(t,e)=>{const s=[];e.owned?s.push({name:"Leave clan",fun:async()=>{h(await BE("/api/clan/leave",{name:e.name}),"Left the clan")}}):e.clanrole<i.role&&s.push({name:"Kick member",fun:async()=>{h(await BE("/api/clan/kick",{name:e.name}),"Member kicked")}});for(let t=0;t<(3==i.role?4:i.role);t++)s.push({name:"Set rank: "+tn.ui.clan.roles[t],fun:async()=>{h(await BE("/api/clan/setrole",{name:e.name,role:t}),"Set rank: "+tn.ui.clan.roles[t])}});Wt.set({x:t.pageX,y:t.pageY,opts:s})};let l,c,d=!1;const h=async(t,e)=>{"ok"!==t.result?(s(1,l=t.result),s(2,c="red")):(s(1,l=e),s(2,c="green")),await r(),s(3,d=!1)};let u="";const m=async()=>{s(3,d=!0),h(await BE("/api/clan/invite",{name:u,tag:a}),u+" invited"),s(4,u="")};let p="";const f=async()=>{s(3,d=!0),h(await BE("/api/clan/apply",{name:p,tag:a}),"Applied to clan"),s(5,p="")},g=(t,e)=>{const s=[];i.role>0&&s.push({name:"Accept application",fun:async()=>{h(await BE("/api/clan/acceptapplication",{id:e.id}),"Accepted application")}}),i.role>1&&s.push({name:"Deny application",fun:async()=>{h(await BE("/api/clan/denyapplication",{id:e.id}),"Denied application")}}),Wt.set({x:t.pageX,y:t.pageY,opts:s})};let v="members";function y(t){u=t,s(4,u)}function b(){p=q(this),s(5,p),s(0,i)}const x=t=>s(6,v="members"),w=t=>s(6,v="applications"),k=(t,e)=>o(e,t),$=(t,e)=>g(e,t);return t.$$set=t=>{"tag"in t&&s(11,a=t.tag)},[i,l,c,d,u,p,v,o,m,f,g,a,y,b,x,w,k,$]}class pC extends Ht{constructor(t){super(),Gt(this,t,mC,uC,d,{tag:11})}}function fC(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y;return c=new Hw({props:{amount:1e4}}),{c(){e=B("h3"),e.textContent="Create clan",s=B("label"),s.textContent="Clan name",i=B("input"),n=B("label"),n.textContent="Clan tag",a=B("input"),r=B("p"),o=F("Cost: "),_t(c.$$.fragment),h=B("div"),u=F(t[2]),m=B("div"),p=F("Create"),A(e,"class","textprimary"),A(s,"class","svelte-7uvqsx"),A(i,"type","text"),A(i,"placeholder","Guardians of Guardstone (a-Z)"),A(i,"maxlength","20"),A(n,"class","svelte-7uvqsx"),A(a,"type","text"),A(a,"placeholder","GoG (a-Z !~=#*+-)"),A(a,"maxlength","4"),A(r,"class",d="text"+(t[4]>1e4?"primary":"red")),A(h,"class","textred"),N(m,"display","inline-block"),A(m,"class",f="btn marg-top formatted "+(t[3]?"blue":"blue disabled"))},m(l,d){T(l,e,d),T(l,s,d),T(l,i,d),_(i,t[0]),T(l,n,d),T(l,a,d),_(a,t[1]),T(l,r,d),C(r,o),Nt(c,r,null),T(l,h,d),C(h,u),T(l,m,d),C(m,p),g=!0,v||(y=[D(i,"input",t[6]),D(a,"input",t[7]),D(m,"click",t[5])],v=!0)},p(t,[e]){1&e&&i.value!==t[0]&&_(i,t[0]),2&e&&a.value!==t[1]&&_(a,t[1]),(!g||16&e&&d!==(d="text"+(t[4]>1e4?"primary":"red")))&&A(r,"class",d),(!g||4&e)&&O(u,t[2]),(!g||8&e&&f!==(f="btn marg-top formatted "+(t[3]?"blue":"blue disabled")))&&A(m,"class",f)},i(t){g||(Tt(c.$$.fragment,t),g=!0)},o(t){It(c.$$.fragment,t),g=!1},d(t){t&&I(e),t&&I(s),t&&I(i),t&&I(n),t&&I(a),t&&I(r),Zt(c),t&&I(h),t&&I(m),v=!1,l(y)}}}function gC(t,e,s){let i;p(t,me,t=>s(4,i=t));let n="",a="",r=!1,o="";const l=async()=>{if(r)return;s(8,r=!0);const t=await BE("/api/clan/create",{name:n,tag:a});"ok"!==t.result&&(s(2,o=t.result),s(8,r=!1))};function c(){n=this.value,s(0,n)}function d(){a=this.value,s(1,a)}let h;return t.$$.update=()=>{275&t.$$.dirty&&s(3,h=!r&&i>=1e4&&n.length<=20&&n.length>=3&&a.length<=4&&a.length>=2)},[n,a,o,h,i,l,c,d]}class vC extends Ht{constructor(t){super(),Gt(this,t,gC,fC,d,{})}}function yC(t,e,s){const i=t.slice();return i[4]=e[s],i[6]=s,i}function bC(t){let e,s=[],i=new Map,n=t[0];const a=t=>t[4].clan;for(let e=0;e<n.length;e+=1){let r=yC(t,n,e),o=a(r);i.set(o,s[e]=kC(o,r))}return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=U()},m(t,i){for(let e=0;e<s.length;e+=1)s[e].m(t,i);T(t,e,i)},p(t,n){if(3&n){const r=t[0];s=At(s,n,a,1,t,r,i,e.parentNode,Ut,kC,e,yC)}},d(t){for(let e=0;e<s.length;e+=1)s[e].d(t);t&&I(e)}}}function xC(t){let e,s,i;function n(...e){return t[2](t[4],...e)}return{c(){e=B("div"),e.textContent="Accept",A(e,"class","btn blue")},m(t,a){T(t,e,a),s||(i=D(e,"click",n),s=!0)},p(e,s){t=e},d(t){t&&I(e),s=!1,i()}}}function wC(t){let e;return{c(){e=B("div"),e.textContent="Application"},m(t,s){T(t,e,s)},p:i,d(t){t&&I(e)}}}function kC(t,e){let s,i,n,a,r,o,l=e[4].tag+"",c=e[4].name+"";function d(t,e){return t[4].request?wC:xC}let h=d(e),u=h(e);return{key:t,first:null,c(){s=B("tr"),i=B("td"),n=F(l),a=B("td"),r=F(c),o=B("td"),u.c(),A(s,"class","striped"),this.first=s},m(t,e){T(t,s,e),C(s,i),C(i,n),C(s,a),C(a,r),C(s,o),u.m(o,null)},p(t,e){1&e&&l!==(l=t[4].tag+"")&&O(n,l),1&e&&c!==(c=t[4].name+"")&&O(r,c),h===(h=d(t))&&u?u.p(t,e):(u.d(1),u=h(t),u&&(u.c(),u.m(o,null)))},d(t){t&&I(s),u.d()}}}function $C(t){let e,s,n,a=t[0]&&bC(t);return{c(){e=B("table"),s=B("thead"),s.innerHTML='<tr class="textprimary"><th width="20%">Tag</th><th width="60%">Clan Name</th><th>Action</th></tr>',n=B("tbody"),a&&a.c(),A(e,"class","marg-top panel-black")},m(t,i){T(t,e,i),C(e,s),C(e,n),a&&a.m(n,null)},p(t,[e]){t[0]?a?a.p(t,e):(a=bC(t),a.c(),a.m(n,null)):a&&(a.d(1),a=null)},i:i,o:i,d(t){t&&I(e),a&&a.d()}}}function SC(t,e,s){let i;(async()=>{s(0,i=await BE("/api/clan/invites",{name:Ya.player.name}))})();const n=async t=>{await BE("/api/clan/acceptinvite",{id:t})},a=(t,e)=>n(t.id);return[i,n,a]}class MC extends Ht{constructor(t){super(),Gt(this,t,SC,$C,d,{})}}function EC(t){let e,s,i;return s=new wb({props:{title:"Clan",icon:"clan",scroll:"true",$$slots:{default:[FC]},$$scope:{ctx:t}}}),s.$on("close",t[6]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","absCentered container svelte-1rc4ub7")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};133&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function CC(t){let e,s,n,a,r,o,c;return{c(){e=B("div"),s=B("div"),n=B("h3"),n.textContent="You have no clan",a=B("div"),a.textContent="View invitations",r=B("div"),r.textContent="Create clan",A(a,"class","btn grey"),A(r,"class","btn grey marg-top"),A(s,"class","panel-black"),A(e,"class","clanInfoBox textcenter svelte-1rc4ub7")},m(i,l){T(i,e,l),C(e,s),C(s,n),C(s,a),C(s,r),o||(c=[D(a,"click",t[4]),D(r,"click",t[5])],o=!0)},p:i,i:i,o:i,d(t){t&&I(e),o=!1,l(c)}}}function TC(t){let e,s,i,n,a,r,o;const l=[BC,PC],c=[];function d(t,e){return"create"==t[0]?0:"invites"==t[0]?1:-1}return~(i=d(t))&&(n=c[i]=l[i](t)),{c(){e=B("div"),s=B("div"),s.textContent="Back",n&&n.c(),N(s,"display","inline-block"),A(s,"class","btn formatted grey"),A(e,"class","modemenu svelte-1rc4ub7")},m(n,l){T(n,e,l),C(e,s),~i&&c[i].m(e,null),a=!0,r||(o=D(s,"click",t[3]),r=!0)},p(t,s){let a=i;i=d(t),i!==a&&(n&&(Et(),It(c[a],1,1,()=>{c[a]=null}),Ct()),~i?(n=c[i],n||(n=c[i]=l[i](t),n.c()),Tt(n,1),n.m(e,null)):n=null)},i(t){a||(Tt(n),a=!0)},o(t){It(n),a=!1},d(t){t&&I(e),~i&&c[i].d(),r=!1,o()}}}function IC(t){let e,s,i;return s=new pC({props:{tag:t[2]}}),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","clanView svelte-1rc4ub7")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};4&e&&(i.tag=t[2]),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function PC(t){let e,s;return e=new MC({}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function BC(t){let e,s;return e=new vC({}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function FC(t){let e,s,i,n;const a=[IC,TC,CC],r=[];function o(t,e){return t[2]?0:t[0]?1:2}return e=o(t),s=r[e]=a[e](t),{c(){s.c(),i=U()},m(t,s){r[e].m(t,s),T(t,i,s),n=!0},p(t,n){let l=e;e=o(t),e===l?r[e].p(t,n):(Et(),It(r[l],1,1,()=>{r[l]=null}),Ct(),s=r[e],s||(s=r[e]=a[e](t),s.c()),Tt(s,1),s.m(i.parentNode,i))},i(t){n||(Tt(s),n=!0)},o(t){It(s),n=!1},d(t){r[e].d(t),t&&I(i)}}}function zC(t){let e,s,i=t[1]&&EC(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[1]?i?(i.p(t,s),2&s&&Tt(i,1)):(i=EC(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function UC(t,e,s){let i,n;p(t,bs,t=>s(1,i=t)),p(t,qe,t=>s(2,n=t));let a=!1;const r=t=>s(0,a=!1),o=t=>s(0,a="invites"),l=t=>s(0,a="create"),c=()=>{x(bs,i=!1)};return[a,i,n,r,o,l,c]}class DC extends Ht{constructor(t){super(),Gt(this,t,UC,zC,d,{})}}const AC=t=>({days:~~(t/864e5),hours:~~(t/36e5%24),minutes:~~(t/1e3/60%60),seconds:~~(t/1e3%60)}),RC=t=>{const e=AC(t);return`${e.days?e.days+"d ":""}${e.hours?e.hours+"h ":""}${e.minutes?e.minutes+"m ":""}${e.seconds?e.seconds+"s":""}`},LC=t=>~~(1e4+t**1.5*8e3);function OC(t,e,s){const i=t.slice();return i[9]=e[s],i[11]=s,i}function _C(t){let e,s,i;return s=new wb({props:{title:"War Statistics",icon:"pvp",$$slots:{default:[qC]},$$scope:{ctx:t}}}),s.$on("close",t[8]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","absCentered container svelte-g2pdl9")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};4101&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function NC(t){let e,s,i,n,a,r,o,l=Mb(t[2].contrib)+"",c=Mb(LC(t[2].level))+"",d=t[2].level+"";return{c(){e=B("span"),s=F(l),i=F(" / "),n=F(c),a=F(" (Lv. "),r=F(d),o=F(" War)"),N(e,"font-size","14px"),A(e,"class","absCentered textprimary")},m(t,l){T(t,e,l),C(e,s),C(e,i),C(e,n),C(e,a),C(e,r),C(e,o)},p(t,e){4&e&&l!==(l=Mb(t[2].contrib)+"")&&O(s,l),4&e&&c!==(c=Mb(LC(t[2].level))+"")&&O(n,c),4&e&&d!==(d=t[2].level+"")&&O(r,d)},d(t){t&&I(e)}}}function ZC(t,e){let s,i,n,a,r,o,l,c,d,h,u,m,p=Mb(e[9].stats[1])+"",f=Mb(e[9].stats[2])+"",g=e[9].stats[0]+"",v=Mb(e[9].stats[3])+"";return n=new ib({props:{name:e[9].name,pclass:e[9].class,level:e[9].level,faction:e[9].faction}}),{key:t,first:null,c(){s=B("tr"),i=B("td"),_t(n.$$.fragment),a=B("td"),r=F(p),o=B("td"),l=F(f),c=B("td"),d=F(g),h=B("td"),u=F(v),A(i,"class","svelte-g2pdl9"),A(a,"class","textcenter svelte-g2pdl9"),A(o,"class","textcenter svelte-g2pdl9"),A(c,"class","textcenter svelte-g2pdl9"),A(h,"class","textcenter textfame svelte-g2pdl9"),A(s,"class","striped svelte-g2pdl9"),this.first=s},m(t,e){T(t,s,e),C(s,i),Nt(n,i,null),C(s,a),C(a,r),C(s,o),C(o,l),C(s,c),C(c,d),C(s,h),C(h,u),m=!0},p(t,e){const s={};5&e&&(s.name=t[9].name),5&e&&(s.pclass=t[9].class),5&e&&(s.level=t[9].level),5&e&&(s.faction=t[9].faction),n.$set(s),(!m||5&e)&&p!==(p=Mb(t[9].stats[1])+"")&&O(r,p),(!m||5&e)&&f!==(f=Mb(t[9].stats[2])+"")&&O(l,f),(!m||5&e)&&g!==(g=t[9].stats[0]+"")&&O(d,g),(!m||5&e)&&v!==(v=Mb(t[9].stats[3])+"")&&O(u,v)},i(t){m||(Tt(n.$$.fragment,t),m=!0)},o(t){It(n.$$.fragment,t),m=!1},d(t){t&&I(s),Zt(n)}}}function qC(t){let e,s,i,n,a,r,o,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,P,U,R,L,_,Z,q,G,H,X,j,J,V,Y,W,Q,K,tt,et,st,it,nt,at,rt,ot,lt,ct,dt,ht,ut,mt,pt,ft=t[2].kills[0]+"",gt=Mb(t[2].reward)+"",vt=["Ended","Ending Soon","Active"][t[2].status]+"",yt=RC(1e3*t[2].duration)+"",bt=t[2].kills[1]+"",xt=[],wt=new Map;H=new Jb({props:{size:"1.3em",fract:~~(t[2].contrib/LC(t[2].level)*100),left:"",right:"",barcol:"bgpurp",$$slots:{default:[NC]},$$scope:{ctx:t}}});let kt=t[2].contributors.sort(t[7]);const $t=t=>t[9].name;for(let e=0;e<kt.length;e+=1){let s=OC(t,kt,e),i=$t(s);wt.set(i,xt[e]=ZC(i,s))}return{c(){e=B("div"),s=B("div"),i=B("div"),n=B("div"),a=B("span"),a.textContent="Vanguard",r=B("span"),o=B("img"),d=z(),h=F(ft),u=B("div"),m=B("span"),p=B("img"),g=z(),v=F(gt),y=B("span"),b=F("War Status: "),x=B("span"),w=F(vt),$=B("span"),S=F("Duration: "),M=B("span"),E=F(yt),P=z(),U=B("div"),R=B("span"),R.textContent="Bloodlust",L=B("span"),_=B("img"),q=z(),G=F(bt),_t(H.$$.fragment),X=B("div"),j=B("table"),J=B("thead"),V=B("tr"),Y=B("th"),Y.textContent="Player",W=B("th"),Q=F("Damage"),tt=B("th"),et=F("Healing"),it=B("th"),nt=F("Kills"),rt=B("th"),ot=B("img"),ct=F(" Fame"),ht=B("tbody");for(let t=0;t<xt.length;t+=1)xt[t].c();A(a,"class","infosmall textf0 svelte-g2pdl9"),N(a,"margin-top","30px"),A(o,"class","svgicon"),o.src!==(c="/assets/ui/icons/pvp.svg?v=4597824")&&A(o,"src",c),A(r,"class","infobig textprimary svelte-g2pdl9"),N(r,"margin-top","10px"),A(p,"class","svgicon"),p.src!==(f=Cy)&&A(p,"src",f),A(m,"class","infobig textfame svelte-g2pdl9"),N(m,"margin-top","20px"),A(x,"class",k="text"+["red","orange","green"][t[2].status]+" svelte-g2pdl9"),A(y,"class","infosmall svelte-g2pdl9"),N(y,"margin-top","10px"),A(M,"class","textprimary"),A($,"class","infosmall svelte-g2pdl9"),N($,"margin-bottom","20px"),A(R,"class","infosmall textf1 svelte-g2pdl9"),N(R,"margin-top","30px"),A(_,"class","svgicon"),_.src!==(Z="/assets/ui/icons/pvp.svg?v=4597824")&&A(_,"src",Z),A(L,"class","infobig textprimary svelte-g2pdl9"),N(L,"margin-top","10px"),A(i,"class","grid three"),A(s,"class"," panel-black border grey"),A(Y,"width","30%"),A(W,"class",K="textcenter "+(1==t[0]?"textwhite":"")),A(tt,"class",st="textcenter "+(2==t[0]?"textwhite":"")),A(it,"class",at="textcenter "+(0==t[0]?"textwhite":"")),A(ot,"class","svgicon"),ot.src!==(lt=Cy)&&A(ot,"src",lt),A(rt,"class",dt="textcenter "+(3==t[0]?"textwhite":"")),A(V,"class","textprimary"),A(ht,"class","svelte-g2pdl9"),A(j,"class","statboard panel-black svelte-g2pdl9"),A(X,"class","scrollbar"),A(e,"class","layout svelte-g2pdl9")},m(l,c){T(l,e,c),C(e,s),C(s,i),C(i,n),C(n,a),C(n,r),C(r,o),C(r,d),C(r,h),C(i,u),C(u,m),C(m,p),C(m,g),C(m,v),C(u,y),C(y,b),C(y,x),C(x,w),C(u,$),C($,S),C($,M),C(M,E),C(u,P),C(i,U),C(U,R),C(U,L),C(L,_),C(L,q),C(L,G),Nt(H,s,null),C(e,X),C(X,j),C(j,J),C(J,V),C(V,Y),C(V,W),C(W,Q),C(V,tt),C(tt,et),C(V,it),C(it,nt),C(V,rt),C(rt,ot),C(rt,ct),C(j,ht);for(let t=0;t<xt.length;t+=1)xt[t].m(ht,null);ut=!0,mt||(pt=[D(W,"click",t[3]),D(tt,"click",t[4]),D(it,"click",t[5]),D(rt,"click",t[6])],mt=!0)},p(t,e){(!ut||4&e)&&ft!==(ft=t[2].kills[0]+"")&&O(h,ft),(!ut||4&e)&&gt!==(gt=Mb(t[2].reward)+"")&&O(v,gt),(!ut||4&e)&&vt!==(vt=["Ended","Ending Soon","Active"][t[2].status]+"")&&O(w,vt),(!ut||4&e&&k!==(k="text"+["red","orange","green"][t[2].status]+" svelte-g2pdl9"))&&A(x,"class",k),(!ut||4&e)&&yt!==(yt=RC(1e3*t[2].duration)+"")&&O(E,yt),(!ut||4&e)&&bt!==(bt=t[2].kills[1]+"")&&O(G,bt);const s={};if(4&e&&(s.fract=~~(t[2].contrib/LC(t[2].level)*100)),4100&e&&(s.$$scope={dirty:e,ctx:t}),H.$set(s),(!ut||1&e&&K!==(K="textcenter "+(1==t[0]?"textwhite":"")))&&A(W,"class",K),(!ut||1&e&&st!==(st="textcenter "+(2==t[0]?"textwhite":"")))&&A(tt,"class",st),(!ut||1&e&&at!==(at="textcenter "+(0==t[0]?"textwhite":"")))&&A(it,"class",at),(!ut||1&e&&dt!==(dt="textcenter "+(3==t[0]?"textwhite":"")))&&A(rt,"class",dt),5&e){const s=t[2].contributors.sort(t[7]);Et(),xt=At(xt,e,$t,1,t,s,wt,ht,Dt,ZC,null,OC),Ct()}},i(t){if(!ut){Tt(H.$$.fragment,t);for(let t=0;t<kt.length;t+=1)Tt(xt[t]);ut=!0}},o(t){It(H.$$.fragment,t);for(let t=0;t<xt.length;t+=1)It(xt[t]);ut=!1},d(t){t&&I(e),Zt(H);for(let t=0;t<xt.length;t+=1)xt[t].d();mt=!1,l(pt)}}}function GC(t){let e,s,i=t[1]&&_C(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[1]?i?(i.p(t,s),2&s&&Tt(i,1)):(i=_C(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function HC(t,e,s){let i,n;p(t,Te,t=>s(1,i=t)),p(t,Ce,t=>s(2,n=t));let a=1;const r=()=>s(0,a=1),o=()=>s(0,a=2),l=()=>s(0,a=0),c=()=>s(0,a=3),d=()=>{x(Te,i=!1)};return[a,i,n,r,o,l,c,(t,e)=>e.stats[a]-t.stats[a],d]}class XC extends Ht{constructor(t){super(),Gt(this,t,HC,GC,d,{})}}function jC(t){let e,s,i;return s=new wb({props:{title:"PVP",icon:"pvp",$$slots:{default:[VC]},$$scope:{ctx:t}}}),s.$on("close",t[5]),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","l-upperLeftModal container uiscaled svelte-voya4q")},m(t,n){T(t,e,n),Nt(s,e,null),i=!0},p(t,e){const i={};271&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){i||(Tt(s.$$.fragment,t),i=!0)},o(t){It(s.$$.fragment,t),i=!1},d(t){t&&I(e),Zt(s)}}}function JC(t){let e,s=(t[0]>0?Ab(t[0],tn.ui.title.name[Ya.player.faction][t[0]-1]):"Unranked")+"";return{c(){e=B("span"),A(e,"class","absCentered ranktitle svelte-voya4q")},m(t,i){T(t,e,i),e.innerHTML=s},p(t,i){1&i&&s!==(s=(t[0]>0?Ab(t[0],tn.ui.title.name[Ya.player.faction][t[0]-1]):"Unranked")+"")&&(e.innerHTML=s)},d(t){t&&I(e)}}}function VC(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,P,U,D,R,L,_,N,Z,q,G,X,j,J,V,Y,W,Q,K,tt,et,st,it,nt,at,rt,ot,lt,ct,dt,ht,ut,mt,pt,ft,gt,vt,yt,bt,xt,wt,kt,$t,St,Mt,Et,Ct,Pt,Bt,Ft,zt,Ut,Dt,At=Mb(t[3].prestige)+"",Rt=Ab(t[1],tn.ui.title.name[Ya.player.faction][t[1]-1])+"",Lt=Mb(GM(t[3].prestige))+"",Ot=Mb(t[3].kills_today)+"",qt=Mb(t[3].fame_today)+"",Gt=Mb(t[3].kills_this_week)+"",Ht=Mb(t[3].fame)+"",Xt=t[3].fame_position+"",jt=XM(t[3].fame_bracket)+"",Jt=Mb(t[3].kills_last_week)+"",Vt=Mb(t[3].fame_last_week)+"",Yt=t[3].fame_position_last_week+"",Wt=XM(t[3].fame_bracket_last_week)+"",Qt=Mb(t[3].kills_lifetime)+"",Kt=Mb(t[3].fame_lifetime)+"",te=(t[3].rank_lifetime>0?Ab(t[3].rank_lifetime,tn.ui.title.name[Ya.player.faction][t[3].rank_lifetime-1]):"Unranked")+"";return s=new Jb({props:{size:"1.5em",fract:t[2],barcol:"bgpurp",$$slots:{default:[JC]},$$scope:{ctx:t}}}),{c(){e=B("div"),_t(s.$$.fragment),i=B("div"),n=B("span"),n.textContent="Current Prestige",a=B("span"),r=B("img"),l=z(),c=F(At),d=B("span"),d.textContent="Next Rank",h=B("span"),m=F(" ("),p=F(Lt),f=F(")"),g=B("div"),v=B("small"),v.textContent="Today",y=B("span"),b=B("span"),b.textContent="Kills",x=B("span"),w=F(Ot),k=B("span"),k.textContent="Fame",$=B("span"),S=B("img"),E=z(),P=F(qt),U=B("div"),D=B("small"),D.textContent="This week",R=B("a"),R.textContent="View weekly brackets",L=B("span"),L.textContent="Kills",_=B("span"),N=F(Gt),Z=B("span"),Z.textContent="Fame",q=B("span"),G=B("img"),j=z(),J=F(Ht),V=B("span"),V.textContent="Fame Position",Y=B("span"),W=F(Xt),Q=B("span"),Q.textContent="Fame Bracket",K=B("span"),tt=F(jt),et=B("div"),st=B("small"),st.textContent="Last Week",it=B("span"),nt=B("span"),nt.textContent="Kills",at=B("span"),rt=F(Jt),ot=B("span"),ot.textContent="Fame",lt=B("span"),ct=B("img"),ht=z(),ut=F(Vt),mt=B("span"),mt.textContent="Fame Position",pt=B("span"),ft=F(Yt),gt=B("span"),gt.textContent="Fame Bracket",vt=B("span"),yt=F(Wt),bt=B("div"),xt=B("small"),xt.textContent="Lifetime",wt=B("span"),kt=B("span"),kt.textContent="Kills",$t=B("span"),St=F(Qt),Mt=B("span"),Mt.textContent="Fame",Et=B("span"),Ct=B("img"),Bt=z(),Ft=F(Kt),zt=B("span"),zt.textContent="Highest Rank",Ut=B("span"),A(n,"class","textwhite"),A(r,"class","svgicon"),r.src!==(o=Ey)&&A(r,"src",o),A(a,"class","textprestige statnumber"),A(d,"class","textwhite"),u=new H(m),A(h,"class","textprestige statnumber"),A(i,"class","stats marg-top svelte-voya4q"),A(e,"class","panel-black"),A(v,"class","bold textgreen"),A(b,"class","textwhite"),A(x,"class","textprimary statnumber"),A(k,"class","textwhite"),A(S,"class","svgicon"),S.src!==(M=Cy)&&A(S,"src",M),A($,"class","textfame statnumber"),A(g,"class","stats panel-black marg-top svelte-voya4q"),A(D,"class","bold textgreen"),A(R,"class","statnumber"),A(R,"href","/pvp"),A(R,"target","_blank"),A(R,"rel","noopener noreferrer"),A(L,"class","textwhite"),A(_,"class","textprimary statnumber"),A(Z,"class","textwhite"),A(G,"class","svgicon"),G.src!==(X=Cy)&&A(G,"src",X),A(q,"class","textfame statnumber"),A(V,"class","textwhite"),A(Y,"class","textgreen statnumber"),A(Q,"class","textwhite"),A(K,"class","textprimary statnumber"),A(U,"class","stats panel-black marg-top svelte-voya4q"),A(st,"class","bold textgreen"),A(nt,"class","textwhite"),A(at,"class","textprimary statnumber"),A(ot,"class","textwhite"),A(ct,"class","svgicon"),ct.src!==(dt=Cy)&&A(ct,"src",dt),A(lt,"class","textfame statnumber"),A(mt,"class","textwhite"),A(pt,"class","textgreen statnumber"),A(gt,"class","textwhite"),A(vt,"class","textprimary statnumber"),A(et,"class","stats panel-black marg-top svelte-voya4q"),A(xt,"class","bold textgreen"),A(kt,"class","textwhite"),A($t,"class","textprimary statnumber"),A(Mt,"class","textwhite"),A(Ct,"class","svgicon"),Ct.src!==(Pt=Cy)&&A(Ct,"src",Pt),A(Et,"class","textfame statnumber"),A(zt,"class","textwhite"),A(Ut,"class","textprestige statnumber"),A(bt,"class","stats panel-black marg-top svelte-voya4q")},m(t,o){T(t,e,o),Nt(s,e,null),C(e,i),C(i,n),C(i,a),C(a,r),C(a,l),C(a,c),C(i,d),C(i,h),u.m(Rt,h),C(h,m),C(h,p),C(h,f),T(t,g,o),C(g,v),C(g,y),C(g,b),C(g,x),C(x,w),C(g,k),C(g,$),C($,S),C($,E),C($,P),T(t,U,o),C(U,D),C(U,R),C(U,L),C(U,_),C(_,N),C(U,Z),C(U,q),C(q,G),C(q,j),C(q,J),C(U,V),C(U,Y),C(Y,W),C(U,Q),C(U,K),C(K,tt),T(t,et,o),C(et,st),C(et,it),C(et,nt),C(et,at),C(at,rt),C(et,ot),C(et,lt),C(lt,ct),C(lt,ht),C(lt,ut),C(et,mt),C(et,pt),C(pt,ft),C(et,gt),C(et,vt),C(vt,yt),T(t,bt,o),C(bt,xt),C(bt,wt),C(bt,kt),C(bt,$t),C($t,St),C(bt,Mt),C(bt,Et),C(Et,Ct),C(Et,Bt),C(Et,Ft),C(bt,zt),C(bt,Ut),Ut.innerHTML=te,Dt=!0},p(t,e){const i={};4&e&&(i.fract=t[2]),257&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i),(!Dt||8&e)&&At!==(At=Mb(t[3].prestige)+"")&&O(c,At),(!Dt||2&e)&&Rt!==(Rt=Ab(t[1],tn.ui.title.name[Ya.player.faction][t[1]-1])+"")&&u.p(Rt),(!Dt||8&e)&&Lt!==(Lt=Mb(GM(t[3].prestige))+"")&&O(p,Lt),(!Dt||8&e)&&Ot!==(Ot=Mb(t[3].kills_today)+"")&&O(w,Ot),(!Dt||8&e)&&qt!==(qt=Mb(t[3].fame_today)+"")&&O(P,qt),(!Dt||8&e)&&Gt!==(Gt=Mb(t[3].kills_this_week)+"")&&O(N,Gt),(!Dt||8&e)&&Ht!==(Ht=Mb(t[3].fame)+"")&&O(J,Ht),(!Dt||8&e)&&Xt!==(Xt=t[3].fame_position+"")&&O(W,Xt),(!Dt||8&e)&&jt!==(jt=XM(t[3].fame_bracket)+"")&&O(tt,jt),(!Dt||8&e)&&Jt!==(Jt=Mb(t[3].kills_last_week)+"")&&O(rt,Jt),(!Dt||8&e)&&Vt!==(Vt=Mb(t[3].fame_last_week)+"")&&O(ut,Vt),(!Dt||8&e)&&Yt!==(Yt=t[3].fame_position_last_week+"")&&O(ft,Yt),(!Dt||8&e)&&Wt!==(Wt=XM(t[3].fame_bracket_last_week)+"")&&O(yt,Wt),(!Dt||8&e)&&Qt!==(Qt=Mb(t[3].kills_lifetime)+"")&&O(St,Qt),(!Dt||8&e)&&Kt!==(Kt=Mb(t[3].fame_lifetime)+"")&&O(Ft,Kt),(!Dt||8&e)&&te!==(te=(t[3].rank_lifetime>0?Ab(t[3].rank_lifetime,tn.ui.title.name[Ya.player.faction][t[3].rank_lifetime-1]):"Unranked")+"")&&(Ut.innerHTML=te)},i(t){Dt||(Tt(s.$$.fragment,t),Dt=!0)},o(t){It(s.$$.fragment,t),Dt=!1},d(t){t&&I(e),Zt(s),t&&I(g),t&&I(U),t&&I(et),t&&I(bt)}}}function YC(t){let e,s,i=t[4]&&jC(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[4]?i?(i.p(t,s),16&s&&Tt(i,1)):(i=jC(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function WC(t,e,s){let i;p(t,xs,t=>s(4,i=t));let n=0,a=1,r=0,o={};const l=async()=>{s(3,o=await BE("/api/pvp/getplayerpvpinfo",{name:Ya.player.name})),s(0,n=ZM(o.prestige)),s(1,a=Math.min(n+1,12));const t=qM(a)-qM(n),e=o.prestige-qM(n);s(2,r=~~(e/t*100))};let c=0;const d=()=>{x(xs,i=!1)};return t.$$.update=()=>{80&t.$$.dirty&&(i&&Date.now()-c>3e4||0===c)&&(l(),s(6,c=Date.now()))},[n,a,r,o,i,d]}class QC extends Ht{constructor(t){super(),Gt(this,t,WC,YC,d,{})}}function KC(t){let e,s,i,n,a,r,o,l,c,d,h,u,m=t[0].name+"",p=void 0!==t[0].level?`Lv. ${t[0].level} `:"",f=(void 0!==t[0].class?tn.classes[t[0].class].name:"Item")+"",g=(void 0!==t[0].faction?tn.factions[t[0].faction].name:"")+"";return{c(){e=B("div"),s=B("div"),i=F(m),n=B("div"),a=B("span"),r=F(p),o=B("span"),l=F(f),d=B("span"),h=F(g),A(s,"class","textwhite title svelte-1wip79f"),A(o,"class",c=b(void 0!==t[0].class?"textc"+t[0].class:"textyellow")+" svelte-1wip79f"),A(d,"class",u=b(void 0!==t[0].faction?"textf"+t[0].faction:"")+" svelte-1wip79f"),A(e,"class","panel-black container svelte-1wip79f"),N(e,"display",t[1]?"block":"none")},m(t,c){T(t,e,c),C(e,s),C(s,i),C(e,n),C(n,a),C(a,r),C(n,o),C(o,l),C(e,d),C(d,h)},p(t,s){1&s&&m!==(m=t[0].name+"")&&O(i,m),1&s&&p!==(p=void 0!==t[0].level?`Lv. ${t[0].level} `:"")&&O(r,p),1&s&&f!==(f=(void 0!==t[0].class?tn.classes[t[0].class].name:"Item")+"")&&O(l,f),1&s&&c!==(c=b(void 0!==t[0].class?"textc"+t[0].class:"textyellow")+" svelte-1wip79f")&&A(o,"class",c),1&s&&g!==(g=(void 0!==t[0].faction?tn.factions[t[0].faction].name:"")+"")&&O(h,g),1&s&&u!==(u=b(void 0!==t[0].faction?"textf"+t[0].faction:"")+" svelte-1wip79f")&&A(d,"class",u),2&s&&N(e,"display",t[1]?"block":"none")},d(t){t&&I(e)}}}function tT(t){let e,s=t[0]&&KC(t);return{c(){s&&s.c(),e=U()},m(t,i){s&&s.m(t,i),T(t,e,i)},p(t,[i]){t[0]?s?s.p(t,i):(s=KC(t),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i:i,o:i,d(t){s&&s.d(t),t&&I(e)}}}function eT(t,e,s){let i,n;return p(t,Se,t=>s(1,i=t)),t.$$.update=()=>{2&t.$$.dirty&&i>0&&Ya.isEntityIdTaken(i)&&s(0,n=Ya.entity(i))},[n,i]}class sT extends Ht{constructor(t){super(),Gt(this,t,eT,tT,d,{})}}const iT=Ge,nT=async t=>{const e=await BE("/api/account/info");iT.set(e),fe.set(e.storepoints),t&&t(e)};function aT(t){let e,s,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,P,U,D,R,L,O,_,N,Z,q,G,H,X,j;return{c(){e=B("div"),s=B("div"),s.innerHTML='<img class="artwork svelte-cbx1m" src="/assets/ui/elixir.svg?v=4597824"><div class="sparkle svelte-cbx1m" style="font-size:35px; left:30%; top:30%; animation-delay: -1s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:50px; left:40%; top:60%; animation-delay: -2s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:80px; left:60%; top:20%; animation-delay: -3s;">+</div>',n=B("div"),a=B("h1"),a.innerHTML='Hordes <span class="textsub">Elixir</span>',r=B("div"),r.innerHTML='<img class="svgicon" src="/assets/ui/icons/gem.svg?v=4597824"> Chat supporter icon',o=B("div"),o.innerHTML='<img class="svgicon" src="/assets/ui/icons/check.svg?v=4597824"> No ads',l=B("div"),c=B("img"),h=z(),u=B("span"),u.textContent=""+AS[0].inventory,m=z(),p=B("span"),p.textContent=""+AS[1].inventory,f=F(" base bag slots"),g=B("div"),v=B("img"),b=z(),x=B("span"),x.textContent=""+AS[0].stash,w=z(),k=B("span"),k.textContent=""+AS[1].stash,$=F(" stash storage"),S=B("div"),M=B("img"),P=z(),U=B("span"),U.textContent=""+AS[0].auction,D=z(),R=B("span"),R.textContent=""+AS[1].auction,L=F(" merchant limit"),O=B("div"),_=B("img"),Z=z(),q=B("span"),q.textContent=AS[0].auctionHours+"h",G=z(),H=B("span"),H.textContent=AS[1].auctionHours+"h",X=F(" merchant duration"),j=B("div"),j.textContent="+ more to come (TBA)",A(s,"class","artcontainer svelte-cbx1m"),A(a,"class","textprimary"),A(r,"class","textwhite"),A(o,"class","textwhite"),A(c,"class","svgicon"),c.src!==(d="/assets/ui/icons/check.svg?v=4597824")&&A(c,"src",d),A(u,"class","old svelte-cbx1m"),A(p,"class","textsub"),A(l,"class","textwhite"),A(v,"class","svgicon"),v.src!==(y="/assets/ui/icons/check.svg?v=4597824")&&A(v,"src",y),A(x,"class","old svelte-cbx1m"),A(k,"class","textsub"),A(g,"class","textwhite"),A(M,"class","svgicon"),M.src!==(E="/assets/ui/icons/check.svg?v=4597824")&&A(M,"src",E),A(U,"class","old svelte-cbx1m"),A(R,"class","textsub"),A(S,"class","textwhite"),A(_,"class","svgicon"),_.src!==(N="/assets/ui/icons/check.svg?v=4597824")&&A(_,"src",N),A(q,"class","old svelte-cbx1m"),A(H,"class","textsub"),A(O,"class","textwhite"),A(j,"class","textgrey"),A(e,"class","split svelte-cbx1m")},m(t,i){T(t,e,i),C(e,s),C(e,n),C(n,a),C(n,r),C(n,o),C(n,l),C(l,c),C(l,h),C(l,u),C(l,m),C(l,p),C(l,f),C(n,g),C(g,v),C(g,b),C(g,x),C(g,w),C(g,k),C(g,$),C(n,S),C(S,M),C(S,P),C(S,U),C(S,D),C(S,R),C(S,L),C(n,O),C(O,_),C(O,Z),C(O,q),C(O,G),C(O,H),C(O,X),C(n,j)},p:i,i:i,o:i,d(t){t&&I(e)}}}class rT extends Ht{constructor(t){super(),Gt(this,t,null,aT,d,{})}}const oT={SECONDS_A_MINUTE:60,SECONDS_A_HOUR:3600,SECONDS_A_DAY:86400,SECONDS_A_WEEK:604800,MILLISECONDS_A_SECOND:1e3,MILLISECONDS_A_MINUTE:6e4,MILLISECONDS_A_HOUR:36e5,MILLISECONDS_A_DAY:864e5,MILLISECONDS_A_WEEK:6048e5,MS:"millisecond",S:"second",MIN:"minute",H:"hour",D:"day",W:"week",M:"month",Q:"quarter",Y:"year",DATE:"date",FORMAT_DEFAULT:"YYYY-MM-DDTHH:mm:ssZ",INVALID_DATE_STRING:"Invalid Date",REGEX_PARSE:/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,REGEX_FORMAT:/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g},lT=(t,e,s)=>{const i=String(t);return!i||i.length>=e?t:`${Array(e+1-i.length).join(s)}${t}`},cT=t=>{const e=-t.utcOffset(),s=Math.abs(e),i=Math.floor(s/60),n=s%60;return`${e<=0?"+":"-"}${lT(i,2,"0")}:${lT(n,2,"0")}`},dT={s:lT,z:cT,m:(t,e)=>{const s=12*(e.year()-t.year())+(e.month()-t.month()),i=t.clone().add(s,oT.M),n=e-i<0,a=t.clone().add(s+(n?-1:1),oT.M);return Number(-(s+(e-i)/(n?i-a:a-i))||0)},a:t=>t<0?Math.ceil(t)||0:Math.floor(t),p:t=>({M:oT.M,y:oT.Y,w:oT.W,d:oT.D,h:oT.H,m:oT.MIN,s:oT.S,ms:oT.MS,Q:oT.Q}[t]||String(t||"").toLowerCase().replace(/s$/,"")),u:t=>void 0===t},hT={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")};let uT="en";const mT={};mT[uT]=hT;const pT=t=>t instanceof xT,fT=(t,e,s)=>{let i;if(!t)return uT;if("string"==typeof t)mT[t]&&(i=t),e&&(mT[t]=e,i=t);else{const{name:e}=t;mT[e]=t,i=e}return s||(uT=i),i},gT=(t,e,s)=>{if(pT(t))return t.clone();const i=e?"string"==typeof e?{format:e,pl:s}:e:{};return i.date=t,new xT(i)},vT=(t,e)=>gT(t,{locale:e.$L,utc:e.$u,$offset:e.$offset}),yT=dT;yT.l=fT,yT.i=pT,yT.w=vT;const bT=t=>{const{date:e,utc:s}=t;if(null===e)return new Date(NaN);if(yT.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){const t=e.match(oT.REGEX_PARSE);if(t)return s?new Date(Date.UTC(t[1],t[2]-1,t[3]||1,t[4]||0,t[5]||0,t[6]||0,t[7]||0)):new Date(t[1],t[2]-1,t[3]||1,t[4]||0,t[5]||0,t[6]||0,t[7]||0)}return new Date(e)};class xT{constructor(t){this.$L=this.$L||fT(t.locale,null,!0),this.parse(t)}parse(t){this.$d=bT(t),this.init()}init(){const{$d:t}=this;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()}$utils(){return yT}isValid(){return!(this.$d.toString()===oT.INVALID_DATE_STRING)}isSame(t,e){const s=gT(t);return this.startOf(e)<=s&&s<=this.endOf(e)}isAfter(t,e){return gT(t)<this.startOf(e)}isBefore(t,e){return this.endOf(e)<gT(t)}$g(t,e,s){return yT.u(t)?this[e]:this.set(s,t)}year(t){return this.$g(t,"$y",oT.Y)}month(t){return this.$g(t,"$M",oT.M)}day(t){return this.$g(t,"$W",oT.D)}date(t){return this.$g(t,"$D",oT.DATE)}hour(t){return this.$g(t,"$H",oT.H)}minute(t){return this.$g(t,"$m",oT.MIN)}second(t){return this.$g(t,"$s",oT.S)}millisecond(t){return this.$g(t,"$ms",oT.MS)}unix(){return Math.floor(this.valueOf()/1e3)}valueOf(){return this.$d.getTime()}startOf(t,e){const s=!!yT.u(e)||e,i=yT.p(t),n=(t,e)=>{const i=yT.w(this.$u?Date.UTC(this.$y,e,t):new Date(this.$y,e,t),this);return s?i:i.endOf(oT.D)},a=(t,e)=>{const i=[0,0,0,0],n=[23,59,59,999];return yT.w(this.toDate()[t].apply(this.toDate(),(s?i:n).slice(e)),this)},{$W:r,$M:o,$D:l}=this,c="set"+(this.$u?"UTC":"");switch(i){case oT.Y:return s?n(1,0):n(31,11);case oT.M:return s?n(1,o):n(0,o+1);case oT.W:{const t=this.$locale().weekStart||0,e=(r<t?r+7:r)-t;return n(s?l-e:l+(6-e),o)}case oT.D:case oT.DATE:return a(c+"Hours",0);case oT.H:return a(c+"Minutes",1);case oT.MIN:return a(c+"Seconds",2);case oT.S:return a(c+"Milliseconds",3);default:return this.clone()}}endOf(t){return this.startOf(t,!1)}$set(t,e){const s=yT.p(t),i="set"+(this.$u?"UTC":""),n={[oT.D]:i+"Date",[oT.DATE]:i+"Date",[oT.M]:i+"Month",[oT.Y]:i+"FullYear",[oT.H]:i+"Hours",[oT.MIN]:i+"Minutes",[oT.S]:i+"Seconds",[oT.MS]:i+"Milliseconds"}[s],a=s===oT.D?this.$D+(e-this.$W):e;if(s===oT.M||s===oT.Y){const t=this.clone().set(oT.DATE,1);t.$d[n](a),t.init(),this.$d=t.set(oT.DATE,Math.min(this.$D,t.daysInMonth())).toDate()}else n&&this.$d[n](a);return this.init(),this}set(t,e){return this.clone().$set(t,e)}get(t){return this[yT.p(t)]()}add(t,e){t=Number(t);const s=yT.p(e),i=e=>{const s=gT(this);return yT.w(s.date(s.date()+Math.round(e*t)),this)};if(s===oT.M)return this.set(oT.M,this.$M+t);if(s===oT.Y)return this.set(oT.Y,this.$y+t);if(s===oT.D)return i(1);if(s===oT.W)return i(7);const n={[oT.MIN]:oT.MILLISECONDS_A_MINUTE,[oT.H]:oT.MILLISECONDS_A_HOUR,[oT.S]:oT.MILLISECONDS_A_SECOND}[s]||1,a=this.$d.getTime()+t*n;return yT.w(a,this)}subtract(t,e){return this.add(-1*t,e)}format(t){if(!this.isValid())return oT.INVALID_DATE_STRING;const e=t||oT.FORMAT_DEFAULT,s=yT.z(this),i=this.$locale(),{$H:n,$m:a,$M:r}=this,{weekdays:o,months:l,meridiem:c}=i,d=(t,s,i,n)=>t&&(t[s]||t(this,e))||i[s].substr(0,n),h=t=>yT.s(n%12||12,t,"0"),u=c||((t,e,s)=>{const i=t<12?"AM":"PM";return s?i.toLowerCase():i}),m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:r+1,MM:yT.s(r+1,2,"0"),MMM:d(i.monthsShort,r,l,3),MMMM:l[r]||l(this,e),D:this.$D,DD:yT.s(this.$D,2,"0"),d:String(this.$W),dd:d(i.weekdaysMin,this.$W,o,2),ddd:d(i.weekdaysShort,this.$W,o,3),dddd:o[this.$W],H:String(n),HH:yT.s(n,2,"0"),h:h(1),hh:h(2),a:u(n,a,!0),A:u(n,a,!1),m:String(a),mm:yT.s(a,2,"0"),s:String(this.$s),ss:yT.s(this.$s,2,"0"),SSS:yT.s(this.$ms,3,"0"),Z:s};return e.replace(oT.REGEX_FORMAT,(t,e)=>e||m[t]||s.replace(":",""))}utcOffset(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)}diff(t,e,s){const i=yT.p(e),n=gT(t),a=(n.utcOffset()-this.utcOffset())*oT.MILLISECONDS_A_MINUTE,r=this-n;let o=yT.m(this,n);return o={[oT.Y]:o/12,[oT.M]:o,[oT.Q]:o/3,[oT.W]:(r-a)/oT.MILLISECONDS_A_WEEK,[oT.D]:(r-a)/oT.MILLISECONDS_A_DAY,[oT.H]:r/oT.MILLISECONDS_A_HOUR,[oT.MIN]:r/oT.MILLISECONDS_A_MINUTE,[oT.S]:r/oT.MILLISECONDS_A_SECOND}[i]||r,s?o:yT.a(o)}daysInMonth(){return this.endOf(oT.M).$D}$locale(){return mT[this.$L]}locale(t,e){if(!t)return this.$L;const s=this.clone();return s.$L=fT(t,e,!0),s}clone(){return yT.w(this.$d,this)}toDate(){return new Date(this.valueOf())}toJSON(){return this.isValid()?this.toISOString():null}toISOString(){return this.$d.toISOString()}toString(){return this.$d.toUTCString()}}function wT(t,e,s){const i=t.slice();return i[13]=e[s],i[15]=s,i}function kT(t){let e;return{c(){e=F("Not active")},m(t,s){T(t,e,s)},p:i,d(t){t&&I(e)}}}function $T(t){let e,s,i,n,a=gT(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"";return{c(){e=B("img"),i=z(),n=F(a),A(e,"class","svgicon"),e.src!==(s="/assets/ui/icons/check.svg?v=4597824")&&A(e,"src",s)},m(t,s){T(t,e,s),T(t,i,s),T(t,n,s)},p(t,e){2&e&&a!==(a=gT(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"")&&O(n,a)},d(t){t&&I(e),t&&I(i),t&&I(n)}}}function ST(t){let e,s,i,n,a,r,o,l,c=t[13].name+"";function d(...e){return t[9](t[15],...e)}return n=new Ww({props:{amount:t[13].price}}),{c(){e=B("btn"),s=F(c),i=z(),_t(n.$$.fragment),A(e,"class",a="btn black navbtn "+(t[5]==t[15]?"active":"")+" big")},m(t,a){T(t,e,a),C(e,s),C(e,i),Nt(n,e,null),r=!0,o||(l=D(e,"click",d),o=!0)},p(s,i){t=s,(!r||32&i&&a!==(a="btn black navbtn "+(t[5]==t[15]?"active":"")+" big"))&&A(e,"class",a)},i(t){r||(Tt(n.$$.fragment,t),r=!0)},o(t){It(n.$$.fragment,t),r=!1},d(t){t&&I(e),Zt(n),o=!1,l()}}}function MT(t){let e;return{c(){e=B("div"),e.innerHTML='<p class="fadeIn textsub">Elixir time added. Thank you for your support. Please re-log any active characters.</p>',A(e,"class","fadeIn card marg-top")},m(t,s){T(t,e,s)},p:i,i:i,o:i,d(t){t&&I(e)}}}function ET(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S=t[6]?"Gift":"Add",M=t[8].description+"",E=t[6]?"someone":"your account",P=t[6]?"Send Elixir Gift":t[1].subscribed_until?"Extend Elixir":"Activate Elixir";u=new Ww({props:{amount:t[8].price}});const R=[TT,CT],L=[];function _(t,e){return t[6]?1:0}p=_(t),f=L[p]=R[p](t);let Z="addsubscription"==t[0]&&t[2]&&IT(t),q=t[1].storepoints<t[8].price&&PT();return{c(){e=B("div"),s=B("div"),i=F(S),n=z(),a=B("span"),r=F(M),o=F(" of "),l=B("span"),l.textContent="Elixir",c=F(" to "),d=F(E),h=F(" for "),_t(u.$$.fragment),m=F("."),f.c(),g=U(),Z&&Z.c(),v=B("div"),y=B("div"),b=F(P),q&&q.c(),A(a,"class","bold textwhite"),A(l,"class","textsub"),A(s,"class","textgrey"),A(y,"class",x="btn grey formatted "+("addsubscription"==t[3]||t[1].storepoints<t[8].price?"disabled":"")),A(v,"class","subnav"),A(e,"class","fadeIn card marg-top"),N(e,"padding","18px")},m(f,x){T(f,e,x),C(e,s),C(s,i),C(s,n),C(s,a),C(a,r),C(s,o),C(s,l),C(s,c),C(s,d),C(s,h),Nt(u,s,null),C(s,m),L[p].m(e,null),C(e,g),Z&&Z.m(e,null),C(e,v),C(v,y),C(y,b),q&&q.m(e,null),w=!0,k||($=D(y,"click",t[12]),k=!0)},p(t,s){(!w||64&s)&&S!==(S=t[6]?"Gift":"Add")&&O(i,S),(!w||256&s)&&M!==(M=t[8].description+"")&&O(r,M),(!w||64&s)&&E!==(E=t[6]?"someone":"your account")&&O(d,E);const n={};256&s&&(n.amount=t[8].price),u.$set(n);let a=p;p=_(t),p===a?L[p].p(t,s):(Et(),It(L[a],1,1,()=>{L[a]=null}),Ct(),f=L[p],f||(f=L[p]=R[p](t),f.c()),Tt(f,1),f.m(e,g)),"addsubscription"==t[0]&&t[2]?Z?Z.p(t,s):(Z=IT(t),Z.c(),Z.m(e,v)):Z&&(Z.d(1),Z=null),(!w||66&s)&&P!==(P=t[6]?"Send Elixir Gift":t[1].subscribed_until?"Extend Elixir":"Activate Elixir")&&O(b,P),(!w||266&s&&x!==(x="btn grey formatted "+("addsubscription"==t[3]||t[1].storepoints<t[8].price?"disabled":"")))&&A(y,"class",x),t[1].storepoints<t[8].price?q||(q=PT(),q.c(),q.m(e,null)):q&&(q.d(1),q=null)},i(t){w||(Tt(u.$$.fragment,t),Tt(f),w=!0)},o(t){It(u.$$.fragment,t),It(f),w=!1},d(t){t&&I(e),Zt(u),L[p].d(),Z&&Z.d(),q&&q.d(),k=!1,$()}}}function CT(t){let e,s,i,n;function a(e){t[11].call(null,e)}let r={};return void 0!==t[7]&&(r.name=t[7]),s=new WE({props:r}),lt.push(()=>Ot(s,"name",a)),{c(){e=B("div"),_t(s.$$.fragment),A(e,"class","subnav")},m(t,i){T(t,e,i),Nt(s,e,null),n=!0},p(t,e){const n={};!i&&128&e&&(i=!0,n.name=t[7],gt(()=>i=!1)),s.$set(n)},i(t){n||(Tt(s.$$.fragment,t),n=!0)},o(t){It(s.$$.fragment,t),n=!1},d(t){t&&I(e),Zt(s)}}}function TT(t){let e,s,n,a,r,o=gT(t[1].subscribed_until||void 0).add(t[8].days,"day").format("MMM DD, YYYY HH:mm")+"";return{c(){e=B("p"),s=F("Enables Elixir until "),n=B("span"),a=F(o),r=F("."),A(n,"class","textwhite"),A(e,"class","bold textsub")},m(t,i){T(t,e,i),C(e,s),C(e,n),C(n,a),C(e,r)},p(t,e){258&e&&o!==(o=gT(t[1].subscribed_until||void 0).add(t[8].days,"day").format("MMM DD, YYYY HH:mm")+"")&&O(a,o)},i:i,o:i,d(t){t&&I(e)}}}function IT(t){let e,s;return{c(){e=B("p"),s=F(t[2]),A(e,"class","fadeIn textred")},m(t,i){T(t,e,i),C(e,s)},p(t,e){4&e&&O(s,t[2])},d(t){t&&I(e)}}}function PT(t){let e;return{c(){e=B("p"),e.innerHTML='<small>You do not have enough Hordes Points to do this. <a class="textprimary" href="/store">Buy Hordes Points</a></small>'},m(t,s){T(t,e,s)},d(t){t&&I(e)}}}function BT(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b,x;function w(t,e){return t[1].subscribed_until?$T:kT}s=new rT({});let k=w(t),$=k(t);l=new Ww({props:{amount:t[1].storepoints}});let S=DS,M=[];for(let e=0;e<S.length;e+=1)M[e]=ST(wT(t,S,e));const E=t=>It(M[t],1,1,()=>{M[t]=null}),U=[ET,MT],R=[];function L(t,e){return void 0!==t[5]?0:"addsubscription"==t[0]?1:-1}return~(g=L(t))&&(v=R[g]=U[g](t)),{c(){e=B("div"),_t(s.$$.fragment),i=B("small"),i.textContent="Elixir",n=B("div"),$.c(),r=B("small"),r.textContent="Hordes Points",o=B("div"),_t(l.$$.fragment),c=z(),d=B("a"),d.textContent="(Buy Hordes Points)",h=B("p"),h.textContent="Support Hordes development for a low cost. Unlock additional bag slots, store more items in your stash, make use of enhanced merchant features and many more perks (TBA).",u=B("div");for(let t=0;t<M.length;t+=1)M[t].c();m=B("btn"),p=F("Send Gift"),v&&v.c(),A(i,"class","textgrey"),A(n,"class",a="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")),A(r,"class","textgrey"),A(d,"class","textwhite"),A(d,"href","/store"),A(o,"class","cardinfo"),A(h,"class","textgrey"),A(m,"class",f="btn navbtn "+(t[6]?"active white":"")+" big"),A(u,"class","subnav"),A(e,"class","card")},m(a,f){T(a,e,f),Nt(s,e,null),C(e,i),C(e,n),$.m(n,null),C(e,r),C(e,o),Nt(l,o,null),C(o,c),C(o,d),C(e,h),C(e,u);for(let t=0;t<M.length;t+=1)M[t].m(u,null);C(u,m),C(m,p),~g&&R[g].m(e,null),y=!0,b||(x=D(m,"click",t[10]),b=!0)},p(t,[s]){k===(k=w(t))&&$?$.p(t,s):($.d(1),$=k(t),$&&($.c(),$.m(n,null))),(!y||2&s&&a!==(a="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")))&&A(n,"class",a);const i={};if(2&s&&(i.amount=t[1].storepoints),l.$set(i),32&s){let e;for(S=DS,e=0;e<S.length;e+=1){const i=wT(t,S,e);M[e]?(M[e].p(i,s),Tt(M[e],1)):(M[e]=ST(i),M[e].c(),Tt(M[e],1),M[e].m(u,m))}for(Et(),e=S.length;e<M.length;e+=1)E(e);Ct()}(!y||64&s&&f!==(f="btn navbtn "+(t[6]?"active white":"")+" big"))&&A(m,"class",f);let r=g;g=L(t),g===r?~g&&R[g].p(t,s):(v&&(Et(),It(R[r],1,1,()=>{R[r]=null}),Ct()),~g?(v=R[g],v||(v=R[g]=U[g](t),v.c()),Tt(v,1),v.m(e,null)):v=null)},i(t){if(!y){Tt(s.$$.fragment,t),Tt(l.$$.fragment,t);for(let t=0;t<S.length;t+=1)Tt(M[t]);Tt(v),y=!0}},o(t){It(s.$$.fragment,t),It(l.$$.fragment,t),M=M.filter(Boolean);for(let t=0;t<M.length;t+=1)It(M[t]);It(v),y=!1},d(t){t&&I(e),Zt(s),$.d(),Zt(l),P(M,t),~g&&R[g].d(),b=!1,x()}}}function FT(t,e,s){let i,n,a=!1,{user:r}=e,{flash:o}=e,{flashmsg:l}=e,{action:c}=e,{apiCall:d}=e;const h=(t,e)=>s(5,i=t),u=t=>s(6,a=!a);function m(t){n=t,s(7,n)}const p=t=>d("addsubscription","/api/account/addsubscription",{value:i,gift:a?n:void 0},!0,t=>{"ok"==t.result&&(s(5,i=void 0),s(0,o="addsubscription"))});let f;return t.$$set=t=>{"user"in t&&s(1,r=t.user),"flash"in t&&s(0,o=t.flash),"flashmsg"in t&&s(2,l=t.flashmsg),"action"in t&&s(3,c=t.action),"apiCall"in t&&s(4,d=t.apiCall)},t.$$.update=()=>{32&t.$$.dirty&&s(8,f=DS[i])},[o,r,l,c,d,i,a,n,f,h,u,m,p]}gT.prototype=xT.prototype,gT.extend=(t,e)=>(t(e,xT,gT),gT),gT.locale=fT,gT.isDayjs=pT,gT.unix=t=>gT(1e3*t),gT.en=mT[uT],gT.Ls=mT;class zT extends Ht{constructor(t){super(),Gt(this,t,FT,BT,d,{user:1,flash:0,flashmsg:2,action:3,apiCall:4})}}function UT(t){let e,s,i,n;return i=new wb({props:{title:"Store / Elixir",icon:"gem",$$slots:{default:[AT]},$$scope:{ctx:t}}}),i.$on("close",t[6]),{c(){e=B("div"),s=B("div"),_t(i.$$.fragment),A(s,"class","uiscaled"),A(e,"class","absCentered container svelte-1un8upk")},m(t,a){T(t,e,a),C(e,s),Nt(i,s,null),n=!0},p(t,e){const s={};302&e&&(s.$$scope={dirty:e,ctx:t}),i.$set(s)},i(t){n||(Tt(i.$$.fragment,t),n=!0)},o(t){It(i.$$.fragment,t),n=!1},d(t){t&&I(e),Zt(i)}}}function DT(t){let e,s;return e=new zT({props:{user:t[5],flash:t[1],flashmsg:t[2],action:t[3],apiCall:t[0]}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},p(t,s){const i={};32&s&&(i.user=t[5]),2&s&&(i.flash=t[1]),4&s&&(i.flashmsg=t[2]),8&s&&(i.action=t[3]),e.$set(i)},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function AT(t){let e,s,i=t[5]&&DT(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,s){t[5]?i?(i.p(t,s),32&s&&Tt(i,1)):(i=DT(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function RT(t){let e,s,i=t[4]&&UT(t);return{c(){i&&i.c(),e=U()},m(t,n){i&&i.m(t,n),T(t,e,n),s=!0},p(t,[s]){t[4]?i?(i.p(t,s),16&s&&Tt(i,1)):(i=UT(t),i.c(),Tt(i,1),i.m(e.parentNode,e)):i&&(Et(),It(i,1,1,()=>{i=null}),Ct())},i(t){s||(Tt(i),s=!0)},o(t){It(i),s=!1},d(t){i&&i.d(t),t&&I(e)}}}function LT(t,e,s){let i,n;p(t,ys,t=>s(4,i=t)),p(t,iT,t=>s(5,n=t));let a=void 0,r=void 0,o=void 0;const l=async(t,e,i,n,l)=>{s(3,o=t);const c=await BE(e,i);s(3,o=void 0),"ok"===c.result?s(1,a=void 0):(s(1,a=t),s(2,r=c.result)),n&&nT(),l&&l(c)},c=t=>x(ys,i=!1);return t.$$.update=()=>{16&t.$$.dirty&&i&&nT()},[l,a,r,o,i,n,c]}class OT extends Ht{constructor(t){super(),Gt(this,t,LT,RT,d,{apiCall:0})}get apiCall(){return this.$$.ctx[0]}}function _T(t){let e,s,n,a,r,o,l,c,d;return{c(){e=B("div"),s=B("h3"),n=F("Using AdBlock? Buy "),a=B("span"),a.innerHTML='<span class="textwhite">Hordes</span>  <img class="svgicon texticon" src="/assets/ui/icons/gem.svg?v=4597824">  Elixir',r=F(" to hide this window and support development."),o=B("ins"),l=B("script"),l.textContent="(adsbygoogle = window.adsbygoogle || []).push({});",A(a,"class","btn textsub"),A(s,"class","textgrey blocktext svelte-svpjti"),A(o,"class","adsbygoogle"),N(o,"display","inline-block"),N(o,"width","728px"),N(o,"height","90px"),A(o,"data-ad-client","ca-pub-6128207871826113"),A(o,"data-ad-slot","2385450998"),A(e,"class","container panel-black svelte-svpjti")},m(i,h){T(i,e,h),C(e,s),C(s,n),C(s,a),C(s,r),C(e,o),C(e,l),c||(d=D(a,"click",t[1]),c=!0)},p:i,i:i,o:i,d(t){t&&I(e),c=!1,d()}}}function NT(t,e,s){let i;p(t,ys,t=>s(0,i=t));const n=t=>x(ys,i=!0);return[i,n]}class ZT extends Ht{constructor(t){super(),Gt(this,t,NT,_T,d,{})}}function qT(t,e,s){const i=t.slice();return i[4]=e[s],i}function GT(t){let e,s,i,n,a,r=$b(t[4].viewers)+"",o=$b(t[4].followers)+"";return{c(){e=B("div"),s=B("span"),i=F(r),n=z(),a=F(o),A(s,"class","textgreen"),A(e,"class","bold viewcount textbox svelte-13wcf6i")},m(t,r){T(t,e,r),C(e,s),C(s,i),C(e,n),C(e,a)},p(t,e){2&e&&r!==(r=$b(t[4].viewers)+"")&&O(i,r),2&e&&o!==(o=$b(t[4].followers)+"")&&O(a,o)},d(t){t&&I(e)}}}function HT(t){let e,s,i,n,a,r,o,l=t[4].name+"",c=(t[4].viewers||t[4].followers)&&GT(t);return{c(){e=B("a"),s=B("div"),c&&c.c(),i=B("div"),n=F(l),A(i,"class","name textbox svelte-13wcf6i"),A(s,"class","border black preview svelte-13wcf6i"),A(s,"style",a="background-image:url("+(t[4].preview||"")+"); "+(t[0]?"margin-top:2px;":"")),A(e,"class","fadeIn stream svelte-13wcf6i"),A(e,"target","_blank"),A(e,"rel","noopener noreferrer"),A(e,"href",r=t[4].url),A(e,"style",o=t[0]?"":"width:calc(100%/6);")},m(t,a){T(t,e,a),C(e,s),c&&c.m(s,null),C(s,i),C(i,n)},p(t,d){t[4].viewers||t[4].followers?c?c.p(t,d):(c=GT(t),c.c(),c.m(s,i)):c&&(c.d(1),c=null),2&d&&l!==(l=t[4].name+"")&&O(n,l),3&d&&a!==(a="background-image:url("+(t[4].preview||"")+"); "+(t[0]?"margin-top:2px;":""))&&A(s,"style",a),2&d&&r!==(r=t[4].url)&&A(e,"href",r),1&d&&o!==(o=t[0]?"":"width:calc(100%/6);")&&A(e,"style",o)},d(t){t&&I(e),c&&c.d()}}}function XT(t){let e,s,n=t[1],a=[];for(let e=0;e<n.length;e+=1)a[e]=HT(qT(t,n,e));return{c(){e=B("div");for(let t=0;t<a.length;t+=1)a[t].c();A(e,"style",s="pointer-events: all; "+(t[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))},m(t,s){T(t,e,s);for(let t=0;t<a.length;t+=1)a[t].m(e,null)},p(t,[i]){if(3&i){let s;for(n=t[1],s=0;s<n.length;s+=1){const r=qT(t,n,s);a[s]?a[s].p(r,i):(a[s]=HT(r),a[s].c(),a[s].m(e,null))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}1&i&&s!==(s="pointer-events: all; "+(t[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))&&A(e,"style",s)},i:i,o:i,d(t){t&&I(e),P(a,t)}}}function jT(t,e,s){let i,{vertical:n=!1}=e,a=[];n&&a.push({name:"Loading streams..."});const r=async()=>{i=setTimeout(r,2e4),s(1,a=await BE("/api/twitch/streams",{max:6})),n&&0===a.length&&a.push({name:"No streams, refreshing..."})};return st(r),nt(t=>{i&&clearTimeout(i)}),t.$$set=t=>{"vertical"in t&&s(0,n=t.vertical)},[n,a]}class JT extends Ht{constructor(t){super(),Gt(this,t,jT,XT,d,{vertical:0})}}function VT(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g=t[1][3]+"",v=t[1][1]+"",y=t[1][0]+"",b=t[1][2]+"",x=t[1][4]+"";return{c(){e=B("small"),s=B("div"),i=F(g),n=B("div"),a=F(v),r=F(" fps"),o=B("div"),l=F(y),c=F(" ms"),d=B("div"),h=F(b),u=F(" KBs"),m=B("div"),p=F(x),f=F(" BFR"),A(s,"class","textyellow"),A(n,"class","textgreen"),A(o,"class","textcyan"),A(d,"class","textorange"),A(m,"class","textpurp"),A(e,"class","marg-top bar btn black grey svelte-1apx3f3")},m(t,g){T(t,e,g),C(e,s),C(s,i),C(e,n),C(n,a),C(n,r),C(e,o),C(o,l),C(o,c),C(e,d),C(d,h),C(d,u),C(e,m),C(m,p),C(m,f)},p(t,e){2&e&&g!==(g=t[1][3]+"")&&O(i,g),2&e&&v!==(v=t[1][1]+"")&&O(a,v),2&e&&y!==(y=t[1][0]+"")&&O(l,y),2&e&&b!==(b=t[1][2]+"")&&O(h,b),2&e&&x!==(x=t[1][4]+"")&&O(p,x)},d(t){t&&I(e)}}}function YT(t){let e,s=t[0]&&VT(t);return{c(){s&&s.c(),e=U()},m(t,i){s&&s.m(t,i),T(t,e,i)},p(t,[i]){t[0]?s?s.p(t,i):(s=VT(t),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i:i,o:i,d(t){s&&s.d(t),t&&I(e)}}}function WT(t,e,s){let i,n;return p(t,Hs,t=>s(0,i=t)),p(t,Me,t=>s(1,n=t)),[i,n]}class QT extends Ht{constructor(t){super(),Gt(this,t,WT,YT,d,{})}}let KT=void 0;const tI={},eI=t=>(void 0===KT&&(KT=getComputedStyle(document.body)),void 0!==tI[t]?tI[t]:tI[t]=KT.getPropertyValue("--"+t));let sI=!1,iI=!1;const nI=document.createElement("canvas"),aI=["war0","war1"].map(t=>{const e=document.createElement("img");return e.src=`/assets/ui/icons/${t}.png?v=4597824`,e}),rI=nI.getContext("2d"),oI=document.createElement("img");oI.onload=function(){iI=!0};const lI={player:"#fff",monster:"#D53434",pvp:eI("pvp"),friendly:eI("health"),party:eI("party")},cI=()=>{fl.map.onPress(()=>{dI(sI=!sI)})},dI=t=>{const e=nI.parentElement.parentElement.parentElement,s=Math.min(e.offsetWidth,e.offsetHeight);let i=Math.round(t?.8*s:Math.max(150,Math.min(200,.2*s)));i%2!=0&&(i+=1),yI=(nI.width=i)/2,vI=(nI.height=i)/2,nI.parentElement.style.height=nI.parentElement.style.width=2*yI+"px"};let hI=0;const uI=t=>{hI++,!iI||!Ya.player||Qi.mapLowQuality&&hI%10!=0||(sI?(fI=gI=0,rI.drawImage(oI,0,0,nI.width,nI.height)):(fI=oI.width*Ya.player.Zc[0]/Ya.bounds-yI,gI=oI.height*Ya.player.Zc[2]/Ya.bounds-vI,rI.drawImage(oI,-Math.round(fI),-Math.round(gI))),Ya.mapinfo.wars.forEach(t=>{mI(t.Zc[0],t.Zc[1],1,aI[t.size],t.active)}),Ya.mapinfo.wars.length>0&&(rI.globalAlpha=1),Ya.entities.array.forEach(t=>{t.stats&&t.stats.alive&&pI(t.Zc[0],t.Zc[2],t.type,Ya.player.hostility(t),t.party>0&&t.party===Ya.player.party,t===Ya.player)}),Ya.party.forEach(t=>{t.local&&void 0!==t.Zc&&!Ya.isEntityIdTaken(t.id)&&pI(t.Zc[0],t.Zc[1],0,0,Ya.player.party,!1)}))},mI=(t,e,s,i,n)=>{const a=bI(t,e);a[0]<1||a[1]<1||a[0]>=nI.width||a[1]>=nI.height||(!n||Ya.smoothtime%1<.5?rI.globalAlpha=n?.6:.8:rI.globalAlpha=1,rI.drawImage(i,a[0],a[1]))},pI=(t,e,s,i,n,a)=>{if(!Qi.mapShowMonsters&&1===s)return;const r=bI(t,e);if(!(r[0]<1||r[1]<1||r[0]>=nI.width||r[1]>=nI.height))if(0===s){if(sI&&n&&Ya.smoothtime%1>.5)return;rI.fillStyle=0===i?a?lI.player:n?lI.party:lI.friendly:lI.pvp,rI.fillRect(...r,5,5)}else rI.fillStyle=i>0?lI.monster:lI.friendly,rI.fillRect(...r,3,3)};let fI=0,gI=0,vI=0,yI=0;const bI=(t,e)=>[Math.round(t/Ya.bounds*(sI?nI.width:oI.width)-fI),Math.round(e/Ya.bounds*(sI?nI.height:oI.height)-gI)],xI=t=>{oI.src=wy(t.id),iI=!1},wI=t=>{iI=!1};var kI=Object.freeze({__proto__:null,canvas:nI,init:cI,changeCanvas:dI,postTick:uI,onWorldEnter:xI,onWorldDestroy:wI});function $I(t){let e,s,n,a;return{c(){e=B("img"),A(e,"class","btn border black bgblack round warIcon svelte-1npf5af"),e.src!==(s="/assets/ui/icons/war0.png?v=4597824")&&A(e,"src",s)},m(s,i){T(s,e,i),n||(a=D(e,"click",t[3]),n=!0)},p:i,d(t){t&&I(e),n=!1,a()}}}function SI(t){let e,s=void 0!==t[1]&&$I(t);return{c(){e=B("div"),s&&s.c(),A(e,"class","marg-top container panel-black svelte-1npf5af")},m(i,n){T(i,e,n),s&&s.m(e,null),t[4](e)},p(t,[i]){void 0!==t[1]?s?s.p(t,i):(s=$I(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},i:i,o:i,d(i){i&&I(e),s&&s.d(),t[4](null)}}}function MI(t,e,s){let i,n,a;p(t,Ce,t=>s(1,i=t)),p(t,Te,t=>s(2,n=t)),st(()=>{a.appendChild(nI),dI(!1)});const r=t=>x(Te,n=!n);function o(t){lt[t?"unshift":"push"](()=>{a=t,s(0,a)})}return[a,i,n,r,o]}class EI extends Ht{constructor(t){super(),Gt(this,t,MI,SI,d,{})}}function CI(t){let e,s;return e=new ZT({}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function TI(t){let e,s;return e=new JT({props:{vertical:!0}}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function II(t){let e,s,i,n,a,r,o,l,c,d,h,u,m,p,f,g,v,y,b,x,w,k,$,S,M,E,P,F,z,D,R,L,O,_,N,Z,q,G,H;e=new f$({}),i=new Om({});let X=t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])&&CI();r=new PE({}),o=new NE({}),l=new jm({}),c=new k$({}),d=new Hb({}),h=new xE({}),u=new gb({}),m=new Yk({}),p=new d$({}),f=new C$({}),g=new nS({}),v=new uE({}),y=new gS({}),b=new BS({}),x=new XS({}),w=new iM({}),k=new zM({}),$=new XC({}),S=new QC({}),M=new DC({}),E=new OT({}),F=new z$({}),z=new EI({}),D=new QT({}),R=new A$({});let j=t[6]&&TI();return N=new Zx({}),Z=new Lk({}),q=new sT({}),G=new SE({}),{c(){_t(e.$$.fragment),s=B("div"),_t(i.$$.fragment),n=B("div"),X&&X.c(),a=U(),_t(r.$$.fragment),_t(o.$$.fragment),_t(l.$$.fragment),_t(c.$$.fragment),_t(d.$$.fragment),_t(h.$$.fragment),_t(u.$$.fragment),_t(m.$$.fragment),_t(p.$$.fragment),_t(f.$$.fragment),_t(g.$$.fragment),_t(v.$$.fragment),_t(y.$$.fragment),_t(b.$$.fragment),_t(x.$$.fragment),_t(w.$$.fragment),_t(k.$$.fragment),_t($.$$.fragment),_t(S.$$.fragment),_t(M.$$.fragment),_t(E.$$.fragment),P=B("div"),_t(F.$$.fragment),_t(z.$$.fragment),_t(D.$$.fragment),_t(R.$$.fragment),j&&j.c(),L=B("div"),O=B("div"),_=B("div"),_t(N.$$.fragment),_t(Z.$$.fragment),_t(q.$$.fragment),_t(G.$$.fragment),A(P,"class","l-corner-ur uiscaled"),A(n,"class","container svelte-1j9lddf"),A(_,"class","actionbarcontainer svelte-1j9lddf"),A(O,"class","uiscaled"),A(L,"class","container svelte-1j9lddf"),A(s,"class","l-ui layout svelte-1j9lddf")},m(t,I){Nt(e,t,I),T(t,s,I),Nt(i,s,null),C(s,n),X&&X.m(n,null),C(n,a),Nt(r,n,null),Nt(o,n,null),Nt(l,n,null),Nt(c,n,null),Nt(d,n,null),Nt(h,n,null),Nt(u,n,null),Nt(m,n,null),Nt(p,n,null),Nt(f,n,null),Nt(g,n,null),Nt(v,n,null),Nt(y,n,null),Nt(b,n,null),Nt(x,n,null),Nt(w,n,null),Nt(k,n,null),Nt($,n,null),Nt(S,n,null),Nt(M,n,null),Nt(E,n,null),C(n,P),Nt(F,P,null),Nt(z,P,null),Nt(D,P,null),Nt(R,P,null),j&&j.m(P,null),C(s,L),C(L,O),C(O,_),Nt(N,_,null),Nt(Z,_,null),Nt(q,L,null),Nt(G,s,null),H=!0},p(t,[e]){t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])?X?63&e&&Tt(X,1):(X=CI(),X.c(),Tt(X,1),X.m(n,a)):X&&(Et(),It(X,1,1,()=>{X=null}),Ct()),t[6]?j?64&e&&Tt(j,1):(j=TI(),j.c(),Tt(j,1),j.m(P,null)):j&&(Et(),It(j,1,1,()=>{j=null}),Ct())},i(t){H||(Tt(e.$$.fragment,t),Tt(i.$$.fragment,t),Tt(X),Tt(r.$$.fragment,t),Tt(o.$$.fragment,t),Tt(l.$$.fragment,t),Tt(c.$$.fragment,t),Tt(d.$$.fragment,t),Tt(h.$$.fragment,t),Tt(u.$$.fragment,t),Tt(m.$$.fragment,t),Tt(p.$$.fragment,t),Tt(f.$$.fragment,t),Tt(g.$$.fragment,t),Tt(v.$$.fragment,t),Tt(y.$$.fragment,t),Tt(b.$$.fragment,t),Tt(x.$$.fragment,t),Tt(w.$$.fragment,t),Tt(k.$$.fragment,t),Tt($.$$.fragment,t),Tt(S.$$.fragment,t),Tt(M.$$.fragment,t),Tt(E.$$.fragment,t),Tt(F.$$.fragment,t),Tt(z.$$.fragment,t),Tt(D.$$.fragment,t),Tt(R.$$.fragment,t),Tt(j),Tt(N.$$.fragment,t),Tt(Z.$$.fragment,t),Tt(q.$$.fragment,t),Tt(G.$$.fragment,t),H=!0)},o(t){It(e.$$.fragment,t),It(i.$$.fragment,t),It(X),It(r.$$.fragment,t),It(o.$$.fragment,t),It(l.$$.fragment,t),It(c.$$.fragment,t),It(d.$$.fragment,t),It(h.$$.fragment,t),It(u.$$.fragment,t),It(m.$$.fragment,t),It(p.$$.fragment,t),It(f.$$.fragment,t),It(g.$$.fragment,t),It(v.$$.fragment,t),It(y.$$.fragment,t),It(b.$$.fragment,t),It(x.$$.fragment,t),It(w.$$.fragment,t),It(k.$$.fragment,t),It($.$$.fragment,t),It(S.$$.fragment,t),It(M.$$.fragment,t),It(E.$$.fragment,t),It(F.$$.fragment,t),It(z.$$.fragment,t),It(D.$$.fragment,t),It(R.$$.fragment,t),It(j),It(N.$$.fragment,t),It(Z.$$.fragment,t),It(q.$$.fragment,t),It(G.$$.fragment,t),H=!1},d(t){Zt(e,t),t&&I(s),Zt(i),X&&X.d(),Zt(r),Zt(o),Zt(l),Zt(c),Zt(d),Zt(h),Zt(u),Zt(m),Zt(p),Zt(f),Zt(g),Zt(v),Zt(y),Zt(b),Zt(x),Zt(w),Zt(k),Zt($),Zt(S),Zt(M),Zt(E),Zt(F),Zt(z),Zt(D),Zt(R),j&&j.d(),Zt(N),Zt(Z),Zt(q),Zt(G)}}}function PI(t,e,s){let i,n,a,r,o,l,c;return p(t,Ge,t=>s(0,i=t)),p(t,Ue,t=>s(1,n=t)),p(t,Pe,t=>s(2,a=t)),p(t,Le,t=>s(3,r=t)),p(t,Re,t=>s(4,o=t)),p(t,De,t=>s(5,l=t)),p(t,vs,t=>s(6,c=t)),nT(t=>{t&&t.subscribed_until&&US("sub","Hordes Elixir active $gt",!0)}),[i,n,a,r,o,l,c]}class BI extends Ht{constructor(t){super(),Gt(this,t,PI,II,d,{})}}function FI(t){let e,s;return e=new BI({}),{c(){_t(e.$$.fragment)},m(t,i){Nt(e,t,i),s=!0},i(t){s||(Tt(e.$$.fragment,t),s=!0)},o(t){It(e.$$.fragment,t),s=!1},d(t){Zt(e,t)}}}function zI(t){let e,s,i,n;e=new Fm({props:{active:t[0]}});let a="play"==t[1]&&t[2]&&!t[0]&&t[3]&&FI();return i=new Dm({}),{c(){_t(e.$$.fragment),a&&a.c(),s=U(),_t(i.$$.fragment)},m(t,r){Nt(e,t,r),a&&a.m(t,r),T(t,s,r),Nt(i,t,r),n=!0},p(t,[i]){const n={};1&i&&(n.active=t[0]),e.$set(n),"play"==t[1]&&t[2]&&!t[0]&&t[3]?a?15&i&&Tt(a,1):(a=FI(),a.c(),Tt(a,1),a.m(s.parentNode,s)):a&&(Et(),It(a,1,1,()=>{a=null}),Ct())},i(t){n||(Tt(e.$$.fragment,t),Tt(a),Tt(i.$$.fragment,t),n=!0)},o(t){It(e.$$.fragment,t),It(a),It(i.$$.fragment,t),n=!1},d(t){Zt(e,t),a&&a.d(t),t&&I(s),Zt(i,t)}}}function UI(t,e,s){let i,n,a,r;return p(t,ne,t=>s(0,i=t)),p(t,ae,t=>s(1,n=t)),p(t,ee,t=>s(2,a=t)),p(t,$e,t=>s(3,r=t)),[i,n,a,r]}class DI extends Ht{constructor(t){super(),Gt(this,t,UI,zI,d,{})}}let AI;const RI=()=>{AI=Va.canvas2dContext,AI.font="bold 18px hordes",AI.fillText("Hordes",0,0)},LI=(t,e,s=1,i=1,n=1,a=1,r=0,o=0,l=.5,c=.5)=>{AI.globalAlpha=Qi.nameplateShowTransparency?s:1;const d=t.width*i,h=t.height*i,u=Math.round(d*n),m=Math.round(h*a);return 0===u||0===m||AI.drawImage(t,0,0,Math.round(t.width*n),Math.round(t.height*a),Math.round(e[0]-d*l+r*i),Math.round(e[1]-h*c+o*i),u,m),u},OI=(t,e,s,i,n,a=0,r=0,o=.5,l=.5)=>LI(GI(e,s),t,i,n,1,1,a,r,o,l),_I=(t,e,s=!1)=>(s?(e[0]=t[0],e[1]=t[1]):wn(e,t,Xa.kX),!!(s||e[2]<1&&e[0]>-1&&e[0]<1&&e[1]>-1&&e[1]<1)&&(e[0]=Math.round((.5*e[0]+.5)*Va.canvas2dElement.width),e[1]=Math.round((-.5*e[1]+.5)*Va.canvas2dElement.height),e)),NI=(t,e,s)=>{t.font="bold "+e+"px hordes",t.shadowColor="#000",t.shadowOffsetX=1,t.shadowOffsetY=1,t.fillStyle=s},ZI={name:{fill:eI("name"),size:17},enemy:{fill:eI("enemy"),size:17},pvp:{fill:eI("pvp"),size:17},nameSmall:{fill:eI("name"),size:13},enemySmall:{fill:eI("enemy"),size:13},pvpSmall:{fill:eI("pvp"),size:13},chatGlobal:{fill:eI("global"),size:13,wrap:150},chatClan:{fill:eI("clan"),size:13,wrap:150},chatParty:{fill:eI("party"),size:13,wrap:150},chatWhisper:{fill:eI("pvp"),size:13,wrap:150},lev0:{fill:"#919191",size:13},lev1:{fill:eI("name"),size:13},lev2:{fill:"#EEA303",size:13},lev3:{fill:eI("enemy"),size:13},clan:{fill:eI("clan"),size:17},faction0:{fill:eI("f0"),size:17},faction1:{fill:eI("f1"),size:17},faction0small:{fill:eI("f0"),size:13},faction1small:{fill:eI("f1"),size:13},phys:{fill:eI("name"),size:18},physCrit:{fill:eI("name"),size:24},spell:{fill:"#FFE404",size:28},spellCrit:{fill:"#FFE404",size:40},heal:{fill:"#12F027",size:28},mana:{fill:eI("mana"),size:20},exp:{fill:eI("exp"),size:20},fame:{fill:eI("fame"),size:20},gold:{fill:"#EEDDA3",size:16},misc:{fill:"#A6EBFA",size:16},book:{fill:"#749DEF",size:20},rune:{fill:"#DC9A4D",size:20},itemgrey:{fill:"#747474",size:16},common:{fill:"#dddddd",size:20},uncommon:{fill:eI("green"),size:20},rare:{fill:eI("blue"),size:20},epic:{fill:eI("purp"),size:20},pheal:{fill:"#12F027",size:20},pdmg:{fill:eI("enemy"),size:20}},qI={},GI=(t,{fill:e,size:s,wrap:i=0})=>{const n=t+e+s;if(qI[n])return qI[n];const a=document.createElement("canvas"),r=a.getContext("2d");return r.font="bold "+s+"px hordes",i>0?XI(a,r,t,0,0,i,s,e):(a.width=Math.max(1,Math.ceil(r.measureText(t).width))+5,a.height=Math.ceil(1.2*s+5),NI(r,s,e),r.fillText(t,0,a.height-6)),qI[n]=a,a},HI=(t,e,s,i,n,a,r)=>{t||((t=document.createElement("canvas")).width=s,t.height=i);const o=t.getContext("2d");return o.fillStyle=e,o.beginPath(),o.moveTo(n+r,a),o.arcTo(n+s,a,n+s,a+i,r),o.arcTo(n+s,a+i,n,a+i,r),o.arcTo(n,a+i,n,a,r),o.arcTo(n,a,n+s,a,r),o.closePath(),o.fill(),t},XI=(t,e,s,i,n,a,r,o)=>{const l=s.split(" "),c=[];let d=0,h="";for(let t=0;t<l.length;++t){const s=h+l[t]+" ",i=e.measureText(s);i.width>a?(c.push(h),h=l[t]+" "):(d=Math.max(d,i.width),h=s)}c.push(h),t.width=Math.ceil(d+5),t.height=Math.ceil(c.length*r+10),HI(t,"#00000099",t.width,t.height,0,0,5),NI(e,r,o);for(let t=0;t<c.length;++t)e.fillText(c[t],i+5,(t+1)*r+3)},jI=[];let JI=0;const VI=t=>{JI+=t;for(let t=0;t<jI.length;t++){const e=jI[t];if(e.timer.done(JI))aP(e),jI.splice(t--,1);else if(JI>=e.timer.start){const t=e.timer.fraction(JI);an(Ka,e.Zc);const s=_I(Ka,Ka,e.flat);if(s){let i=1;const n=e.timer.remaining(JI),a=n<.3?n/.3:1;if(e.crit){const e=Math.min(1,6*t);i=1+1.6*(e>.5?2-2*e:2*e),s[1]-=30}else s[1]-=200*(t-t**2)+10,s[0]-=t*e.side*50;OI(s,e.text,e.style,a,i)}}}},YI=(t,e,s,i,n=!1,a)=>{const r=3===s;sP(t,n,r,n||!r,0===s?"Miss":e+(1===s?"":""),n?ZI.pdmg:1===i?r?ZI.spellCrit:ZI.spell:r?ZI.physCrit:ZI.phys,a,JI+.15,r?1.2:.9)},WI=(t,e,s,i=!1,n)=>{sP(t,i,3===s,i||3!==s,e,i?ZI.pheal:ZI.heal,n,JI,1.3)},QI=(t,e,s)=>{sP(t,s,!1,!0,"Immune",s?ZI.mana:ZI.spell,e,JI,2)},KI=(t,e,s,i=!1)=>{sP(t,i,3===s,i||3!==s,e,ZI.mana,0,JI,1.3)},tP=(t,e)=>{sP(t,!1,!1,!0,`+${e} EXP`,ZI.exp,4,JI,1.5)},eP=(t,e)=>{sP(t,!1,!1,!0,`+${e} Fame`,ZI.fame,5.5,JI,1.5)},sP=(t,e=!1,s=!1,i=!1,n,a,r,o,l)=>{const c=nP();an(c.Zc,t),c.Zc[1]+=r||0,c.side=Math.sin(2.3*jI.length),c.flat=e,c.crit=s,c.float=i,c.text=n,c.style=a,c.timer.reset(o+Zo(0,.2),l),jI.push(c)},iP=[],nP=()=>iP.length?iP.pop():{Zc:[0,0,0],flat:!0,crit:!0,float:!0,text:"",style:ZI.fame,yoffset:0,timer:new id(0,1)},aP=t=>{iP.push(t)},rP=Qi.itemTypeFilter.toLowerCase().replace(/\s/g,"").split(","),oP=new Set,lP=(t,e,s)=>{for(let i=s.length-1;i>=0;i--){const n=s[i];(n==e||pn(e.Zc,n.Zc)<25)&&(t.push(n),ln(t.Zc,t.Zc,n.Zc),s.splice(i,1))}},cP=(t,e)=>{an(t.hudPos,t.visualPosition||t.Zc),_I(t.hudPos,t.hudPos)&&t.hudPos[2]<.997&&e.push(t)},dP=t=>{let e=[];Ya.entities.array.forEach(t=>{!t.visual.transform.visible||3!==t.type||t.quality<Qi.itemQualityFilter||rP.includes(t.droptype)||cP(t,e)}),oP.forEach(t=>{t.uiTimeout<Ya.time?oP.delete(t):cP(t,e)}),e=e.sort((t,e)=>e.id-t.id);const s=new Set;for(;e.length;){const t=e[0],i=[];i.Zc=[0,0,0],lP(i,t,e),hn(i.Zc,i.Zc,1/i.length),rn(i.Zc,Math.round(i.Zc[0]),Math.round(i.Zc[1]),Math.round(i.Zc[2])),_I(i.Zc,i.Zc)?s.add(i.sort((t,e)=>t.hudPos[2]-e.hudPos[2])):s.delete(i)}let i=0;Array.from(s).sort((t,e)=>e.Zc[2]-t.Zc[2]).forEach(t=>{const e=t.length/5*100;let s=0,n=0;t.forEach((a,r)=>{a.hudTextImg||(a.hudTextImg=GI(a.name,ZI[a.color]));const o=a.hudTextImg.width,l=Math.round(t.Zc[0]+n-.5*e)-2,c=Math.round(t.Zc[1]-20*s)-8;if(0===a.uiTimeout){const t=a.canBePickedUpBy(Ya.player),e=a.partyTimeoutCheck(Ya.player);t&&!(ml[0]>l+o||ml[1]>c+20||ml[0]<l||ml[1]<c)?(i=a.id,AI.globalAlpha=1):AI.globalAlpha=t?.4:.1,AI.fillStyle="#000000",AI.beginPath(),AI.rect(l,c,o,20),AI.fill(),OI(Fa(rr,l+2,c+8),a.name,e?ZI[a.color]:ZI.itemgrey,t?1:.8,1,0,0,0)}n+=o+3,n>e&&(s++,n=0)})}),i!==lx&&fx(i)},hP=[];let uP,mP;const pP=2,fP=()=>{const t=(10+3)/13,e=Math.ceil(100*t),s=Math.max(7,Math.ceil(9*t)),i=Math.max(1,Math.ceil(pP*t)),n=e-2*pP,a=s-2*pP;hP.push(HI(null,eI("panel"),e,s,0,0,i)),HI(hP[0],eI("grey"),n,a,pP,pP,1),hP.push(HI(null,eI("health"),n,a,0,0,1)),hP.push(HI(null,eI("enemy"),n,a,0,0,1)),hP.push(HI(null,eI("party"),n,a,0,0,1)),hP.push(HI(null,eI("pvp"),n,a,0,0,1)),hP.push(HI(null,"#555555",n,a,0,0,1)),hP.push(HI(null,eI("spell"),n,a,0,0,1));for(let t=0;t<=3;++t)hP.push(HI(null,eI("c"+t),n,a,0,0,1));uP=HI(null,"#ffffff",100+2*pP,9+2*pP,0,0,3),mP=HI(null,"#ffffff",100+2*pP,16+2*pP,0,0,3)},gP=()=>{const t=[];return Ya.entities.array.forEach((e,s)=>{e.stats&&!e.stats.alive||!e.visual.transform.visible||e.id!==Ya.player.target&&e.visual.cDist&&e.visual.cDist>60||3===e.type&&e.id!==lx||(an(e.hudPos,e.visualPosition||e.Zc),3!==e.type&&(e.hudPos[1]+=e.visual.getTopAbsolute()),_I(e.hudPos,e.hudPos)&&(e===Ya.player&&(e.hudPos[0]=Math.round(.5*Va.canvas2dElement.width),e.hudPos[1]=Math.round(.5*Va.canvas2dElement.height)),t.push(e)))}),t.sort((t,e)=>e.hudPos[2]-t.hudPos[2])},vP=(t,e)=>{let s=t.visual&&t.visual.cDist;if(s>Qi.nameplateViewRange)return;s?s/=70:s=0;const i=t.party>0&&t.party===Ya.player.party,n=t.id===Ya.player.target,a=void 0!==t.faction?Ya.player.hostility(t):0,r=t.id===lx;if(3!==t.type&&t.stats&&t.stats.alive){if(!Qi.nameplateShowMonsers&&1===t.type)return;t.namePlateScale=gr(t.namePlateScale+.25*((n?1:0)-t.namePlateScale),.5,1);const e=n?1:.7*Math.max(.1,Math.min(1,1-s)),o=n||i?1:Math.min(.8,r?.9:.75*e+.2),l=void 0!==t.skills.timedSkill;if(t!==Ya.player&&n&&LI(l?mP:uP,t.hudPos,1,t.namePlateScale,1,l?2:1,0,l?4:0),l){const e=hP[0].height-pP,s=gr(t.skills.timedCast.fraction(Ya.smoothtime),0,1);LI(hP[0],t.hudPos,o,t.namePlateScale,1,1,0,e),s>0&&LI(hP[6],t.hudPos,o,t.namePlateScale,s,1,0,e)}if(t!==Ya.player&&(Qi.showFriendlyBars||n||a>0)&&(LI(hP[0],t.hudPos,o,t.namePlateScale,1,l?2:1),LI(i?hP[3]:0===a?hP[Qi.classColorBars&&0===t.type?7+t.class:1]:a>1?t.canCombatInteract(Ya.player)?hP[Qi.classColorBars?7+t.class:4]:hP[5]:hP[2],t.hudPos,o,t.namePlateScale,t.stats.getResource(6)/t.stats.getStat(6),1),t.clan&&OI(Fa(rr,t.hudPos[0]-(hP[0].width/2+pP)*t.namePlateScale,t.hudPos[1]),t.clan,t.clan==Ya.player.clan?ZI.clan:0===t.faction?ZI.faction0small:ZI.faction1small,o,1,2,0,1),t.level&&(Qi.alwaysShowLevel||n))){let e=ZI.lev1;a>0&&(t.level-Ya.player.level>4?e=ZI.lev3:t.level-Ya.player.level>1?e=ZI.lev2:t.level-Ya.player.level<-5&&(e=ZI.lev0)),OI(Fa(rr,t.hudPos[0]+(hP[0].width/2+pP)*t.namePlateScale,t.hudPos[1]),t.level,e,o,1,0,0,0)}}if(t===Ya.player||n||t.faction<2||r){const e=3===t.type&&r&&!t.canBePickedUpBy(Ya.player)?.5:n||3===t.type?1:r?.9:.7*Math.max(.1,Math.min(1,1-s));let i;3===t.type?i=t.partyTimeoutCheck(Ya.player)?ZI[t.color]:ZI.itemgrey:0===a?i=n?ZI.name:ZI.nameSmall:1===a?i=n?ZI.enemy:ZI.enemySmall:2===a&&(i=n?ZI.pvp:ZI.pvpSmall);const o=n?-16:-9,l=t==Ya.player&&t.clan?5*t.clan.length:0,c=OI(t.hudPos,t.name,i,e,1,l,o);t.clan&&t==Ya.player&&OI(Fa(rr,t.hudPos[0]-c/2+pP,t.hudPos[1]),t.clan,0===t.faction?n?ZI.faction0:ZI.faction0small:n?ZI.faction1:ZI.faction1small,e,1,5*t.clan.length,o,1)}t.speechText&&OI(t.hudPos,t.speechText,t.speechStyle,1,1,0,n?-30:-20,.5,1)},yP=t=>{oP.clear();let e=gP();Sx(e),e=e.sort((t,e)=>t.id===Ya.player.target||t.id===lx?1:e.id===Ya.player.target||e.id===lx?-1:e.hudPos[2]-t.hudPos[2]),ea(ar,0,0,0,0),e.forEach(vP)},bP=()=>{RI(),fP()},xP=t=>{Va.canvas2dContext.clearRect(0,0,Va.canvas2dElement.width,Va.canvas2dElement.height),fl.shift.down?dP():yP(),VI(t)};var wP=Object.freeze({__proto__:null,init:bP,postTick:xP});Ym.report.fun=t=>{t.length>=3?Ee.set({name:t,reason:0,reasonfixed:!1}):US("error","Enter a player name to report",!0)};const kP=[wP,Ex,i$,kI,Jy,im,Kb];new DI({target:document.querySelector("body")});let $P=!1;const SP=()=>{kP.forEach(t=>{t.init&&t.init()})},MP=t=>{kP.forEach(e=>{e.preTick&&e.preTick(t)})},EP=t=>{$P&&kP.forEach(e=>{e.tick&&e.tick(t)})},CP=t=>{$P&&kP.forEach(e=>{e.postTick&&e.postTick(t)})},TP=t=>{kP.forEach(e=>{e.onWorldEnter&&e.onWorldEnter(t)}),$P=!0},IP=t=>{$P&&kP.forEach(e=>{e.onWorldDestroy&&e.onWorldDestroy(t)}),$P=!1},PP=[829927830,606999248,2044712200,185185300,1811810416,1962670504,708807558,1787901159,765415420,694562746,2006402030,986985301,1656999600,1393498346,233854303,1701969552,1166642373,677206296,795478924,795550645,252103880,1048414973,1372386482,168622719,2129176955,1108656007,1629050812,38449511,439211961,1846216176,620824999,1322528325,1783169885,2097568378,453585616,1988186369,1851748430,1306678406,417261329,2144028508,974637826,332536585,427866925,2095161840,1444654502,167924627,1241729450,1241730065,1122104127,321091462,1482206796,1281435537,1884591304,1884591305,2081883782,1258482524,1543660443,684238378,441617460,684663140,411484321,1969262899,223252476,157747493,629621382,1189916431,1058210608,1444964391,99368550,275696679,957774871,944144637,2028314237,1607895727,238952528,766698876,425486787,1690805417,434615455,1323213911,1657870018,776709424,1961719665,1740624203,1184045228,593866486,511816150,1290384506,1536390922,77043737,1611838039,1537902732,1588404599,609824517,1352399103,598819245,1227423714,1287031123,601483113,1862143986];class BP{constructor(t){this.id=0,this.Zc=[-0,-0,-0],this.rot=[-0,-0,-0],this.scale=1,this.matrix=void 0,this.loaded=!1}setWorldMatrix(t,e){this.matrix=t,ln(Ka,e,this.Zc),on(tr,this.scale),ia(ar,this.rot),Xn(this.matrix,ar,Ka,tr)}loadGeometry(t,e){let s="prop/"+this.id;PP.includes(this.id)||(s="engine/placeholder_error"),this.loaded||(this.loaded=!0,To(s,(i,n)=>{this.onGeometryLoad(t,e,i,n,s)}))}onUpdate(t,e,s){}onGeometryLoad(t,e,s,i,n){const a=s.position.data,r=s.Jw.data,o=i.coll,l=new Map,c=new Map,d=t=>{if(l.has(t))return l.get(t);{const e=[a[t],a[t+1],a[t+2]];return wn(e,e,this.matrix),l.set(t,e),e}},h=t=>{if(c.has(t))return c.get(t);const e=[r[t],r[t+1],r[t+2]];return kn(e,e,this.matrix),vn(e,e),c.set(t,e),e};for(let e=0,s=o.length;e<s;e+=3){const s=3*o[e],i=3*o[e+1],n=3*o[e+2],a=[d(s),d(i),d(n)],r=jv(qv(),a);a.push(h(s)),t.triangleGrid.add(a,r)}e.onPropFinishLoading(this)}onRemove(t){}}class FP extends BP{constructor(t){super(t||{}),this.mesh=void 0,this.effects=[]}onUpdate(t,e,s){void 0!==this.mesh&&this.updateMesh(e),super.onUpdate(t,e,s)}updateMesh(t){this.setWorldMatrix(this.mesh.cX,t),ln(this.mesh.position,t,this.Zc),rn(this.mesh.rotation,this.rot[0],this.rot[1],this.rot[2]),on(this.mesh.scale,this.scale),this.mesh.data.multi.needsUpdate=!0,this.effects.forEach(t=>{ca(t,!0)})}onRemove(t){super.onRemove(t),this.effects.forEach(t=>{ra(t,null),t.data.remove=!0}),this.mesh&&(this.mesh.data.multi.remove(this.mesh),this.mesh=void 0)}onGeometryLoad(t,e,s,i,n){if(void 0===this.mesh){const t=s.position.data.length<=0,a=su[i.texture]||su.default;let r=zc.multimeshTextured;a.JC>0?r=zc.multimeshTileable:a.tree&&(r=zc.multimeshTree),this.mesh=Bd({geo:t?"engine/placeholder_effect":n,program:r,ts:!0,rs:!0,cull:a.double?0:void 0,visible:!t}),a.JC>0&&(this.mesh.data.JC=this.scale*a.JC),i.effects.forEach(t=>{if(yp[t.id]){const e=_d(yp[t.id],this.mesh);e.data.origin=t.Zc,an(e.position,e.data.origin),this.effects.push(e)}else console.error("Unknown prop effect: ",t.id)}),this.updateMesh(e.origin)}super.onGeometryLoad(t,e,s,i,n)}}class zP{constructor(t){this.id=t.id,this.origin=[64*t.x,0,64*t.z],this.center=ln([0,0,0],this.origin,[32,0,32]),this.deserialized=!1,this.props={},this.intHeights=[],this.normals=[],this.data=void 0,this.left=void 0,this.right=void 0,this.front=void 0,this.back=void 0,this.frontRight=void 0,this.backLeft=void 0,this.currentlyLoadingProps=new Set}tickDelta(){}tickFixed(){}onBeginLoading(){Ya.onChunkBeginLoading(this)}onFinishLoading(){Ya.onChunkFinishLoading(this)}deserialize(t){this.parse(po.chunk.decode(t))}parse(t){if(this.data=t,0==this.normals.length)for(let t=0,e=24576;t<e;++t)this.normals[t]=0;this.updateIntHeights(),this.updateNormals(),this.unpackProps(!0),this.deserialized=!0}getIndex(t,e,s){return t+(s?64:65)*e}getIndexFromWorld(t,e,s){return t-=this.origin[0],e-=this.origin[2],this.getIndex(t,e,s)}getHeight(t,e){const s=t%1,i=e%1;if(0===s&&0===i)return.030517578125*this.intHeights[t+65*e];{const n=Math.floor(t),a=Math.floor(e),r=s+i<1,o=r?-(s-1+i):-(i-1),l=r?i:-(s-1);return.030517578125*(o*this.intHeights[n+65*a+(r?0:1)]+l*this.intHeights[n+65*(a+1)]+(1-o-l)*this.intHeights[n+1+65*(a+(r?0:1))])}}getHeightFromWorld(t,e){return t-=this.origin[0],e-=this.origin[2],this.getHeight(t,e)}getTriangleIndex(t,e){let s=2*Math.floor(t)+64*Math.floor(e)*2;return t%1+e%1>1&&s++,s}updateNormals(){const t=[-0,-0,-0];for(let e=0;e<64;++e)for(let s=0;s<64;++s){const i=3*(2*s+64*e*2);rn(sr,s,this.getHeight(s,e),e),rn(ir,s,this.getHeight(s,e+1),e+1),rn(nr,s+1,this.getHeight(s+1,e),e),$r(t,sr,ir,nr),this.normals[i]=t[0],this.normals[i+1]=t[1],this.normals[i+2]=t[2],rn(sr,s+1,this.getHeight(s+1,e),e),rn(nr,s+1,this.getHeight(s+1,e+1),e+1),$r(t,sr,ir,nr),this.normals[i+3]=t[0],this.normals[i+4]=t[1],this.normals[i+5]=t[2]}}updateIntHeights(){for(let t=0;t<65;++t)for(let e=0;e<65;++e){const s=e+65*t;this.intHeights[s]=this.data.terrain.readUInt16BE(2*s)}}getNeighborChunk(t,e){return t<64?this.front:e<64?this.right:this.frontRight}getWorldFromLocal(t){return[t[0]+this.origin[0],t[1],t[2]+this.origin[2]]}unpackProps(t){const e={};for(let s=0,i=this.data.props.length;s<i;++s){const i=this.data.props[s];null==this.props[i.id]&&(this.props[i.id]=[]),void 0===e[i.id]&&(e[i.id]=0);const n=Bh(this,this.props[i.id][e[i.id]]||new FP,i);t&&this.onPropBeginLoading(n),this.props[i.id][e[i.id]]=n,e[i.id]++}for(const t in this.props)this.props[t].forEach(t=>{t.onUpdate(Ya,this.origin,Ya.bounds),t.loadGeometry(Ya,this)});for(const t in this.props){const s=e[t]||0;if(this.props[t]&&s<this.props[t].length){for(let e=s;e<this.props[t].length;++e)this.props[t][e].onRemove();this.props[t].splice(s)}}0==this.data.props.length&&this.onAllPropsFinishLoading()}destroy(){this.left=void 0,this.right=void 0,this.front=void 0,this.back=void 0,this.frontRight=void 0,this.backLeft=void 0;for(const t in this.props)this.props[t].forEach(t=>t.onRemove())}onPropBeginLoading(t){this.currentlyLoadingProps.add(t)}onPropFinishLoading(t){this.currentlyLoadingProps.has(t)&&(this.currentlyLoadingProps.delete(t),0===this.currentlyLoadingProps.size&&this.onAllPropsFinishLoading())}onAllPropsFinishLoading(){this.onFinishLoading()}}const UP=[];let DP=0;const AP=()=>{const t=UP.shift();t[0](...t[1])},RP=(t,e,s)=>{if(s)for(;DP>0;)DP--,AP();else DP>0&&(DP--,requestIdleCallback(AP,{timeout:5e3}))},LP=(t,e,s)=>{UP.push([t,e]),DP++},OP=(t,e)=>{e.state=2,e.deserialize(t)};class _P extends zP{constructor(t){super(t),this.geometry={},this.meshes={},this.state=0,this.addedToScene=!1,this.rebuildAny=!1,this.rebuildHeightmap=!1,this.rebuildTexture=!1,this.rebuildFoliage=!1,this.rebuildProps=!1}load(){this.state>0||(super.onBeginLoading(),this.state=1,fetch(`worlddata/${Ya.file}/${this.id}?v=4597824`,{cache:"default"}).then(t=>{t.arrayBuffer().then(t=>{const e=Qr(t);LP(OP,[e,this])})}))}isInRange(t){return mn(Xa.worldPosition,this.center)-64<Uu}tickDelta(t,e,s){super.tickDelta(t,e,s),this.isInRange(s)?(this.rebuildAny&&this.state>1&&this.rebuild(),this.state<1?this.load(s):3==this.state&&(this.addedToScene||this.addToScene())):3==this.state&&this.addedToScene&&this.removeFromScene()}parse(t){super.parse(t,Qi.detailprops),this.rebuildAny=!0,this.rebuildHeightmap=!0,this.rebuildTexture=!0,this.rebuildFoliage=!0,this.rebuildProps=!0}rebuild(){(this.rebuildHeightmap||this.rebuildTexture||this.rebuildFoliage||this.rebuildProps)&&LP(Nu,[this,this.rebuildHeightmap,this.rebuildTexture,this.rebuildFoliage,this.rebuildProps]),this.rebuildAny=!1,this.rebuildHeightmap=!1,this.rebuildTexture=!1,this.rebuildFoliage=!1,this.rebuildProps=!1}addToScene(){for(const t in this.props)this.props[t].forEach(t=>t.onUpdate(Ya,this.origin,Ya.bounds));Nc(this.meshes.terrain.transform),this.addedToScene=!0}removeFromScene(){Zc(this.meshes.terrain.transform),this.addedToScene=!1}destroy(){super.destroy(),this.addedToScene&&this.removeFromScene(),Zu(this)}sendToServer(){storeChunk(this.id,Ya.file,this.serializedData)}}class NP{constructor(t,e,s,i,n,a){this.nodes=new Map,this.width=t,this.height=e,this.BS=s,this.yd=n,this.zd=a,this.xm=i-1,this.ym=n-1,this.zm=a-1,this.xs=t/i,this.ys=e/n,this.zs=s/a}clear(){this.nodes.clear()}add(t,e){const s=Math.max(0,Math.min(this.xm,~~(e[0]/this.xs))),i=Math.max(0,Math.min(this.ym,~~(e[1]/this.ys))),n=Math.max(0,Math.min(this.zm,~~(e[2]/this.zs))),a=Math.max(0,Math.min(this.xm,~~(e[3]/this.xs))),r=Math.max(0,Math.min(this.ym,~~(e[4]/this.ys))),o=Math.max(0,Math.min(this.zm,~~(e[5]/this.zs)));for(let l=s;l<=a;++l)for(let s=i;s<=r;++s)for(let i=n;i<=o;++i){const n=l*this.yd*this.zd+s*this.zd+i;this.nodes.has(n)||this.nodes.set(n,{aabbs:[],content:[],count:0});const a=this.nodes.get(n);a.content.push(t),a.aabbs.push(e),a.count++}}queryAABB(t){const e=Math.max(0,Math.min(this.xm,~~(t[0]/this.xs))),s=Math.max(0,Math.min(this.ym,~~(t[1]/this.ys))),i=Math.max(0,Math.min(this.zm,~~(t[2]/this.zs))),n=Math.max(0,Math.min(this.xm,~~(t[3]/this.xs))),a=Math.max(0,Math.min(this.ym,~~(t[4]/this.ys))),r=Math.max(0,Math.min(this.zm,~~(t[5]/this.zs))),o=[];for(let l=e;l<=n;++l)for(let e=s;e<=a;++e)for(let s=i;s<=r;++s){const i=l*this.yd*this.zd+e*this.zd+s;if(this.nodes.has(i)){const e=this.nodes.get(i);for(let s=0;s<e.count;++s){const i=e.content[s];Hv(e.aabbs[s],t)&&!o.includes(i)&&o.push(i)}}}return o}queryRay(t,e,s){const i=t[0]+e[0],n=t[1]+e[1],a=t[2]+e[2],r=Math.max(0,Math.min(this.xm,~~(Math.min(t[0],i)/this.xs))),o=Math.max(0,Math.min(this.ym,~~(Math.min(t[1],n)/this.ys))),l=Math.max(0,Math.min(this.zm,~~(Math.min(t[2],a)/this.zs))),c=Math.max(0,Math.min(this.xm,~~(Math.max(t[0],i)/this.xs))),d=Math.max(0,Math.min(this.ym,~~(Math.max(t[1],n)/this.ys))),h=Math.max(0,Math.min(this.zm,~~(Math.max(t[2],a)/this.zs))),u=[];for(let e=r;e<=c;++e)for(let i=o;i<=d;++i)for(let n=l;n<=h;++n){const a=e*this.yd*this.zd+i*this.zd+n;if(this.nodes.has(a)){const e=this.nodes.get(a);for(let i=0;i<e.count;++i){const n=e.content[i];Vv(e.aabbs[i],t,s,0,1)&&!u.includes(n)&&u.push(n)}}}return u}}class ZP extends Pg{constructor(t){super({Zj:mp.blacksteel,colEyes:mp.fireorange,...t}),this.eyes.position[1]+=.1,this.kilt=this.mesh(this.chest,!1,null,.6,mp.leather),rn(this.kilt.scale,1.1,.6,.4),this.kilt.position[1]=-.5,this.kilt.position[2]=.35,this.hammer=this.mesh(this.hands[0],!1,null,.5,mp.woodbrown),rn(this.hammer.scale,.25,.25,1.2),this.hammerhead=this.mesh(this.hammer,!1,null,.3,mp.darksteel),this.setShoulders(mp.greysteel)}tickParts(t,e,s){super.tickParts(t,e,s);const i=this.hands[0];cn(i.rotation,.9,-.4,0),i.position[2]-=.1}}class qP extends ay{constructor(t){super({type:6,size:1.2,name:"Blacksmith",...t})}}class GP extends qP{constructor(t){super({...t,...tn.npcs.blacksmith})}makeTransform(){this.visual=new ZP({entity:this})}}class HP extends Pg{constructor(t){super({Zj:mp.paleskin,...t}),this.robe=this.mesh(this.chest,!1,"character/robe",1.2,mp.magicblue),rn(this.robe.scale,1.2,1.2,1.2),rn(this.robe.rotation,0,0,0),rn(this.robe.position,0,-.9,.05)}tickFixed(){}tickParts(t,e,s){super.tickParts(t,e,s),this.hands.forEach((t,e)=>{if(!t.visible)return;const s=this.cycle(1.3);rn(t.rotation,.78,0,e?.2*s:.2*-s),rn(t.position,e?.2:-.2,-.4,.6)})}}class XP extends ay{constructor(t){super({type:2,size:1.2,name:"Conjurer",...t})}}class jP extends XP{constructor(t){super({...t,...tn.npcs.conjurer})}interact(t){const e=Qr.from(t.splice(1)).toString().split("#");""!==e[0]?this.setDialogue(this.interactions[0].text,Array.from(e,t=>{const e=t.split("~");return this.interactions[0].choices[0].replace("$1",e[0])+(e[1]>0?` (Lv. ${e[1]}+)`:"")})):this.setDialogue(this.interactions[0].text,[]),super.interact(t)}makeTransform(){this.visual=new HP({entity:this})}}class JP extends Rv{constructor(t){super({type:3,...t}),this.partytimeout=0,this.party=0,this.droptype="",this.tier=0,this.quality=0}partyTimeoutCheck(t){return 0===this.party||t.id===this.party||t.party===this.party||Ya.time>this.partytimeout}canBePickedUpBy(t){return this.partyTimeoutCheck(t)&&t.squaredDistance(this.Zc)<30}}class VP extends JP{constructor(t){super(t),this.visual={transform:Bd({geo:"drop/drop",tex:"items.png",program:zc.drop,ts:!1,rs:!1,dynamic:!1})},this.visual.transform.data.multi.needsUpdate=!1,this.setSize(.2),this.visual.transform.visible=!1,this.uiTimeout=0,this.dirty=!1,this.hasInfo=!1,this.hasPos=!1,this.hasRot=!1,this.color="misc"}postDelta(t,e,s){this.visual.transform.visible&&this.dirty&&s.getChunkFromWorld(this.Zc[0],this.Zc[2]).deserialized&&(this.Zc[1]=s.getHeight(this.Zc[0],this.Zc[2])+.1*Math.random()+.1,this.visual.transform.rotation[1]+=Math.random()*Math.PI,an(this.visual.transform.position,this.Zc),this.visual.transform.data.multi.needsUpdate=!0,ca(this.visual.transform,!1),this.dirty=!1)}setDropInfo(t,e,s,i,n){let a,r;this.hasInfo=!0,this.party=i,this.partytimeout=n,this.droptype=Jo[t],this.tier=e,this.quality=s,"gold"==this.droptype?(this.name=this.tier+"c",this.setSize(.1),a="gold",this.color="gold",this.quality=100):(a=this.droptype+this.tier,r=Ry[a],r&&(this.name=en(this.droptype,this.tier)),"misc"!==this.droptype&&"rune"!==this.droptype&&"book"!==this.droptype?(this.color=up(s)[1],Qi.itemQualityPercent&&(this.name+=` ${this.quality}%`)):(this.color=this.droptype,this.quality=100));const o=r&&r.art||a;this.visual.transform.data.Fs=zo[o],rn(this.visual.transform.scale,20*zo[o][0],1,20*zo[o][1]),this.visual.transform.data.MT=[6.1*Math.random(),0,0,0],this.dirty=!0,this.visual.transform.visible=!0}onRemove(){this.visual.transform.data.multi.remove(this.visual.transform),fl.shift.down&&(oP.add(this),this.uiTimeout=5*Math.round(Ya.time/5)+10)}}const YP={0:{size:3,name:"King",stationary:!0,impatience:2,exp:2,aggroRange:42,drProtection:!0,statfactor:{0:40,10:40,11:40,1:220,15:4},skills:[0,3]},1:{size:2,name:"Warden",stationary:!0,impatience:2,exp:2,aggroRange:42,drProtection:!0,statfactor:{10:30,11:30,0:30,1:120,15:5},skills:[0,2,3,33]},2:{size:.9,name:"Grub",impatience:3,skills:[0]},3:{size:1.1,exp:1.1,name:"Skeleton",impatience:3,skills:[0]},4:{size:1.2,exp:1.1,name:"Zombie",impatience:3,skills:[0]},5:{size:1,exp:1.1,name:"Crawler",impatience:3,skills:[0]},6:{size:1,exp:1.1,name:"Skeleton Archer",impatience:3,statfactor:{10:.35,11:.35},skills:[5]},7:{size:1,exp:2,name:"Golem",impatience:3,statfactor:{10:2,11:2,6:1.5,15:.6},skills:[0]},8:{size:1,exp:1.5,name:"Warrior",impatience:3,statfactor:{6:1.5,15:1.2},skills:[0]},9:{size:1,exp:1,name:"Archer",impatience:3,statfactor:{6:.8,11:.35,10:.35,15:1.2},skills:[5]},10:{size:1.3,exp:2,name:"Warrior",impatience:3,statfactor:{6:3,15:1.3},skills:[0]},100:{size:1,exp:0,impatience:3,statfactor:{6:100,8:100}},11:{size:3,exp:0,impatience:3,name:"Skeleton Mage",statfactor:{6:3,7:3}}};class WP extends Wv{constructor(t){super({type:7,size:1,name:"Training Dummy",...t}),this.static=!0,this.class=5,this.behavior=YP[100]}}class QP extends Tg{constructor(t){super(t),this.block=this.mesh(this.transform,!1,null,2,mp.woodbrown),rn(this.block.scale,.3,3,.3),rn(this.block.position,0,-.5,0),this.chest=this.mesh(this.transform,!1,null,1.5,mp.woodbrown2,void 0,void 0,!0),rn(this.chest.scale,1,2,1),rn(this.chest.position,0,2,0),this.arms=this.mesh(this.transform,!1,null,1,mp.woodbrown,void 0,void 0),rn(this.arms.scale,3,.3,.3),rn(this.arms.position,0,2.1,0)}tickFixed(t,e,s){this.tickPushBack(t,e,s)}tickParts(t,e,s){rn(this.transform.rotation,2*-this.pushBack[1],this.entity.rot,2*this.pushBack[0])}getTopAbsolute(){return 5*this.entity.radius}}class KP extends WP{constructor(t){super({...t}),this.remakeTransform()}makeTransform(){this.visual=new QP({entity:this})}}class tB{constructor(t){this.entity=t,this.slots=new Map,this.gold=0,this.medals=0,this.setSize(0)}tickFixed(t,e,s){}setSize(t){this.size=Math.min(100,t)}setGold(t){this.gold=t}setMedals(t){this.medals=t}setItem(t,e){const s=new MM(e);return this.slots.set(t,s),s}removeItem(t){const e=this.slots.get(t);return this.slots.delete(t),e}async hydrateItems(t=!1){const e=[],s=[];if(this.slots.forEach((t,i)=>{t.dirty&&(t.dirty=!1,e.push(t.dbid),s.push(i))}),e.length){const i=await this.fetchData(e);this.compareData(i,s,0),this.postHydrate(s,t)}else t&&this.postHydrate(s,t)}hydrate(t){this.slots.has(t.slot)?this.slots.get(t.slot).hydrate(t):console.error("received hydration of unknown item")}postHydrate(t){}compareData(t,e,s){t.forEach(t=>{null!==t.slot&&(this.hydrate(t),e=e.filter(e=>e!==t.slot))}),e.forEach(t=>this.removeItem(t,s))}findFirstItemOfType(t,e){for(const s of this.slots)if(s[1].type==t&&s[1].tier==e)return s[1]}findFirstSlotOfType(t,e){let s=-1;for(const i of this.slots)i[1].type==t&&i[1].tier==e&&i[0]>s&&(s=i[0]);return s>=0?s:void 0}findByDbid(t){for(const e of this.slots)if(e[1]&&e[1].dbid===t)return e;throw"Item not found"}findFirstEmpty(){for(let t=0;t<this.size;++t)if(!this.slots.has(t))return t}}let eB=void 0;class sB extends tB{constructor(t){super(t),this.dirty=!1}tickFixed(t,e,s){super.tickFixed(t,e,s),this.dirty&&(this.hydrateItems(),this.dirty=!1)}setGold(t,e,s){super.setGold(t),SM(t,e,s,"$g"),me.set(t)}setMedals(t,e,s){super.setMedals(t),SM(t,e,s,"$m"),pe.set(t)}setItem(t,e,s){super.setItem(t,e).reason=s,this.dirty=!0}removeItem(t,e){$M(super.removeItem(t),e),void 0!==eB[t]&&(eB[t].set(void 0),this.dirty=!0,this.updateInventoryCounts())}hydrate(t){t.store=eB[t.slot],super.hydrate(t)}postHydrate(t){super.postHydrate(t),this.updateInventoryCounts()}updateInventoryCounts(){const t={};this.slots.forEach(e=>{const s=e.type+e.tier;t[s]=(t[s]||0)+(e.stacks?e.stacks:1)}),ve.set(t)}async fetchData(t){const e=await fetch("/api/item/get",{method:"POST",body:JSON.stringify({ids:t})}),s=await e.json();if(!s.fail)return s;console.error(s)}setSize(t){super.setSize(t),ge.update(t=>{for(let e=111;e>=0;--e)e>=101?t[e]||(t[e]=jt(void 0)):e>=this.size?t[e]&&delete t[e]:t[e]||(t[e]=jt(void 0));return eB=t,t})}}class iB extends Pg{constructor(t){super({Zj:t.colPrim||mp.archergreen,colEyes:t.colPrim&&mp.fireorange,...t}),!1!==t.quiver&&(this.quiver=this.mesh(this.chest,!1,null,.8,t.colPrim||mp.leather),rn(this.quiver.scale,.27,.5,.27),rn(this.quiver.position,0,-.15,-.7),rn(this.quiver.rotation,-.15,0,-.4),this.quiverTop=this.mesh(this.quiver,!1,null,.3,t.colSec||mp.linen),rn(this.quiverTop.scale,1.2,.8,1.2),rn(this.quiverTop.position,0,.8,0)),this.bow=this.mesh(this.hands[1],!1,"character/bow",1,t.colSec||mp.woodbrown),rn(this.bow.rotation,0,0,0),this.bow.position[2]=-.1,this.setShoulders(t.colSec||mp.woodbrown,.8),this.hands.forEach(e=>this.changeMeshBaseColor(e,t.colPrim||mp.leather)),this.capeswing=!1}tickParts(t,e,s){super.tickParts(t,e,s);const i=this.hands[1];if(i.visible&&(rn(i.rotation,.2,1.7+.15*this.cycleSin,.4),rn(i.position,.1+.2*this.cycleSin,-.3,.9),this.entity.target>0&&(i.position[0]=.2,i.position[1]+=.15,i.position[2]+=.1,i.rotation[0]+=.2,i.rotation[1]=1.8,i.rotation[2]-=.2),this.currentAnim))switch(this.currentAnim.id){case 5:{this.sheathe(!1);const t=br.easeOutQuad(gr(2*this.currentAnim.time,0,1));rn(i.rotation,1.2,2,.3),rn(i.position,.2,0,.8+.8*t),rn(this.hands[0].position,-.1-.6*Math.sin(2*t),.1*t,.8-.8*t),rn(this.chest.position,0,.6-.2*t,0),rn(this.chest.rotation,.2-.2*t,.3*t-.4,0);break}case 7:{this.sheathe(!1);const t=br.easeOutFlick(gr(2*(this.currentAnim.fract-.5),0,1));rn(i.rotation,1.2,2,.3+.1*t),rn(i.position,.2,.3*t,1.6),rn(this.hands[0].position,-.7,.1,.7*-t),rn(this.chest.position,0,.4,0),rn(this.chest.rotation,0,-.1,0);break}case 8:{this.sheathe(!1);const t=br.easeOutQuad(gr(2*this.currentAnim.fract,0,1));rn(this.hands[0].position,-.5-.3*t,.3*t-.3,.6*Math.sin(6.28*t)),rn(i.rotation,.2+.5*t,2,.3),rn(i.position,.2,.3*t-.4,.8+.8*t),this.chest.rotation[1]=0,this.chest.rotation[0]=.2*t-.2}}!this.walking&&this.legs[0].visible&&(this.legs[0].position[2]-=.3,this.legs[1].position[2]+=.1)}}class nB extends Wv{constructor(t){super({type:0,size:.9,...t}),this.exp=0,this.party=0,this.partyrole=0,this.prestige=0,this.prestigeRank=0,this.elo=0,this.eloRank=0,this.clan=void 0,this.clanRole=0}tickMovement(t,e,s,i,n){this.tickVelocity(t,e,s,i,n),this.tickTerrainCollisions(t,e,s,i,n),this.tickPropCollisions(t,e,s,i),this.clampWorldPos()}tickVelocity(t,e,s,i,n){this.onGround?(this.stats.alive&&i>0&&n>0?(this.vel[1]=9,this.onGround=!1):this.vel[1]=-25*t,this.horizontalSteer(n,e,s)):(this.vel[1]=Math.max(-60,this.vel[1]-25*t),this.stats.alive&&0===this.vel[0]&&0===this.vel[2]&&this.horizontalSteer(.5*n,e,s))}tickTerrainCollisions(t,e,s,i,n){const a=Ya.clampV3(un([0,0,0],this.Zc,this.vel,t)),r=this.getWorldYBody(Ya,a[0],a[2]);if(0!==this.vel[0]||0!==this.vel[2]||this.vel[1]>0||!this.onGround){let e=Ya.getNormal(a[0],a[2]);if(r>=a[1]||this.onGround&&e[1]>.65&&a[1]-r<.05){a[1]=r;const s=this.onGround;if(this.onGround=e[1]>.65,this.onGround)!s&&this.vel[1]<0&&this.onFallLanding(-this.vel[1]);else{s&&(e=an(Ka,e),e[1]=0,vn(e,e));const i=yn(this.vel,e),n=hn(Ka,e,i);dn(this.vel,this.vel,n),un(a,this.Zc,this.vel,t)}}else this.onGround=!1;an(this.Zc,a)}else this.onGround=a[1]<r,an(this.Zc,a)}tickPropCollisions(t,e,s,i){this.setAABB();const n=Ya.triangleGrid.queryAABB(this.aabb);for(let t=0;t<n.length;++t){const e=n[t],s=Ir(sr,e[0],e[1],e[2],this.Zc),i=pn(this.Zc,sr);if(i<this.radius*this.radius){if(yn(this.vel,e[3])<0){const t=dn(Ka,this.Zc,s);vn(t,t);const e=yn(this.vel,t),n=this.radius-Math.sqrt(i);if(t[1]>.65){this.onGround||(this.onGround=!0,this.onFallLanding(-this.vel[1]));const t=hn(tr,Wa,e);dn(this.vel,this.vel,t),un(this.Zc,this.Zc,Wa,n)}else{const s=hn(tr,t,e);dn(this.vel,this.vel,s),un(this.Zc,this.Zc,t,n)}}}}}setExp(t){this.exp=t}setParty(t,e){this.party=t,this.partyrole=e}setPrestige(t){return t!==this.prestige&&(this.prestige=t,this.prestigeRank=ZM(t),!0)}setElo(t){return t!==this.elo&&(this.elo=t,this.eloRank=ly(t),!0)}setClan(t,e=0){this.clan=t,this.clanRole=e}getNearbyPartyMembers(t){const e=[];return this.stats.alive&&e.push(this),this.party>0&&Ya.entities.type[0].forEach(s=>{if(s.party==this.party&&s!=this&&s.stats.alive){pn(t,s.Zc)<1e3&&e.push(s)}}),e}calculatePartyItemFind(t){let e=0;return t.forEach(t=>{e+=t.stats.getStat(18)}),e/Math.max(1,t.length)/100}canCombatInteract(t){return!Ya.mode.pvpprotect||this.hostility(t)<2||0!==t.type||Math.abs(this.pvpLevel-t.pvpLevel)<=5+Math.max(this.skills.pvpBoundModifier,t.skills.pvpBoundModifier)}canSupportInteract(t){return 0==this.hostility(t)&&(!Ya.mode.pvpprotect||0!==t.type||Math.abs(this.pvpLevel-t.pvpLevel)<=5)}onFallLanding(t){}updatePvPLevel(t){const e=Math.round(t**.83333/3.6);this.pvpLevel=Math.max(Math.min(45,e),this.level)}setLevel(t){super.setLevel(t),this.updatePvPLevel(this.stats.getStat(24))}}class aB extends Pg{constructor(t){super({Zj:mp.mageblue,...t}),this.staff=this.mesh(this.chest,!1,null,.8,mp.woodbrown),rn(this.staff.scale,.2,2,.2),rn(this.staff.position,0,0,-.6),rn(this.staff.rotation,0,0,.4),this.staffhead=this.mesh(this.staff,!1,null,.3,mp.linen),rn(this.staffhead.scale,1.2,.6,1.2),rn(this.staffhead.position,0,0,0),this.setShoulders(mp.leather),this.capeswing=!1}}class rB extends Pg{constructor(t){super({Zj:mp.shamanblue,...t}),this.back=this.mesh(this.chest,!1,null,.8,mp.bone),rn(this.back.scale,1,1,.2),rn(this.back.position,0,.1,-.6),rn(this.back.rotation,0,0,.25*Math.PI),this.kilt=this.mesh(this.chest,!1,null,.6,mp.bone),rn(this.kilt.scale,.5,.7,.1),this.kilt.position[1]=-.65,this.kilt.position[2]=.5,this.weapon=this.mesh(this.hands[0],!1,null,.5,mp.woodbrown),rn(this.weapon.scale,.25,1,.25),this.hammerhead=this.mesh(this.weapon,!1,null,.4,mp.darksteel),rn(this.hammerhead.scale,1.6,.5,2.6),rn(this.hammerhead.position,0,.6,0),this.sheathedWeaponPos=[0,0,-.7],this.unsheathedWeaponPos=[0,0,0],this.sheathe(!1),this.setShoulders(mp.leather)}setCape(t,e){super.setCape(t,e),void 0!==this.cape&&!1!==t&&rn(this.cape.position,0,.2,-.75)}}class oB extends Pg{constructor(t){super({Zj:t.Zj||t.colPrim||mp.warbrown,colEyes:t.colPrim&&mp.fireorange,...t}),this.weapon=this.mesh(this.hands[0],!1,"character/sword",.7,t.colSec||mp.tealsteel),this.shield=this.mesh(this.hands[1],!1,"character/shield",.8,t.colSec||mp.darksteel),this.setShoulders(t.colSec||mp.greysteel),this.sheathedWeaponPos=[0,0,-.5],this.unsheathedWeaponPos=[0,.8,0],this.sheathe(!1)}}const lB=[oB,aB,iB,rB];class cB extends nB{constructor(t){super(t)}tickFixed(t,e,s){super.tickFixed(t,e,s),this.tickMovement(t,this.steer,this.rot,this.jump,this.speed)}setClass(t){t!==this.class&&(super.setClass(t),this.remakeTransform())}makeTransform(t){this.visual=new(t||lB[this.class])({entity:this}),this.prestige>0&&this.setPrestige(this.prestige,!0),this.level>=10&&this.setLevel(this.level),this.elo>1500&&this.setElo(this.elo,!0)}setPrestige(t,e){if(super.setPrestige(t)||e){if(!this.visual)return;const t=Math.min(this.prestigeRank,10),e=this.prestigeRank-11;t<1?(this.visual.setCrown(!1),this.visual.setHeadgear(!1)):(this.visual.setHeadgear(e<0?pp[Math.min(4,t-1)]:mp.darkgold),t>5?this.visual.setCrown(pp[t-6]):this.visual.setCrown(!1)),e<0?this.visual.setGem(!1):this.visual.setGem(fp[e],e>0?1:.8)}}setElo(t,e){if(super.setElo(t)||e){if(void 0===this.visual)return;const e=ly(t);this.visual.setShoulders(gp[Math.min(e,1)],.65+.08*e,e>0&&gp[e])}}setLevel(t){super.setLevel(t),void 0!==this.visual&&(t>=15?this.visual.setCape(0===this.faction?mp.vanguard:mp.bloodlust,t>=25?1:.5):this.visual.setCape(!1))}setParty(t,e){this.uiFrameDirty=!0,this.buffDisplayDirty=!0,super.setParty(t,e)}}const dB=t=>1+.21*(t-1);class hB extends cB{constructor(t){super(t),Ya.setPlayer(this),this.parsedFirstInput=!1,this.skills.isPlayer=!0,this.skills.clearSkillInfo(),this.inventory=new sB(this),this.partyInfoUpdateTimer=new id(0,1),this.heartBeatTimer=new id(0,1),this.lastNetRot=this.rot,this.torch=void 0,this.inputTicksPassed=0,this.inputTicksSinceLastPosUpdate=0,this.inputTicksSinceLastRotUpdate=0}tickFixed(t,e,s){super.tickFixed(t,e,s),this.inventory.tickFixed(t,e,s)}preFixed(t,e,s){super.preFixed(t,e,s),(fl.turnright.down||fl.turnleft.down)&&(pl[0]=kr(pl[0]+3*Qi.mouseSensitivity*t*((fl.turnleft.down?1:0)-(fl.turnright.down?1:0)))),this.handleInput(t,e,s)}postFixed(t,e,s){super.postFixed(t,e,s)}handleInput(t,e,s){this.inputTicksPassed++;let i=!1,n=!1,a=!1,r=!1,o=!1,l=!1,c=this.steer[0],d=this.steer[1],h=this.jump,u=this.rot;const m=c,p=d,f=h,g=u;this.hasMovementOverride()?(this.buffMovementOverride(t,e,s),c=this.steer[0],d=this.steer[1],h=this.jump,u=this.rot):(c=(fl.left.down?1:0)+(fl.right.down?-1:0),d=(fl.fwd.down||fl.lmb.down&&fl.rmb.down?1:0)+(fl.back.down?-1:0),h=fl.jump.down?1:0,u=Qi.lockedcamera&&fl.lmb.down||fl.rmb.down||fl.turnleft.down||fl.turnright.down?pl[0]:this.rot),c===m&&d===p||(n=c!==m,a=d!==p,this.setSteer(c,d)),h!==f&&(this.setJump(h),o=!0);const v=Er(u,this.lastNetRot);this.inputTicksSinceLastRotUpdate++,u!==g&&this.setRot(u),u!==this.lastNetRot&&((0!==this.steer[0]||0!==this.steer[1])&&Math.abs(v)>.1||this.inputTicksSinceLastRotUpdate>10||a||n||Math.abs(v)>.2)&&(this.lastNetRot=g,i=!0);const y=this.getStatBasedMoveSpeed();y!=this.speed&&(this.setSpeed(y),r=!0),this.inputTicksSinceLastPosUpdate++,this.inputTicksSinceLastPosUpdate>600?l=!0:this.inputTicksSinceLastPosUpdate>40?0===this.steer[0]&&0===this.steer[1]||(l=!0):this.inputTicksSinceLastPosUpdate>20&&(0===this.steer[0]&&0===this.steer[1]||!(i||n||a)||(l=!0)),(i||n||a||r||o||l)&&this.sendInput(i,n,a,r,o,l)}sendInput(t,e,s,i,n,a){const r={uint8s:[],int8s:[],uint16s:[],doubles:[]};r.uint8s.push(Math.min(254,this.inputTicksPassed)),n&&r.uint8s.push(this.jump),e&&!s?r.int8s.push(this.steer[0]):(e||s)&&r.int8s.push(this.steer[0],this.steer[1]),t&&(this.inputTicksSinceLastRotUpdate=0,r.doubles.push(this.rot)),a&&(this.inputTicksSinceLastPosUpdate=0,r.doubles.push(this.Zc[0],this.Zc[1],this.Zc[2])),i&&r.uint16s.push(this.speed),fm(mo.clientPlayerInput.packData(r)),this.inputTicksPassed=0}handleMovementData(t){an(this.Zc,t.Zc),an(this.vel,t.vel)}updateCharPanel(){(Qi.charpanelOpen||Qi.skillmenuOpen)&&this.statsDirty&&(this.statsDirty=!1,Ne.update(t=>(Array.from(this.stats.stat).forEach(e=>t[e[0]]=e[1]),t[29]=this.pvpLevel,t)))}updatePartyInfo(t){if(this.partyInfoUpdateTimer.done(t)){this.partyInfoUpdateTimer.reset(t);const e=this.getNearbyPartyMembers(this.Zc),s=dB(e.length);Vt.update(t=>(t.nearby=e.length,t.exprate=Math.round(100*s),t.itemfind=Math.round(100*s+100*this.calculatePartyItemFind(e)),t))}}handleCamera(t){if(ja.rotation[0]=gr(.7*pl[1],-1.5,1.5),!fl.lmb.down&&(0!==this.steer[0]||0!==this.steer[1])){let e=Er(this.rot,pl[0])*t*2;0!==e&&(Math.abs(e)>.03*t?(e=e>0?Math.max(e,.6*t):Math.min(e,-.6*t),pl[0]-=e):pl[0]=this.rot)}ja.rotation[1]=pl[0],ca(ja,!1),rn(Xa.transform.position,0,1,-Qi.cameraZoom),Xa.updateGlobalWorldPos(),ja.position[1]+=Math.max(0,Ya.getHeight(gr(Xa.worldPosition[0],0,Ya.bounds),gr(Xa.worldPosition[2],0,Ya.bounds))-Xa.worldPosition[1])+2*Math.tan(Xa.fov*Math.PI/180/2)*Xa.near,ca(ja,!1),Xa.updateMatrixWorldCamView(!1)}handleHeartbeat(t){let e=this.stats.getResource(6)/(.5*this.stats.getStat(6));this.heartBeatTimer.done(t)&&e>0&&e<1&&(e=(Math.max(0,Math.min(1,e))+.5)/1.5,nl({id:"ui/lowhpheart"}),this.heartBeatTimer.reset(t,e))}handleTorch(t){}postDelta(t,e,s){this.updateCharPanel(),this.updatePartyInfo(e),super.postDelta(t,e,s),an(ja.position,this.mount?this.mount.transform.position:this.visual.transform.position),this.handleCamera(t),this.handleHeartbeat(e),this.handleTorch(e)}updateTransformRotation(t){this.stats.alive&&(this.updateMountRotation(t),this.buffs.movementOverride.size||!fl.rmb.down?this.visual.transform.rotation[1]=this.rot:this.visual.transform.rotation[1]=pl[0],this.visual.transform.rotation[1]+=this.mountRotAdd)}setLevel(t){super.setLevel(t),this.uiFrameDirty=!0}onRemove(){super.onRemove(),Ya.removePlayer(this)}setExp(t){super.setExp(t),xe.update(e=>(e.current=t,e.max=zf(this.level),e))}setClan(t,e=0){super.setClan(t,e),qe.set(t)}}class uB extends ay{constructor(t){super({type:4,size:1.2,name:"Merchant",...t})}}class mB extends Pg{constructor(t){super({Zj:mp.darkskin,...t}),this.robe=this.mesh(this.chest,!1,"character/robe",1.2,mp.linen),rn(this.robe.scale,1.2,1.2,1.2),rn(this.robe.rotation,0,0,0),rn(this.robe.position,0,-.9,.05),this.hat=this.mesh(this.chest,!1,null,.8,mp.emerald),rn(this.hat.position,0,.6,0),rn(this.hat.scale,1.2,.6,1.2),this.brochure=this.mesh(this.chest,!1,null,.3,mp.gold),rn(this.brochure.position,0,.55,.6),rn(this.brochure.rotation,0,0,.78),rn(this.brochure.scale,.3,.3,.2),this.scroll=this.mesh(this.hands[0],!1,null,.4,mp.paper),rn(this.scroll.position,0,0,0),rn(this.scroll.scale,.25,.25,1.2)}tickFixed(){}tickParts(t,e,s){super.tickParts(t,e,s),rn(this.hands[0].position,-.8,-.2,.7),rn(this.hands[0].rotation,1.8+.1*this.cycleSin,0,0)}}class pB extends uB{constructor(t){super({...t,...tn.npcs.merchant})}makeTransform(){this.visual=new mB({entity:this})}}const fB={origin:[0,0,0],dir:[0,-1,0],invDir:[0,0,0]},gB=(t,e,s,i,n,a,r)=>{rn(t.origin,e,s,i),rn(t.dir,n,a,r),gn(t.invDir,t.dir)};class vB extends Wv{constructor(t){const e=YP[t.spawn.meta[0]||0];super({type:1,name:e.name,size:(t.spawn.meta[5]||100)/100*e.size,...t}),this.behavior=e,this.stationary=this.behavior.stationary||!1,this.groundHeight=0}tickFixed(t,e,s){if(this.horizontalSteer(this.speed,this.steer,this.rot),super.tickFixed(t,e,s),this.stats.alive){un(this.Zc,this.Zc,this.vel,t),this.groundHeight=s.getHeight(this.Zc[0],this.Zc[2]);const e=this.Zc[1]-this.radius,i=e+1,n=i-e;Gv[0]=Gv[3]=this.Zc[0],Gv[5]=Gv[2]=this.Zc[2],Gv[4]=i,Gv[1]=e;const a=s.triangleGrid.queryAABB(Gv);if(a.length>0){gB(fB,this.Zc[0],i,this.Zc[2],0,-n,0);for(let t=0;t<a.length;++t){const e=a[t],s=Fr(e[0],e[1],e[2],fB.origin,fB.dir,!1);if(s<1/0){const t=i-s*n;t>this.groundHeight&&(this.groundHeight=t)}}}}this.Zc[1]-=10*t,this.Zc[1]-this.radius<=this.groundHeight&&(this.Zc[1]=this.groundHeight+this.radius)}}class yB extends Pg{constructor(t){t.colPrim=t.colPrim||mp.emerald,t.colSec=t.colSec||mp.bone2,t.sounds=Bg,super({Zj:t.colPrim,colEyes:mp.evilred,...t}),this.head=this.chest,this.changeMeshBaseColor(this.head,t.colSec),this.chest=this.mesh(this.transform,!0,null,2,t.colSec,null,t.shader,!0),ra(this.head,this.chest),rn(this.head.scale,.4,.2,.6),rn(this.head.position,0,.6,0),this.hands.forEach(t=>{ra(t,this.chest)}),this.legs.forEach(e=>{rn(e.scale,.7,.7,.7),this.changeMeshBaseColor(e,t.colPrim)})}tickParts(t,e,s){super.tickParts(t,e,s),this.hands.forEach(t=>{t.position[1]*=.8,t.position[2]*=.8,t.position[1]+=.5}),this.legs.forEach((t,e)=>{t.position[1]-=0,t.position[0]+=e?.4:-.4}),rn(this.chest.scale,1.8,2,1.8),this.chest.position[1]+=1}getTopAbsolute(){return 5.5*this.entity.radius}}class bB extends oB{constructor(t){super({Zj:t.colPrim||mp.warden,...t}),this.setCrown(t.colSec||mp.gold),this.setShoulders(t.colSec||mp.gold,1.1),this.setCape(t.colSec||mp.gold,.7)}}const xB={death:{id:"skeleton/death",rnd:2},hurt:{id:"skeleton/hurt",rnd:2},melee:{delay:.3,distance:5,rnd:3,id:"melee/sword"},aggro:{id:"skeleton/aggro",rnd:1},idle:{id:"skeleton/idle",rnd:2}};class wB extends oB{constructor(t){t.colPrim=t.colPrim||mp.bone,t.colSec=t.colSec||mp.bone2,t.sounds=xB,super({Zj:t.colPrim,colEyes:mp.evilred,...t}),this.setShoulders(t.colSec,.5),this.legs.forEach(e=>{rn(e.scale,.4,.4,.4),this.changeMeshBaseColor(e,t.colSec)}),this.hands.forEach(e=>this.changeMeshBaseColor(e,t.colSec)),this.removeMesh(this.shield,!0),this.shield=void 0}tickParts(t,e,s){super.tickParts(t,e,s),cn(this.chest.rotation,.1*(Math.sin(1.8*e)*Math.cos(12*e)*.3+.3*Math.sin(1.4*e))-.2,.15*(Math.sin(1.3*e)+.6*Math.sin(2.4*e)),.2*(Math.sin(.2*e)+.5*Math.sin(1.9*e))),this.hands.forEach(t=>{t.rotation[0]+=.2*(Math.sin(2*e)*Math.cos(9*e)+Math.sin(1.3*e)),t.rotation[1]+=.3*(Math.sin(2*e-2)*Math.cos(7*e)+Math.sin(.8*e))}),this.legs.forEach((t,s)=>{t.rotation[1]+=.3*Math.sin(.2*e-s),t.position[0]+=s?.15:-.15})}}class kB extends iB{constructor(t){t.colPrim=t.colPrim||mp.bone,t.colSec=t.colSec||mp.bone2,t.sounds=xB,super({Zj:t.colPrim,colEyes:mp.evilred,quiver:!1,...t}),this.setShoulders(t.colSec,.5),this.legs.forEach(e=>{rn(e.scale,.4,.4,.4),this.changeMeshBaseColor(e,t.colSec)}),this.hands.forEach(e=>this.changeMeshBaseColor(e,t.colSec))}tickParts(t,e,s){super.tickParts(t,e,s),cn(this.chest.rotation,.1*(Math.sin(1.8*e)*Math.cos(12*e)*.3+.3*Math.sin(1.4*e))-.2,.15*(Math.sin(1.3*e)+.6*Math.sin(2.4*e)),.2*(Math.sin(.2*e)+.5*Math.sin(1.9*e))),this.hands.forEach(t=>{t.visible&&cn(t.rotation,.2*(Math.sin(2*e)*Math.cos(9*e)+Math.sin(1.3*e)),.3*(Math.sin(2*e-2)*Math.cos(7*e)+Math.sin(.8*e)),0)}),this.legs.forEach((t,s)=>{t.visible&&(t.rotation[1]+=.3*Math.sin(.2*e-s),t.position[0]+=s?.15:-.15)})}}class $B extends aB{constructor(t){t.colPrim=t.colPrim||mp.bone,t.colSec=t.colSec||mp.bone2,t.sounds=xB,super({Zj:t.colPrim,colEyes:mp.evilred,quiver:!1,...t}),this.setShoulders(t.colSec,.5),this.legs.forEach(e=>{rn(e.scale,.4,.4,.4),this.changeMeshBaseColor(e,t.colSec)}),this.hands.forEach(e=>this.changeMeshBaseColor(e,t.colSec))}tickParts(t,e,s){super.tickParts(t,e,s),cn(this.chest.rotation,.1*(Math.sin(1.8*e)*Math.cos(12*e)*.3+.3*Math.sin(1.4*e))-.2,.15*(Math.sin(1.3*e)+.6*Math.sin(2.4*e)),.2*(Math.sin(.2*e)+.5*Math.sin(1.9*e))),this.hands.forEach(t=>{t.visible&&cn(t.rotation,.2*(Math.sin(2*e)*Math.cos(9*e)+Math.sin(1.3*e)),.3*(Math.sin(2*e-2)*Math.cos(7*e)+Math.sin(.8*e)),0)}),this.legs.forEach((t,s)=>{t.visible&&(t.rotation[1]+=.3*Math.sin(.2*e-s),t.position[0]+=s?.15:-.15)})}}class SB extends oB{constructor(t){super({Zj:mp.warden,...t}),this.setHeadgear(mp.gold),this.setShoulders(mp.gold,1),this.setCape(mp.darksteel,.5)}}const MB=[bB,SB,Zg,wB,Fg,yv,kB,yB,oB,iB,bB,$B];class EB extends vB{constructor(t){super(t),this.spawn=t.spawn,this.remakeTransform()}makeTransform(t,e){this.visual=t?new t({...e,entity:this}):new(MB[this.spawn.meta[0]||0]||MB[0])({entity:this,level:this.spawn.meta[1]||0,colPrim:this.spawn.meta[2]&&sh(this.spawn.meta[2],0),colSec:this.spawn.meta[3]&&sh(this.spawn.meta[3],0)})}}class CB extends cB{constructor(t){super(t)}}class TB extends ay{constructor(t){super({type:9,size:1.2,name:"Sage",...t})}}class IB extends Pg{constructor(t){super({Zj:mp.paleskin,colEyes:mp.teal,...t}),this.robe=this.mesh(this.chest,!1,"character/robe",1.2,mp.leather),rn(this.robe.scale,1.2,1.2,1.2),rn(this.robe.rotation,0,0,0),rn(this.robe.position,0,-.9,.05),this.scroll=this.mesh(this.hands[1],!1,null,.4,mp.woodbrown),rn(this.scroll.position,0,0,0),rn(this.scroll.scale,.2,.2,3),this.orb=this.mesh(this.scroll,!0,null,.5,mp.teal),rn(this.orb.position,0,0,-.5),rn(this.orb.scale,2,2,.1)}tickFixed(){}tickParts(t,e,s){super.tickParts(t,e,s),rn(this.orb.rotation,0,0,.3*e),rn(this.hands[1].position,.8,-.2,.7),rn(this.hands[1].rotation,1.8,0,0)}}class PB extends TB{constructor(t){super({...t,...tn.npcs.sage})}interact(t){this.interactions[0].choices[0]=this.interactions[0].choices[0].replace("$1",200*Ya.player.level),super.interact(t)}makeTransform(){this.visual=new IB({entity:this})}}class BB extends ay{constructor(t){super({type:5,size:1.5,name:"Stash",...t})}}class FB extends Tg{constructor(t){super(t),this.chest=this.mesh(this.transform,!1,null,1.5,mp.woodbrown),rn(this.chest.scale,2,1,1),rn(this.chest.position,0,-.3,0),this.brochure=this.mesh(this.transform,!1,null,.5,mp.gold),rn(this.brochure.position,0,-.3,.5),rn(this.brochure.rotation,0,0,.78),rn(this.brochure.scale,.3,.3,.2)}tickParts(t,e,s){}}class zB extends BB{constructor(t){super({...t,...tn.npcs.stash})}makeTransform(){this.visual=new FB({entity:this})}}class UB extends Pg{constructor(t){super({Zj:mp.richpurple,...t}),this.backpack=this.mesh(this.chest,!1,null,1,mp.leather),rn(this.backpack.scale,1.1,.8,.6),rn(this.backpack.position,0,.2,-.7),this.scroll=this.mesh(this.hands[0],!1,null,.5,mp.paper),rn(this.scroll.position,-.4,0,0),rn(this.scroll.scale,.8,.25,1)}tickParts(t,e,s){super.tickParts(t,e,s),this.hands[0].position[2]+=.6,cn(this.hands[0].rotation,-2.1,-4.1,-.2)}}class DB extends _y{constructor(t){super({...t,...tn.npcs.trader}),this.hydratedItems=[],this.itemStores=this.items.map((t,e)=>{const s=new MM,i=jt();return s.hydrate({type:t.item.type,tier:t.item.tier,stacks:t.stacks,store:i}),s.traderslot=e,this.hydratedItems.push(s),i})}makeTransform(){this.visual=new UB({entity:this})}}const AB=new Map([[6,GP],[2,jP],[7,KP],[4,pB],[0,cB],[9,PB],[5,zB],[8,DB],[3,VP],[1,EB]]),RB=(t,e)=>0==t?e==Ya.playerId?hB:CB:AB.get(t),LB=[-0,-1,-0];class OB{constructor(t){this.bounds=0,this.chunkAmount=0,this.entities={array:[],map:new Map,type:{}},AB.forEach((t,e)=>this.entities.type[e]=[]),this.chunks=[],this.unloadedChunks=new Set,this.currentlyLoadingChunks=new Set,this.finishedLoadingChunks=new Set,this.time=this.daytime=this.accum=-0,this.timestep=1/60,this.tickId=0,this.data=void 0,this.spawns={array:[],map:new Map,types:new Map},this.settingsCache=new Map,this.file="",this.triangleGrid=void 0,this.setOctrees()}load(t,e){this.id=t,this.file=e}tickIdToTimestamp(t){return t*this.timestep}setTimeFromTickId(t){return this.tickId=t,this.time=this.tickIdToTimestamp(t),this.tickId}tickDelta(t,e){const s=this.time+e;for(let e=0,i=this.chunks.length;e<i;++e)this.chunks[e].tickDelta(t,s,this);for(let e=this.entities.array.length-1;e>=0;--e)this.entities.array[e].preDelta(t,s,this),this.entities.array[e].tickDelta(t,s,this),this.entities.array[e].postDelta(t,s,this)}tickFixed(t,e=1){this.daytime=(this.time/600+.9)%1;for(let s=0,i=this.chunks.length;s<i;++s)this.chunks[s].tickFixed(t,this.time,e);for(let s=this.entities.array.length-1;s>=0;--s)this.entities.array[s].preFixed(t,this.time,this,e),this.entities.array[s].tickFixed(t,this.time,this,e),this.entities.array[s].postFixed(t,this.time,this,e)}createEntity(t,e,s){return(s=s||{}).spawn=this.spawns.map.get(e),s.id=e,new(RB(t,e))(s)}addEntity(t){if(void 0!==t&&void 0!==t.type)if(this.entities.array.length>=32766)console.log("Error: tried addint entity but we already are at the maximum");else{if(!this.isEntityInWorld(t)&&!this.isEntityIdTaken(t.id))return this.entities.array.push(t),this.entities.map.set(t.id,t),this.entities.type[t.type].push(t),t;console.log("Error: Entity in world or entity id taken")}else console.log("Error: tried adding an entity of unknown type to the world")}removeEntity(t){if(void 0===t)return!1;this.entities.map.delete(t.id);let e=this.entities.array.indexOf(t);return e>-1&&this.entities.array.splice(e,1),e=this.entities.type[t.type].indexOf(t),e>-1&&this.entities.type[t.type].splice(e,1),t.onRemove(),t}isEntityIdTaken(t){return this.entities.map.has(t)}isEntityIdAllowed(t){return!0}isEntityInWorld(t){return this.entities.array.indexOf(t)>=0}entity(t){return this.entities.map.get(t)}getEntityById(t){return this.entities.map.get(t)}serialize(){return this.serializedData=po.world.encode(this.data),this.serializedData}getHeight(t,e){t=gr(t,0,this.bounds),e=gr(e,0,this.bounds);const s=this.chunks[Math.min(Math.floor(t/64),this.chunkAmount-1)+Math.min(Math.floor(e/64),this.chunkAmount-1)*this.chunkAmount];return s.deserialized?s.getHeight(t>=this.bounds?63:t%64,e>=this.bounds?63:e%64):-0}getNormal(t,e){t=gr(t,0,this.bounds),e=gr(e,0,this.bounds);const s=this.chunks[Math.min(Math.floor(t/64),this.chunkAmount-1)+Math.min(Math.floor(e/64),this.chunkAmount-1)*this.chunkAmount];if(s.deserialized){const i=3*s.getTriangleIndex(t>=this.bounds?63:t%64,e>=this.bounds?63:e%64);rn(LB,s.normals[i],s.normals[i+1],s.normals[i+2])}else rn(LB,0,0,0);return LB}clampV3(t){return t[0]=gr(t[0],0,this.bounds),t[2]=gr(t[2],0,this.bounds),t}deserialize({serialized:t,isUpdate:e}){this.parse({deserialized:po.world.decode(t),isUpdate:e})}getChunkFromWorld(t,e){return t=gr(t,0,this.bounds),e=gr(e,0,this.bounds),t=Math.min(Math.floor(t/64),this.chunkAmount-1),e=Math.min(Math.floor(e/64),this.chunkAmount-1),this.chunks[t+e*this.chunkAmount]}getChunk(t,e){return t=gr(t,0,this.chunkAmount),e=gr(e,0,this.chunkAmount),this.chunks[t+e*this.chunkAmount]}getChunkUnsafe(t,e){if(!(t>=this.chunkAmount||e>=this.chunkAmount))return this.chunks[t+e*this.chunkAmount]}setMode(t){this.mode=ep[this.id]||ep[t||"Jw"]}parse({deserialized:t,isUpdate:e}){if(e||this.destroy(),this.data=t,this.deserialized=!0,this.settingsCache.clear(),this.setMode(this.getSetting("mode")),!e){this.chunkAmount=this.data.chunkAmount,this.bounds=64*this.chunkAmount,this.setOctrees(),this.unloadedChunks.clear(),this.finishedLoadingChunks.clear(),this.currentlyLoadingChunks.clear(),this.chunks=[];for(let t=0;t<this.chunkAmount;++t)for(let e=0;e<this.chunkAmount;++e){const s=e+t*this.chunkAmount;this.unloadedChunks.add(s),this.chunks.push(new _P({id:s,x:e,z:t,world:this}))}for(let t=0;t<this.chunkAmount;++t)for(let e=0;e<this.chunkAmount;++e){const s=this.getChunkUnsafe(e,t);s.left=this.getChunkUnsafe(e-1,t),s.right=this.getChunkUnsafe(e+1,t),s.front=this.getChunkUnsafe(e,t+1),s.back=this.getChunkUnsafe(e,t-1),s.frontRight=this.getChunkUnsafe(e+1,t+1),s.backLeft=this.getChunkUnsafe(e-1,t-1)}}this.spawns.array.forEach(t=>{t.entity>0&&this.removeEntity(this.getEntityById(t.entity))}),this.spawns.types.forEach(t=>t.clear()),this.spawns.array.length=0,this.spawns.map.clear(),this.spawns.types.set(2,new Map),this.data.spawns.forEach((t,e)=>{const s={entity:0};Fh(s,t),this.spawns.map.has(s.id)?console.error(`Duplicate spawn id ${s.id} - spawns must have unique id`):(this.spawns.map.set(s.id,s),this.spawns.types.has(s.class)||this.spawns.types.set(s.class,new Map),this.spawns.types.get(s.class).set(s.id,s)),this.spawns.array[e]=s})}getSetting(t){if(!this.settingsCache.has(t)){const e=this.data.settings.find(e=>e.id===t);this.settingsCache.set(t,e?e.value:void 0)}return this.settingsCache.get(t)}destroy(){this.deserialized&&console.log("destroying world"),this.deserialized=!1,this.chunks.forEach(t=>{t.destroy()}),this.chunks=[];for(let t=this.entities.array.length-1;t>=0;t--)this.removeEntity(this.entities.array[t]);this.spawns.array.length=0,this.spawns.map.clear(),this.spawns.types.clear(),this.data=void 0,this.bounds=1,this.setOctrees()}setOctrees(){this.triangleGrid=new NP(this.bounds,this.bounds,this.bounds,50,50,50)}rebuildTriangleOctree(){this.triangleGrid.clear(),this.chunks.forEach(t=>{for(const e in t.props)t.props[e].forEach(e=>{e.loaded=!1,e.loadGeometry(this,t)})})}getPlayerByName(t){const e=t.toLowerCase();return this.entities.type[0].find(t=>t.name&&t.name.toLowerCase()===e)}onChunkBeginLoading(t){this.unloadedChunks.has(t.id)&&(this.unloadedChunks.delete(t.id),this.currentlyLoadingChunks.add(t.id))}onChunkFinishLoading(t){this.currentlyLoadingChunks.has(t.id)&&(this.currentlyLoadingChunks.delete(t.id),this.finishedLoadingChunks.add(t.id),this.finishedLoadingChunks.size===this.chunks.length&&this.onAllChunksFinishLoading())}onAllChunksFinishLoading(){}}const _B=(t,e,s="")=>{Jt.update(i=>(i.push({text:t,icon:e,css:s}),i))},NB={2:"On cooldown.",3:"Can only be cast on enemy.",4:"Can only be cast on ally.",5:"Not enough mana.",6:"Out of range.",10:"Target is dead.",7:"Can't do that during movement.",8:"Can't cast while busy.",9:"You are incapacitated.",11:"Can't do that in combat.",12:"Can't cast this right now.",13:"Level difference is too big.",14:"Target is not in line of sight."},ZB=new Map;ZB.set(16,t=>{if(US("system",`You have learned ${tn.items.book[t[0]].name} Lv. ${t[1]+1}`,!0),jy(24,100),0===t[1]&&Pf.get(t[0]).autoSkillbar){const e=Qi.skillbarsettings[Ya.player.name].findIndex(t=>-1===t.id);e>=0&&He[e].update(e=>(e.id=t[0],e))}}).set(15,t=>{Ya.player.skills.add(t[0],Sh(t[2]),Sh(t[3]),t[1])}).set(17,t=>{Ya.player.skills.remove(t[0])}).set(1,t=>{Kt.set({type:"error",text:NB[t[0]]})}).set(18,t=>{Ya.player.setExp(t[1]);const e=Ya.entity(t[2]);e&&tP(an([0,0,0],e.visualPosition),t[0]),Qi.chat[0]&&US("exp",`Gained ${t[0]} experience ${e?"from "+e.name:""}.\n      ${Ya.player.exp}/${zf(Ya.player.level)}`,!0)}).set(19,t=>{Ya.player.setExp(t[1]),US("error",`Lost ${t[0]} experience. ${Ya.player.exp}/${zf(Ya.player.level)}`,!0)}).set(20,t=>{Ya.player.setExp(t[0])}).set(43,t=>{const e=Ya.entity(t[1]);nl({id:"ui/fame",pitch:-1}),e&&eP(an([0,0,0],e.visualPosition),t[0]),Qi.chat[11]&&US("fame",`Gained $fm${t[0]} fame ${e?"from "+e.name:""} (${t[2]} recent kills).`,!0)}).set(44,t=>{nl({id:"ui/fame",pitch:-1}),Qi.chat[11]&&US("fame",`Gained $fm${t[0]} salary from the war.`,!0)}).set(45,t=>{nl({id:"ui/war",pitch:-1}),Qi.chat[11]&&US("fame",`War: Gained $fm${t[0]} spoils of war (Fight ${t[1]>0?"Victory!":"Loss!"}).`,!0)}).set(46,t=>{Ce.set(),Te.set(!1),1===t[0]&&US("system","War: You have left the war due to inactivity.",!0)}).set(21,t=>{const e=Ya.getEntityById(t[0]);e&&e.interact(t)}).set(22,t=>{te.set(void 0)}).set(23,t=>{const e=Qr.from(t).toString();US("system",e,!0)}).set(24,t=>{const e=Qr.from(t).toString();US("error",e,!0)}).set(48,t=>{const e=Qr.from(t.slice(1)).toString();Qm(tn.ui.party.summon,tn.ui.party.onSummon.replace("$1",e),[{text:tn.ui.accept,nocombat:!0,fun:()=>{Jm("summonaccept",e)}},{text:tn.ui.decline,fun:()=>{}}])}).set(25,t=>{const e=Qr.from(t.slice(1)).toString();Qm(tn.ui.party.invite,tn.ui.party.onInvite.replace("$1",e),[{text:tn.ui.accept,fun:()=>{Jm("partyaccept",t[0]+"")}},{text:tn.ui.decline,fun:()=>{Jm("partydecline",t[0]+"")}}])}).set(26,t=>{const e=Qr.from(t).toString();Qm(tn.ui.party.link,tn.ui.party.onLink+`<p><input readonly type="text" id='partylink' value='${e}'></p>`,[{text:tn.ui.party.copyLink,fun:()=>{document.getElementById("partylink").select(),document.execCommand("copy")}},{text:tn.ui.close}])}).set(27,t=>{Ya.player.inventory.setItem(t[0],t[1],t[2])}).set(28,t=>{Ya.player.inventory.removeItem(t[0],t[1])}).set(29,t=>{Ya.player.inventory.setGold(t[0],t[1],t[2])}).set(30,t=>{Ya.player.inventory.setMedals(t[0],t[1],t[2])}).set(31,t=>{fe.set(t[0]),SM(t[0],t[1],12,"$sp")}).set(32,t=>{we.set(0==t[0]?void 0:t[0]-1)}).set(47,t=>{ke.set(0==t[0]?void 0:t[0]-1)}).set(33,t=>{Pe.set(t[0])}).set(34,t=>{qB(t,Be)}).set(35,t=>{ze.update(t=>!t),US("inv",tn.ui.merchant.auctioncancel,!0)}).set(36,t=>{qB(t.slice(1),Ae),De.set({gold:t[0]})}).set(37,t=>{De.set({gold:t[0]})}).set(38,t=>{De.set(!1)}).set(39,t=>{Re.set(!0),jy(22,100)}).set(40,t=>{Re.set(!1)}).set(41,t=>{Le.set(!0)}).set(42,t=>{Le.set(!1)}).set(50,t=>{const e=Ya.entity(t[0]);void 0!==e&&(e.party=1)}).set(49,t=>{const e=t[0];e<1e3&&e>0&&Kt.set({type:"error",timer:500,text:e}),e<=5&&e>0?nl({id:"ui/countdown",pitch:-1}):0===e?nl({id:"ui/battlestart",pitch:-1}):1e3===e?nl({id:"ui/victory",pitch:-1}):2e3===e&&nl({id:"ui/loss",pitch:-1})});const qB=(t,e)=>{e.update(e=>(e.length=0,t.forEach(t=>{e.push(new MM(t))}),e))},GB=(t,e)=>{Ya.player&&ZB.get(t)(e)},HB=new Map;HB.set(0,(t,e,s)=>{}).set(1,(t,e,s)=>{Ya.removeEntity(t)}).set(2,(t,e,s)=>{e[1]>0&&e[1]!==t.target&&t.visual&&t.visual.onAggro(),t===Ya.player&&ux(e[1])}).set(3,(t,e,s)=>{for(let s=1;s<e.length;s+=2)t.stats.setResource(e[s],e[s+1])}).set(6,(t,e,s)=>{for(let s=1;s<e.length;s+=2)t.stats.setResource(e[s],e[s+1])}).set(4,(t,e,s)=>{for(let s=1;s<e.length;s+=2)t.stats.setStat(e[s],e[s+1])}).set(5,(t,e,s)=>{if(t==Ya.player&&(jy(6,100),t.skills.cd(e[1],Ya.time,Sh(e[2])),e[5]>0&&t.skills.globalCd(Sh(e[4]),Sh(e[5]))),!s&&t.visual&&!t.visual.inFog){const s=Pf.get(e[1]);s.castLen&&t.visual.currentAnim||!s.fx.animCast||t.visual.anim(s.fx.animCast),s.fx.weaponRibbon&&t.visual.weapon&&ld({parent:t.visual.weapon,...s.fx.weaponRibbon}),s.fx.effectCast&&s.fx.effectCast.forEach(e=>{_d(e,t.visual.transform).data.creature=t}),t.visual.onEffort()}}).set(22,(t,e,s)=>{t.skills.startTimedCast(Pf.get(e[1]),Sh(e[2]),e[3],Sh(e[4])),e[5]>0&&t.skills.globalCd(Sh(e[2]),Sh(e[5]))}).set(23,(t,e,s)=>{t.skills.interruptTimedCast(!0,1===e[1])}).set(24,(t,e,s)=>{t.skills.finishTimedCast(Sh(e[1]))}).set(7,(t,e,s)=>{const i=Ya.getEntityById(e[3]),n=e[4];void 0!==i&&"Damage"===Qi.dpsmeterMode&&s$(i,e[1]),t===Ya.player?Qi.showIncomingDamage&&YI([-.3,-.3,.5],e[1],n,e[5],!0,0):i===Ya.player&&YI(t.visualPosition,e[1],n,e[5],!1,t.visual.getTopAbsolute()),n>0&&t.stats.changeResource(6,-e[1]),e[6]>0&&(t.stats.refreshCombatTimer(Ya.time,e[6]),i&&i.stats.refreshCombatTimer(Ya.time,e[6]));const a=Pf.get(e[2]);if(!s&&n>0)if(1!==n)i&&i.visual&&t.visual&&!t.visual.inFog&&(a.fx.impactSound&&nl({...sp(a.fx.impactSound,i),transform:t.visual.transform,pitch:a.fx.impactSoundPitchCaster?i.visual.getScaleFactor():1}),JB(a,i,t),t.visual.onHurt(e[1]/t.stats.getStat(6),n));else if(i&&i.visual&&t.visual&&!t.visual.inFog&&!i.visual.inFog){const e=_d(yp.physBlock);e.data.creature=t,dn(e.data.dir=[0,0,0],i.visual.transform.position,t.visual.transform.position),vn(e.data.dir,e.data.dir),un(e.position,t.visual.transform.position,e.data.dir,t.radius)}}).set(8,(t,e,s)=>{const i=Ya.getEntityById(e[3]);void 0!==i&&"Healing"===Qi.dpsmeterMode&&s$(i,e[1]),i&&e[5]>0&&i.stats.refreshCombatTimer(Ya.time,e[5]),t===Ya.player?Qi.showIncomingHeal&&WI([.3,-.3,.5],e[1],e[4],!0,0):i===Ya.player&&WI(t.visualPosition,e[1],e[4],!1,t.visual.getTopAbsolute()),t.stats.changeResource(6,e[1]);const n=Pf.get(e[2]);!s&&i&&i.visual&&t.visual&&!t.visual.inFog&&JB(n,i,t)}).set(9,(t,e,s)=>{t.stats.changeResource(7,e[1]);const i=Ya.getEntityById(e[3]);if(t===Ya.player&&Qi.showIncomingHeal&&KI([.35,-.2,.5],e[1],e[4],!0),t.visual&&!t.visual.inFog){_d(yp.gainMana,t.visual.transform).data.creature=t}const n=Pf.get(e[2]);!s&&i&&i.visual&&t.visual&&!t.visual.inFog&&!i.visual.inFog&&JB(n,i,t)}).set(10,(t,e,s)=>{0==e[1]?t.stats.alive&&(t.stats.die(),t==Ya.player&&Ya.mode.allowRespawn?Qm(tn.ui.death.death,tn.ui.death.deathmsg,[{text:tn.ui.death.respawn,fun:()=>{Jm("respawn","")}}]):t.id==Ya.player.target&&jy(7,100)):t.stats.alive||t.stats.respawn()}).set(11,(t,e,s)=>{t.setFaction(e[1])}).set(14,(t,e,s)=>{t.setLevel(e[1])}).set(16,(t,e,s)=>{t.setClass(e[1])}).set(12,(t,e,s)=>{t.setName(Qr.from(e.slice(1)).toString())}).set(13,(t,e,s)=>{t.setClan(e.length>2?Qr.from(e.slice(2)).toString():void 0,e[1])}).set(15,(t,e,s)=>{if(t.setLevel(e[1]),Qi.chat[6]){const s=`${t==Ya.player?"You":jB(e[0])} leveled up to ${e[1]}!`;US("lvlup",s),t==Ya.player&&(jy(16,100),Pf.forEach(t=>{t.class===Ya.player.class&&t.minlevel===e[1]&&(jy(19,100),_B(`<span class=textprimary><b class=textgreen>${tn.items.book[t.id].name}</b><br>Skill book available at the Trader!</span>`,`skills/${t.id}.${Po}`,"border primary"))}))}t.visual&&!t.visual.inFog&&_d(yp.levelUp,t.visual.transform)}).set(17,(t,e,s)=>{t.buffs.setBuff(e[1],e[2],e[3],Sh(e[4]),Sh(e[5]),e[6],e[7],e.length>8?e.slice(8):void 0)}).set(19,(t,e,s)=>{e[2]===Ya.player.id?QI(t.visualPosition,t.visual.getTopAbsolute(),!1):Qi.showIncomingDamage&&Ya.player===t&&QI([-.3,-.3,.5],0,!0)}).set(18,(t,e,s)=>{t.buffs.removeBuff(e[1],e[2])}).set(20,(t,e,s)=>{const i=Pf.get(e[1]),n=new id(Ya.time,Sh(e[3])-Ya.time+.2);Oh(e[0],e[2],i,n)}).set(21,(t,e,s)=>{const i=Pf.get(e[1]),n=Sh(e[2])-Ya.time,a=new id(Ya.time,n),r=e.length-3,o=r>6?2+(r-6)/4:2,l=[],c=[];for(let t=3;t<3+3*o;t+=3)l.push([kh(e[t],768),kh(e[t+1],768),kh(e[t+2],768)]);if(o>2)for(let t=3+3*o;t<e.length;++t)c.push(e[t]/65535);_h(l,c,i,a)}).set(25,(t,e,s)=>{t.setParty(e[1],e[2])}).set(26,(t,e,s)=>{!1===t.hasInfo&&t.setDropInfo(e[1],e[2],e[3],e[4],e[5])}).set(27,(t,e,s)=>{t.setPosLock(e[1],e[2],e[3])});const XB=(t,e,s)=>{const i=Ya.getEntityById(e[0]);void 0===i||HB.get(t)(i,e,s)},jB=t=>{const e=Ya.getEntityById(t);return""+(t>0?e?e.name:"unknown":"nobody")},JB=(t,e,s)=>{t.fx.effectDirImpact&&e&&t.fx.effectDirImpact.forEach(t=>{const i=_d(t);i.data.creature=s,dn(i.data.dir=[0,0,0],e.visual.transform.position,s.visual.transform.position),vn(i.data.dir,i.data.dir),un(i.position,s.visual.transform.position,i.data.dir,s.radius)}),t.fx.effectImpact&&t.fx.effectImpact.forEach(t=>{const e=_d(t);e.data.creature=s,an(e.position,s.visual.transform.position)}),t.fx.effectTarget&&t.fx.effectTarget.forEach(t=>{_d(t,s.visual.transform).data.creature=s})},VB=[te,Pe,De,Le,Re],YB=[Yt,Be,Qt],WB=[oe,le],QB=()=>{WB.forEach(t=>t.update(t=>(t.visible=!1,t))),Vt.update(t=>(t.membercount=0,t.role=0,Qi.partyinfo=t,t)),VB.forEach(t=>t.set()),YB.forEach(t=>t.set([]))};class KB extends OB{constructor(t){super(t),this.smoothtime=0,this.loading=!1,this.mapinfo={wars:[]},this.playerId=0,this.removePlayer(),this.netTimeoutTimer=new id,this.party=new Map,this.partyIterator=0,pm("close",()=>{console.log("Disconnected"),this.onDisconnect()}),this.netData=[],pm(mo.serverEntityDelta.header,t=>{this.netData.push(mo.serverEntityDelta.decode(t))}),this.chatData=[],pm(mo.serverChat.header,t=>{this.chatData.push(t)}),this.systemMessageData=[],pm(mo.serverSystemMessage.header,t=>{this.systemMessageData.push(t)}),this.partyData=void 0,pm(mo.serverPartyUpdate.header,t=>{this.partyData=t}),pm(mo.serverPartyPositions.header,t=>{t=mo.serverPartyPositions.decode(t).members,this.party.forEach(e=>{const s=t.find(t=>t.entityid===e.id);s&&(e.Zc[0]=s.Zc[0],e.Zc[1]=s.Zc[1])})}),pm(mo.serverWarUpdate.header,t=>{Ce.update(e=>{const s=mo.serverWarUpdate.decode(t);return void 0===e||0===s.contributors.length&&(s.contributors=e.contributors),s})}),pm(mo.serverMapUpdate.header,t=>{this.mapinfo=mo.serverMapUpdate.decode(t)}),pm(mo.ping.header,t=>{km(mo.ping.decode(t))})}handlePartyData(t){let e;this.party.forEach(t=>{t.found=!1}),(t=mo.serverPartyUpdate.decode(t)).members.forEach(t=>{if(this.party.has(t.name)){const e=this.party.get(t.name);t.entityid!==this.player.id&&(e.local=t.world===this.id,e.unitStore.update(e=>(e.id=t.entityid,e.name=t.name,e.level=t.level,e.class=t.class,e.world=t.world,e.party=this.player.party,e.faction=this.player.faction,e.role=t.role,e))),e.id=t.entityid,e.found=!0}else this.party.set(t.name,{id:t.entityid,found:!0,Zc:[0,0],local:t.world===this.id,name:t.name,buffStore:t.entityid==this.player.id?de:jt([]),unitStore:t.entityid==this.player.id?oe:jt({id:t.entityid,name:t.name,level:t.level,class:t.class,world:t.world,role:t.role,party:this.player.party,faction:this.player.faction,type:0,visible:!0,alive:!0,powertype:!1,range:!1})});t.entityid==this.player.id&&(e=t)}),this.party.forEach((t,e)=>{t.found||this.party.delete(e)}),Yt.set(Array.from(this.party.values()).filter(t=>Qi.showSelfInParty||t.id!=this.player.id)),e?Vt.update(s=>(s.membercount=t.members.length,s.role=e.role,s.queues=t.queues,Qi.partyinfo=s,s)):Vt.update(t=>(t.membercount=0,t.role=0,t.queues=[],Qi.partyinfo=t,t))}handleChatData(t){t.forEach(t=>{(t=mo.serverChat.decode(t)).messages.forEach(t=>{if(""==t.from){const e=t.message.split(" ");tn&&tn.ui.messages[e[0]]&&(t.message=tn.ui.messages[e[0]],e.splice(1).forEach((e,s)=>{t.message=t.message.replace("$"+(s+1),e)})),t.channel="notice"}else if(Qi.chatbubbles){const e="to"==t.channel?this.player.name:t.from,s=this.getPlayerByName(e);if(s){let i;switch(t.channel){case"from":case"to":i=ZI.chatWhisper;break;case"clan":i=ZI.chatClan;break;case"party":i=ZI.chatParty;break;default:case"global":i=ZI.chatGlobal}s.speech(e+": "+t.message,i)}}"GM"===t.clan&&"global"===t.channel&&(t.channel="GM"),US(t.channel,t.message,"system"==t.channel||"notice"==t.channel,t.from,t.faction,t.class,t.level,t.subscribed,t.id)})})}handleSystemMessageData(t){t.forEach(t=>{(t=mo.serverSystemMessage.decode(t)).messages.forEach(t=>{US(t.type,t.message,!0)})})}handleEntityCreation(t){for(let e=0,s=t.log.length;e<s;++e){const s=t.log[e];0===s.type&&(this.isEntityIdTaken(s.data[0])||this.addEntity(this.createEntity(s.data[1],s.data[0],{world:this})))}}handleEntityInput(t){for(let e=0;e<t.inputs.length;++e){const s=t.inputs[e],i=this.entity(s.id);void 0!==i&&i!==this.player&&(Ba(i.steer,s.steer),i.setRot(s.rot),i.setJump(s.jump),i.setSpeed(s.speed))}}handleEntityMovements(t){for(let e=0;e<t.movements.length;++e){const s=t.movements[e],i=this.entity(s.id);if(void 0!==i){const n=t.inputs[e];i.handleMovementData(s,n)}}}handleEntityLog(t){const e=!1;for(let s=0,i=t.log.length;s<i;++s)XB(t.log[s].type,t.log[s].data,e)}handlePersonalLog(t){for(let e=0,s=t.logPersonal.length;e<s;++e)GB(t.logPersonal[e].type,t.logPersonal[e].data)}pollNetData(t){const e=this.netData[0];if(void 0!==e)return Math.abs(e.tickId-t)>5&&(t=this.setTimeFromTickId(e.tickId)),e.tickId<=t?(this.netData.shift(),e):void 0}tickFixed(t,e){if(!this.deserialized)return;const s=this.pollNetData(e);void 0!==s&&(this.handleEntityCreation(s),this.handleEntityInput(s)),super.tickFixed(t),void 0!==s&&(this.handleEntityLog(s),this.handlePersonalLog(s),this.handleEntityMovements(s)),this.handleNetTimeouts()}tick(t){this.netData.length>5&&(this.accum+=(this.netData.length-5)*this.timestep),t=Math.min(t,1),this.accum+=t;let e=0;for(;this.accum>this.timestep;)this.accum-=this.timestep,++e,this.setTimeFromTickId(this.tickId+1),this.tickFixed(this.timestep,this.tickId);1!==e&&Math.abs(this.accum)<.1*this.timestep&&(this.accum=0),this.tickDelta(t,this.accum),this.setSmoothTime(t),this.handleMiscNetData(),!this.loading&&this.deserialized&&wm(this.time)}handleNetTimeouts(){if(this.player&&(this.netTimeoutTimer.done(this.time)||this.time<this.netTimeoutTimer.start)){this.netTimeoutTimer.reset(this.time-.5,1);for(let t=this.entities.array.length-1;t>=0;t--){const e=this.entities.array[t];e!=this.player&&(pn(e.Zc,this.player.Zc)<1e4?e.netDeletion.reset(this.time,2):e.netDeletion.end>0&&e.netDeletion.done(this.time)&&(this.removeEntity(e),e.id==this.player.target&&this.player.setTarget(0)))}}}handleMiscNetData(){if(this.player&&(this.partyData&&(this.handlePartyData(this.partyData),this.partyData=void 0),this.chatData.length&&(this.handleChatData(this.chatData),this.chatData.length=0),this.systemMessageData.length&&(this.handleSystemMessageData(this.systemMessageData),this.systemMessageData.length=0),this.player.party>0))if(Qi.partyBuffLimitUpdateRate){const t=Array.from(this.party.values())[this.partyIterator++%this.party.size];if(t){const e=this.entity(t.id);void 0!==e&&e.id!==this.player.id&&(e.buffDisplayDirty=!0)}}else this.entities.type[0].forEach(t=>{t.party===this.player.party&&(t.buffDisplayDirty=!0)})}removeEntity(t){const e=super.removeEntity(t);if(e){const t=this.party.get(e.name);void 0!==t&&(t.unitStore.update(t=>(t.timedSkill=void 0,t.timedCast=void 0,t.alive=!0,t.range=!1,t.mp=t.hp=t.hpMax=t.mpMax=0,t)),t.buffStore.set([]))}return e}load(t,e,s){super.load(t,e),this.deserialized=!1,this.playerId=s,ne.set(1),this.loading=!0,fetch("/worlddata/"+this.file+"/world?v=4597824",{cache:"default"}).then(t=>{t.ok&&t.arrayBuffer().then(t=>{this.deserialize({serialized:Qr(t)})})})}parse({deserialized:t,isUpdate:e,sendToServer:s}){t&&super.parse({deserialized:t,isUpdate:e}),Ou(this,!e),s&&(this.serialize(),this.sendToServer())}onDisconnect(){this.netData.length=0,this.partyData=void 0,this.party.clear()}destroy(){super.destroy(),_u(),IP(this)}setPlayer(t){this.player=t,$e.set(!0),QB()}removePlayer(t){this.player==t&&(this.player=void 0,this.playerId=0,$e.set(!1),Ce.set(),Te.set(!1),this.mapinfo.wars.length=0)}setSmoothTime(t){const e=this.smoothtime-this.time;Math.abs(e)>1?this.smoothtime=this.time:this.smoothtime+=e>.05?.5*t:e<-.05?2*t:t}onChunkFinishLoading(t){if(super.onChunkFinishLoading(t),this.loading)if(0==this.currentlyLoadingChunks.size)ne.set(!1),this.loading=!1,Kt.set({type:"Tz",text:this.file.replace(/_/g," "),time:5e3}),TP(this);else{const t=this.finishedLoadingChunks.size+this.currentlyLoadingChunks.size;ne.set(Math.max(1,Math.round(this.finishedLoadingChunks.size/t*100)))}}}const tF={guardstone:{port:5002},headless:{port:5003},faivel:{port:5004},arena3v3:{port:5006},arena5v5:{port:5007},dev:{port:5008}},eF=()=>{pm(mo.serverOnClientConnect.header,t=>{const e=mo.serverOnClientConnect.decode(t);Ya.load(e.world,e.file,e.playerId),Ya.setTimeFromTickId(e.tickId),document.cookie="party=",US("log","Entering "+(e.world.charAt(0).toUpperCase()+e.world.slice(1)))}),pm("close",t=>{switch(Ya.destroy(),t.code){default:case 1006:case 4002:ne.set("autoReconnect");break;case 4003:ne.set("askReconnect");break;case 4004:window.location.href="/"}})},sF=t=>{Ya.deserialized||ne.set(!0),vm(),gm(t.target)};let iF=0;const nF=t=>{if(Ya&&Ya.deserialized&&Ya.player){wl(),MP(t),Ya.tick(t),EP(t),Lu(t),Ru(),CP(t);const e=cr;ju(e-iF),iF=e}else Ya&&Ya.tick(t)};var aF=Object.freeze({__proto__:null,init:eF,enter:sF,tick:nF});const rF={};let oF;const lF=(t,e)=>{rF[t]=e,e.init&&e.init()},cF=(t,e)=>{rF[oF]&&rF[oF].exit&&rF[oF].exit(),oF=t,ae.set(t),rF[oF].enter&&rF[oF].enter(e)},dF=t=>{oF&&rF[oF].tick&&rF[oF].tick(t)};let hF;window.onload=()=>{mr(),xl(),Du(),SP(),lr(new KB({})),console.log("Hordes 0.36.4597 Live"),lF("play",aF),Xe.subscribe(t=>{t&&void 0!==tF[t]?cF("play",{target:"hordes.io:"+tF[t].port}):ne.set("autoReconnect")}),fF()};let uF=0,mF=!1;const pF=new id(0,2e4),fF=()=>{const t=am();dr(t);const e=(t-(hF||1e3/60))/1e3;hF=t,dF(e),RP(e,t,Ya.loading),requestAnimationFrame(fF),pF.done(t)&&(t>1e5&&!mF&&t-uF>18e4?(mF=!0,uF=t,Ue.set(!0)):mF&&(mF=!1,Ue.set(!1)),Bf("session","minutetick","sec",Math.round(t/1e3)),pF.reset(t))}
